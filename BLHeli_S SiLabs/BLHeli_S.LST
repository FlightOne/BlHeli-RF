AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE     1


MACRO ASSEMBLER AX51 V3.15.3.0
OBJECT MODULE PLACED IN Output\W_H_90_REV16_77.OBJ
ASSEMBLER INVOKED BY: C:\keil_v5\c51\bin\AX51.exe BLHeli_S.asm DEFINE(ESCNO=23) DEFINE(MCU_48MHZ=1) DEFINE(FETON_DELAY=9
                      0) OBJECT(Output\W_H_90_REV16_77.OBJ) DEBUG MACRO NOMOD51 COND SYMBOLS PAGEWIDTH(120) PAGELENGTH(65) 

LOC    OBJ             LINE     SOURCE

                          1     $nomod51 
                          2     ;**** **** **** **** ****
                          3     ;
                          4     ; BLHeli program for controlling brushless motors in multirotors
                          5     ;
                          6     ; Copyright 2011, 2012 Steffen Skaug
                          7     ; This program is distributed under the terms of the GNU General Public License
                          8     ;
                          9     ; This file is part of BLHeli.
                         10     ;
                         11     ; BLHeli is free software: you can redistribute it and/or modify
                         12     ; it under the terms of the GNU General Public License as published by
                         13     ; the Free Software Foundation, either version 3 of the License, or
                         14     ; (at your option) any later version.
                         15     ;
                         16     ; BLHeli is distributed in the hope that it will be useful,
                         17     ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                         18     ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                         19     ; GNU General Public License for more details.
                         20     ;
                         21     ; You should have received a copy of the GNU General Public License
                         22     ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                         23     ;
                         24     ;**** **** **** **** ****
                         25     ;
                         26     ; This software was initially designed for use with Eflite mCP X, but is now adapted to 
                               copters/planes in general
                         27     ;
                         28     ; The software was inspired by and started from from Bernard Konze's BLMC: http://home.v
                               ersanet.de/~bkonze/blc_6a/blc_6a.htm
                         29     ; And also Simon Kirby's TGY: https://github.com/sim-/tgy
                         30     ;
                         31     ; This file is best viewed with tab width set to 5
                         32     ;
                         33     ; The code is designed for multirotor applications, running damped light mode
                         34     ;
                         35     ; The input signal can be Normal (1-2ms), OneShot125 (125-250us), OneShot42 (41.7-83.3us
                               ) or Multishot (5-25us) at rates as high as allowed by the format.
                         36     ; Three Dshot signal rates are also supported, Dshot150, Dshot300 and Dshot600. A 48MHz 
                               MCU is required for Dshot600.
                         37     ; The code autodetects normal, OneShot125, Oneshot42, Multishot or Dshot.
                         38     ;
                         39     ; The first lines of the software must be modified according to the chosen environment:
                         40     ; ESCNO EQU "ESC"
                         41     ; MCU_48MHZ EQU "N"
                         42     ; FETON_DELAY EQU "N"
                         43     ; 
                         44     ;**** **** **** **** ****
                         45     ; Revision history:
                         46     ; - Rev16.0 Started. Built upon rev 14.5 of base code
                         47     ;           Using hardware pwm for very smooth throttle response, silent running and sup
                               port of very high rpms
                         48     ;           Implemented reverse bidirectional mode
                         49     ;           Implemented separate throttle gains fwd and rev in bidirectional mode
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE     2

                         50     ;           Implemented support for Oneshot42 and Multishot
                         51     ; - Rev16.1 Made low rpm power limiting programmable through the startup power parameter
                         52     ; - Rev16.2 Fixed bug that prevented temperature protection
                         53     ;           Improved robustness to very high input signal rates
                         54     ;           Beeps can be turned off by programming beep strength to 1
                         55     ;           Throttle cal difference is checked to be above required minimum before stori
                               ng. Throttle cal max is not stored until successful min throttle cal
                         56     ; - Rev16.3 Implemented programmable temperature protection
                         57     ;           Improved protection of bootloader and generally reduced risk of flash corrup
                               tion
                         58     ;           Some small changes for improved sync hold
                         59     ; - Rev16.4 Fixed bug where bootloader operation could be blocked by a defective "eeprom
                               " signature
                         60     ; - Rev16.5 Added support for DShot150, DShot300 and DShot600
                         61     ; - Rev16.6 Fixed signal detection issue of multishot at 32kHz
                         62     ;           Improved bidirectional mode for high input signal rates
                         63     ; - Rev16.7 Addition of Dshot commands for beeps and temporary reverse direction (largel
                               y by brycedjohnson)
                         64     ;           
                         65     ;
                         66     ;**** **** **** **** ****
                         67     ; Minimum 8K Bytes of In-System Self-Programmable Flash
                         68     ; Minimum 512 Bytes Internal SRAM
                         69     ;
                         70     ;**** **** **** **** ****
                         71     ; Master clock is internal 24MHz oscillator (or 48MHz, for which the times below are hal
                               ved)
                         72     ; Although 24/48 are used in the code, the exact clock frequencies are 24.5MHz or 49.0 M
                               Hz
                         73     ; Timer 0 (41.67ns counts) always counts up and is used for
                         74     ; - RC pulse measurement
                         75     ; Timer 1 (41.67ns counts) always counts up and is used for
                         76     ; - DShot frame sync detection
                         77     ; Timer 2 (500ns counts) always counts up and is used for
                         78     ; - RC pulse timeout counts and commutation times
                         79     ; Timer 3 (500ns counts) always counts up and is used for
                         80     ; - Commutation timeouts
                         81     ; PCA0 (41.67ns counts) always counts up and is used for
                         82     ; - Hardware PWM generation
                         83     ;
                         84     ;**** **** **** **** ****
                         85     ; Interrupt handling
                         86     ; The C8051 does not disable interrupts when entering an interrupt routine.
                         87     ; Also some interrupt flags need to be cleared by software
                         88     ; The code disables interrupts in some interrupt routines
                         89     ; - Interrupts are disabled during beeps, to avoid audible interference from interrupts
                         90     ;
                         91     ;**** **** **** **** ****
                         92     ; Motor control:
                         93     ; - Brushless motor control with 6 states for each electrical 360 degrees
                         94     ; - An advance timing of 0deg has zero cross 30deg after one commutation and 30deg befor
                               e the next
                         95     ; - Timing advance in this implementation is set to 15deg nominally
                         96     ; - Motor pwm is always damped light (aka complementary pwm, regenerative braking)
                         97     ; Motor sequence starting from zero crossing:
                         98     ; - Timer wait: Wt_Comm                 15deg   ; Time to wait from zero cross to actual
                                commutation
                         99     ; - Timer wait: Wt_Advance              15deg   ; Time to wait for timing advance. Nomin
                               al commutation point is after this
                        100     ; - Timer wait: Wt_Zc_Scan              7.5deg  ; Time to wait before looking for zero c
                               ross
                        101     ; - Scan for zero cross                 22.5deg ; Nominal, with some motor variations
                        102     ;
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE     3

                        103     ; Motor startup:
                        104     ; There is a startup phase and an initial run phase, before normal bemf commutation run 
                               begins.
                        105     ;
                        106     ;**** **** **** **** ****
                        107     ; List of enumerated supported ESCs
 0001                   108     A_                      EQU 1   ; X  X  RC X  MC MB MA CC    X  X  Cc Cp Bc Bp Ac Ap
 0002                   109     B_                      EQU 2   ; X  X  RC X  MC MB MA CC    X  X  Ap Ac Bp Bc Cp Cc
 0003                   110     C_                      EQU 3   ; Ac Ap MC MB MA CC X  RC    X  X  X  X  Cc Cp Bc Bp
 0004                   111     D_                      EQU 4   ; X  X  RC X  CC MA MC MB    X  X  Cc Cp Bc Bp Ac Ap    
                               Com fets inverted
 0005                   112     E_                      EQU 5   ; L1 L0 RC X  MC MB MA CC    X  L2 Cc Cp Bc Bp Ac Ap    
                               A with LEDs
 0006                   113     F_                      EQU 6   ; X  X  RC X  MA MB MC CC    X  X  Cc Cp Bc Bp Ac Ap
 0007                   114     G_                      EQU 7   ; X  X  RC X  CC MA MC MB    X  X  Cc Cp Bc Bp Ac Ap    
                               Like D, but noninverted com fets
 0008                   115     H_                      EQU 8   ; RC X  X  X  MA MB CC MC    X  Ap Bp Cp X  Ac Bc Cc
 0009                   116     I_                      EQU 9   ; X  X  RC X  MC MB MA CC    X  X  Ac Bc Cc Ap Bp Cp
 000A                   117     J_                      EQU 10  ; L2 L1 L0 RC CC MB MC MA    X  X  Cc Bc Ac Cp Bp Ap    
                               LEDs
 000B                   118     K_                      EQU 11  ; X  X  MC X  MB CC MA RC    X  X  Ap Bp Cp Cc Bc Ac    
                               Com fets inverted
 000C                   119     L_                      EQU 12  ; X  X  RC X  CC MA MB MC    X  X  Ac Bc Cc Ap Bp Cp
 000D                   120     M_                      EQU 13  ; MA MC CC MB RC L0 X  X     X  Cc Bc Ac Cp Bp Ap X    L
                               ED
 000E                   121     N_                      EQU 14  ; X  X  RC X  MC MB MA CC    X  X  Cp Cc Bp Bc Ap Ac
 000F                   122     O_                      EQU 15  ; X  X  RC X  CC MA MC MB    X  X  Cc Cp Bc Bp Ac Ap    
                               Like D, but low side pwm
 0010                   123     P_                      EQU 16  ; X  X  RC MA CC MB MC X     X  Cc Bc Ac Cp Bp Ap X
 0011                   124     Q_                      EQU 17  ; Cp Bp Ap L1 L0 X  RC X     X  MA MB MC CC Cc Bc Ac   L
                               EDs
 0012                   125     R_                      EQU 18  ; X  X  RC X  MC MB MA CC    X  X  Ac Bc Cc Ap Bp Cp
 0013                   126     S_              EQU 19          ; X  X  RC X  CC MA MC MB    X  X  Cc Cp Bc Bp Ac Ap   L
                               ike O, but com fets inverted
 0014                   127     T_                      EQU 20  ; RC X  MA X  MB CC MC X     X  X  Cp Bp Ap Ac Bc Cc
 0015                   128     U_                      EQU 21  ; MA MC CC MB RC L0 L1 L2    X  Cc Bc Ac Cp Bp Ap X     
                               Like M, but with 3 LEDs
 0016                   129     V_                      EQU 22  ; Cc X  RC X  MC CC MB MA    X  Ap Ac Bp X  X  Bc Cp
 0017                   130     W_                      EQU 23  ; RC MC MB X  CC MA X X      X  Ap Bp Cp X  X  X  X     
                               Tristate gate driver
                        131     
                        132     
                        133     ;**** **** **** **** ****
                        134     ; Select the port mapping to use (or unselect all for use with external batch compile fi
                               le)
                        135     ;ESCNO EQU A_
                        136     ;ESCNO EQU B_
                        137     ;ESCNO EQU C_
                        138     ;ESCNO EQU D_
                        139     ;ESCNO EQU E_
                        140     ;ESCNO EQU F_
                        141     ;ESCNO EQU G_
                        142     ;ESCNO EQU H_
                        143     ;ESCNO EQU I_
                        144     ;ESCNO EQU J_
                        145     ;ESCNO EQU K_
                        146     ;ESCNO EQU L_
                        147     ;ESCNO EQU M_
                        148     ;ESCNO EQU N_
                        149     ;ESCNO EQU O_
                        150     ;ESCNO EQU P_
                        151     ;ESCNO EQU Q_
                        152     ;ESCNO EQU R_
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE     4

                        153     ;ESCNO EQU S_
                        154     ;ESCNO EQU T_
                        155     ;ESCNO EQU U_
                        156     ;ESCNO EQU V_
                        157     ;ESCNO EQU W_
                        158     
                        159     ;**** **** **** **** ****
                        160     ; Select the MCU type (or unselect for use with external batch compile file)
                        161     ;MCU_48MHZ EQU  0
                        162     
                        163     ;**** **** **** **** ****
                        164     ; Select the fet deadtime (or unselect for use with external batch compile file)
                        165     ;FETON_DELAY EQU 15     ; 20.4ns per step
                        166     
                        167     
                        168     ;**** **** **** **** ****
                        169     ; ESC selection statements
                        170     IF 23 == A_
                                ;$include (A.inc) ; Select pinout A
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "A"
                    +1          ; X  X  RC X  MC MB MA CC    X  X  Cc Cp Bc Bp Ac Ap
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 1 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE     5

                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE     6

                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE     7

                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE     8

                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE     9

                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    10

                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    11

                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    12

                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    13

                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    14

                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    15

                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    16

                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    17

                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 1 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#A_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#A_L_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#A_L_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#A_L_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#A_L_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#A_L_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#A_L_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#A_L_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#A_L_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#A_L_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#A_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#A_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#A_H_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#A_H_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#A_H_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#A_H_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#A_H_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#A_H_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#A_H_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#A_H_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#A_H_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#A_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    18

                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     5               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 1 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          Rcp_In          EQU     5       ;i
                    +1          ;                       EQU     4       ;i 
                    +1          Mux_C           EQU     3       ;i
                    +1          Mux_B           EQU     2       ;i
                    +1          Mux_A           EQU     1       ;i
                    +1          Comp_Com                EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     0FFh
                    +1          P0_PUSHPULL     EQU     0
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 1 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 1 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 1 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    19

                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    20

                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 90 == 0
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1                  mov     PCA0POL, #02h                           ; Damping inverted, pwm noninver
                               ted
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    21

                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          CcomFET         EQU     5       ;o
                    +1          CpwmFET         EQU     4       ;o
                    +1          BcomFET         EQU     3       ;o
                    +1          BpwmFET         EQU     2       ;o
                    +1          AcomFET         EQU     1       ;o
                    +1          ApwmFET         EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     00h             
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     3Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    22

                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  clr     P1.BcomFET
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    23

                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1                  mov     P1SKIP, #3Eh
                    +1          ELSE
                    +1                  mov     P1SKIP, #3Ch
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1                  mov     P1SKIP, #3Bh
                    +1          ELSE
                    +1                  mov     P1SKIP, #33h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1                  mov     P1SKIP, #2Fh
                    +1          ELSE
                    +1                  mov     P1SKIP, #0Fh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #3Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #10h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #20h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #30h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    24

                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 1 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 1 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    25

                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                       1482     
                       1483     IF 23 == B_
                                ;$include (B.inc) ; Select pinout B
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "B". Equals "A", but with A and C fets swapped and pwm and co
                               m fets swapped
                    +1          ; X  X  RC X  MC MB MA CC    X  X  Ap Ac Bp Bc Cp Cc
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    26

                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 1 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    27

                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    28

                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    29

                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    30

                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    31

                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    32

                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    33

                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    34

                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    35

                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    36

                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    37

                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    38

                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 1 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#B_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#B_L_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#B_L_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#B_L_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#B_L_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#B_L_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#B_L_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#B_L_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#B_L_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#B_L_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#B_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#B_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#B_H_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#B_H_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#B_H_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#B_H_20#        "
                    +1          ELSEIF 90 == 25
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    39

                    +1          Eep_ESC_Layout:         DB      "#B_H_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#B_H_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#B_H_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#B_H_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#B_H_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#B_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     5               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 1 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          Rcp_In          EQU     5       ;i
                    +1          ;                       EQU     4       ;i 
                    +1          Mux_C           EQU     3       ;i
                    +1          Mux_B           EQU     2       ;i
                    +1          Mux_A           EQU     1       ;i
                    +1          Comp_Com                EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     0FFh
                    +1          P0_PUSHPULL     EQU     0
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    40

                    +1          IF 1 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 1 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 1 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    41

                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 90 == 0
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0POL, #00h                           ; Pwm noninverted
                    +1          ELSE
                    +1                  mov     PCA0POL, #01h                           ; Damping inverted, pwm noninver
                               ted
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    42

                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO       ; CCF interrupt is only used for FETON_DELAY == 0
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    43

                    +1          ApwmFET         EQU     5       ;o
                    +1          AcomFET         EQU     4       ;o
                    +1          BpwmFET         EQU     3       ;o
                    +1          BcomFET         EQU     2       ;o
                    +1          CpwmFET         EQU     1       ;o
                    +1          CcomFET         EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     00h             
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     3Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    44

                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1                  mov     P1SKIP, #1Fh
                    +1          ELSE
                    +1                  mov     P1SKIP, #0Fh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1                  mov     P1SKIP, #37h
                    +1          ELSE
                    +1                  mov     P1SKIP, #33h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1                  mov     P1SKIP, #3Dh
                    +1          ELSE
                    +1                  mov     P1SKIP, #3Ch
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #3Fh
                    +1          ENDM
                    +1          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    45

                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #10h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #20h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #30h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 1 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 1 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    46

                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                       2800     
                       2801     IF 23 == C_
                                ;$include (C.inc) ; Select pinout C
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    47

                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "C"
                    +1          ; Ac Ap MC MB MA CC X  RC    X  X  X  X  Cc Cp Bc Bp
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 1 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    48

                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    49

                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    50

                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    51

                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    52

                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    53

                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    54

                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    55

                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    56

                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    57

                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    58

                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    59

                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 1 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#C_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#C_L_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#C_L_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#C_L_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#C_L_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#C_L_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#C_L_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#C_L_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#C_L_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#C_L_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#C_L_90#        "
                    +1          ENDIF
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    60

                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#C_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#C_H_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#C_H_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#C_H_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#C_H_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#C_H_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#C_H_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#C_H_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#C_H_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#C_H_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#C_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     0               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 1 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          AcomFET         EQU     7       ;o
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    61

                    +1          ApwmFET         EQU     6       ;o
                    +1          Mux_C           EQU     5       ;i
                    +1          Mux_B           EQU     4       ;i
                    +1          Mux_A           EQU     3       ;i
                    +1          Comp_Com                EQU     2       ;i
                    +1          ;                       EQU     1       ;i
                    +1          Rcp_In          EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     NOT((1 SHL ApwmFET)+(1 SHL AcomFET))
                    +1          P0_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL AcomFET)
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 1 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 1 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 1 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    62

                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 90 == 0
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    63

                    +1          Set_Pwm_Polarity MACRO
                    +1                  mov     PCA0POL, #02h                           ; Damping inverted, pwm noninver
                               ted
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    64

                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          ;                       EQU     5       ;i
                    +1          ;                       EQU     4       ;i
                    +1          CcomFET         EQU     3       ;o
                    +1          CpwmFET         EQU     2       ;o
                    +1          BcomFET         EQU     1       ;o
                    +1          BpwmFET         EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     00h             
                    +1          P1_PUSHPULL     EQU     (1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     0Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P0.ApwmFET
                    +1          IF 90 == 0
                    +1                  setb    P0.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P0.ApwmFET
                    +1          ELSE
                    +1                  clr     P0.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    65

                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P0.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P0.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P0.ApwmFET
                    +1          ENDIF
                    +1                  setb    P0.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  clr     P0.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  clr     P0.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 90 == 0
                    +1                  setb    P0.AcomFET
                    +1                  mov     P0SKIP, #0BFh
                    +1                  mov     P1SKIP, #0Fh
                    +1          ELSE
                    +1                  mov     P0SKIP, #03Fh
                    +1                  mov     P1SKIP, #0Fh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1                  mov     P0SKIP, #0FFh
                    +1                  mov     P1SKIP, #0Eh
                    +1          ELSE
                    +1                  mov     P0SKIP, #0FFh
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    66

                    +1                  mov     P1SKIP, #0Ch
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1                  mov     P0SKIP, #0FFh
                    +1                  mov     P1SKIP, #0Bh
                    +1          ELSE
                    +1                  mov     P0SKIP, #0FFh
                    +1                  mov     P1SKIP, #03h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P0SKIP, #0FFh
                    +1                  mov     P1SKIP, #0Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #32h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #42h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #52h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 1 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    67

                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 1 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    68

                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                       4120     
                       4121     IF 23 == D_
                                ;$include (D.inc) ; Select pinout D
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "D". Com fets are active low for H/L_N driver and EN_N/PWM dr
                               iver
                    +1          ; X  X  RC X  CC MA MC MB    X  X  Cc Cp Bc Bp Ac Ap
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 1 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    69

                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    70

                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    71

                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    72

                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    73

                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    74

                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    75

                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    76

                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    77

                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    78

                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    79

                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    80

                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 1 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#D_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#D_L_05#        "
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    81

                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#D_L_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#D_L_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#D_L_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#D_L_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#D_L_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#D_L_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#D_L_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#D_L_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#D_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#D_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#D_H_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#D_H_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#D_H_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#D_H_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#D_H_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#D_H_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#D_H_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#D_H_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#D_H_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#D_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    82

                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     5               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 1 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          Rcp_In          EQU     5       ;i
                    +1          ;                       EQU     4       ;i 
                    +1          Comp_Com                EQU     3       ;i
                    +1          Mux_A           EQU     2       ;i
                    +1          Mux_C           EQU     1       ;i
                    +1          Mux_B           EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     0FFh
                    +1          P0_PUSHPULL     EQU     0
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 1 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 1 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 1 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    83

                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    84

                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 90 == 0
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1                  mov     PCA0POL, #00h                           ; Damping noninverted, pwm nonin
                               verted
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    85

                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          CcomFET         EQU     5       ;o
                    +1          CpwmFET         EQU     4       ;o
                    +1          BcomFET         EQU     3       ;o
                    +1          BpwmFET         EQU     2       ;o
                    +1          AcomFET         EQU     1       ;o
                    +1          ApwmFET         EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     (1 SHL AcomFET)+(1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     3Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 90 == 0
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1          ELSE
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 90 == 0
                    +1                  clr     P1.BcomFET
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    86

                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 90 == 0
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  setb    P1.AcomFET
                    +1                  setb    P1.BcomFET
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  setb    P1.AcomFET
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    87

                    +1                  setb    P1.BcomFET
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.AcomFET
                    +1                  mov     P1SKIP, #3Eh
                    +1          ELSE
                    +1                  mov     P1SKIP, #3Ch
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BcomFET
                    +1                  mov     P1SKIP, #3Bh
                    +1          ELSE
                    +1                  mov     P1SKIP, #33h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CcomFET
                    +1                  mov     P1SKIP, #2Fh
                    +1          ELSE
                    +1                  mov     P1SKIP, #0Fh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #3Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #23h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #03h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #13h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 1 == 1
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    88

                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 1 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    89

                    +1          Set_LED_0 MACRO
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                       5433     
                       5434     IF 23 == E_
                                ;$include (E.inc) ; Select pinout E
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "E". Equals "A", but with LED control. And with HIP2103/4 dri
                               ver initialization
                    +1          ; L1 L0 RC X  MC MB MA CC    X  L2 Cc Cp Bc Bp Ac Ap
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 1 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    90

                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    91

                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    92

                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    93

                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    94

                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    95

                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    96

                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    97

                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    98

                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE    99

                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   100

                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   101

                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   102

                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 1 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#E_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#E_L_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#E_L_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#E_L_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#E_L_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#E_L_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#E_L_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#E_L_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#E_L_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#E_L_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#E_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#E_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#E_H_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#E_H_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#E_H_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#E_H_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#E_H_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#E_H_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#E_H_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#E_H_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#E_H_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#E_H_90#        "
                    +1          ENDIF
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   103

                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     5               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 1 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          LED_1           EQU     7       ;o
                    +1          LED_0           EQU     6       ;o
                    +1          Rcp_In          EQU     5       ;i
                    +1          ;                       EQU     4       ;i 
                    +1          Mux_C           EQU     3       ;i
                    +1          Mux_B           EQU     2       ;i
                    +1          Mux_A           EQU     1       ;i
                    +1          Comp_Com                EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     NOT((1 SHL LED_0)+(1 SHL LED_1))
                    +1          P0_PUSHPULL     EQU     (1 SHL LED_0)+(1 SHL LED_1)
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 1 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 1 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 1 == 1
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   104

                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   105

                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 90 == 0
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1                  mov     PCA0POL, #02h                           ; Damping inverted, pwm noninver
                               ted
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   106

                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          LED_2           EQU     6       ;o
                    +1          CcomFET         EQU     5       ;o
                    +1          CpwmFET         EQU     4       ;o
                    +1          BcomFET         EQU     3       ;o
                    +1          BpwmFET         EQU     2       ;o
                    +1          AcomFET         EQU     1       ;o
                    +1          ApwmFET         EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)+(1 SHL LED_2)
                    +1          P1_INIT         EQU     00h             
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)+(1 SHL LED_2)
                    +1          P1_SKIP         EQU     7Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 90 == 0
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   107

                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  setb    P1.BcomFET
                    +1          ENDM
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   108

                    +1          BcomFET_off MACRO
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1                  mov     P1SKIP, #7Eh
                    +1          ELSE
                    +1                  mov     P1SKIP, #7Ch
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1                  mov     P1SKIP, #7Bh
                    +1          ELSE
                    +1                  mov     P1SKIP, #73h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1                  mov     P1SKIP, #6Fh
                    +1          ELSE
                    +1                  mov     P1SKIP, #4Fh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #7Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #10h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #20h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #30h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   109

                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 1 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1                  All_pwmFETs_off ; For unlocking of HIP2103/4 driver circuits
                    +1                  call wait100ms
                    +1                  AcomFET_on
                    +1                  BcomFET_on
                    +1                  CcomFET_on
                    +1                  call wait1ms
                    +1                  All_comFETs_off
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 1 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   110

                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1                  setb    P0.LED_0
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1                  clr     P0.LED_0
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1                  setb    P0.LED_1
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1                  clr     P0.LED_1
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1                  setb    P1.LED_2
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1                  clr     P1.LED_2
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                       6759     
                       6760     IF 23 == F_
                                ;$include (F.inc) ; Select pinout F
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   111

                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "F". Equals "A", but with Mux_A and Mux_C swapped
                    +1          ; X  X  RC X  MA MB MC CC    X  X  Cc Cp Bc Bp Ac Ap
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 1 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   112

                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   113

                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   114

                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   115

                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   116

                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   117

                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   118

                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   119

                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   120

                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   121

                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   122

                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   123

                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 1 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#F_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#F_L_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#F_L_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#F_L_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#F_L_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#F_L_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#F_L_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#F_L_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#F_L_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#F_L_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#F_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   124

                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#F_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#F_H_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#F_H_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#F_H_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#F_H_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#F_H_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#F_H_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#F_H_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#F_H_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#F_H_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#F_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     5               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 1 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          Rcp_In          EQU     5       ;i
                    +1          ;                       EQU     4       ;i 
                    +1          Mux_A           EQU     3       ;i
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   125

                    +1          Mux_B           EQU     2       ;i
                    +1          Mux_C           EQU     1       ;i
                    +1          Comp_Com                EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     0FFh
                    +1          P0_PUSHPULL     EQU     0
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 1 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 1 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 1 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   126

                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 90 == 0
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1                  mov     PCA0POL, #02h                           ; Damping inverted, pwm noninver
                               ted
                    +1          ENDM
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   127

                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   128

                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          CcomFET         EQU     5       ;o
                    +1          CpwmFET         EQU     4       ;o
                    +1          BcomFET         EQU     3       ;o
                    +1          BpwmFET         EQU     2       ;o
                    +1          AcomFET         EQU     1       ;o
                    +1          ApwmFET         EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     00h             
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     3Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   129

                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1                  mov     P1SKIP, #3Eh
                    +1          ELSE
                    +1                  mov     P1SKIP, #3Ch
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1                  mov     P1SKIP, #3Bh
                    +1          ELSE
                    +1                  mov     P1SKIP, #33h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   130

                    +1                  mov     P1SKIP, #2Fh
                    +1          ELSE
                    +1                  mov     P1SKIP, #0Fh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #3Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #30h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #20h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #10h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 1 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   131

                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 1 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                       8072     
                       8073     IF 23 == G_
                                ;$include (G.inc) ; Select pinout G
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   132

                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "G"
                    +1          ; X  X  RC X  CC MA MC MB    X  X  Cc Cp Bc Bp Ac Ap
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 1 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   133

                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   134

                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   135

                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   136

                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   137

                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   138

                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   139

                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   140

                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   141

                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   142

                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   143

                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   144

                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 1 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#G_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#G_L_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#G_L_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#G_L_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#G_L_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#G_L_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#G_L_30#        "
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   145

                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#G_L_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#G_L_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#G_L_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#G_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#G_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#G_H_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#G_H_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#G_H_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#G_H_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#G_H_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#G_H_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#G_H_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#G_H_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#G_H_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#G_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     5               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 1 == 0
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   146

                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          Rcp_In          EQU     5       ;i
                    +1          ;                       EQU     4       ;i 
                    +1          Comp_Com                EQU     3       ;i
                    +1          Mux_A           EQU     2       ;i
                    +1          Mux_C           EQU     1       ;i
                    +1          Mux_B           EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     0FFh
                    +1          P0_PUSHPULL     EQU     0
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 1 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 1 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 1 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   147

                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 90 == 0
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   148

                    +1          ELSE
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1                  mov     PCA0POL, #02h                           ; Damping inverted, pwm noninver
                               ted
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   149

                    +1          Clear_CCF_Interrupt MACRO
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          CcomFET         EQU     5       ;o
                    +1          CpwmFET         EQU     4       ;o
                    +1          BcomFET         EQU     3       ;o
                    +1          BpwmFET         EQU     2       ;o
                    +1          AcomFET         EQU     1       ;o
                    +1          ApwmFET         EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     00h             
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     3Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   150

                    +1                  setb    P1.CpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1                  mov     P1SKIP, #3Eh
                    +1          ELSE
                    +1                  mov     P1SKIP, #3Ch
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   151

                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1                  mov     P1SKIP, #3Bh
                    +1          ELSE
                    +1                  mov     P1SKIP, #33h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1                  mov     P1SKIP, #2Fh
                    +1          ELSE
                    +1                  mov     P1SKIP, #0Fh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #3Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #23h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #03h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #13h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 1 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   152

                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 1 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1          ENDM
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   153

                    +1          Clear_LED_2 MACRO
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                       9385     
                       9386     IF 23 == H_
                                ;$include (H.inc) ; Select pinout H
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "H". 
                    +1          ; RC X  X  X  MA MB CC MC    X  Ap Bp Cp X  Ac Bc Cc 
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 1 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   154

                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   155

                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   156

                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   157

                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   158

                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   159

                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   160

                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   161

                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   162

                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   163

                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   164

                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   165

                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 1 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   166

                    +1          Eep_ESC_Layout:         DB      "#H_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#H_L_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#H_L_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#H_L_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#H_L_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#H_L_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#H_L_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#H_L_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#H_L_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#H_L_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#H_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#H_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#H_H_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#H_H_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#H_H_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#H_H_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#H_H_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#H_H_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#H_H_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#H_H_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#H_H_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#H_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   167

                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     7               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 1 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          Rcp_In          EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          ;                       EQU     5       ;i
                    +1          ;                       EQU     4       ;i 
                    +1          Mux_A           EQU     3       ;i
                    +1          Mux_B           EQU     2       ;i
                    +1          Comp_Com                EQU     1       ;i
                    +1          Mux_C           EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     0FFh
                    +1          P0_PUSHPULL     EQU     0
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 1 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 1 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 1 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   168

                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   169

                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 90 == 0
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0POL, #00h                           ; Pwm noninverted
                    +1          ELSE
                    +1                  mov     PCA0POL, #01h                           ; Damping inverted, pwm noninver
                               ted
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   170

                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO       ; CCF interrupt is only used for FETON_DELAY == 0
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          ApwmFET         EQU     6       ;o
                    +1          BpwmFET         EQU     5       ;o
                    +1          CpwmFET         EQU     4       ;o
                    +1          ;                       EQU     3       ;i
                    +1          AcomFET         EQU     2       ;o 
                    +1          BcomFET         EQU     1       ;o
                    +1          CcomFET         EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     00h             
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     7Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   171

                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CpwmFET
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   172

                    +1          ENDIF
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1                  mov     P1SKIP, #3Fh
                    +1          ELSE
                    +1                  mov     P1SKIP, #3Bh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1                  mov     P1SKIP, #5Fh
                    +1          ELSE
                    +1                  mov     P1SKIP, #5Dh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1                  mov     P1SKIP, #6Fh
                    +1          ELSE
                    +1                  mov     P1SKIP, #6Eh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #7Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #31h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #21h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #01h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   173

                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 1 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 1 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   174

                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                      10703     
                      10704     IF 23 == I_
                                ;$include (I.inc) ; Select pinout I
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "I"
                    +1          ; X  X  RC X  MC MB MA CC    X  X  Ac Bc Cc Ap Bp Cp
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 1 == 0
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   175

                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   176

                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   177

                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   178

                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   179

                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   180

                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   181

                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   182

                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   183

                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   184

                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   185

                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   186

                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   187

                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 1 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#I_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#I_L_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#I_L_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#I_L_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#I_L_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#I_L_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#I_L_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#I_L_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#I_L_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#I_L_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#I_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#I_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#I_H_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#I_H_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#I_H_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#I_H_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#I_H_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#I_H_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#I_H_40#        "
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   188

                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#I_H_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#I_H_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#I_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     5               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 1 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          Rcp_In          EQU     5       ;i
                    +1          ;                       EQU     4       ;i 
                    +1          Mux_C           EQU     3       ;i
                    +1          Mux_B           EQU     2       ;i
                    +1          Mux_A           EQU     1       ;i
                    +1          Comp_Com                EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     0FFh
                    +1          P0_PUSHPULL     EQU     0
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 1 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   189

                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 1 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 1 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   190

                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 90 == 0
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1                  mov     PCA0POL, #02h                           ; Damping inverted, pwm noninver
                               ted
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 90 == 0
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   191

                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          AcomFET         EQU     5       ;o
                    +1          BcomFET         EQU     4       ;o
                    +1          CcomFET         EQU     3       ;o
                    +1          ApwmFET         EQU     2       ;o
                    +1          BpwmFET         EQU     1       ;o
                    +1          CpwmFET         EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     00h             
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   192

                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     3Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  clr     P1.AcomFET
                    +1          ENDM
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   193

                    +1          BcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1                  mov     P1SKIP, #3Bh
                    +1          ELSE
                    +1                  mov     P1SKIP, #1Bh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1                  mov     P1SKIP, #3Dh
                    +1          ELSE
                    +1                  mov     P1SKIP, #2Dh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1                  mov     P1SKIP, #3Eh
                    +1          ELSE
                    +1                  mov     P1SKIP, #36h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #7Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #10h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #20h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #30h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   194

                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 1 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 1 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   195

                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                      12015     
                      12016     IF 23 == J_
                                ;$include (J.inc) ; Select pinout J
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   196

                    +1          ;
                    +1          ; Hardware definition file "J"
                    +1          ; L2 L1 L0 RC CC MB MC MA    X  X  Cc Bc Ac Cp Bp Ap
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 1 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   197

                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   198

                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   199

                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   200

                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   201

                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   202

                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   203

                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   204

                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   205

                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   206

                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   207

                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   208

                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 1 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#J_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#J_L_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#J_L_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#J_L_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#J_L_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#J_L_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#J_L_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#J_L_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#J_L_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#J_L_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#J_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#J_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#J_H_05#        "
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   209

                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#J_H_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#J_H_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#J_H_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#J_H_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#J_H_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#J_H_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#J_H_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#J_H_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#J_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     4               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 1 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          LED_2           EQU     7       ;o
                    +1          LED_1           EQU     6       ;o
                    +1          LED_0           EQU     5       ;o
                    +1          Rcp_In          EQU     4       ;i
                    +1          Comp_Com                EQU     3       ;i
                    +1          Mux_B           EQU     2       ;i
                    +1          Mux_C           EQU     1       ;i
                    +1          Mux_A           EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     0FFh
                    +1          P0_PUSHPULL     EQU     (1 SHL LED_0)+(1 SHL LED_1)+(1 SHL LED_2)
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   210

                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 1 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 1 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 1 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   211

                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 90 == 0
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1                  mov     PCA0POL, #02h                           ; Damping inverted, pwm noninver
                               ted
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   212

                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   213

                    +1          ;                       EQU     6       ;i
                    +1          CcomFET         EQU     5       ;o
                    +1          BcomFET         EQU     4       ;o
                    +1          AcomFET         EQU     3       ;o
                    +1          CpwmFET         EQU     2       ;o
                    +1          BpwmFET         EQU     1       ;o
                    +1          ApwmFET         EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     00h             
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     3Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   214

                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1                  mov     P1SKIP, #3Eh
                    +1          ELSE
                    +1                  mov     P1SKIP, #36h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1                  mov     P1SKIP, #3Dh
                    +1          ELSE
                    +1                  mov     P1SKIP, #2Dh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1                  mov     P1SKIP, #3Bh
                    +1          ELSE
                    +1                  mov     P1SKIP, #1Bh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #7Fh
                    +1          ENDM
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   215

                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #03h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #23h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #13h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 1 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 1 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   216

                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1                  clr     P0.LED_0
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1                  setb    P0.LED_0
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1                  clr     P0.LED_1
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1                  setb    P0.LED_1
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1                  clr     P0.LED_2
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1                  setb    P0.LED_2
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                      13333     
                      13334     IF 23 == K_
                                ;$include (K.inc) ; Select pinout K
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   217

                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "K". Com fets are active low for H/L_N driver and EN_N/PWM dr
                               iver
                    +1          ; X  X  MC X  MB CC MA RC    X  X  Ap Bp Cp Cc Bc Ac    Com fets inverted
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 1 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   218

                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   219

                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   220

                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   221

                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   222

                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   223

                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   224

                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   225

                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   226

                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   227

                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   228

                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   229

                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 1 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#K_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#K_L_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#K_L_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#K_L_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#K_L_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#K_L_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#K_L_30#        "
                    +1          ELSEIF 90 == 40
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   230

                    +1          Eep_ESC_Layout:         DB      "#K_L_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#K_L_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#K_L_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#K_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#K_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#K_H_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#K_H_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#K_H_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#K_H_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#K_H_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#K_H_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#K_H_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#K_H_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#K_H_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#K_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     0               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 1 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   231

                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          Mux_C           EQU     5       ;i
                    +1          ;                       EQU     4       ;i
                    +1          Mux_B           EQU     3       ;i
                    +1          Comp_Com                EQU     2       ;i
                    +1          Mux_A           EQU     1       ;i
                    +1          Rcp_In          EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     0FFh
                    +1          P0_PUSHPULL     EQU     0
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 1 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 1 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 1 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   232

                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 90 == 0
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   233

                    +1          ELSE
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1                  mov     PCA0POL, #00h                           ; Damping noninverted, pwm nonin
                               verted
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   234

                    +1          Clear_CCF_Interrupt MACRO       ; CCF interrupt is only used for FETON_DELAY == 0
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          ApwmFET         EQU     5       ;o
                    +1          BpwmFET         EQU     4       ;o
                    +1          CpwmFET         EQU     3       ;o
                    +1          CcomFET         EQU     2       ;o
                    +1          BcomFET         EQU     1       ;o
                    +1          AcomFET         EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     (1 SHL AcomFET)+(1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     3Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 90 == 0
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1          ELSE
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 90 == 0
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   235

                    +1                  setb    P1.CpwmFET
                    +1          IF 90 == 0
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  setb    P1.AcomFET
                    +1                  setb    P1.BcomFET
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  setb    P1.AcomFET
                    +1                  setb    P1.BcomFET
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.AcomFET
                    +1                  mov     P1SKIP, #1Fh
                    +1          ELSE
                    +1                  mov     P1SKIP, #1Eh
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   236

                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BcomFET
                    +1                  mov     P1SKIP, #2Fh
                    +1          ELSE
                    +1                  mov     P1SKIP, #2Dh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CcomFET
                    +1                  mov     P1SKIP, #37h
                    +1          ELSE
                    +1                  mov     P1SKIP, #33h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #3Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #12h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #32h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #52h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 1 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   237

                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 1 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1          ENDM
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   238

                    +1          Clear_LED_2 MACRO
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                      14647     
                      14648     IF 23 == L_
                                ;$include (L.inc) ; Select pinout L
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "L"
                    +1          ; X  X  RC X  CC MA MB MC    X  X  Ac Bc Cc Ap Bp Cp
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 1 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   239

                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   240

                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   241

                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   242

                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   243

                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   244

                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   245

                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   246

                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   247

                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   248

                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   249

                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   250

                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 1 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   251

                    +1          Eep_ESC_Layout:         DB      "#L_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#L_L_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#L_L_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#L_L_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#L_L_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#L_L_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#L_L_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#L_L_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#L_L_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#L_L_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#L_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#L_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#L_H_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#L_H_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#L_H_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#L_H_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#L_H_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#L_H_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#L_H_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#L_H_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#L_H_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#L_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   252

                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     5               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 1 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          Rcp_In          EQU     5       ;i
                    +1          ;                       EQU     4       ;i 
                    +1          Comp_Com                EQU     3       ;i
                    +1          Mux_A           EQU     2       ;i
                    +1          Mux_B           EQU     1       ;i
                    +1          Mux_C           EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     0FFh
                    +1          P0_PUSHPULL     EQU     0
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 1 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 1 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 1 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   253

                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   254

                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 90 == 0
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1                  mov     PCA0POL, #02h                           ; Damping inverted, pwm noninver
                               ted
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   255

                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          AcomFET         EQU     5       ;o
                    +1          BcomFET         EQU     4       ;o
                    +1          CcomFET         EQU     3       ;o
                    +1          ApwmFET         EQU     2       ;o
                    +1          BpwmFET         EQU     1       ;o
                    +1          CpwmFET         EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     00h             
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     3Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   256

                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  clr     P1.CcomFET
                    +1          ENDM
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   257

                    +1          All_comFETs_Off MACRO
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1                  mov     P1SKIP, #3Bh
                    +1          ELSE
                    +1                  mov     P1SKIP, #1Bh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1                  mov     P1SKIP, #3Dh
                    +1          ELSE
                    +1                  mov     P1SKIP, #2Dh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1                  mov     P1SKIP, #3Eh
                    +1          ELSE
                    +1                  mov     P1SKIP, #36h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #7Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #23h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #13h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #03h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   258

                    +1                  jmp     int0_int        
                    +1          IF 1 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 1 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   259

                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                      15959     
                      15960     IF 23 == M_
                                ;$include (M.inc) ; Select pinout M
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "M".
                    +1          ; MA MC CC MB RC L0 X  X     X  Cc Bc Ac Cp Bp Ap X     
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 1 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   260

                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   261

                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   262

                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   263

                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   264

                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   265

                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   266

                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   267

                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   268

                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   269

                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   270

                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   271

                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   272

                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 1 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#M_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#M_L_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#M_L_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#M_L_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#M_L_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#M_L_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#M_L_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#M_L_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#M_L_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#M_L_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#M_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#M_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#M_H_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#M_H_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#M_H_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#M_H_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#M_H_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#M_H_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#M_H_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#M_H_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#M_H_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#M_H_90#        "
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   273

                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     3               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 1 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          Mux_A           EQU     7       ;i
                    +1          Mux_C           EQU     6       ;i
                    +1          Comp_Com        EQU     5       ;i
                    +1          Mux_B           EQU     4       ;i
                    +1          Rcp_In          EQU     3       ;i
                    +1          LED_0           EQU     2       ;i
                    +1          ;                       EQU     1       ;i
                    +1          ;                       EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     NOT(1 SHL LED_0)
                    +1          P0_PUSHPULL     EQU     (1 SHL LED_0)
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 1 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 1 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   274

                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 1 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   275

                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 90 == 0
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1                  mov     PCA0POL, #02h                           ; Damping inverted, pwm noninver
                               ted
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   276

                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          CcomFET         EQU     6       ;o
                    +1          BcomFET         EQU     5       ;o
                    +1          AcomFET         EQU     4       ;o
                    +1          CpwmFET         EQU     3       ;i
                    +1          BpwmFET         EQU     2       ;o 
                    +1          ApwmFET         EQU     1       ;o
                    +1          ;                       EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     00h             
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     7Fh
                    +1          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   277

                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BpwmFET
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   278

                    +1          ENDIF
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1                  mov     P1SKIP, #7Dh
                    +1          ELSE
                    +1                  mov     P1SKIP, #6Dh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1                  mov     P1SKIP, #7Bh
                    +1          ELSE
                    +1                  mov     P1SKIP, #5Bh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1                  mov     P1SKIP, #77h
                    +1          ELSE
                    +1                  mov     P1SKIP, #37h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #7Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #75h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #45h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #65h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   279

                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 1 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 1 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   280

                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1                  setb    P0.LED_0
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1               clr        P0.LED_0
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                      17276     
                      17277     IF 23 == N_
                                ;$include (N.inc) ; Select pinout N
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   281

                    +1          ; Hardware definition file "N"
                    +1          ; X  X  RC X  MC MB MA CC    X  X  Cp Cc Bp Bc Ap Ac
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 1 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   282

                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   283

                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   284

                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   285

                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   286

                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   287

                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   288

                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   289

                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   290

                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   291

                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   292

                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   293

                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 1 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#N_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#N_L_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#N_L_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#N_L_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#N_L_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#N_L_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#N_L_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#N_L_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#N_L_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#N_L_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#N_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#N_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#N_H_05#        "
                    +1          ELSEIF 90 == 10
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   294

                    +1          Eep_ESC_Layout:         DB      "#N_H_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#N_H_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#N_H_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#N_H_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#N_H_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#N_H_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#N_H_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#N_H_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#N_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     5               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 1 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          Rcp_In          EQU     5       ;i
                    +1          ;                       EQU     4       ;i 
                    +1          Mux_C           EQU     3       ;i
                    +1          Mux_B           EQU     2       ;i
                    +1          Mux_A           EQU     1       ;i
                    +1          Comp_Com                EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     0FFh
                    +1          P0_PUSHPULL     EQU     0
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   295

                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 1 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 1 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 1 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   296

                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 90 == 0
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0POL, #00h                           ; Pwm noninverted
                    +1          ELSE
                    +1                  mov     PCA0POL, #01h                           ; Damping inverted, pwm noninver
                               ted
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   297

                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO       ; CCF interrupt is only used for FETON_DELAY == 0
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   298

                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          CpwmFET         EQU     5       ;o
                    +1          CcomFET         EQU     4       ;o
                    +1          BpwmFET         EQU     3       ;o
                    +1          BcomFET         EQU     2       ;o
                    +1          ApwmFET         EQU     1       ;o
                    +1          AcomFET         EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     00h             
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     3Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   299

                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1                  mov     P1SKIP, #3Dh
                    +1          ELSE
                    +1                  mov     P1SKIP, #3Ch
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1                  mov     P1SKIP, #37h
                    +1          ELSE
                    +1                  mov     P1SKIP, #33h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1                  mov     P1SKIP, #1Fh
                    +1          ELSE
                    +1                  mov     P1SKIP, #0Fh
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   300

                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #3Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #10h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #20h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #30h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 1 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   301

                               as
                    +1          IF 1 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                      18594     
                      18595     IF 23 == O_
                                ;$include (O.inc) ; Select pinout O
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   302

                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "O". Com fets are active low for H/L_N driver and EN_N/PWM dr
                               iver. Low side pwm and 1S flag set
                    +1          ; X  X  RC X  CC MA MC MB    X  X  Cc Cp Bc Bp Ac Ap
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 1 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   303

                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   304

                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   305

                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   306

                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   307

                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   308

                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   309

                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   310

                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   311

                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   312

                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   313

                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   314

                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 1 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#O_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#O_L_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#O_L_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#O_L_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#O_L_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#O_L_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#O_L_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#O_L_40#        "
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   315

                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#O_L_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#O_L_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#O_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#O_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#O_H_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#O_H_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#O_H_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#O_H_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#O_H_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#O_H_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#O_H_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#O_H_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#O_H_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#O_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     5               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 1 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   316

                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          Rcp_In          EQU     5       ;i
                    +1          ;                       EQU     4       ;i 
                    +1          Comp_Com                EQU     3       ;i
                    +1          Mux_A           EQU     2       ;i
                    +1          Mux_C           EQU     1       ;i
                    +1          Mux_B           EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     0FFh
                    +1          P0_PUSHPULL     EQU     0
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 1 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 1 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 1 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   317

                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 90 == 0
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 1 == 0
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   318

                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1                  mov     PCA0POL, #00h                           ; Damping noninverted, pwm nonin
                               verted
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO
                    +1                  anl     PCA0CN0, #0FEh
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   319

                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          CcomFET         EQU     5       ;o
                    +1          CpwmFET         EQU     4       ;o
                    +1          BcomFET         EQU     3       ;o
                    +1          BpwmFET         EQU     2       ;o
                    +1          AcomFET         EQU     1       ;o
                    +1          ApwmFET         EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     (1 SHL AcomFET)+(1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     3Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 90 == 0
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1          ELSE
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 90 == 0
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 90 == 0
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   320

                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  setb    P1.AcomFET
                    +1                  setb    P1.BcomFET
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  setb    P1.AcomFET
                    +1                  setb    P1.BcomFET
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.AcomFET
                    +1                  mov     P1SKIP, #3Eh
                    +1          ELSE
                    +1                  mov     P1SKIP, #3Ch
                    +1          ENDIF
                    +1          ENDM
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   321

                    +1          Set_Pwm_B MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BcomFET
                    +1                  mov     P1SKIP, #3Bh
                    +1          ELSE
                    +1                  mov     P1SKIP, #33h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CcomFET
                    +1                  mov     P1SKIP, #2Fh
                    +1          ELSE
                    +1                  mov     P1SKIP, #0Fh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #3Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #23h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #03h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #13h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1                  cpl A
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 1 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   322

                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 1 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   323

                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                      19908     
                      19909     IF 23 == P_
                                ;$include (P.inc) ; Select pinout P
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "P".
                    +1          ; X  X  RC MA CC MB MC X     X  Cc Bc Ac Cp Bp Ap X    
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 1 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   324

                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   325

                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   326

                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   327

                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   328

                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   329

                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   330

                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   331

                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   332

                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   333

                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   334

                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   335

                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 1 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#P_L_00#        "      ; ESC layout tag
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   336

                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#P_L_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#P_L_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#P_L_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#P_L_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#P_L_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#P_L_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#P_L_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#P_L_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#P_L_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#P_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#P_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#P_H_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#P_H_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#P_H_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#P_H_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#P_H_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#P_H_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#P_H_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#P_H_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#P_H_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#P_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   337

                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     5               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 1 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          Rcp_In          EQU     5       ;i
                    +1          Mux_A           EQU     4       ;i
                    +1          Comp_Com                EQU     3       ;i
                    +1          Mux_B           EQU     2       ;i
                    +1          Mux_C           EQU     1       ;i
                    +1          ;                       EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     0FFh
                    +1          P0_PUSHPULL     EQU     0
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 1 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 1 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 1 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   338

                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   339

                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 90 == 0
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1                  mov     PCA0POL, #02h                           ; Damping inverted, pwm noninver
                               ted
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   340

                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          CcomFET         EQU     6       ;o
                    +1          BcomFET         EQU     5       ;o
                    +1          AcomFET         EQU     4       ;o
                    +1          CpwmFET         EQU     3       ;i
                    +1          BpwmFET         EQU     2       ;o 
                    +1          ApwmFET         EQU     1       ;o
                    +1          ;                       EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     00h             
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     7Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   341

                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   342

                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1                  mov     P1SKIP, #7Dh
                    +1          ELSE
                    +1                  mov     P1SKIP, #6Dh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1                  mov     P1SKIP, #7Bh
                    +1          ELSE
                    +1                  mov     P1SKIP, #5Bh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1                  mov     P1SKIP, #77h
                    +1          ELSE
                    +1                  mov     P1SKIP, #37h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #7Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #43h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #23h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #13h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   343

                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 1 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 1 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   344

                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                      21223     
                      21224     IF 23 == Q_
                                ;$include (Q.inc) ; Select pinout Q
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "Q"
                    +1          ; Cp Bp Ap L1 L0 X  RC X     X  MA MB MC CC Cc Bc Ac
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 1 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   345

                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   346

                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   347

                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   348

                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   349

                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   350

                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   351

                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   352

                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   353

                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   354

                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   355

                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   356

                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   357

                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 1 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#Q_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#Q_L_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#Q_L_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#Q_L_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#Q_L_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#Q_L_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#Q_L_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#Q_L_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#Q_L_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#Q_L_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#Q_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#Q_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#Q_H_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#Q_H_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#Q_H_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#Q_H_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#Q_H_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#Q_H_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#Q_H_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#Q_H_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#Q_H_70#        "
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   358

                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#Q_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     1               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 1 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          CpwmFET         EQU     7       ;o
                    +1          BpwmFET         EQU     6       ;o
                    +1          ApwmFET         EQU     5       ;o
                    +1          LED_1           EQU     4       ;i
                    +1          LED_0           EQU     3       ;i
                    +1          ;                       EQU     2       ;i
                    +1          Rcp_In          EQU     1       ;i
                    +1          ;                       EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     0FFh
                    +1          P0_INIT         EQU     (1 SHL Rcp_In)
                    +1          P0_PUSHPULL     EQU     (1 SHL LED_0)+(1 SHL LED_1)+(1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 S
                               HL CpwmFET)
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 1 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 1 == 1
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   359

                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 1 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   360

                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 90 == 0
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1                  mov     PCA0POL, #02h                           ; Damping inverted, pwm noninver
                               ted
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   361

                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          Mux_A           EQU     6       ;i
                    +1          Mux_B           EQU     5       ;i
                    +1          Mux_C           EQU     4       ;i
                    +1          Comp_Com                EQU     3       ;o
                    +1          CcomFET         EQU     2       ;o
                    +1          BcomFET         EQU     1       ;o
                    +1          AcomFET         EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL AcomFET)+(1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     00h             
                    +1          P1_PUSHPULL     EQU     (1 SHL AcomFET)+(1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     07h
                    +1          
                    +1          ApwmFET_on MACRO
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   362

                    +1                  setb    P0.ApwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P0.ApwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P0.BpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P0.BpwmFET
                    +1          ELSE
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P0.CpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P0.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P0.ApwmFET
                    +1                  clr     P0.BpwmFET
                    +1                  clr     P0.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P0.ApwmFET
                    +1          ENDIF
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P0.BpwmFET
                    +1          ENDIF
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   363

                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P0.CpwmFET
                    +1          ENDIF
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1                  mov     P0SKIP, #0DFh
                    +1                  mov     P1SKIP, #07h
                    +1          ELSE
                    +1                  mov     P0SKIP, #0DFh
                    +1                  mov     P1SKIP, #06h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1                  mov     P0SKIP, #0BFh
                    +1                  mov     P1SKIP, #07h
                    +1          ELSE
                    +1                  mov     P0SKIP, #0BFh
                    +1                  mov     P1SKIP, #05h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1                  mov     P0SKIP, #07Fh
                    +1                  mov     P1SKIP, #07h
                    +1          ELSE
                    +1                  mov     P0SKIP, #07Fh
                    +1                  mov     P1SKIP, #03h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P0SKIP, #0FFh
                    +1                  mov     P1SKIP, #07h
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP1MX, #63h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP1MX, #53h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP1MX, #43h    ; Set comparator multiplexer to phase C
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   364

                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP1CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 1 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP1CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP1MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 1 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   365

                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1                  setb    P0.LED_0
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1                  clr     P0.LED_0
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1                  setb    P0.LED_1
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1                  clr     P0.LED_1
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                      22547     
                      22548     IF 23 == R_
                                ;$include (R.inc) ; Select pinout R
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   366

                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "R".
                    +1          ; X  X  RC X  MC MB MA CC    X  X  Ac Bc Cc Ap Bp Cp
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 1 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   367

                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   368

                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   369

                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   370

                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   371

                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   372

                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   373

                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   374

                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   375

                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   376

                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   377

                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   378

                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 1 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#R_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#R_L_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#R_L_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#R_L_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#R_L_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#R_L_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#R_L_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#R_L_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#R_L_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#R_L_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#R_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   379

                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#R_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#R_H_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#R_H_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#R_H_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#R_H_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#R_H_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#R_H_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#R_H_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#R_H_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#R_H_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#R_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     5               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 1 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          Rcp_In          EQU     5       ;i
                    +1          ;                       EQU     4       ;i 
                    +1          Mux_C           EQU     3       ;i
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   380

                    +1          Mux_B           EQU     2       ;i
                    +1          Mux_A           EQU     1       ;i
                    +1          Comp_Com                EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     0FFh
                    +1          P0_PUSHPULL     EQU     0
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 1 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 1 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 1 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   381

                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 90 == 0
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1                  mov     PCA0POL, #02h                           ; Damping inverted, pwm noninver
                               ted
                    +1          ENDM
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   382

                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO       ; CCF interrupt is only used for FETON_DELAY == 0
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   383

                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          AcomFET         EQU     5       ;o
                    +1          BcomFET         EQU     4       ;o
                    +1          CcomFET         EQU     3       ;o
                    +1          ApwmFET         EQU     2       ;o
                    +1          BpwmFET         EQU     1       ;o
                    +1          CpwmFET         EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     00h             
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     3Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 90 != 0
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   384

                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1                  mov     P1SKIP, #3Bh
                    +1          ELSE
                    +1                  mov     P1SKIP, #1Bh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1                  mov     P1SKIP, #3Dh
                    +1          ELSE
                    +1                  mov     P1SKIP, #2Dh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1                  mov     P1SKIP, #3Eh
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   385

                    +1          ELSE
                    +1                  mov     P1SKIP, #36h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #3Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #10h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #20h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #30h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 1 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   386

                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 1 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                      23859     
                      23860     IF 23 == S_
                                ;$include (S.inc) ; Select pinout S
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   387

                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "S". like "O" but Com fets are active high, Pwm fets are acti
                               ve low
                    +1          ; X  X  RC X  CC MA MC MB    X  X  Cc Cp Bc Bp Ac Ap
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 1 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   388

                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   389

                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   390

                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   391

                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   392

                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   393

                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   394

                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   395

                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   396

                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   397

                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   398

                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   399

                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 1 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#S_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#S_L_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#S_L_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#S_L_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#S_L_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#S_L_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#S_L_30#        "
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   400

                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#S_L_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#S_L_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#S_L_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#S_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#S_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#S_H_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#S_H_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#S_H_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#S_H_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#S_H_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#S_H_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#S_H_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#S_H_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#S_H_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#S_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     5               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 1 == 0
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   401

                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          Rcp_In          EQU     5       ;i
                    +1          ;                       EQU     4       ;i 
                    +1          Comp_Com                EQU     3       ;i
                    +1          Mux_A           EQU     2       ;i
                    +1          Mux_C           EQU     1       ;i
                    +1          Mux_B           EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     0FFh
                    +1          P0_PUSHPULL     EQU     0
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 1 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 1 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 1 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   402

                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 90 == 0
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   403

                    +1          ELSE
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0POL, #00h                           ; Pwm noninverted
                    +1          ELSE
                    +1                  mov     PCA0POL, #01h                           ; Damping inverted, pwm noninver
                               ted
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   404

                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          CpwmFET         EQU     5       ;o
                    +1          CcomFET         EQU     4       ;o
                    +1          BpwmFET         EQU     3       ;o
                    +1          BcomFET         EQU     2       ;o
                    +1          ApwmFET         EQU     1       ;o
                    +1          AcomFET         EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     (0 SHL AcomFET)+(0 SHL BcomFET)+(0 SHL CcomFET)
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     3Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   405

                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 90 == 0
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   406

                    +1                  setb    P1.AcomFET
                    +1                  mov     P1SKIP, #3Dh
                    +1          ELSE
                    +1                  mov     P1SKIP, #3Ch
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1                  mov     P1SKIP, #37h
                    +1          ELSE
                    +1                  mov     P1SKIP, #33h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1                  mov     P1SKIP, #1Fh
                    +1          ELSE
                    +1                  mov     P1SKIP, #0Fh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #3Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #23h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #03h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #13h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 1 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   407

                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 1 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1          ENDM
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   408

                    +1          Clear_LED_1 MACRO
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                      25176     
                      25177     IF 23 == T_
                                ;$include (T.inc) ; Select pinout T
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "T".
                    +1          ; RC X  MA X  MB CC MC X     X  X  Cp Bp Ap Ac Bc Cc
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 1 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   409

                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   410

                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   411

                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   412

                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   413

                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   414

                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   415

                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   416

                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   417

                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   418

                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   419

                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   420

                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   421

                    +1          ;**** **** **** **** ****
                    +1          IF 1 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#T_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#T_L_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#T_L_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#T_L_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#T_L_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#T_L_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#T_L_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#T_L_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#T_L_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#T_L_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#T_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#T_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#T_H_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#T_H_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#T_H_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#T_H_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#T_H_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#T_H_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#T_H_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#T_H_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#T_H_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#T_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   422

                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     7               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 1 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          Rcp_In          EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          Mux_A           EQU     5       ;i
                    +1          ;                       EQU     4       ;i 
                    +1          Mux_B           EQU     3       ;i
                    +1          Comp_Com                EQU     2       ;i
                    +1          Mux_C           EQU     1       ;i
                    +1          ;                       EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     0FFh
                    +1          P0_PUSHPULL     EQU     0
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 1 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 1 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 1 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   423

                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   424

                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 90 == 0
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0POL, #00h                           ; Pwm noninverted
                    +1          ELSE
                    +1                  mov     PCA0POL, #01h                           ; Damping inverted, pwm noninver
                               ted
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   425

                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO       ; CCF interrupt is only used for FETON_DELAY == 0
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          CpwmFET         EQU     5       ;o
                    +1          BpwmFET         EQU     4       ;o
                    +1          ApwmFET         EQU     3       ;o
                    +1          AcomFET         EQU     2       ;o 
                    +1          BcomFET         EQU     1       ;o
                    +1          CcomFET         EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     00h             
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     3Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   426

                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  clr     P1.BcomFET
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   427

                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1                  mov     P1SKIP, #37h
                    +1          ELSE
                    +1                  mov     P1SKIP, #33h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1                  mov     P1SKIP, #2Fh
                    +1          ELSE
                    +1                  mov     P1SKIP, #2Dh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1                  mov     P1SKIP, #1Fh
                    +1          ELSE
                    +1                  mov     P1SKIP, #1Eh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #3Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #52h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #32h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #12h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   428

                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 1 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 1 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   429

                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                      26494     
                      26495     IF 23 == U_
                                ;$include (U.inc) ; Select pinout U
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "U".
                    +1          ; MA MC CC MB RC L0 L1 L2     X  Cc Bc Ac Cp Bp Ap X     
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   430

                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 1 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   431

                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   432

                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   433

                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   434

                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   435

                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   436

                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   437

                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   438

                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   439

                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   440

                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   441

                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   442

                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 1 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#U_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#U_L_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#U_L_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#U_L_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#U_L_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#U_L_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#U_L_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#U_L_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#U_L_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#U_L_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#U_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#U_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#U_H_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#U_H_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#U_H_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#U_H_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#U_H_25#        "
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   443

                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#U_H_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#U_H_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#U_H_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#U_H_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#U_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     3               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 1 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          Mux_A           EQU     7       ;i
                    +1          Mux_C           EQU     6       ;i
                    +1          Comp_Com        EQU     5       ;i
                    +1          Mux_B           EQU     4       ;i
                    +1          Rcp_In          EQU     3       ;i
                    +1          LED_0           EQU     2       ;i
                    +1          LED_1           EQU     1       ;i
                    +1          LED_2           EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     0FFh
                    +1          P0_PUSHPULL     EQU     (1 SHL LED_0)+(1 SHL LED_1)+(1 SHL LED_2)
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 1 == 1
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   444

                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 1 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 1 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   445

                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 90 == 0
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1                  mov     PCA0POL, #02h                           ; Damping inverted, pwm noninver
                               ted
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   446

                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          CcomFET         EQU     6       ;o
                    +1          BcomFET         EQU     5       ;o
                    +1          AcomFET         EQU     4       ;o
                    +1          CpwmFET         EQU     3       ;i
                    +1          BpwmFET         EQU     2       ;o 
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   447

                    +1          ApwmFET         EQU     1       ;o
                    +1          ;                       EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     00h             
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     7Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 90 == 0
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   448

                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1                  mov     P1SKIP, #7Dh
                    +1          ELSE
                    +1                  mov     P1SKIP, #6Dh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1                  mov     P1SKIP, #7Bh
                    +1          ELSE
                    +1                  mov     P1SKIP, #5Bh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1                  mov     P1SKIP, #77h
                    +1          ELSE
                    +1                  mov     P1SKIP, #37h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #7Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #75h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   449

                    +1                  mov     CMP0MX, #45h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #65h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 1 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 1 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   450

                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1                  clr     P0.LED_0
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1                  setb    P0.LED_0
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1                  clr     P0.LED_1
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1                  setb    P0.LED_1
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1                  clr     P0.LED_2
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1                  setb    P0.LED_2
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                    +1          
                                ENDIF
                      27816     
                      27817     IF 23 == V_
                                ;$include (V.inc) ; Select pinout V
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   451

                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "V"
                    +1          ; Cc X  RC X  MC CC MB MA    X  Ap Ac Bp X  X  Bc Cp
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 1 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   452

                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   453

                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   454

                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   455

                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   456

                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   457

                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   458

                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   459

                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   460

                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   461

                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   462

                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   463

                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 1 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#V_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#V_L_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#V_L_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#V_L_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#V_L_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#V_L_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#V_L_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#V_L_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#V_L_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#V_L_70#        "
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   464

                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#V_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#V_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#V_H_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#V_H_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#V_H_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#V_H_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#V_H_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#V_H_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#V_H_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#V_H_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#V_H_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#V_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     5               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 1 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          ;*********************
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   465

                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          CcomFET         EQU     7       ;o
                    +1          ;                       EQU     6       ;i
                    +1          Rcp_In          EQU     5       ;i
                    +1          ;                       EQU     4       ;i 
                    +1          Mux_C           EQU     3       ;i
                    +1          Comp_Com        EQU     2       ;i
                    +1          Mux_B           EQU     1       ;i
                    +1          Mux_A           EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     NOT(1 SHL CcomFET)
                    +1          P0_PUSHPULL     EQU     (1 SHL CcomFET)
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 1 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 1 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 1 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   466

                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 90 == 0
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   467

                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0POL, #00h                           ; Pwm noninverted
                    +1          ELSE
                    +1                  mov     PCA0POL, #01h                           ; Damping inverted, pwm noninver
                               ted
                    +1          ENDIF
                    +1                  ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO
                    +1                  anl     PCA0CN0, #0FEh
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   468

                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          ApwmFET         EQU     6       ;i
                    +1          AcomFET         EQU     5       ;i
                    +1          BpwmFET         EQU     4       ;o
                    +1          ;               EQU     3       ;o
                    +1          ;               EQU     2       ;o
                    +1          BcomFET         EQU     1       ;o
                    +1          CpwmFET         EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)
                    +1          P1_INIT         EQU     00h             
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)
                    +1          P1_SKIP         EQU     7Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 90 == 0
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   469

                    +1                  setb    P0.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P0.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P0.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  setb P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  setb    P0.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  clr     P0.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P0.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1                  mov     P0SKIP, #0FFh
                    +1                  mov     P1SKIP, #3Fh
                    +1          ELSE
                    +1                  mov     P0SKIP, #0FFh
                    +1                  mov     P1SKIP, #1Fh
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   470

                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1                  mov     P0SKIP, #0FFh
                    +1                  mov     P1SKIP, #6Fh
                    +1          ELSE
                    +1                  mov     P0SKIP, #0FFh
                    +1                  mov     P1SKIP, #6Dh
                    +1          endif
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 90 == 0
                    +1                  setb    P0.CcomFET
                    +1                  mov     P0SKIP, #0FFh
                    +1                  mov     P1SKIP, #7Fh
                    +1          ELSE
                    +1                  mov     P0SKIP, #7Fh
                    +1                  mov     P1SKIP, #7Eh
                    +1          endif
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P0SKIP, #0FFh
                    +1                  mov     P1SKIP, #7Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #02h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #12h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #32h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 1 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   471

                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 1 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1          ENDM
                    +1          Set_LED_1 MACRO
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   472

                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                      29140     
                      29141     IF 23 == W_
                      29142     ;$include (W.inc) ; Select pinout W
                    +129143     ;**** **** **** **** ****
                    +129144     ;
                    +129145     ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +129146     ;
                    +129147     ; Copyright 2011, 2012 Steffen Skaug
                    +129148     ; This program is distributed under the terms of the GNU General Public License
                    +129149     ;
                    +129150     ; This file is part of BLHeli.
                    +129151     ;
                    +129152     ; BLHeli is free software: you can redistribute it and/or modify
                    +129153     ; it under the terms of the GNU General Public License as published by
                    +129154     ; the Free Software Foundation, either version 3 of the License, or
                    +129155     ; (at your option) any later version.
                    +129156     ;
                    +129157     ; BLHeli is distributed in the hope that it will be useful,
                    +129158     ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +129159     ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +129160     ; GNU General Public License for more details.
                    +129161     ;
                    +129162     ; You should have received a copy of the GNU General Public License
                    +129163     ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +129164     ;
                    +129165     ;**** **** **** **** ****
                    +129166     ;
                    +129167     ; Hardware definition file "W". This is for tristate input style FET driver chips
                    +129168     ; RC MC MB X CC MA X X     X  Ap Bp Cp X X X X
                    +129169     ;
                    +129170     ;**** **** **** **** ****
                    +129171     
                    +129172     
                    +129173     
                    +129174     ;*********************
                    +129175     ; Device SiLabs EFM8BB1x/2x
                    +129176     ;*********************
                    +129177     IF 1 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   473

                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   474

                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   475

                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   476

                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   477

                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +129504     ;$include (SI_EFM8BB2_Defs.inc)
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   478

                    +229505     ;------------------------------------------------------------------------------
                    +229506     ; Copyright 2014 Silicon Laboratories, Inc.
                    +229507     ; All rights reserved. This program and the accompanying materials
                    +229508     ; are made available under the terms of the Silicon Laboratories End User
                    +229509     ; License Agreement which accompanies this distribution, and is available at
                    +229510     ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +229511     ; Original content and implementation provided by Silicon Laboratories.
                    +229512     ;------------------------------------------------------------------------------
                    +229513     ;Supported Devices:
                    +229514     ;  EFM8BB21F16G_QFN20
                    +229515     ;  EFM8BB21F16G_QSOP24
                    +229516     ;  EFM8BB21F16I_QFN20
                    +229517     ;  EFM8BB21F16I_QSOP24
                    +229518     ;  EFM8BB22F16G_QFN28
                    +229519     ;  EFM8BB22F16I_QFN28
                    +229520     
                    +229521     ;-----------------------------------------------------------------------------
                    +229522     ; Register Definitions
                    +229523     ;-----------------------------------------------------------------------------
 00E0               +229524     ACC       DATA 0E0H; Accumulator                            
 00B3               +229525     ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
 00BC               +229526     ADC0CF    DATA 0BCH; ADC0 Configuration                     
 00E8               +229527     ADC0CN0   DATA 0E8H; ADC0 Control 0                         
 00B2               +229528     ADC0CN1   DATA 0B2H; ADC0 Control 1                         
 00C4               +229529     ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
 00C3               +229530     ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
 00BE               +229531     ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
 00BD               +229532     ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
 00C6               +229533     ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
 00C5               +229534     ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
 00BB               +229535     ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
 00DF               +229536     ADC0PWR   DATA 0DFH; ADC0 Power Control                     
 00B9               +229537     ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
 00F0               +229538     B         DATA 0F0H; B Register                             
 008E               +229539     CKCON0    DATA 08EH; Clock Control 0                        
 00A6               +229540     CKCON1    DATA 0A6H; Clock Control 1
 00A9               +229541     CLKSEL    DATA 0A9H; Clock Select                           
 009B               +229542     CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
 0099               +229543     CMP0CN1   DATA 099H; Comparator 0 Control 1
 009D               +229544     CMP0MD    DATA 09DH; Comparator 0 Mode                      
 009F               +229545     CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
 00BF               +229546     CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
 00AC               +229547     CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
 00AB               +229548     CMP1MD    DATA 0ABH; Comparator 1 Mode                      
 00AA               +229549     CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
 00CE               +229550     CRC0CN0   DATA 0CEH; CRC0 Control 0                         
 0086               +229551     CRC0CN1   DATA 086H; CRC0 Control 1                         
 00D3               +229552     CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
 00DE               +229553     CRC0DAT   DATA 0DEH; CRC0 Data Output                       
 00CF               +229554     CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
 00DD               +229555     CRC0IN    DATA 0DDH; CRC0 Data Input                        
 00D2               +229556     CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
 00AD               +229557     DERIVID   DATA 0ADH; Derivative Identification              
 00B5               +229558     DEVICEID  DATA 0B5H; Device Identification                  
 0083               +229559     DPH       DATA 083H; Data Pointer High                      
 0082               +229560     DPL       DATA 082H; Data Pointer Low                       
 00E6               +229561     EIE1      DATA 0E6H; Extended Interrupt Enable 1            
 00CE               +229562     EIE2      DATA 0CEH; Extended Interrupt Enable 2            
 00F3               +229563     EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
 00F5               +229564     EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
 00F4               +229565     EIP2      DATA 0F4H; Extended Interrupt Priority 2          
 00F6               +229566     EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   479

 00E7               +229567     EMI0CN    DATA 0E7H; External Memory Interface Control      
 00B7               +229568     FLKEY     DATA 0B7H; Flash Lock and Key                     
 00C7               +229569     HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
 00D6               +229570     HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
 00EF               +229571     HFOCN     DATA 0EFH; High Frequency Oscillator Control      
 00BA               +229572     I2C0CN0   DATA 0BAH; I2C0 Control                           
 00BC               +229573     I2C0DIN   DATA 0BCH; I2C0 Received Data                     
 00BB               +229574     I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
 00AD               +229575     I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
 00AB               +229576     I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
 00F5               +229577     I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
 00BD               +229578     I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
 00B9               +229579     I2C0STAT  DATA 0B9H; I2C0 Status                            
 00A8               +229580     IE        DATA 0A8H; Interrupt Enable                       
 00B8               +229581     IP        DATA 0B8H; Interrupt Priority                     
 00F2               +229582     IPH       DATA 0F2H; Interrupt Priority High                
 00E4               +229583     IT01CF    DATA 0E4H; INT0/INT1 Configuration                
 00B1               +229584     LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
 0080               +229585     P0        DATA 080H; Port 0 Pin Latch                       
 00FE               +229586     P0MASK    DATA 0FEH; Port 0 Mask                            
 00FD               +229587     P0MAT     DATA 0FDH; Port 0 Match                           
 00F1               +229588     P0MDIN    DATA 0F1H; Port 0 Input Mode                      
 00A4               +229589     P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
 00D4               +229590     P0SKIP    DATA 0D4H; Port 0 Skip                            
 0090               +229591     P1        DATA 090H; Port 1 Pin Latch                       
 00EE               +229592     P1MASK    DATA 0EEH; Port 1 Mask                            
 00ED               +229593     P1MAT     DATA 0EDH; Port 1 Match                           
 00F2               +229594     P1MDIN    DATA 0F2H; Port 1 Input Mode                      
 00A5               +229595     P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
 00D5               +229596     P1SKIP    DATA 0D5H; Port 1 Skip                            
 00A0               +229597     P2        DATA 0A0H; Port 2 Pin Latch                       
 00FC               +229598     P2MASK    DATA 0FCH; Port 2 Mask                            
 00FB               +229599     P2MAT     DATA 0FBH; Port 2 Match                           
 00F3               +229600     P2MDIN    DATA 0F3H; Port 2 Input Mode                      
 00A6               +229601     P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
 00CC               +229602     P2SKIP    DATA 0CCH; Port 2 Skip                            
 00B0               +229603     P3        DATA 0B0H; Port 3 Pin Latch                       
 00F4               +229604     P3MDIN    DATA 0F4H; Port 3 Input Mode                      
 009C               +229605     P3MDOUT   DATA 09CH; Port 3 Output Mode                     
 009E               +229606     PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
 009C               +229607     PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
 00D8               +229608     PCA0CN0   DATA 0D8H; PCA Control                            
 00FC               +229609     PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
 00EA               +229610     PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
 00EC               +229611     PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
 00FB               +229612     PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
 00E9               +229613     PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
 00EB               +229614     PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
 00DA               +229615     PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
 00DB               +229616     PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
 00DC               +229617     PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
 00FA               +229618     PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
 00F9               +229619     PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
 00D9               +229620     PCA0MD    DATA 0D9H; PCA Mode                               
 0096               +229621     PCA0POL   DATA 096H; PCA Output Polarity                    
 00F7               +229622     PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
 0087               +229623     PCON0     DATA 087H; Power Control                          
 009A               +229624     PCON1     DATA 09AH; Power Control 1                        
 00C1               +229625     PFE0CN    DATA 0C1H; Prefetch Engine Control                
 00F6               +229626     PRTDRV    DATA 0F6H; Port Drive Strength                    
 008F               +229627     PSCTL     DATA 08FH; Program Store Control                  
 00D0               +229628     PSW       DATA 0D0H; Program Status Word                    
 00D1               +229629     REF0CN    DATA 0D1H; Voltage Reference Control              
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   480

 00C9               +229630     REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
 00C6               +229631     REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
 00B6               +229632     REVID     DATA 0B6H; Revision Identifcation                 
 00EF               +229633     RSTSRC    DATA 0EFH; Reset Source                           
 0094               +229634     SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
 0096               +229635     SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
 0095               +229636     SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
 0099               +229637     SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
 0092               +229638     SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
 0098               +229639     SCON0     DATA 098H; UART0 Serial Port Control              
 00C8               +229640     SCON1     DATA 0C8H; UART1 Serial Port Control              
 00A7               +229641     SFRPAGE   DATA 0A7H; SFR Page                               
 00CF               +229642     SFRPGCN   DATA 0CFH; SFR Page Control                       
 00D7               +229643     SFRSTACK  DATA 0D7H; SFR Page Stack                         
 00D6               +229644     SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
 00D7               +229645     SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
 00C1               +229646     SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
 00C0               +229647     SMB0CN0   DATA 0C0H; SMBus 0 Control                        
 00C2               +229648     SMB0DAT   DATA 0C2H; SMBus 0 Data                           
 00C3               +229649     SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
 00C4               +229650     SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
 00EF               +229651     SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
 00C5               +229652     SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
 00AC               +229653     SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
 0093               +229654     SMOD1     DATA 093H; UART1 Mode                             
 0081               +229655     SP        DATA 081H; Stack Pointer                          
 00A1               +229656     SPI0CFG   DATA 0A1H; SPI0 Configuration                     
 00A2               +229657     SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
 00F8               +229658     SPI0CN0   DATA 0F8H; SPI0 Control                           
 00A3               +229659     SPI0DAT   DATA 0A3H; SPI0 Data                              
 009A               +229660     SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
 009B               +229661     SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
 00F7               +229662     SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
 0088               +229663     TCON      DATA 088H; Timer 0/1 Control                      
 008C               +229664     TH0       DATA 08CH; Timer 0 High Byte                      
 008D               +229665     TH1       DATA 08DH; Timer 1 High Byte                      
 008A               +229666     TL0       DATA 08AH; Timer 0 Low Byte                       
 008B               +229667     TL1       DATA 08BH; Timer 1 Low Byte                       
 0089               +229668     TMOD      DATA 089H; Timer 0/1 Mode                         
 00C8               +229669     TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
 00FD               +229670     TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
 00CD               +229671     TMR2H     DATA 0CDH; Timer 2 High Byte                      
 00CC               +229672     TMR2L     DATA 0CCH; Timer 2 Low Byte                       
 00CB               +229673     TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
 00CA               +229674     TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
 0091               +229675     TMR3CN0   DATA 091H; Timer 3 Control 0                      
 00FE               +229676     TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
 0095               +229677     TMR3H     DATA 095H; Timer 3 High Byte                      
 0094               +229678     TMR3L     DATA 094H; Timer 3 Low Byte                       
 0093               +229679     TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
 0092               +229680     TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
 0098               +229681     TMR4CN0   DATA 098H; Timer 4 Control 0                      
 00FF               +229682     TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
 00A5               +229683     TMR4H     DATA 0A5H; Timer 4 High Byte                      
 00A4               +229684     TMR4L     DATA 0A4H; Timer 4 Low Byte                       
 00A3               +229685     TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
 00A2               +229686     TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
 009D               +229687     UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
 00D8               +229688     UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
 00FA               +229689     UART1FCT  DATA 0FAH; UART1 FIFO Count                       
 009E               +229690     UART1LIN  DATA 09EH; UART1 LIN Configuration                
 00FF               +229691     VDM0CN    DATA 0FFH; Supply Monitor Control                 
 0097               +229692     WDTCN     DATA 097H; Watchdog Timer Control                 
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   481

 00E1               +229693     XBR0      DATA 0E1H; Port I/O Crossbar 0                    
 00E2               +229694     XBR1      DATA 0E2H; Port I/O Crossbar 1                    
 00E3               +229695     XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +229696     
                    +229697     ;------------------------------------------------------------------------------
                    +229698     ; 16-bit Register Definitions (may not work on all compilers)
                    +229699     ;------------------------------------------------------------------------------
 00C3               +229700     ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
 00BD               +229701     ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
 00C5               +229702     ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
 0082               +229703     DP      DATA 082H ; Data Pointer Low                     
 00FB               +229704     PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
 00E9               +229705     PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
 00EB               +229706     PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
 00F9               +229707     PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
 0095               +229708     SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
 00CC               +229709     TMR2    DATA 0CCH ; Timer 2 Low Byte                     
 00CA               +229710     TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
 0094               +229711     TMR3    DATA 094H ; Timer 3 Low Byte                     
 0092               +229712     TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
 00A4               +229713     TMR4    DATA 0A4H ; Timer 4 Low Byte                     
 00A2               +229714     TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +229715     
                    +229716     ;------------------------------------------------------------------------------
                    +229717     ; Indirect Register Definitions
                    +229718     ;------------------------------------------------------------------------------
                    +229719     
                    +229720     ;------------------------------------------------------------------------------
                    +229721     ; Bit Definitions
                    +229722     ;------------------------------------------------------------------------------
                    +229723     
                    +229724     ; ACC 0xE0 (Accumulator)
 00E0.0             +229725     ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
 00E0.1             +229726     ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
 00E0.2             +229727     ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
 00E0.3             +229728     ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
 00E0.4             +229729     ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
 00E0.5             +229730     ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
 00E0.6             +229731     ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
 00E0.7             +229732     ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +229733     
                    +229734     ; ADC0CN0 0xE8 (ADC0 Control 0)
 00E8.0             +229735     ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
 00E8.1             +229736     ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
 00E8.2             +229737     ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
 00E8.3             +229738     ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
 00E8.4             +229739     ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
 00E8.5             +229740     ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
 00E8.6             +229741     ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
 00E8.7             +229742     ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +229743     
                    +229744     ; B 0xF0 (B Register)
 00F0.0             +229745     B_B0 BIT B.0 ; B Register Bit 0
 00F0.1             +229746     B_B1 BIT B.1 ; B Register Bit 1
 00F0.2             +229747     B_B2 BIT B.2 ; B Register Bit 2
 00F0.3             +229748     B_B3 BIT B.3 ; B Register Bit 3
 00F0.4             +229749     B_B4 BIT B.4 ; B Register Bit 4
 00F0.5             +229750     B_B5 BIT B.5 ; B Register Bit 5
 00F0.6             +229751     B_B6 BIT B.6 ; B Register Bit 6
 00F0.7             +229752     B_B7 BIT B.7 ; B Register Bit 7
                    +229753     
                    +229754     ; IE 0xA8 (Interrupt Enable)
 00A8.0             +229755     IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   482

 00A8.1             +229756     IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
 00A8.2             +229757     IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
 00A8.3             +229758     IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
 00A8.4             +229759     IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
 00A8.5             +229760     IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
 00A8.6             +229761     IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
 00A8.7             +229762     IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +229763     
                    +229764     ; IP 0xB8 (Interrupt Priority)
 00B8.0             +229765     IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
 00B8.1             +229766     IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
 00B8.2             +229767     IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
 00B8.3             +229768     IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
 00B8.4             +229769     IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
 00B8.5             +229770     IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
 00B8.6             +229771     IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +229772     
                    +229773     ; P0 0x80 (Port 0 Pin Latch)
 0080.0             +229774     P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
 0080.1             +229775     P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
 0080.2             +229776     P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
 0080.3             +229777     P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
 0080.4             +229778     P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
 0080.5             +229779     P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
 0080.6             +229780     P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
 0080.7             +229781     P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +229782     
                    +229783     ; P1 0x90 (Port 1 Pin Latch)
 0090.0             +229784     P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
 0090.1             +229785     P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
 0090.2             +229786     P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
 0090.3             +229787     P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
 0090.4             +229788     P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
 0090.5             +229789     P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
 0090.6             +229790     P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
 0090.7             +229791     P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +229792     
                    +229793     ; P2 0xA0 (Port 2 Pin Latch)
 00A0.0             +229794     P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
 00A0.1             +229795     P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
 00A0.2             +229796     P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
 00A0.3             +229797     P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +229798     
                    +229799     ; P3 0xB0 (Port 3 Pin Latch)
 00B0.0             +229800     P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
 00B0.1             +229801     P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +229802     
                    +229803     ; PCA0CN0 0xD8 (PCA Control)
 00D8.0             +229804     PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
 00D8.1             +229805     PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
 00D8.2             +229806     PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
 00D8.6             +229807     PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
 00D8.7             +229808     PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +229809     
                    +229810     ; PSW 0xD0 (Program Status Word)
 00D0.0             +229811     PSW_PARITY BIT PSW.0 ; Parity Flag               
 00D0.1             +229812     PSW_F1     BIT PSW.1 ; User Flag 1               
 00D0.2             +229813     PSW_OV     BIT PSW.2 ; Overflow Flag             
 00D0.3             +229814     PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
 00D0.4             +229815     PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
 00D0.5             +229816     PSW_F0     BIT PSW.5 ; User Flag 0               
 00D0.6             +229817     PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
 00D0.7             +229818     PSW_CY     BIT PSW.7 ; Carry Flag                
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   483

                    +229819     
                    +229820     ; SCON0 0x98 (UART0 Serial Port Control)
 0098.0             +229821     SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
 0098.1             +229822     SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
 0098.2             +229823     SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
 0098.3             +229824     SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
 0098.4             +229825     SCON0_REN   BIT SCON0.4 ; Receive Enable                     
 0098.5             +229826     SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
 0098.7             +229827     SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +229828     
                    +229829     ; SCON1 0xC8 (UART1 Serial Port Control)
 00C8.0             +229830     SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
 00C8.1             +229831     SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
 00C8.2             +229832     SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
 00C8.3             +229833     SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
 00C8.4             +229834     SCON1_REN  BIT SCON1.4 ; Receive Enable           
 00C8.6             +229835     SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
 00C8.7             +229836     SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +229837     
                    +229838     ; SMB0CN0 0xC0 (SMBus 0 Control)
 00C0.0             +229839     SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
 00C0.1             +229840     SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
 00C0.2             +229841     SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
 00C0.3             +229842     SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
 00C0.4             +229843     SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
 00C0.5             +229844     SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
 00C0.6             +229845     SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
 00C0.7             +229846     SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +229847     
                    +229848     ; SPI0CN0 0xF8 (SPI0 Control)
 00F8.0             +229849     SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
 00F8.1             +229850     SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
 00F8.2             +229851     SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
 00F8.3             +229852     SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
 00F8.4             +229853     SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
 00F8.5             +229854     SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
 00F8.6             +229855     SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
 00F8.7             +229856     SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +229857     
                    +229858     ; TCON 0x88 (Timer 0/1 Control)
 0088.0             +229859     TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
 0088.1             +229860     TCON_IE0 BIT TCON.1 ; External Interrupt 0   
 0088.2             +229861     TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
 0088.3             +229862     TCON_IE1 BIT TCON.3 ; External Interrupt 1   
 0088.4             +229863     TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
 0088.5             +229864     TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
 0088.6             +229865     TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
 0088.7             +229866     TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +229867     
                    +229868     ; TMR2CN0 0xC8 (Timer 2 Control 0)
 00C8.0             +229869     TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
 00C8.1             +229870     TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
 00C8.2             +229871     TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
 00C8.3             +229872     TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
 00C8.4             +229873     TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
 00C8.5             +229874     TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
 00C8.6             +229875     TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
 00C8.7             +229876     TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +229877     
                    +229878     ; TMR4CN0 0x98 (Timer 4 Control 0)
 0098.0             +229879     TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
 0098.1             +229880     TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
 0098.2             +229881     TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   484

 0098.3             +229882     TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
 0098.4             +229883     TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
 0098.5             +229884     TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
 0098.6             +229885     TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
 0098.7             +229886     TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +229887     
                    +229888     ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
 00D8.0             +229889     UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
 00D8.1             +229890     UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
 00D8.2             +229891     UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
 00D8.3             +229892     UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
 00D8.4             +229893     UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
 00D8.5             +229894     UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
 00D8.6             +229895     UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
 00D8.7             +229896     UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +229897     
                    +229898     ;------------------------------------------------------------------------------
                    +229899     ; Interrupt Definitions
                    +229900     ;------------------------------------------------------------------------------
 0000               +229901     INT0_IRQn    EQU 0  ; External Interrupt 0      
 0001               +229902     TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
 0002               +229903     INT1_IRQn    EQU 2  ; External Interrupt 1      
 0003               +229904     TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
 0004               +229905     UART0_IRQn   EQU 4  ; UART0                     
 0005               +229906     TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
 0006               +229907     SPI0_IRQn    EQU 6  ; SPI0                      
 0007               +229908     SMBUS0_IRQn  EQU 7  ; SMBus 0                   
 0008               +229909     PMATCH_IRQn  EQU 8  ; Port Match                
 0009               +229910     ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
 000A               +229911     ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
 000B               +229912     PCA0_IRQn    EQU 11 ; PCA0                      
 000C               +229913     CMP0_IRQn    EQU 12 ; Comparator 0              
 000D               +229914     CMP1_IRQn    EQU 13 ; Comparator 1              
 000E               +229915     TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
 0011               +229916     UART1_IRQn   EQU 17 ; UART1                     
 0012               +229917     I2C0_IRQn    EQU 18 ; I2C0 Slave                
 0013               +229918     TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +229919     
                    +229920     ;------------------------------------------------------------------------------
                    +229921     ; SFR Page Definitions
                    +229922     ;------------------------------------------------------------------------------
 0000               +229923     CRC0_PAGE       EQU 000H ; CRC0 Page       
 0000               +229924     LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
 0000               +229925     PCA0_PAGE       EQU 000H ; PCA0 Page       
 0010               +229926     PG2_PAGE        EQU 010H ; Page2           
 0010               +229927     TIMER2_PAGE     EQU 010H ; Timer 2 Page    
 0010               +229928     TIMER3_PAGE     EQU 010H ; Timer 3 Page    
 0010               +229929     TIMER4_PAGE     EQU 010H ; Timer 4 Page    
 0020               +229930     I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
 0020               +229931     PG3_PAGE        EQU 020H ; Page3           
 0020               +229932     SMB0_PAGE       EQU 020H ; SMBus 0 Page    
 0020               +229933     SPI0_PAGE       EQU 020H ; SPI0 Page       
 0020               +229934     UART0_PAGE      EQU 020H ; UART0 Page      
 0020               +229935     UART1_PAGE      EQU 020H ; UART1 Page      
                    +129936     
                    +129937     ENDIF
                    +129938     
                    +129939     
                    +129940     ;**** **** **** **** ****
                    +129941     ; Uses internal calibrated oscillator set to 24/48Mhz
                    +129942     ;**** **** **** **** ****
                    +129943     
                    +129944     ;**** **** **** **** ****
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   485

                    +129945     ; Constant definitions
                    +129946     ;**** **** **** **** ****
                    +129947     IF 1 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#W_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#W_L_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#W_L_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#W_L_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#W_L_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#W_L_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#W_L_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#W_L_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#W_L_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#W_L_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#W_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +129976     
001A40              +129977     CSEG AT 1A40h
                    +129978     IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#W_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#W_H_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#W_H_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#W_H_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#W_H_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#W_H_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#W_H_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#W_H_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#W_H_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#W_H_70#        "
                    +1          ELSEIF 90 == 90
001A40 23575F48     +129999     Eep_ESC_Layout:         DB      "#W_H_90#        "
001A44 5F393023                 
001A48 20202020                 
001A4C 20202020                 
                    +130000     ENDIF
001A50              +130001     CSEG AT 1A50h
001A50 23424C48     +130002     Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   486

001A54 454C4924                 
001A58 45464D38                 
001A5C 42323123                 
                    +130003     ENDIF
                    +130004     
 0031               +130005     TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
 0009               +130006     TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +130007     
                    +130008     ;**** **** **** **** ****
                    +130009     ; Bootloader definitions
                    +130010     ;**** **** **** **** ****
 0080               +130011     RTX_PORT                                EQU     P0              ; Receive/Transmit port
 00A4               +130012     RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
 00F1               +130013     RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
 00D4               +130014     RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
 0007               +130015     RTX_PIN                         EQU     7               ; RTX pin
                    +130016     
 00E8               +130017     SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +130018     IF 1 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
 00B2               +130021     SIGNATURE_002                   EQU     0B2h
                    +130022     ENDIF
                    +130023     
                    +130024     
                    +130025     ;*********************
                    +130026     ; PORT 0 definitions *
                    +130027     ;*********************  
 0007               +130028     Rcp_In          EQU     7       ;i
 0006               +130029     Mux_C           EQU     6       ;i
 0005               +130030     Mux_B           EQU     5       ;i
                    +130031     ;               EQU     4       ;i
 0003               +130032     Comp_Com        EQU     3       ;i
 0002               +130033     Mux_A           EQU     2       ;i
                    +130034     ;               EQU     1       ;i
                    +130035     ;               EQU     0       ;i
                    +130036     
 FF93               +130037     P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
 00FF               +130038     P0_INIT         EQU     0FFh
 0000               +130039     P0_PUSHPULL     EQU     0
 00FF               +130040     P0_SKIP         EQU     0FFh
                    +130041     
                    +130042     
                    +130043     Get_Rcp_Capture_Values MACRO
                    +130044             anl     TCON, #0EFh                             ; Disable timer0
                    +130045             mov     Temp1, TL0                              ; Get timer0 values
                    +130046             mov     Temp2, TH0
                    +130047     IF 1 == 1
                    +130048             mov     Temp3, Timer0_X
                    +130049             jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +130050             inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +130051     ENDIF
                    +130052             mov     TL0, #0                                 ; Reset timer0
                    +130053             mov     TH0, #0
                    +130054     IF 1 == 1
                    +130055             mov     Timer0_X, #0
                    +130056     ENDIF
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   487

                    +130057             orl     TCON, #10h                              ; Enable timer0 again
                    +130058     IF 1 == 1
                    +130059             mov     A, Clock_Set_At_48MHz
                    +130060             jnz     Get_Rcp_End
                    +130061             clr     C
                    +130062             mov     A, Temp1
                    +130063             rlc     A
                    +130064             mov     Temp1, A
                    +130065             mov     A, Temp2
                    +130066             rlc     A
                    +130067             mov     Temp2, A
                    +130068             mov     A, Temp3
                    +130069             rlc     A
                    +130070             mov     Temp3, A
                    +130071     Get_Rcp_End:
                    +130072     ENDIF
                    +130073     ENDM
                    +130074     Decode_Dshot_2Msb MACRO
                    +130075             movx    A, @DPTR
                    +130076             mov     Temp6, A
                    +130077             clr     C
                    +130078             subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +130079             clr     C
                    +130080             subb    A, Temp1
                    +130081             jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +130082     
                    +130083             subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +130084             mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +130085             rlc     A
                    +130086             mov     Temp4, A
                    +130087             inc     DPL                                             ; Next bit
                    +130088             movx    A, @DPTR
                    +130089             mov     Temp5, A
                    +130090             clr     C
                    +130091             subb    A, Temp6
                    +130092             clr     C
                    +130093             subb    A, Temp1
                    +130094             jc      t1_int_msb_fail
                    +130095     
                    +130096             subb    A, Temp1
                    +130097             mov     A, Temp4
                    +130098             rlc     A
                    +130099             mov     Temp4, A
                    +130100             inc     DPL
                    +130101     ENDM
                    +130102     Decode_Dshot_2Lsb MACRO
                    +130103             movx    A, @DPTR
                    +130104             mov     Temp6, A
                    +130105             clr     C
                    +130106             subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +130107             clr     C
                    +130108             subb    A, Temp1
                    +130109             jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +130110     
                    +130111             subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +130112             mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +130113             rlc     A
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   488

                    +130114             mov     Temp3, A
                    +130115             inc     DPL                                             ; Next bit
                    +130116             movx    A, @DPTR
                    +130117             mov     Temp5, A
                    +130118             clr     C
                    +130119             subb    A, Temp6
                    +130120             clr     C
                    +130121             subb    A, Temp1
                    +130122             jc      t1_int_lsb_fail
                    +130123     
                    +130124             subb    A, Temp1
                    +130125             mov     A, Temp3
                    +130126             rlc     A
                    +130127             mov     Temp3, A
                    +130128             inc     DPL
                    +130129     ENDM
                    +130130     Initialize_PCA MACRO
                    +130131             mov     PCA0CN0, #40h                           ; PCA enabled
                    +130132             mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +130133     IF 90 == 0
                    +130134     IF 1 == 0
                    +130135             mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +130136     ELSE
                    +130137             mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +130138     ENDIF
                    +130139             mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +130140     ELSE
                    +130141     IF 1 == 0
                    +130142             mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +130143     ELSE
                    +130144             mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +130145     ENDIF
                    +130146             mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +130147     ENDIF
                    +130148     ENDM
                    +130149     Set_Pwm_Polarity MACRO
                    +130150     IF 90 == 0
                    +130151             mov     PCA0POL, #00h                           ; Pwm noninverted
                    +130152     ELSE
                    +130153             mov     PCA0POL, #01h                           ; Damping inverted, pwm noninver
                               ted
                    +130154     ENDIF
                    +130155     ENDM
                    +130156     Enable_Power_Pwm_Module MACRO
                    +130157     IF 90 == 0
                    +130158             mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +130159     ELSE
                    +130160             mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +130161     ENDIF
                    +130162     ENDM
                    +130163     Enable_Damp_Pwm_Module MACRO
                    +130164     IF 90 == 0
                    +130165             mov     PCA0CPM1, #00h                          ; Disable
                    +130166     ELSE
                    +130167             mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +130168     ENDIF
                    +130169     ENDM
                    +130170     Set_Power_Pwm_Regs MACRO
                    +130171     IF 90 == 0
                    +130172             mov     PCA0CPL0, Power_Pwm_Reg_L
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   489

                    +130173             mov     PCA0CPH0, Power_Pwm_Reg_H
                    +130174     ELSE
                    +130175             clr     C
                    +130176             mov     A, Power_Pwm_Reg_H
                    +130177             rrc     A
                    +130178             mov     Temp1, A
                    +130179             mov     A, Power_Pwm_Reg_L
                    +130180             rrc     A
                    +130181             mov     PCA0CPL1, A
                    +130182             mov     PCA0CPH1, Temp1
                    +130183     ENDIF
                    +130184     ENDM            
                    +130185     Set_Damp_Pwm_Regs MACRO
                    +130186     IF 90 == 0
                    +130187             mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +130188             mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +130189     ELSE
                    +130190             clr     C
                    +130191             mov     A, Damp_Pwm_Reg_H
                    +130192             rrc     A
                    +130193             mov     Temp1, A
                    +130194             mov     A, Damp_Pwm_Reg_L
                    +130195             rrc     A
                    +130196             mov     PCA0CPL0, A
                    +130197             mov     PCA0CPH0, Temp1
                    +130198     ENDIF
                    +130199     ENDM            
                    +130200     Clear_COVF_Interrupt MACRO
                    +130201             anl     PCA0PWM, #0DFh
                    +130202     ENDM
                    +130203     Clear_CCF_Interrupt MACRO       ; CCF interrupt is only used for FETON_DELAY == 0
                    +130204             anl     PCA0CN0, #0FEh
                    +130205     ENDM
                    +130206     Enable_COVF_Interrupt MACRO
                    +130207             orl     PCA0PWM, #40h
                    +130208     ENDM
                    +130209     Enable_CCF_Interrupt MACRO
                    +130210             orl     PCA0CPM0,#01h
                    +130211     ENDM
                    +130212     Disable_COVF_Interrupt MACRO
                    +130213             anl     PCA0PWM, #0BFh
                    +130214     ENDM
                    +130215     Disable_CCF_Interrupt MACRO
                    +130216             anl     PCA0CPM0,#0FEh
                    +130217     ENDM
                    +130218     
                    +130219     
                    +130220     ;*********************
                    +130221     ; PORT 1 definitions *
                    +130222     ;*********************
                    +130223     ;               EQU     7       ;i
 0006               +130224     ApwmFET         EQU     6       ;o
 0005               +130225     BpwmFET         EQU     5       ;o
 0004               +130226     CpwmFET         EQU     4       ;o
                    +130227     ;               EQU     3       ;i
                    +130228     ;               EQU     2       ;i
                    +130229     ;               EQU     1       ;i
                    +130230     ;               EQU     0       ;i
                    +130231     ; pwm outputs start as analog in -> floating
                    +130232     ; this ensures all mosfet drivers start with floating outputs
 FF8F               +130233     P1_DIGITAL      EQU     NOT((1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET))
 0000               +130234     P1_INIT         EQU     00h
 0070               +130235     P1_PUSHPULL     EQU     ((1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET))
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   490

                    +130236     ;
 00FF               +130237     P1_SKIP         EQU     0FFh
                    +130238     
                    +130239     
                    +130240     ApwmFET_on MACRO
                    +130241             setb     P1.ApwmFET             ; set pin to high
                    +130242             orl P1MDIN, #(1 SHL ApwmFET)    ; enable pin driver
                    +130243     ENDM
                    +130244     ApwmFET_off MACRO
                    +130245             anl P1MDIN, #(NOT(1 SHL ApwmFET))       ; analog in -> pullup, driver and digita
                               l in is disable = floating
                    +130246     ENDM
                    +130247     BpwmFET_on MACRO
                    +130248             setb P1.BpwmFET         ; set pin to high
                    +130249             orl P1MDIN, #(1 SHL BpwmFET)    ; enable pin driver
                    +130250     ENDM
                    +130251     BpwmFET_off MACRO
                    +130252             anl P1MDIN, #(NOT(1 SHL BpwmFET))       ; analog in -> pullup, driver and digita
                               l in is disable = floating
                    +130253     ENDM
                    +130254     CpwmFET_on MACRO
                    +130255             setb     P1.CpwmFET             ; set pin to high
                    +130256             orl P1MDIN, #(1 SHL CpwmFET)    ; enable pin driver
                    +130257     ENDM
                    +130258     CpwmFET_off MACRO
                    +130259             anl P1MDIN, #(NOT(1 SHL CpwmFET))       ; analog in -> pullup, driver and digita
                               l in is disable = floating
                    +130260     ENDM
                    +130261     All_pwmFETs_Off MACRO
                    +130262             anl P1MDIN, #(NOT((1 SHL ApwmFET) + (1 SHL BpwmFET) + (1 SHL CpwmFET))) ; analog
                                in -> pullup, driver and digital in is disable = floating
                    +130263     ENDM
                    +130264     
                    +130265     AcomFET_on MACRO
                    +130266             clr P1.ApwmFET                  ; set pin to low
                    +130267             orl P1MDIN, #(1 SHL ApwmFET)    ; enable pin driver
                    +130268     ENDM
                    +130269     AcomFET_off MACRO
                    +130270             anl P1MDIN, #(NOT(1 SHL ApwmFET))       ; analog in -> pullup, driver and digita
                               l in is disable = floating
                    +130271     ENDM
                    +130272     BcomFET_on MACRO
                    +130273             clr P1.BpwmFET                  ; set pin to low
                    +130274             orl P1MDIN, #(1 SHL BpwmFET)    ; enable pin driver
                    +130275     ENDM
                    +130276     BcomFET_off MACRO
                    +130277             anl P1MDIN, #(NOT(1 SHL BpwmFET))       ; analog in -> pullup, driver and digita
                               l in is disable = floating
                    +130278     ENDM
                    +130279     CcomFET_on MACRO
                    +130280             clr P1.CpwmFET                  ; set pin to low
                    +130281             orl P1MDIN, #(1 SHL CpwmFET)    ; enable pin driver
                    +130282     ENDM
                    +130283     CcomFET_off MACRO
                    +130284             anl P1MDIN, #(NOT(1 SHL CpwmFET))       ; analog in -> pullup, driver and digita
                               l in is disable = floating
                    +130285     ENDM
                    +130286     All_comFETs_Off MACRO
                    +130287             anl P1MDIN, #(NOT((1 SHL ApwmFET) + (1 SHL BpwmFET) + (1 SHL CpwmFET))) ; analog
                                in -> pullup, driver and digital in is disable = floating
                    +130288     ENDM
                    +130289     Set_Pwm_A MACRO
                    +130290             mov     P1SKIP, #(NOT(1 SHL ApwmFET));
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   491

                    +130291             orl     P1MDIN, #(1 SHL ApwmFET)        ; enable pin driver
                    +130292     ENDM
                    +130293     Set_Pwm_B MACRO
                    +130294             mov     P1SKIP, #(NOT(1 SHL BpwmFET));
                    +130295             orl     P1MDIN, #(1 SHL BpwmFET)        ; enable pin driver
                    +130296     ENDM
                    +130297     Set_Pwm_C MACRO
                    +130298             mov     P1SKIP, #(NOT(1 SHL CpwmFET));
                    +130299             orl     P1MDIN, #(1 SHL CpwmFET)        ; enable pin driver
                    +130300     ENDM
                    +130301     Set_Pwms_Off MACRO
                    +130302             mov     P1SKIP, #P1_SKIP;
                    +130303     ENDM
                    +130304     
                    +130305     
                    +130306     
                    +130307     Set_Comp_Phase_A MACRO
                    +130308             mov     CMP0MX, #((Mux_A) SHL 4)+((Comp_Com) SHL 0);
                    +130309     ENDM
                    +130310     Set_Comp_Phase_B MACRO
                    +130311             mov     CMP0MX, #((Mux_B) SHL 4)+((Comp_Com) SHL 0);
                    +130312     ENDM
                    +130313     Set_Comp_Phase_C MACRO
                    +130314             mov     CMP0MX, #((Mux_C) SHL 4)+((Comp_Com) SHL 0);
                    +130315     ENDM
                    +130316     Read_Comp_Out MACRO
                    +130317             mov     A, CMP0CN0      ; Read comparator output
                    +130318     ENDM
                    +130319     
                    +130320     
                    +130321     
                    +130322     ;*********************
                    +130323     ; PORT 2 definitions *
                    +130324     ;*********************
 0000               +130325     DebugPin                EQU     0       ;o
                    +130326     
 0001               +130327     P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +130328     
                    +130329     
                    +130330     ;**********************
                    +130331     ; MCU specific macros *
                    +130332     ;**********************
                    +130333     Interrupt_Table_Definition MACRO
                    +130334     CSEG AT 0                               ; Code segment start
                    +130335             jmp reset
                    +130336     CSEG AT 03h                     ; Int0 interrupt        
                    +130337             jmp     int0_int        
                    +130338     IF 1 == 1
                    +130339     CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +130340             jmp     t0_int
                    +130341     ENDIF
                    +130342     CSEG AT 13h                     ; Int1 interrupt
                    +130343             jmp     int1_int
                    +130344     CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +130345             jmp     t1_int
                    +130346     CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +130347             jmp     t2_int  
                    +130348     CSEG AT 5Bh                     ; Pca interrupt
                    +130349             jmp     pca_int
                    +130350     CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +130351             jmp     t3_int  
                    +130352     ENDM
                    +130353     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   492

                    +130354     Initialize_Xbar MACRO
                    +130355             mov     XBR2, #40h      ; Xbar enabled                  
                    +130356             mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +130357     ENDM
                    +130358     
                    +130359     Initialize_Comparator MACRO
                    +130360             mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +130361             mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +130362     ENDM
                    +130363     Initialize_Adc MACRO
                    +130364             mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +130365     IF 1 == 0
                    +130366             mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +130367     ELSE
                    +130368             mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +130369     ENDIF
                    +130370             mov     ADC0MX, #10h    ; Select temp sensor input
                    +130371             mov     ADC0CN0, #80h   ; ADC enabled 
                    +130372             mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +130373     ENDM
                    +130374     Start_Adc MACRO
                    +130375             mov     ADC0CN0, #90h   ; ADC start
                    +130376     ENDM
                    +130377     Read_Adc_Result MACRO
                    +130378             mov     Temp1, ADC0L
                    +130379             mov     Temp2, ADC0H
                    +130380     ENDM
                    +130381     Stop_Adc MACRO
                    +130382     ENDM
                    +130383     Set_RPM_Out MACRO
                    +130384     ENDM
                    +130385     Clear_RPM_Out MACRO
                    +130386     ENDM
                    +130387     Set_MCU_Clk_24MHz MACRO
                    +130388             mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +130389             mov     SFRPAGE, #10h
                    +130390             mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +130391             mov     SFRPAGE, #00h
                    +130392             mov     Clock_Set_At_48MHz, #0
                    +130393     ENDM
                    +130394     Set_MCU_Clk_48MHz MACRO
                    +130395             mov     SFRPAGE, #10h
                    +130396             mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +130397             mov     SFRPAGE, #00h
                    +130398             mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +130399             mov     Clock_Set_At_48MHz, #1
                    +130400     ENDM
                    +130401     Set_LED_0 MACRO
                    +130402     ENDM
                    +130403     Clear_LED_0 MACRO
                    +130404     ENDM
                    +130405     Set_LED_1 MACRO
                    +130406     ENDM
                    +130407     Clear_LED_1 MACRO
                    +130408     ENDM
                    +130409     Set_LED_2 MACRO
                    +130410     ENDM
                    +130411     Clear_LED_2 MACRO
                    +130412     ENDM
                    +130413     Set_LED_3 MACRO
                    +130414     ENDM
                    +130415     Clear_LED_3 MACRO
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   493

                    +130416     ENDM
                      30417     ENDIF
                      30418     
                      30419     
                      30420     ;**** **** **** **** ****
                      30421     ; Programming defaults
                      30422     ;
 0009                 30423     DEFAULT_PGM_STARTUP_PWR                                 EQU 9   ; 1=0.031 2=0.047 3=0.06
                               3 4=0.094 5=0.125 6=0.188       7=0.25  8=0.38  9=0.50  10=0.75 11=1.00 12=1.25 13=1.50
 0003                 30424     DEFAULT_PGM_COMM_TIMING                         EQU 3   ; 1=Low                 2=Medium
                               Low     3=Medium                4=MediumHigh    5=High
 0002                 30425     DEFAULT_PGM_DEMAG_COMP                          EQU 2   ; 1=Disabled    2=Low           
                               3=High
 0001                 30426     DEFAULT_PGM_DIRECTION                           EQU 1   ; 1=Normal      2=Reversed      
                               3=Bidir         4=Bidir rev
 0028                 30427     DEFAULT_PGM_BEEP_STRENGTH                       EQU 40  ; Beep strength
 0050                 30428     DEFAULT_PGM_BEACON_STRENGTH                     EQU 80  ; Beacon strength
 0004                 30429     DEFAULT_PGM_BEACON_DELAY                                EQU 4   ; 1=1m          2=2m    
                                               3=5m                    4=10m           5=Infinite
                      30430     
                      30431     ; COMMON
 0001                 30432     DEFAULT_PGM_ENABLE_TX_PROGRAM           EQU 1   ; 1=Enabled     0=Disabled
 0025                 30433     DEFAULT_PGM_MIN_THROTTLE                                EQU 37  ; 4*37+1000=1148
 00D0                 30434     DEFAULT_PGM_MAX_THROTTLE                                EQU 208 ; 4*208+1000=1832
 007A                 30435     DEFAULT_PGM_CENTER_THROTTLE                     EQU 122 ; 4*122+1000=1488 (used in bidir
                               ectional mode)
 0007                 30436     DEFAULT_PGM_ENABLE_TEMP_PROT                    EQU 7   ; 0=Disabled    1=80C   2=90C   
                               3=100C  4=110C  5=120C  6=130C  7=140C
 0001                 30437     DEFAULT_PGM_ENABLE_POWER_PROT           EQU 1   ; 1=Enabled     0=Disabled
 0000                 30438     DEFAULT_PGM_BRAKE_ON_STOP                       EQU 0   ; 1=Enabled     0=Disabled
 0000                 30439     DEFAULT_PGM_LED_CONTROL                         EQU 0   ; Byte for LED control. 2bits pe
                               r LED, 0=Off, 1=On
                      30440     
                      30441     ;**** **** **** **** ****
                      30442     ; Temporary register definitions
  REG                 30443     Temp1           EQU     R0
  REG                 30444     Temp2           EQU     R1
  REG                 30445     Temp3           EQU     R2
  REG                 30446     Temp4           EQU     R3
  REG                 30447     Temp5           EQU     R4
  REG                 30448     Temp6           EQU     R5
  REG                 30449     Temp7           EQU     R6
  REG                 30450     Temp8           EQU     R7
                      30451     
                      30452     ;**** **** **** **** ****
                      30453     ; Register definitions
000020                30454     DSEG AT 20h                                     ; Variables segment 
                      30455     
000020                30456     Bit_Access:                             DS      1               ; MUST BE AT THIS ADDRES
                               S. Variable at bit accessible address (for non interrupt routines)
000021                30457     Bit_Access_Int:                 DS      1               ; Variable at bit accessible add
                               ress (for interrupts)
                      30458     
000022                30459     Rcp_Outside_Range_Cnt:          DS      1               ; RC pulse outside range counter
                                (incrementing) 
000023                30460     Rcp_Timeout_Cntd:                       DS      1               ; RC pulse timeout count
                               er (decrementing) 
                      30461     
                      30462     
000024                30463     Flags0:                                 DS      1       ; State flags. Reset upon init_s
                               tart
 0000                 30464     T3_PENDING                              EQU     0               ; Timer 3 pending flag
 0001                 30465     DEMAG_DETECTED                          EQU     1               ; Set when excessive dem
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   494

                               ag time is detected
 0002                 30466     COMP_TIMED_OUT                          EQU     2               ; Set when comparator re
                               ading timed out
                      30467     ;                                               EQU     3
                      30468     ;                                               EQU     4
                      30469     ;                                               EQU     5       
                      30470     ;                                               EQU     6       
                      30471     ;                                               EQU     7       
                      30472     
                      30473     
000025                30474     Flags1:                                 DS      1       ; State flags. Reset upon init_s
                               tart 
 0000                 30475     STARTUP_PHASE                           EQU     0               ; Set when in startup ph
                               ase
 0001                 30476     INITIAL_RUN_PHASE                       EQU     1               ; Set when in initial ru
                               n phase, before synchronized run is achieved
 0002                 30477     MOTOR_STARTED                           EQU     2               ; Set when motor is star
                               ted
 0003                 30478     DIR_CHANGE_BRAKE                        EQU     3               ; Set when braking befor
                               e direction change
 0004                 30479     HIGH_RPM                                        EQU     4               ; Set when motor
                                rpm is high (Comm_Period4x_H less than 2)
                      30480     ;                                               EQU     5
                      30481     ;                                               EQU     6       
                      30482     ;                                               EQU     7       
                      30483     
000026                30484     Flags2:                                 DS      1               ; State flags. NOT reset
                                upon init_start
 0000                 30485     RCP_UPDATED                             EQU     0               ; New RC pulse length va
                               lue available
 0001                 30486     RCP_ONESHOT125                          EQU     1               ; RC pulse input is OneS
                               hot125 (125-250us)
 0002                 30487     RCP_ONESHOT42                           EQU     2               ; RC pulse input is OneS
                               hot42 (41.67-83us)
 0003                 30488     RCP_MULTISHOT                           EQU     3               ; RC pulse input is Mult
                               ishot (5-25us)
 0004                 30489     RCP_DSHOT                                       EQU     4               ; RC pulse input
                                is digital shot
 0005                 30490     RCP_DIR_REV                             EQU     5               ; RC pulse direction in 
                               bidirectional mode
 0006                 30491     RCP_FULL_RANGE                          EQU     6               ; When set full input si
                               gnal range is used (1000-2000us) and stored calibration values are ignored
                      30492     ;                                               EQU     7       
                      30493     
000027                30494     Flags3:                                 DS      1               ; State flags. NOT reset
                                upon init_start
 0000                 30495     PGM_DIR_REV                             EQU     0               ; Programmed direction. 
                               0=normal, 1=reversed
 0001                 30496     PGM_BIDIR_REV                           EQU     1               ; Programmed bidirection
                               al direction. 0=normal, 1=reversed
 0002                 30497     PGM_BIDIR                                       EQU     2               ; Programmed bid
                               irectional operation. 0=normal, 1=bidirectional
                      30498     ;                                               EQU     3
                      30499     ;                                               EQU     4       
                      30500     ;                                               EQU     5       
                      30501     ;                                               EQU     6       
                      30502     ;                                               EQU     7       
                      30503     
                      30504     
                      30505     ;**** **** **** **** ****
                      30506     ; RAM definitions
000030                30507     DSEG AT 30h                                             ; Ram data segment, direct addre
                               ssing
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   495

000030                30508     Initial_Arm:                            DS      1               ; Variable that is set d
                               uring the first arm sequence after power on
                      30509     
000031                30510     Min_Throttle_L:                 DS      1               ; Minimum throttle scaled (lo by
                               te)
000032                30511     Min_Throttle_H:                 DS      1               ; Minimum throttle scaled (hi by
                               te)
000033                30512     Center_Throttle_L:                      DS      1               ; Center throttle scaled
                                (lo byte)
000034                30513     Center_Throttle_H:                      DS      1               ; Center throttle scaled
                                (hi byte)
000035                30514     Max_Throttle_L:                 DS      1               ; Maximum throttle scaled (lo by
                               te)
000036                30515     Max_Throttle_H:                 DS      1               ; Maximum throttle scaled (hi by
                               te)
                      30516     
000037                30517     Power_On_Wait_Cnt_L:            DS      1               ; Power on wait counter (lo byte)
000038                30518     Power_On_Wait_Cnt_H:            DS      1               ; Power on wait counter (hi byte)
                      30519     
000039                30520     Startup_Cnt:                            DS      1               ; Startup phase commutat
                               ions counter (incrementing)
00003A                30521     Startup_Zc_Timeout_Cntd:                DS      1               ; Startup zero cross tim
                               eout counter (decrementing)
00003B                30522     Initial_Run_Rot_Cntd:           DS      1               ; Initial run rotations counter 
                               (decrementing)
00003C                30523     Stall_Cnt:                              DS      1               ; Counts start/run attem
                               pts that resulted in stall. Reset upon a proper stop
00003D                30524     Demag_Detected_Metric:          DS      1               ; Metric used to gauge demag eve
                               nt frequency
00003E                30525     Demag_Pwr_Off_Thresh:           DS      1               ; Metric threshold above which p
                               ower is cut
00003F                30526     Low_Rpm_Pwr_Slope:                      DS      1               ; Sets the slope of powe
                               r increase for low rpms
                      30527     
000040                30528     Timer0_X:                                       DS      1               ; Timer 0 extend
                               ed byte
000041                30529     Timer2_X:                                       DS      1               ; Timer 2 extend
                               ed byte
000042                30530     Prev_Comm_L:                            DS      1               ; Previous commutation t
                               imer 3 timestamp (lo byte)
000043                30531     Prev_Comm_H:                            DS      1               ; Previous commutation t
                               imer 3 timestamp (hi byte)
000044                30532     Prev_Comm_X:                            DS      1               ; Previous commutation t
                               imer 3 timestamp (ext byte)
000045                30533     Prev_Prev_Comm_L:                       DS      1               ; Pre-previous commutati
                               on timer 3 timestamp (lo byte)
000046                30534     Prev_Prev_Comm_H:                       DS      1               ; Pre-previous commutati
                               on timer 3 timestamp (hi byte)
000047                30535     Comm_Period4x_L:                        DS      1               ; Timer 3 counts between
                                the last 4 commutations (lo byte)
000048                30536     Comm_Period4x_H:                        DS      1               ; Timer 3 counts between
                                the last 4 commutations (hi byte)
000049                30537     Comparator_Read_Cnt:            DS      1               ; Number of comparator reads done
                      30538     
00004A                30539     Wt_Adv_Start_L:                 DS      1               ; Timer 3 start point for commut
                               ation advance timing (lo byte)
00004B                30540     Wt_Adv_Start_H:                 DS      1               ; Timer 3 start point for commut
                               ation advance timing (hi byte)
00004C                30541     Wt_Zc_Scan_Start_L:                     DS      1               ; Timer 3 start point fr
                               om commutation to zero cross scan (lo byte)
00004D                30542     Wt_Zc_Scan_Start_H:                     DS      1               ; Timer 3 start point fr
                               om commutation to zero cross scan (hi byte)
00004E                30543     Wt_Zc_Tout_Start_L:                     DS      1               ; Timer 3 start point fo
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   496

                               r zero cross scan timeout (lo byte)
00004F                30544     Wt_Zc_Tout_Start_H:                     DS      1               ; Timer 3 start point fo
                               r zero cross scan timeout (hi byte)
000050                30545     Wt_Comm_Start_L:                        DS      1               ; Timer 3 start point fr
                               om zero cross to commutation (lo byte)
000051                30546     Wt_Comm_Start_H:                        DS      1               ; Timer 3 start point fr
                               om zero cross to commutation (hi byte)
                      30547     
000052                30548     Dshot_Cmd:                              DS      1               ; Dshot command
000053                30549     Dshot_Cmd_Cnt:                          DS      1               ; Dshot command count
                      30550     
000054                30551     New_Rcp:                                        DS      1               ; New RC pulse v
                               alue in pca counts
000055                30552     Rcp_Stop_Cnt:                           DS      1               ; Counter for RC pulses 
                               below stop value
                      30553     
000056                30554     Power_Pwm_Reg_L:                        DS      1               ; Power pwm register set
                               ting (lo byte)
000057                30555     Power_Pwm_Reg_H:                        DS      1               ; Power pwm register set
                               ting (hi byte). 0x3F is minimum power
000058                30556     Damp_Pwm_Reg_L:                 DS      1               ; Damping pwm register setting (
                               lo byte)
000059                30557     Damp_Pwm_Reg_H:                 DS      1               ; Damping pwm register setting (
                               hi byte)
00005A                30558     Current_Power_Pwm_Reg_H:                DS      1               ; Current power pwm regi
                               ster setting that is loaded in the PCA register (hi byte)
                      30559     
00005B                30560     Pwm_Limit:                              DS      1               ; Maximum allowed pwm 
00005C                30561     Pwm_Limit_By_Rpm:                       DS      1               ; Maximum allowed pwm fo
                               r low or high rpms
00005D                30562     Pwm_Limit_Beg:                          DS      1               ; Initial pwm limit
                      30563     
00005E                30564     Adc_Conversion_Cnt:                     DS      1               ; Adc conversion counter
                      30565     
00005F                30566     Current_Average_Temp:           DS      1               ; Current average temperature (l
                               o byte ADC reading, assuming hi byte is 1)
                      30567     
000060                30568     Throttle_Gain:                          DS      1               ; Gain to be applied to 
                               RCP value
000061                30569     Throttle_Gain_M:                        DS      1               ; Gain to be applied to 
                               RCP value (multiplier 0=1x, 1=2x, 2=4x etc))
000062                30570     Throttle_Gain_BD_Rev:           DS      1               ; Gain to be applied to RCP valu
                               e for reverse direction in bidirectional mode
000063                30571     Throttle_Gain_BD_Rev_M:         DS      1               ; Gain to be applied to RCP valu
                               e for reverse direction in bidirectional mode (multiplier 0=1x, 1=2x, 2=4x etc)
000064                30572     Beep_Strength:                          DS      1               ; Strength of beeps
                      30573     
000065                30574     Skip_T2_Int:                            DS      1               ; Set for 48MHz MCUs whe
                               n timer 2 interrupt shall be ignored
000066                30575     Clock_Set_At_48MHz:                     DS      1               ; Variable set if 48MHz 
                               MCUs run at 48MHz
                      30576     
000067                30577     Flash_Key_1:                            DS      1               ; Flash key one
000068                30578     Flash_Key_2:                            DS      1               ; Flash key two
                      30579     
000069                30580     Temp_Prot_Limit:                        DS      1               ; Temperature protection
                                limit
                      30581     
00006A                30582     DShot_Pwm_Thr:                          DS      1               ; DShot pulse width thre
                               shold value
00006B                30583     DShot_Timer_Preset:                     DS      1               ; DShot timer preset for
                                frame sync detection
00006C                30584     DShot_Frame_Start_L:            DS      1               ; DShot frame start timestamp (l
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   497

                               o byte)
00006D                30585     DShot_Frame_Start_H:            DS      1               ; DShot frame start timestamp (h
                               i byte)
00006E                30586     DShot_Frame_Length_Thr:         DS      1               ; DShot frame length criteria (i
                               n units of 4 timer 2 ticks)
                      30587     
                      30588     ; Indirect addressing data segment. The variables below must be in this sequence
000080                30589     ISEG AT 080h                                    
000080                30590     _Pgm_Gov_P_Gain:                        DS      1               ; Programmed governor P 
                               gain
000081                30591     _Pgm_Gov_I_Gain:                        DS      1               ; Programmed governor I 
                               gain
000082                30592     _Pgm_Gov_Mode:                          DS      1               ; Programmed governor mo
                               de
000083                30593     _Pgm_Low_Voltage_Lim:           DS      1               ; Programmed low voltage limit
000084                30594     _Pgm_Motor_Gain:                        DS      1               ; Programmed motor gain
000085                30595     _Pgm_Motor_Idle:                        DS      1               ; Programmed motor idle 
                               speed
000086                30596     Pgm_Startup_Pwr:                        DS      1               ; Programmed startup pow
                               er
000087                30597     _Pgm_Pwm_Freq:                          DS      1               ; Programmed pwm frequen
                               cy
000088                30598     Pgm_Direction:                          DS      1               ; Programmed rotation di
                               rection
000089                30599     Pgm_Input_Pol:                          DS      1               ; Programmed input pwm p
                               olarity
00008A                30600     Initialized_L_Dummy:            DS      1               ; Place holder
00008B                30601     Initialized_H_Dummy:            DS      1               ; Place holder
00008C                30602     Pgm_Enable_TX_Program:          DS      1               ; Programmed enable/disable valu
                               e for TX programming
00008D                30603     _Pgm_Main_Rearm_Start:          DS      1               ; Programmed enable/disable re-a
                               rming main every start 
00008E                30604     _Pgm_Gov_Setup_Target:          DS      1               ; Programmed main governor setup
                                target
00008F                30605     _Pgm_Startup_Rpm:                       DS      1               ; Programmed startup rpm
                                (unused - place holder)
000090                30606     _Pgm_Startup_Accel:                     DS      1               ; Programmed startup acc
                               eleration (unused - place holder)
000091                30607     _Pgm_Volt_Comp:                 DS      1               ; Place holder
000092                30608     Pgm_Comm_Timing:                        DS      1               ; Programmed commutation
                                timing
000093                30609     _Pgm_Damping_Force:                     DS      1               ; Programmed damping for
                               ce (unused - place holder)
000094                30610     _Pgm_Gov_Range:                 DS      1               ; Programmed governor range
000095                30611     _Pgm_Startup_Method:            DS      1               ; Programmed startup method (unu
                               sed - place holder)
000096                30612     Pgm_Min_Throttle:                       DS      1               ; Programmed throttle mi
                               nimum
000097                30613     Pgm_Max_Throttle:                       DS      1               ; Programmed throttle ma
                               ximum
000098                30614     Pgm_Beep_Strength:                      DS      1               ; Programmed beep streng
                               th
000099                30615     Pgm_Beacon_Strength:            DS      1               ; Programmed beacon strength
00009A                30616     Pgm_Beacon_Delay:                       DS      1               ; Programmed beacon delay
00009B                30617     _Pgm_Throttle_Rate:                     DS      1               ; Programmed throttle ra
                               te (unused - place holder)
00009C                30618     Pgm_Demag_Comp:                 DS      1               ; Programmed demag compensation
00009D                30619     _Pgm_BEC_Voltage_High:          DS      1               ; Programmed BEC voltage
00009E                30620     Pgm_Center_Throttle:            DS      1               ; Programmed throttle center (in
                                bidirectional mode)
00009F                30621     _Pgm_Main_Spoolup_Time:         DS      1               ; Programmed main spoolup time
0000A0                30622     Pgm_Enable_Temp_Prot:           DS      1               ; Programmed temperature protect
                               ion enable
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   498

0000A1                30623     Pgm_Enable_Power_Prot:          DS      1               ; Programmed low rpm power prote
                               ction enable
0000A2                30624     _Pgm_Enable_Pwm_Input:          DS      1               ; Programmed PWM input signal en
                               able
0000A3                30625     _Pgm_Pwm_Dither:                        DS      1               ; Programmed output PWM 
                               dither
0000A4                30626     Pgm_Brake_On_Stop:                      DS      1               ; Programmed braking whe
                               n throttle is zero
0000A5                30627     Pgm_LED_Control:                        DS      1               ; Programmed LED control
                      30628     
                      30629     ; The sequence of the variables below is no longer of importance
0000A6                30630     Pgm_Startup_Pwr_Decoded:                DS      1               ; Programmed startup pow
                               er decoded
                      30631     
                      30632     
                      30633     ; Indirect addressing data segment
0000D0                30634     ISEG AT 0D0h                                    
0000D0                30635     Temp_Storage:                           DS      48              ; Temporary storage
                      30636     
                      30637     ;**** **** **** **** ****
001A00                30638     CSEG AT 1A00h            ; "Eeprom" segment
 0010                 30639     EEPROM_FW_MAIN_REVISION         EQU     16              ; Main revision of the firmware
 004D                 30640     EEPROM_FW_SUB_REVISION          EQU     77              ; Sub revision of the firmware ;
                                preston
 0021                 30641     EEPROM_LAYOUT_REVISION          EQU     33              ; Revision of the EEPROM layout
                      30642     
001A00 10             30643     Eep_FW_Main_Revision:           DB      EEPROM_FW_MAIN_REVISION                 ; EEPROM
                                firmware main revision number
001A01 4D             30644     Eep_FW_Sub_Revision:            DB      EEPROM_FW_SUB_REVISION                  ; EEPROM
                                firmware sub revision number
001A02 21             30645     Eep_Layout_Revision:            DB      EEPROM_LAYOUT_REVISION                  ; EEPROM
                                layout revision number
                      30646     
001A03 FF             30647     _Eep_Pgm_Gov_P_Gain:            DB      0FFh    
001A04 FF             30648     _Eep_Pgm_Gov_I_Gain:            DB      0FFh    
001A05 FF             30649     _Eep_Pgm_Gov_Mode:                      DB      0FFh    
001A06 FF             30650     _Eep_Pgm_Low_Voltage_Lim:       DB      0FFh                                            
                                       
001A07 FF             30651     _Eep_Pgm_Motor_Gain:            DB      0FFh    
001A08 FF             30652     _Eep_Pgm_Motor_Idle:            DB      0FFh                                            
001A09 09             30653     Eep_Pgm_Startup_Pwr:            DB      DEFAULT_PGM_STARTUP_PWR                 ; EEPROM
                                copy of programmed startup power
001A0A FF             30654     _Eep_Pgm_Pwm_Freq:                      DB      0FFh    
001A0B 01             30655     Eep_Pgm_Direction:                      DB      DEFAULT_PGM_DIRECTION                   
                               ; EEPROM copy of programmed rotation direction
001A0C FF             30656     _Eep_Pgm_Input_Pol:                     DB      0FFh
001A0D 55             30657     Eep_Initialized_L:                      DB      055h                                    
                                               ; EEPROM initialized signature low byte
001A0E AA             30658     Eep_Initialized_H:                      DB      0AAh                                    
                                               ; EEPROM initialized signature high byte
001A0F 01             30659     Eep_Enable_TX_Program:          DB      DEFAULT_PGM_ENABLE_TX_PROGRAM           ; EEPROM
                                TX programming enable
001A10 FF             30660     _Eep_Main_Rearm_Start:          DB      0FFh                                            
                                       
001A11 FF             30661     _Eep_Pgm_Gov_Setup_Target:      DB      0FFh                                            
                                       
001A12 FF             30662     _Eep_Pgm_Startup_Rpm:           DB      0FFh
001A13 FF             30663     _Eep_Pgm_Startup_Accel:         DB      0FFh
001A14 FF             30664     _Eep_Pgm_Volt_Comp:                     DB      0FFh    
001A15 03             30665     Eep_Pgm_Comm_Timing:            DB      DEFAULT_PGM_COMM_TIMING                 ; EEPROM
                                copy of programmed commutation timing
001A16 FF             30666     _Eep_Pgm_Damping_Force:         DB      0FFh
001A17 FF             30667     _Eep_Pgm_Gov_Range:                     DB      0FFh    
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   499

001A18 FF             30668     _Eep_Pgm_Startup_Method:                DB      0FFh
001A19 25             30669     Eep_Pgm_Min_Throttle:           DB      DEFAULT_PGM_MIN_THROTTLE                        
                               ; EEPROM copy of programmed minimum throttle
001A1A D0             30670     Eep_Pgm_Max_Throttle:           DB      DEFAULT_PGM_MAX_THROTTLE                        
                               ; EEPROM copy of programmed minimum throttle
001A1B 28             30671     Eep_Pgm_Beep_Strength:          DB      DEFAULT_PGM_BEEP_STRENGTH               ; EEPROM
                                copy of programmed beep strength
001A1C 50             30672     Eep_Pgm_Beacon_Strength:                DB      DEFAULT_PGM_BEACON_STRENGTH             
                               ; EEPROM copy of programmed beacon strength
001A1D 04             30673     Eep_Pgm_Beacon_Delay:           DB      DEFAULT_PGM_BEACON_DELAY                        
                               ; EEPROM copy of programmed beacon delay
001A1E FF             30674     _Eep_Pgm_Throttle_Rate:         DB      0FFh
001A1F 02             30675     Eep_Pgm_Demag_Comp:                     DB      DEFAULT_PGM_DEMAG_COMP                  
                               ; EEPROM copy of programmed demag compensation
001A20 FF             30676     _Eep_Pgm_BEC_Voltage_High:      DB      0FFh    
001A21 7A             30677     Eep_Pgm_Center_Throttle:                DB      DEFAULT_PGM_CENTER_THROTTLE             
                               ; EEPROM copy of programmed center throttle
001A22 FF             30678     _Eep_Pgm_Main_Spoolup_Time:     DB      0FFh
001A23 07             30679     Eep_Pgm_Temp_Prot_Enable:       DB      DEFAULT_PGM_ENABLE_TEMP_PROT            ; EEPROM
                                copy of programmed temperature protection enable
001A24 01             30680     Eep_Pgm_Enable_Power_Prot:      DB      DEFAULT_PGM_ENABLE_POWER_PROT           ; EEPROM
                                copy of programmed low rpm power protection enable
001A25 FF             30681     _Eep_Pgm_Enable_Pwm_Input:      DB      0FFh    
001A26 FF             30682     _Eep_Pgm_Pwm_Dither:            DB      0FFh    
001A27 00             30683     Eep_Pgm_Brake_On_Stop:          DB      DEFAULT_PGM_BRAKE_ON_STOP               ; EEPROM
                                copy of programmed braking when throttle is zero
001A28 00             30684     Eep_Pgm_LED_Control:            DB      DEFAULT_PGM_LED_CONTROL                 ; EEPROM
                                copy of programmed LED control
                      30685     
001A29 FF             30686     Eep_Dummy:                              DB      0FFh                                    
                                               ; EEPROM address for safety reason
                      30687     
001A60                30688     CSEG AT 1A60h
001A60 20202020       30689     Eep_Name:                                       DB      "                "              
                                               ; Name tag (16 Bytes)
001A64 20202020                 
001A68 20202020                 
001A6C 20202020                 
                      30690     
                      30691     ;**** **** **** **** ****
                      30692+1   Interrupt_Table_Definition              ; SiLabs interrupts
000080                30711     CSEG AT 80h                     ; Code segment after interrupt vectors 
                      30712     
                      30713     ;**** **** **** **** ****
                      30714     
                      30715     ; Table definitions
000080 0406080C       30716     STARTUP_POWER_TABLE:    DB      04h, 06h, 08h, 0Ch, 10h, 18h, 20h, 30h, 40h, 60h, 80h, 0
                               A0h, 0C0h
000084 10182030                 
000088 406080A0                 
00008C C0                       
                      30717     
                      30718     
                      30719     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      30720     ;
                      30721     ; Timer 0 interrupt routine
                      30722     ;
                      30723     ; No assumptions
                      30724     ;
                      30725     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      30726     IF 1 == 1
00008D                30727     t0_int:
00008D 0500       F   30728             inc     Timer0_X
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   500

00008F 32             30729             reti
                      30730     ENDIF
                      30731     
                      30732     
                      30733     
                      30734     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      30735     ;
                      30736     ; Timer 1 interrupt routine
                      30737     ;
                      30738     ; No assumptions
                      30739     ;
                      30740     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
000090                30741     t1_int:
000090 C2AF           30742             clr     IE_EA
000092 C2A8           30743             clr     IE_EX0                  ; Disable int0 interrupts
000094 53E6EF         30744             anl     EIE1, #0EFh             ; Disable pca interrupts
000097 C28E           30745             clr     TCON_TR1                        ; Stop timer 1
000099 85008B     F   30746             mov     TL1, DShot_Timer_Preset ; Reset sync timer
00009C C0D0           30747             push    PSW
00009E D2D3           30748             setb    PSW.3                   ; Select register bank 1 for this interrupt
0000A0 C0E0           30749             push    ACC
0000A2 C0F0           30750             push    B                               ; Will be pop'ed by int0 exit
0000A4 C2CA           30751             clr     TMR2CN0_TR2             ; Timer 2 disabled
0000A6 A8CC           30752             mov     Temp1, TMR2L            ; Read timer value
0000A8 A9CD           30753             mov     Temp2, TMR2H
0000AA D2CA           30754             setb    TMR2CN0_TR2             ; Timer 2 enabled
0000AC D2AF           30755             setb    IE_EA
                      30756             ; Reset timer 0
0000AE 758A00         30757             mov     TL0, #0
                      30758             ; Check frame time length
0000B1 C3             30759             clr     C
0000B2 E8             30760             mov     A, Temp1
0000B3 9500       F   30761             subb    A, DShot_Frame_Start_L
0000B5 F8             30762             mov     Temp1, A
0000B6 E9             30763             mov     A, Temp2
0000B7 9500       F   30764             subb    A, DShot_Frame_Start_H
0000B9 F9             30765             mov     Temp2, A
                      30766             ; Divide by 2 (or 4 for 48MHz). Unit is then us
0000BA C3             30767             clr     C
0000BB E9             30768             mov     A, Temp2
0000BC 13             30769             rrc     A
0000BD F9             30770             mov     Temp2, A
0000BE E8             30771             mov     A, Temp1
0000BF 13             30772             rrc     A
0000C0 F8             30773             mov     Temp1, A
0000C1 E500       F   30774             mov     A, Clock_Set_At_48MHz
0000C3 6007           30775             jz      t1_int_frame_time_scaled
                      30776     
0000C5 C3             30777             clr     C
0000C6 E9             30778             mov     A, Temp2
0000C7 13             30779             rrc     A
0000C8 F9             30780             mov     Temp2, A
0000C9 E8             30781             mov     A, Temp1
0000CA 13             30782             rrc     A
0000CB F8             30783             mov     Temp1, A
                      30784     
0000CC                30785     t1_int_frame_time_scaled:
0000CC E9             30786             mov     A, Temp2
0000CD 7025           30787             jnz     t1_int_msb_fail ; Frame too long
0000CF E8             30788             mov     A, Temp1
0000D0 9500       F   30789             subb    A, DShot_Frame_Length_Thr
0000D2 4020           30790             jc      t1_int_msb_fail ; Frame too short
0000D4 9500       F   30791             subb    A, DShot_Frame_Length_Thr
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   501

0000D6 501C           30792             jnc     t1_int_msb_fail ; Frame too long
                      30793     
                      30794             ; Check that correct number of pulses is received
0000D8 E582           30795             mov     A, DPL                  ; Read current pointer
0000DA B41017         30796             cjne    A, #16, t1_int_msb_fail
                      30797     
                      30798             ; Decode transmitted data
0000DD 7C00           30799             mov     Temp5, #0                       ; Reset timestamp
0000DF 7B00           30800             mov     Temp4, #0                       ; High byte of receive buffer
0000E1 7A00           30801             mov     Temp3, #0                       ; Low byte of receive buffer
0000E3 7908           30802             mov     Temp2, #8                       ; Number of bits per byte
0000E5 900000         30803             mov     DPTR, #0                        ; Set pointer
0000E8 A800       F   30804             mov     Temp1, DShot_Pwm_Thr; DShot pulse width criteria
0000EA E500       F   30805             mov     A, Clock_Set_At_48MHz
0000EC 7004           30806             jnz     t1_int_decode
                      30807     
0000EE C3             30808             clr     C
0000EF E8             30809             mov     A, Temp1                        ; Scale pulse width criteria
0000F0 13             30810             rrc     A
0000F1 F8             30811             mov     Temp1, A
                      30812     
0000F2                30813     t1_int_decode:
0000F2 0100       F   30814             ajmp    t1_int_decode_msb
                      30815     
0000F4                30816     t1_int_msb_fail:
0000F4 900000         30817             mov     DPTR, #0                        ; Set pointer to start
0000F7 D2A8           30818             setb    IE_EX0                  ; Enable int0 interrupts
0000F9 D2AA           30819             setb    IE_EX1                  ; Enable int1 interrupts
0000FB 0100       F   30820             ajmp int0_int_outside_range
                      30821     
0000FD                30822     t1_int_decode_msb:
                      30823             ; Decode DShot data Msb. Use more code space to save time (by not using loop)
                      30824+1           Decode_DShot_2Msb
                      30851+1           Decode_DShot_2Msb
                      30878+1           Decode_DShot_2Msb
                      30905+1           Decode_DShot_2Msb
00016D 0100       F   30932             ajmp    t1_int_decode_lsb
                      30933     
00016F                30934     t1_int_lsb_fail:
00016F 900000         30935             mov     DPTR, #0                        ; Set pointer to start
000172 D2A8           30936             setb    IE_EX0                  ; Enable int0 interrupts
000174 D2AA           30937             setb    IE_EX1                  ; Enable int1 interrupts
000176 0100       F   30938             ajmp int0_int_outside_range
                      30939     
000178                30940     t1_int_decode_lsb:
                      30941             ; Decode DShot data Lsb
                      30942+1           Decode_DShot_2Lsb
                      30969+1           Decode_DShot_2Lsb
                      30996+1           Decode_DShot_2Lsb
                      31023+1           Decode_DShot_2Lsb
                      31050             ; XOR check (in inverted data, which is ok)
0001E8 EB             31051             mov     A, Temp4
0001E9 C4             31052             swap    A
0001EA 6B             31053             xrl     A, Temp4
0001EB 6A             31054             xrl     A, Temp3
0001EC 54F0           31055             anl     A, #0F0h
0001EE F9             31056             mov     Temp2, A
0001EF EA             31057             mov     A, Temp3
0001F0 C4             31058             swap    A
0001F1 54F0           31059             anl     A, #0F0h
0001F3 C3             31060             clr     C
0001F4 99             31061             subb    A, Temp2
0001F5 6009           31062             jz      t1_int_xor_ok           ; XOR check
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   502

                      31063     
0001F7 900000         31064             mov     DPTR, #0                        ; Set pointer to start
0001FA D2A8           31065             setb    IE_EX0                  ; Enable int0 interrupts
0001FC D2AA           31066             setb    IE_EX1                  ; Enable int1 interrupts
0001FE 0100       F   31067             ajmp int0_int_outside_range
                      31068     
000200                31069     t1_int_xor_ok:
                      31070             ; Swap to be LSB aligned to 12 bits (and invert)
000200 EB             31071             mov     A, Temp4
000201 F4             31072             cpl     A
000202 C4             31073             swap A
000203 54F0           31074             anl     A, #0F0h                        ; Low nibble of high byte
000205 F9             31075             mov     Temp2, A
000206 EA             31076             mov     A, Temp3
000207 F4             31077             cpl     A
000208 C4             31078             swap    A
000209 540F           31079             anl     A, #0Fh                 ; High nibble of low byte 
00020B 49             31080             orl     A, Temp2
00020C FA             31081             mov     Temp3, A
00020D EB             31082             mov     A, Temp4                        ; High nibble of high byte
00020E F4             31083             cpl     A
00020F C4             31084             swap A
000210 540F           31085             anl     A, #0Fh
000212 FB             31086             mov     Temp4, A
                      31087             ; Subtract 96 (still 12 bits)
000213 C3             31088             clr     C
000214 EA             31089             mov     A, Temp3
000215 F9             31090             mov     Temp2, A
000216 9460           31091             subb    A, #96
000218 FA             31092             mov     Temp3, A
000219 EB             31093             mov     A, Temp4
00021A 9400           31094             subb    A, #0
00021C FB             31095             mov     Temp4, A
00021D 5020           31096             jnc     t1_normal_range
                      31097     
00021F C3             31098             clr     C       
000220 E9             31099             mov     A, Temp2                ; Check for 0 or dshot command
000221 7B00           31100             mov     Temp4, #0
000223 7A00           31101             mov     Temp3, #0
000225 7900           31102             mov     Temp2, #0
000227 6016           31103             jz      t1_normal_range
                      31104             
000229 C3             31105             clr     C                               ; We are in the special dshot range
00022A 13             31106             rrc     A                               ; Divide by 2
00022B 5006           31107             jnc     t1_dshot_set_cmd        ; Check for tlm bit set (if not telemetry, Temp2
                                will be zero and result in invalid command)
                      31108     
00022D F9             31109             mov     Temp2, A
00022E C3             31110             clr     C
00022F 9500       F   31111             subb A, Dshot_Cmd
000231 600A           31112             jz      t1_dshot_inc_cmd_cnt
                      31113     
000233                31114     t1_dshot_set_cmd:
000233 E9             31115             mov     A, Temp2
000234 F500       F   31116             mov     Dshot_Cmd, A
000236 750000     F   31117             mov     Dshot_Cmd_Cnt, #0
000239 7900           31118             mov     Temp2, #0
00023B 8002           31119             jmp     t1_normal_range
                      31120             
00023D                31121     t1_dshot_inc_cmd_cnt:
00023D 0500       F   31122             inc     Dshot_Cmd_Cnt
                      31123             
00023F                31124     t1_normal_range:
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   503

                      31125             ; Check for bidirectional operation (0=stop, 96-2095->fwd, 2096-4095->rev)
00023F 300027         31126             jnb     Flags3.PGM_BIDIR, t1_int_not_bidir      ; If not bidirectional operation
                                - branch
                      31127     
                      31128             ; Subtract 2000 (still 12 bits)
000242 C3             31129             clr     C
000243 EA             31130             mov     A, Temp3
000244 94D0           31131             subb    A, #0D0h
000246 F8             31132             mov     Temp1, A
000247 EB             31133             mov     A, Temp4
000248 9407           31134             subb    A, #07h
00024A F9             31135             mov     Temp2, A
00024B 400B           31136             jc      t1_int_bidir_fwd                                ; If result is negative 
                               - branch
                      31137     
00024D E8             31138             mov     A, Temp1
00024E FA             31139             mov     Temp3, A
00024F E9             31140             mov     A, Temp2
000250 FB             31141             mov     Temp4, A
000251 200009         31142             jb      Flags2.RCP_DIR_REV, t1_int_bidir_rev_chk        ; If same direction - br
                               anch
                      31143     
000254 D200       F   31144             setb    Flags2.RCP_DIR_REV
000256 0100       F   31145             ajmp    t1_int_bidir_rev_chk
                      31146     
000258                31147     t1_int_bidir_fwd:
000258 300002         31148             jnb     Flags2.RCP_DIR_REV, t1_int_bidir_rev_chk        ; If same direction - br
                               anch
                      31149     
00025B C200       F   31150             clr     Flags2.RCP_DIR_REV
                      31151     
00025D                31152     t1_int_bidir_rev_chk:
00025D 200002         31153             jb      Flags3.PGM_BIDIR_REV, ($+5)
                      31154     
000260 B200       F   31155             cpl     Flags2.RCP_DIR_REV
                      31156     
000262 C3             31157             clr     C                                                       ; Multiply throt
                               tle value by 2
000263 EA             31158             mov     A, Temp3
000264 33             31159             rlc     A
000265 FA             31160             mov     Temp3, A
000266 EB             31161             mov     A, Temp4
000267 33             31162             rlc     A
000268 FB             31163             mov     Temp4, A
000269                31164     t1_int_not_bidir:
                      31165             ; Generate 4/256
000269 EB             31166             mov     A, Temp4
00026A 2B             31167             add     A, Temp4
00026B 3B             31168             addc    A, Temp4
00026C 3B             31169             addc    A, Temp4
00026D F9             31170             mov     Temp2, A
                      31171             ; Align to 11 bits
00026E C3             31172             clr     C
00026F EB             31173             mov     A, Temp4
000270 13             31174             rrc     A
000271 FB             31175             mov     Temp4, A
000272 EA             31176             mov     A, Temp3
000273 13             31177             rrc     A
000274 FA             31178             mov     Temp3, A
                      31179             ; Scale from 2000 to 2048
000275 EA             31180             mov     A, Temp3
000276 29             31181             add     A, Temp2        ; Holds 4/128
000277 FA             31182             mov     Temp3, A
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   504

000278 EB             31183             mov     A, Temp4
000279 3400           31184             addc    A, #0
00027B FB             31185             mov     Temp4, A
00027C 30E304         31186             jnb     ACC.3, ($+7)
                      31187     
00027F 7AFF           31188             mov     Temp3, #0FFh
000281 7BFF           31189             mov     Temp4, #0FFh
                      31190     
                      31191             ; Boost pwm during direct start
000283 E500       F   31192             mov     A, Flags1
000285 5403           31193             anl     A, #((1 SHL STARTUP_PHASE)+(1 SHL INITIAL_RUN_PHASE))
000287 601B           31194             jz      t1_int_startup_boosted
                      31195     
000289 200018         31196             jb      Flags1.MOTOR_STARTED, t1_int_startup_boosted    ; Do not boost when chan
                               ging direction in bidirectional mode
                      31197     
00028C E500       F   31198             mov     A, Pwm_Limit_Beg                                ; Set 25% of max startup
                                power as minimum power
00028E 33             31199             rlc     A
00028F F9             31200             mov     Temp2, A
000290 EB             31201             mov     A, Temp4
000291 7007           31202             jnz     t1_int_startup_boost_stall
                      31203     
000293 C3             31204             clr     C
000294 E9             31205             mov     A, Temp2
000295 9A             31206             subb    A, Temp3
000296 4002           31207             jc      t1_int_startup_boost_stall
                      31208     
000298 E9             31209             mov     A, Temp2
000299 FA             31210             mov     Temp3, A
                      31211     
00029A                31212     t1_int_startup_boost_stall:
00029A E500       F   31213             mov     A, Stall_Cnt                                    ; Add an extra power boo
                               st during start
00029C C4             31214             swap    A
00029D 33             31215             rlc     A
00029E 2A             31216             add     A, Temp3
00029F FA             31217             mov     Temp3, A
0002A0 EB             31218             mov     A, Temp4
0002A1 3400           31219             addc    A, #0
0002A3 FB             31220             mov     Temp4, A
                      31221     
0002A4                31222     t1_int_startup_boosted:
                      31223             ; Set 8bit value
0002A4 C3             31224             clr     C
0002A5 EA             31225             mov     A, Temp3
0002A6 33             31226             rlc     A
0002A7 C4             31227             swap    A
0002A8 540F           31228             anl     A, #0Fh
0002AA F8             31229             mov     Temp1, A
0002AB EB             31230             mov     A, Temp4
0002AC 33             31231             rlc     A
0002AD C4             31232             swap    A
0002AE 54F0           31233             anl     A, #0F0h
0002B0 48             31234             orl     A, Temp1
0002B1 F8             31235             mov     Temp1, A
0002B2 7005           31236             jnz     t1_int_zero_rcp_checked ; New_Rcp (Temp1) is only zero if all 11 bits ar
                               e zero
                      31237     
0002B4 EA             31238             mov     A, Temp3
0002B5 6002           31239             jz      t1_int_zero_rcp_checked
                      31240     
0002B7 7801           31241             mov     Temp1, #1
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   505

                      31242     
0002B9                31243     t1_int_zero_rcp_checked:
                      31244             ; Align to 10 bits for 24MHz MCU
                      31245     IF 1 == 0
                                        clr     C
                                        mov     A, Temp4
                                        rrc     A
                                        mov     Temp4, A
                                        mov     A, Temp3
                                        rrc     A
                                        mov     Temp3, A
                                ENDIF
0002B9 900000         31254             mov     DPTR, #0                                        ; Set pointer to start
0002BC D2A8           31255             setb    IE_EX0                                  ; Enable int0 interrupts
0002BE D2AA           31256             setb    IE_EX1                                  ; Enable int1 interrupts
                      31257             ; Decrement outside range counter
0002C0 E500       F   31258             mov     A, Rcp_Outside_Range_Cnt
0002C2 6002           31259             jz      ($+4)
                      31260     
0002C4 1500       F   31261             dec     Rcp_Outside_Range_Cnt
                      31262     
0002C6 0100       F   31263             ajmp    int0_int_pulse_ready
                      31264     
0002C8                31265     t1_int_frame_fail:
0002C8 900000         31266             mov     DPTR, #0                                        ; Set pointer to start
0002CB D2A8           31267             setb    IE_EX0                                  ; Enable int0 interrupts
0002CD D2AA           31268             setb    IE_EX1                                  ; Enable int1 interrupts
0002CF 0100       F   31269             ajmp int0_int_outside_range
                      31270     
                      31271     
                      31272     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      31273     ;
                      31274     ; Timer 2 interrupt routine
                      31275     ;
                      31276     ; No assumptions
                      31277     ; Requirements: Temp variables can NOT be used since PSW.x is not set
                      31278     ;
                      31279     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0002D1                31280     t2_int: ; Happens every 32ms
0002D1 C0D0           31281             push    PSW                     ; Preserve registers through interrupt
0002D3 C0E0           31282             push    ACC
0002D5 C2CF           31283             clr     TMR2CN0_TF2H                            ; Clear interrupt flag
0002D7 0500       F   31284             inc     Timer2_X
                      31285     IF 1 == 1
0002D9 E500       F   31286             mov     A, Clock_Set_At_48MHz
0002DB 6009           31287             jz      t2_int_start
                      31288     
                      31289             ; Check skip variable
0002DD E500       F   31290             mov     A, Skip_T2_Int
0002DF 6005           31291             jz      t2_int_start                            ; Execute this interrupt
                      31292     
0002E1 750000     F   31293             mov     Skip_T2_Int, #0
0002E4 0100       F   31294             ajmp    t2_int_exit
                      31295     
0002E6                31296     t2_int_start:
0002E6 750001     F   31297             mov     Skip_T2_Int, #1                 ; Skip next interrupt
                      31298     ENDIF
                      31299             ; Update RC pulse timeout counter 
0002E9 E500       F   31300             mov     A, Rcp_Timeout_Cntd                     ; RC pulse timeout count zero?
0002EB 6002           31301             jz      ($+4)                                   ; Yes - do not decrement
                      31302     
0002ED 1500       F   31303             dec     Rcp_Timeout_Cntd                        ; No decrement
                      31304     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   506

                      31305             ; Check RC pulse against stop value
0002EF C3             31306             clr     C
0002F0 E500       F   31307             mov     A, New_Rcp                              ; Load new pulse value
0002F2 6005           31308             jz      t2_int_rcp_stop                 ; Check if pulse is below stop value
                      31309     
                      31310             ; RC pulse higher than stop value, reset stop counter
0002F4 750000     F   31311             mov     Rcp_Stop_Cnt, #0                        ; Reset rcp stop counter
0002F7 0100       F   31312             ajmp    t2_int_exit
                      31313     
0002F9                31314     t2_int_rcp_stop:
                      31315             ; RC pulse less than stop value
0002F9 E500       F   31316             mov     A, Rcp_Stop_Cnt                 ; Increment stop counter
0002FB 2401           31317             add     A, #1
0002FD F500       F   31318             mov     Rcp_Stop_Cnt, A
0002FF 5003           31319             jnc     ($+5)                                   ; Branch if counter has not wrap
                               ped
                      31320     
000301 7500FF     F   31321             mov     Rcp_Stop_Cnt, #0FFh                     ; Set stop counter to max
                      31322     
000304                31323     t2_int_exit:
000304 D0E0           31324             pop     ACC                     ; Restore preserved registers
000306 D0D0           31325             pop     PSW
000308 32             31326             reti
                      31327     
                      31328     
                      31329     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      31330     ;
                      31331     ; Timer 3 interrupt routine
                      31332     ;
                      31333     ; No assumptions
                      31334     ; Requirements: Temp variables can NOT be used since PSW.x is not set
                      31335     ;               ACC can not be used, as it is not pushed to stack
                      31336     ;
                      31337     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
000309                31338     t3_int: ; Used for commutation timing
000309 C2AF           31339             clr     IE_EA                   ; Disable all interrupts
00030B 53E67F         31340             anl     EIE1, #7Fh              ; Disable timer 3 interrupts
00030E 7592FA         31341             mov     TMR3RLL, #0FAh          ; Set a short delay before next interrupt
000311 7593FF         31342             mov     TMR3RLH, #0FFh
000314 C200       F   31343             clr     Flags0.T3_PENDING       ; Flag that timer has wrapped
000316 53917F         31344             anl     TMR3CN0, #07Fh          ; Timer 3 interrupt flag cleared
000319 D2AF           31345             setb    IE_EA                   ; Enable all interrupts
00031B 32             31346             reti
                      31347     
                      31348     
                      31349     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      31350     ;
                      31351     ; Int0 interrupt routine
                      31352     ;
                      31353     ; No assumptions
                      31354     ;
                      31355     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
00031C                31356     int0_int:       ; Used for RC pulse timing
00031C C0E0           31357             push    ACC
00031E E58A           31358             mov     A, TL0                  ; Read pwm for DShot immediately
                      31359             ; Test for DShot
000320 300008         31360             jnb     Flags2.RCP_DSHOT, int0_int_not_dshot
                      31361     
000323 85008B     F   31362             mov     TL1, DShot_Timer_Preset ; Reset sync timer
000326 F0             31363             movx    @DPTR, A                        ; Store pwm
000327 A3             31364             inc     DPTR
000328 D0E0           31365             pop     ACC
00032A 32             31366             reti
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   507

                      31367     
                      31368             ; Not DShot
00032B                31369     int0_int_not_dshot:
00032B D0E0           31370             pop     ACC
00032D C2AF           31371             clr     IE_EA
00032F 53E6EF         31372             anl     EIE1, #0EFh             ; Disable pca interrupts
000332 C0D0           31373             push    PSW                             ; Preserve registers through interrupt
000334 C0E0           31374             push    ACC
000336 C0F0           31375             push    B
000338 D2D3           31376             setb    PSW.3                   ; Select register bank 1 for this interrupt 
00033A D2AF           31377             setb    IE_EA
                      31378             ; Get the counter values
                      31379+1           Get_Rcp_Capture_Values
                      31409             ; Scale down to 10 bits (for 24MHz, and 11 bits for 48MHz)
000363 30001F         31410             jnb     Flags2.RCP_MULTISHOT, int0_int_fall_not_multishot
                      31411     
                      31412             ; Multishot - Multiply by 2 and add 1/16 and 1/32
000366 E8             31413             mov     A, Temp1                ; Divide by 16
000367 C4             31414             swap A
000368 540F           31415             anl     A, #0Fh
00036A FA             31416             mov     Temp3, A
00036B E9             31417             mov     A, Temp2
00036C C4             31418             swap    A
00036D 54F0           31419             anl     A, #0F0h
00036F 4A             31420             orl     A, Temp3
000370 FA             31421             mov     Temp3, A
000371 C3             31422             clr     C                       ; Make divided by 32
000372 13             31423             rrc     A
000373 2A             31424             add     A, Temp3                ; Add 1/16 to 1/32
000374 FA             31425             mov     Temp3, A
000375 C3             31426             clr     C                       ; Multiply by 2
000376 E8             31427             mov     A, Temp1
000377 33             31428             rlc     A
000378 F8             31429             mov     Temp1, A
000379 E9             31430             mov     A, Temp2
00037A 33             31431             rlc     A
00037B F9             31432             mov     Temp2, A
00037C E8             31433             mov     A, Temp1                ; Add 1/16 and 1/32
00037D 2A             31434             add     A, Temp3
00037E FA             31435             mov     Temp3, A
00037F E9             31436             mov     A, Temp2
                      31437     IF 1 == 0
                                        addc    A, #03h         ; Add to low end, to make signal look like 20-40us
                                ELSE
000380 3406           31440             addc    A, #06h
                      31441     ENDIF
000382 FB             31442             mov     Temp4, A
000383 0100       F   31443             ajmp    int0_int_fall_gain_done
                      31444     
000385                31445     int0_int_fall_not_multishot:
000385 30000F         31446             jnb     Flags2.RCP_ONESHOT42, int0_int_fall_not_oneshot_42
                      31447     
                      31448             ; Oneshot42 - Add 2/256
000388 C3             31449             clr     C
000389 E8             31450             mov     A, Temp1
00038A 33             31451             rlc     A
00038B E9             31452             mov     A, Temp2
00038C 33             31453             rlc     A
00038D FA             31454             mov     Temp3, A
00038E E8             31455             mov     A, Temp1
00038F 2A             31456             add     A, Temp3
000390 FA             31457             mov     Temp3, A
000391 E9             31458             mov     A, Temp2
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   508

000392 3400           31459             addc    A, #0
000394 FB             31460             mov     Temp4, A
000395 0100       F   31461             ajmp    int0_int_fall_gain_done
                      31462     
000397                31463     int0_int_fall_not_oneshot_42:
000397 300015         31464             jnb     Flags2.RCP_ONESHOT125, int0_int_fall_not_oneshot_125
                      31465     
                      31466             ; Oneshot125 - multiply by 86/256
00039A E8             31467             mov     A, Temp1                ; Multiply by 86 and divide by 256
00039B 75F056         31468             mov     B, #56h
00039E A4             31469             mul     AB
00039F AAF0           31470             mov     Temp3, B
0003A1 E9             31471             mov     A, Temp2
0003A2 75F056         31472             mov     B, #56h
0003A5 A4             31473             mul     AB
0003A6 2A             31474             add     A, Temp3
0003A7 FA             31475             mov     Temp3, A
0003A8 C5F0           31476             xch     A, B
0003AA 3400           31477             addc    A, #0
0003AC FB             31478             mov     Temp4, A
0003AD 0100       F   31479             ajmp    int0_int_fall_gain_done
                      31480     
0003AF                31481     int0_int_fall_not_oneshot_125:
                      31482             ; Regular signal - multiply by 43/1024
                      31483     IF 1 == 1
0003AF C3             31484             clr     C
0003B0 EA             31485             mov     A, Temp3                ; Divide by 2
0003B1 13             31486             rrc     A
0003B2 FA             31487             mov     Temp3, A
0003B3 E9             31488             mov     A, Temp2
0003B4 13             31489             rrc     A
0003B5 F9             31490             mov     Temp2, A
0003B6 E8             31491             mov     A, Temp1
0003B7 13             31492             rrc     A
0003B8 F8             31493             mov     Temp1, A
                      31494     ENDIF
0003B9 E8             31495             mov     A, Temp1                ; Multiply by 43 and divide by 1024
                      31496     IF 1 == 0
                                        mov     B, #2Bh
                                ELSE
0003BA 75F056         31499             mov     B, #56h         ; Multiply by 86
                      31500     ENDIF
0003BD A4             31501             mul     AB
0003BE AAF0           31502             mov     Temp3, B
0003C0 E9             31503             mov     A, Temp2
                      31504     IF 1 == 0
                                        mov     B, #2Bh
                                ELSE
0003C1 75F056         31507             mov     B, #56h         ; Multiply by 86
                      31508     ENDIF
0003C4 A4             31509             mul     AB
0003C5 2A             31510             add     A, Temp3
0003C6 FA             31511             mov     Temp3, A
0003C7 C5F0           31512             xch     A, B
0003C9 3400           31513             addc    A, #0
0003CB C3             31514             clr     C       
0003CC 13             31515             rrc     A                       ; Divide by 2 for total 512
0003CD FB             31516             mov     Temp4, A
0003CE EA             31517             mov     A, Temp3
0003CF 13             31518             rrc     A
0003D0 FA             31519             mov     Temp3, A
0003D1 C3             31520             clr     C
0003D2 EB             31521             mov     A, Temp4                ; Divide by 2 for total 1024
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   509

0003D3 13             31522             rrc     A                                               
0003D4 FB             31523             mov     Temp4, A
0003D5 EA             31524             mov     A, Temp3
0003D6 13             31525             rrc     A
0003D7 FA             31526             mov     Temp3, A
                      31527     
0003D8                31528     int0_int_fall_gain_done:
                      31529             ; Check if 2235us or above (in order to ignore false pulses)
0003D8 C3             31530             clr     C
0003D9 EB             31531             mov     A, Temp4                                                ; Is pulse 2235u
                               s or higher?
                      31532     IF 1 == 0
                                        subb A, #09h
                                ELSE
0003DA 9412           31535             subb A, #12h
                      31536     ENDIF
0003DC 5009           31537             jnc     int0_int_outside_range                  ; Yes - ignore pulse
                      31538     
                      31539             ; Check if below 900us (in order to ignore false pulses)
0003DE C3             31540             clr     C
0003DF EA             31541             mov     A, Temp3
                      31542     IF 1 == 0
                                        subb A, #9Ah
                                ELSE
0003E0 9434           31545             subb A, #34h
                      31546     ENDIF
0003E2 EB             31547             mov     A, Temp4
                      31548     IF 1 == 0
                                        subb A, #03h
                                ELSE
0003E3 9407           31551             subb A, #07h
                      31552     ENDIF
0003E5 5016           31553             jnc     int0_int_check_full_range               ; No - proceed
                      31554     
0003E7                31555     int0_int_outside_range:
0003E7 0500       F   31556             inc     Rcp_Outside_Range_Cnt
0003E9 E500       F   31557             mov     A, Rcp_Outside_Range_Cnt
0003EB 7002           31558             jnz     ($+4)
                      31559     
0003ED 1500       F   31560             dec     Rcp_Outside_Range_Cnt
                      31561     
0003EF C3             31562             clr     C
0003F0 E500       F   31563             mov     A, Rcp_Outside_Range_Cnt
0003F2 9432           31564             subb    A, #50                                          ; Allow a given number o
                               f outside pulses
0003F4 5002           31565             jnc     ($+4)
0003F6 0100       F   31566             ajmp    int0_int_set_timeout                    ; If outside limits - ignore fir
                               st pulses
                      31567     
0003F8 750000     F   31568             mov     New_Rcp, #0                                     ; Set pulse length to ze
                               ro
0003FB 0100       F   31569             ajmp    int0_int_exit                                   ; Exit without reseting 
                               timeout
                      31570     
0003FD                31571     int0_int_check_full_range:
                      31572             ; Decrement outside range counter
0003FD E500       F   31573             mov     A, Rcp_Outside_Range_Cnt
0003FF 6002           31574             jz      ($+4)
                      31575     
000401 1500       F   31576             dec     Rcp_Outside_Range_Cnt
                      31577     
                      31578             ; Calculate "1000us" plus throttle minimum
000403 300006         31579             jnb     Flags2.RCP_FULL_RANGE, int0_int_set_min ; Check if full range is chosen
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   510

                      31580     
000406 7C00           31581             mov     Temp5, #0                                               ; Set 1000us as 
                               default minimum
                      31582     IF 1 == 0
                                        mov     Temp6, #4
                                ELSE
000408 7D08           31585             mov     Temp6, #8
                      31586     ENDIF
00040A 0100       F   31587             ajmp    int0_int_calculate
                      31588     
00040C                31589     int0_int_set_min:
00040C AC00       F   31590             mov     Temp5, Min_Throttle_L                   ; Min throttle value scaled
00040E AD00       F   31591             mov     Temp6, Min_Throttle_H
000410 300004         31592             jnb     Flags3.PGM_BIDIR, ($+7)
                      31593     
000413 AC00       F   31594             mov     Temp5, Center_Throttle_L                        ; Center throttle value 
                               scaled
000415 AD00       F   31595             mov     Temp6, Center_Throttle_H
                      31596     
000417                31597     int0_int_calculate:
000417 C3             31598             clr     C
000418 EA             31599             mov     A, Temp3                                                ; Subtract minim
                               um
000419 9C             31600             subb    A, Temp5
00041A FA             31601             mov     Temp3, A
00041B EB             31602             mov     A, Temp4                                        
00041C 9D             31603             subb    A, Temp6
00041D FB             31604             mov     Temp4, A
00041E 9200       F   31605             mov     Bit_Access_Int.0, C
000420 AE00       F   31606             mov     Temp7, Throttle_Gain                            ; Load Temp7/Temp8 with 
                               throttle gain
000422 AF00       F   31607             mov     Temp8, Throttle_Gain_M
000424 300042         31608             jnb     Flags3.PGM_BIDIR, int0_int_not_bidir    ; If not bidirectional operation
                                - branch
                      31609     
000427 5007           31610             jnc     int0_int_bidir_fwd                                      ; If result is p
                               ositive - branch
                      31611     
000429 200009         31612             jb      Flags2.RCP_DIR_REV, int0_int_bidir_rev_chk      ; If same direction - br
                               anch
                      31613     
00042C D200       F   31614             setb    Flags2.RCP_DIR_REV
00042E 0100       F   31615             ajmp    int0_int_bidir_rev_chk
                      31616     
000430                31617     int0_int_bidir_fwd:
000430 300002         31618             jnb     Flags2.RCP_DIR_REV, int0_int_bidir_rev_chk      ; If same direction - br
                               anch
                      31619     
000433 C200       F   31620             clr     Flags2.RCP_DIR_REV
                      31621     
000435                31622     int0_int_bidir_rev_chk:
000435 300004         31623             jnb     Flags2.RCP_DIR_REV, ($+7)
                      31624     
000438 AE00       F   31625             mov     Temp7, Throttle_Gain_BD_Rev             ; Load Temp7/Temp8 with throttle
                                gain for bidirectional reverse
00043A AF00       F   31626             mov     Temp8, Throttle_Gain_BD_Rev_M
                      31627     
00043C 200002         31628             jb      Flags3.PGM_BIDIR_REV, ($+5)
                      31629     
00043F B200       F   31630             cpl     Flags2.RCP_DIR_REV
                      31631     
000441 C3             31632             clr     C                                                       ; Multiply throt
                               tle value by 2
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   511

000442 EA             31633             mov     A, Temp3
000443 33             31634             rlc     A
000444 FA             31635             mov     Temp3, A
000445 EB             31636             mov     A, Temp4
000446 33             31637             rlc     A
000447 FB             31638             mov     Temp4, A
000448 A200       F   31639             mov     C, Bit_Access_Int.0
00044A 500A           31640             jnc     int0_int_bidir_do_deadband              ; If result is positive - branch
                      31641     
00044C EA             31642             mov     A, Temp3                                                ; Change sign
00044D F4             31643             cpl     A
00044E 2401           31644             add     A, #1
000450 FA             31645             mov     Temp3, A
000451 EB             31646             mov     A, Temp4
000452 F4             31647             cpl     A
000453 3400           31648             addc    A, #0
000455 FB             31649             mov     Temp4, A
                      31650     
000456                31651     int0_int_bidir_do_deadband:
000456 C3             31652             clr     C                                                       ; Subtract deadb
                               and
000457 EA             31653             mov     A, Temp3
                      31654     IF 1 == 0
                                        subb    A, #40
                                ELSE
000458 9450           31657             subb    A, #80
                      31658     ENDIF
00045A FA             31659             mov     Temp3, A
00045B EB             31660             mov     A, Temp4
00045C 9400           31661             subb    A, #0
00045E FB             31662             mov     Temp4, A
00045F 5014           31663             jnc     int0_int_do_throttle_gain
                      31664     
000461 7800           31665             mov     Temp1, #0
000463 7A00           31666             mov     Temp3, #0
000465 7B00           31667             mov     Temp4, #0
000467 0100       F   31668             ajmp    int0_int_do_throttle_gain
                      31669     
000469                31670     int0_int_not_bidir:
000469 A200       F   31671             mov     C, Bit_Access_Int.0
00046B 5008           31672             jnc     int0_int_do_throttle_gain               ; If result is positive - branch
                      31673     
00046D                31674     int0_int_unidir_neg:
00046D 7800           31675             mov     Temp1, #0                                               ; Yes - set to m
                               inimum
00046F 7A00           31676             mov     Temp3, #0
000471 7B00           31677             mov     Temp4, #0
000473 0100       F   31678             ajmp    int0_int_pulse_ready
                      31679     
000475                31680     int0_int_do_throttle_gain:
                      31681             ; Boost pwm during direct start
000475 E500       F   31682             mov     A, Flags1
000477 5403           31683             anl     A, #((1 SHL STARTUP_PHASE)+(1 SHL INITIAL_RUN_PHASE))
000479 601B           31684             jz      int0_int_startup_boosted
                      31685     
00047B 200018         31686             jb      Flags1.MOTOR_STARTED, int0_int_startup_boosted  ; Do not boost when chan
                               ging direction in bidirectional mode
                      31687     
00047E E500       F   31688             mov     A, Pwm_Limit_Beg                                ; Set 25% of max startup
                                power as minimum power
                      31689     IF 1 == 1
000480 33             31690             rlc     A
                      31691     ENDIF
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   512

000481 F9             31692             mov     Temp2, A
000482 EB             31693             mov     A, Temp4
000483 7007           31694             jnz     int0_int_startup_boost_stall
                      31695     
000485 C3             31696             clr     C
000486 E9             31697             mov     A, Temp2
000487 9A             31698             subb    A, Temp3
000488 4002           31699             jc      int0_int_startup_boost_stall
                      31700     
00048A E9             31701             mov     A, Temp2
00048B FA             31702             mov     Temp3, A
                      31703     
00048C                31704     int0_int_startup_boost_stall:
00048C E500       F   31705             mov     A, Stall_Cnt                                    ; Add an extra power boo
                               st during start
00048E C4             31706             swap    A
                      31707     IF 1 == 1
00048F 33             31708             rlc     A
                      31709     ENDIF
000490 2A             31710             add     A, Temp3
000491 FA             31711             mov     Temp3, A
000492 EB             31712             mov     A, Temp4
000493 3400           31713             addc    A, #0
000495 FB             31714             mov     Temp4, A
                      31715     
000496                31716     int0_int_startup_boosted:
000496 EA             31717             mov     A, Temp3                                                ; Multiply throt
                               tle value by throttle gain
000497 8EF0           31718             mov     B, Temp7                                                ; Temp7 has Thro
                               ttle_Gain
000499 A4             31719             mul     AB
00049A F9             31720             mov     Temp2, A
00049B AAF0           31721             mov     Temp3, B
00049D EB             31722             mov     A, Temp4
00049E 8EF0           31723             mov     B, Temp7                                                ; Temp7 has Thro
                               ttle_Gain
0004A0 A4             31724             mul     AB
0004A1 2A             31725             add     A, Temp3
0004A2 FA             31726             mov     Temp3, A
0004A3 C5F0           31727             xch     A, B
0004A5 3400           31728             addc    A, #0
0004A7 FB             31729             mov     Temp4, A
0004A8 C3             31730             clr     C                                                       ; Generate 8bit 
                               number
0004A9 EB             31731             mov     A, Temp4
0004AA 13             31732             rrc     A
0004AB FD             31733             mov     Temp6, A
0004AC EA             31734             mov     A, Temp3
0004AD 13             31735             rrc     A
0004AE F8             31736             mov     Temp1, A
                      31737     IF 1 == 1
0004AF C3             31738             clr     C
0004B0 ED             31739             mov     A, Temp6
0004B1 13             31740             rrc     A
0004B2 FD             31741             mov     Temp6, A
0004B3 E8             31742             mov     A, Temp1
0004B4 13             31743             rrc     A
0004B5 F8             31744             mov     Temp1, A
                      31745     ENDIF
0004B6 0F             31746             inc     Temp8                                           ; Temp8 has Throttle_Gai
                               n_M
0004B7                31747     int0_int_gain_loop:
0004B7 EF             31748             mov     A, Temp8
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   513

0004B8 14             31749             dec     A
0004B9 6004           31750             jz      int0_int_gain_rcp_done                  ; Skip one multiply by 2 of New_
                               Rcp
                      31751     
0004BB C3             31752             clr     C
0004BC E8             31753             mov     A, Temp1                                                ; Multiply New_R
                               cp by 2
0004BD 33             31754             rlc     A
0004BE F8             31755             mov     Temp1, A
                      31756     
0004BF                31757     int0_int_gain_rcp_done:
0004BF C3             31758             clr     C
0004C0 E9             31759             mov     A, Temp2                                                ; Multiply pwm b
                               y 2
0004C1 33             31760             rlc     A
0004C2 EA             31761             mov     A, Temp3
0004C3 33             31762             rlc     A
0004C4 FA             31763             mov     Temp3, A
0004C5 EB             31764             mov     A, Temp4
0004C6 33             31765             rlc     A
0004C7 FB             31766             mov     Temp4, A
0004C8 DFED           31767             djnz    Temp8, int0_int_gain_loop
                      31768     
0004CA EB             31769             mov     A, Temp4
                      31770     IF 1 == 0
                                        jnb     ACC.2, int0_int_pulse_ready             ; Check that RC pulse is within 
                               legal range
                                ELSE
0004CB 30E306         31773             jnb     ACC.3, int0_int_pulse_ready
                      31774     ENDIF
                      31775     
0004CE 78FF           31776             mov     Temp1, #0FFh
0004D0 7AFF           31777             mov     Temp3, #0FFh
                      31778     IF 1 == 0
                                        mov     Temp4, #3
                                ELSE
0004D2 7B07           31781             mov     Temp4, #7
                      31782     ENDIF
                      31783     
0004D4                31784     int0_int_pulse_ready:
0004D4 8800       F   31785             mov     New_Rcp, Temp1                                  ; Store new pulse length
0004D6 D200       F   31786             setb    Flags2.RCP_UPDATED                              ; Set updated flag
                      31787             ; Check if zero
0004D8 E8             31788             mov     A, Temp1                                                ; Load new pulse
                                value
0004D9 6003           31789             jz      ($+5)                                           ; Check if pulse is zero
                      31790     
0004DB 750000     F   31791             mov     Rcp_Stop_Cnt, #0                                ; Reset rcp stop counter
                      31792     
                      31793             ; Set pwm limit
0004DE C3             31794             clr     C
0004DF E500       F   31795             mov     A, Pwm_Limit                                    ; Limit to the smallest
0004E1 FC             31796             mov     Temp5, A                                                ; Store limit in
                                Temp5
0004E2 9500       F   31797             subb    A, Pwm_Limit_By_Rpm
0004E4 4002           31798             jc      ($+4)
                      31799     
0004E6 AC00       F   31800             mov     Temp5, Pwm_Limit_By_Rpm                 
                      31801     
                      31802             ; Check against limit
0004E8 C3             31803             clr     C
0004E9 EC             31804             mov     A, Temp5
0004EA 9500       F   31805             subb    A, New_Rcp
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   514

0004EC 5008           31806             jnc     int0_int_set_pwm_registers
                      31807     
0004EE EC             31808             mov     A, Temp5                                                ; Multiply limit
                                by 4 (8 for 48MHz MCUs)
                      31809     IF 1 == 0
                                        mov     B, #4
                                ELSE
0004EF 75F008         31812             mov     B, #8
                      31813     ENDIF
0004F2 A4             31814             mul     AB
0004F3 FA             31815             mov     Temp3, A
0004F4 ABF0           31816             mov     Temp4, B
                      31817     
0004F6                31818     int0_int_set_pwm_registers:
0004F6 EA             31819             mov     A, Temp3
0004F7 F4             31820             cpl     A
0004F8 F8             31821             mov     Temp1, A
0004F9 EB             31822             mov     A, Temp4
0004FA F4             31823             cpl     A
                      31824     IF 1 == 0
                                        anl     A, #3
                                ELSE
0004FB 5407           31827             anl     A, #7
                      31828     ENDIF
0004FD F9             31829             mov     Temp2, A
                      31830     IF 90 != 0
0004FE C3             31831             clr     C
0004FF E8             31832             mov     A, Temp1                                                ; Skew damping f
                               et timing
                      31833     IF 1 == 0
                                        subb    A, #90
                                ELSE
000500 94B4           31836             subb    A, #(90 SHL 1)
                      31837     ENDIF
000502 FA             31838             mov     Temp3, A
000503 E9             31839             mov     A, Temp2
000504 9400           31840             subb    A, #0   
000506 FB             31841             mov     Temp4, A
000507 5004           31842             jnc     int0_int_set_pwm_damp_set
                      31843     
000509 7A00           31844             mov     Temp3, #0
00050B 7B00           31845             mov     Temp4, #0
                      31846     
00050D                31847     int0_int_set_pwm_damp_set:
                      31848     ENDIF
00050D 8800       F   31849             mov     Power_Pwm_Reg_L, Temp1
00050F 8900       F   31850             mov     Power_Pwm_Reg_H, Temp2
                      31851     IF 90 != 0
000511 8A00       F   31852             mov     Damp_Pwm_Reg_L, Temp3
000513 8B00       F   31853             mov     Damp_Pwm_Reg_H, Temp4
                      31854     ENDIF
000515 75000A     F   31855             mov     Rcp_Timeout_Cntd, #10                   ; Set timeout count
                      31856     IF 90 != 0
000518 D0F0           31857             pop     B                                                       ; Restore preser
                               ved registers
00051A D0E0           31858             pop     ACC
00051C D0D0           31859             pop     PSW
                      31860+1           Clear_COVF_Interrupt
                      31862+1           Enable_COVF_Interrupt                           ; Generate a pca interrupt
000524 43E610         31864             orl     EIE1, #10h                                      ; Enable pca interrupts
000527 32             31865             reti
                      31866     ELSE
                                        mov     A, Current_Power_Pwm_Reg_H
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   515

                                IF 1 == 0
                                        jnb     ACC.1, int0_int_set_pca_int_hi_pwm
                                ELSE
                                        jnb     ACC.2, int0_int_set_pca_int_hi_pwm
                                ENDIF
                                
                                        pop     B                                                       ; Restore preser
                               ved registers
                                        pop     ACC
                                        pop     PSW
                                        Clear_COVF_Interrupt
                                        Enable_COVF_Interrupt                           ; Generate a pca interrupt
                                        orl     EIE1, #10h                                      ; Enable pca interrupts
                                        reti
                                
                                int0_int_set_pca_int_hi_pwm:
                                        pop     B                                                       ; Restore preser
                               ved registers
                                        pop     ACC
                                        pop     PSW
                                        Clear_CCF_Interrupt
                                        Enable_CCF_Interrupt                            ; Generate pca interrupt
                                        orl     EIE1, #10h                                      ; Enable pca interrupts
                                        reti
                                ENDIF
                      31891     
000528                31892     int0_int_set_timeout:
000528 75000A     F   31893             mov     Rcp_Timeout_Cntd, #10                   ; Set timeout count
00052B                31894     int0_int_exit:
00052B D0F0           31895             pop     B                                                       ; Restore preser
                               ved registers
00052D D0E0           31896             pop     ACC
00052F D0D0           31897             pop     PSW
000531 43E610         31898             orl     EIE1, #10h                                      ; Enable pca interrupts
000534 32             31899             reti
                      31900     
                      31901     
                      31902     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      31903     ;
                      31904     ; Int1 interrupt routine
                      31905     ;
                      31906     ; No assumptions
                      31907     ;
                      31908     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
000535                31909     int1_int:       ; Used for RC pulse timing
000535 C2AA           31910             clr     IE_EX1                  ; Disable int1 interrupts
000537 D28E           31911             setb    TCON_TR1                        ; Start timer 1
000539 C2CA           31912             clr     TMR2CN0_TR2                             ; Timer 2 disabled
00053B 85CC00     F   31913             mov     DShot_Frame_Start_L, TMR2L      ; Read timer value
00053E 85CD00     F   31914             mov     DShot_Frame_Start_H, TMR2H
000541 D2CA           31915             setb    TMR2CN0_TR2                             ; Timer 2 enabled
000543 32             31916     reti
                      31917     
                      31918     
                      31919     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      31920     ;
                      31921     ; PCA interrupt routine
                      31922     ;
                      31923     ; No assumptions
                      31924     ;
                      31925     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
000544                31926     pca_int:        ; Used for setting pwm registers
000544 C2AF           31927             clr     IE_EA
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   516

000546 C0D0           31928             push    PSW                             ; Preserve registers through interrupt
000548 C0E0           31929             push    ACC
00054A D2D3           31930             setb    PSW.3                   ; Select register bank 1 for this interrupt
                      31931     
                      31932     IF 90 != 0                                      ; HI/LO enable style drivers
                      31933     
00054C A8F9           31934             mov     Temp1, PCA0L                            ; Read low byte, to transfer hig
                               h byte to holding register
00054E E500       F   31935             mov     A, Current_Power_Pwm_Reg_H
                      31936     IF 1 == 0
                                        jnb     ACC.1, pca_int_hi_pwm
                                ELSE
000550 30E20A         31939             jnb     ACC.2, pca_int_hi_pwm
                      31940     ENDIF
000553 E5FA           31941             mov     A, PCA0H
                      31942     IF 1 == 0
                                        jb      ACC.1, pca_int_exit                     ; Power below 50%, update pca in
                                the 0x00-0x0F range
                                        jb      ACC.0, pca_int_exit
                                ELSE
000555 20E235         31946             jb      ACC.2, pca_int_exit
000558 20E132         31947             jb      ACC.1, pca_int_exit
                      31948     ENDIF
00055B 0100       F   31949             ajmp    pca_int_set_pwm
                      31950     
00055D                31951     pca_int_hi_pwm:
00055D E5FA           31952             mov     A, PCA0H
                      31953     IF 1 == 0
                                        jnb     ACC.1, pca_int_exit                     ; Power above 50%, update pca in
                                the 0x20-0x2F range
                                        jb      ACC.0, pca_int_exit
                                ELSE
00055F 30E22B         31957             jnb     ACC.2, pca_int_exit
000562 20E128         31958             jb      ACC.1, pca_int_exit
                      31959     ENDIF
                      31960     
000565                31961     pca_int_set_pwm:
                      31962+1           Set_Power_Pwm_Regs
                      31976+1           Set_Damp_Pwm_Regs
00057D 850000     F   31990             mov     Current_Power_Pwm_Reg_H, Power_Pwm_Reg_H
                      31991+1           Disable_COVF_Interrupt
                      31993     
                      31994     ELSE                                                            ; EN/PWM style drivers
                                        Set_Power_Pwm_Regs
                                        mov     Current_Power_Pwm_Reg_H, Power_Pwm_Reg_H
                                        Disable_COVF_Interrupt
                                        Disable_CCF_Interrupt
                                
                                ENDIF
                      32001     
                      32002             ; Pwm updated, enable/disable interrupts
000583 D2A8           32003             setb    IE_EX0                                  ; Enable int0 interrupts
000585 300002         32004             jnb     Flags2.RCP_DSHOT, ($+5)
000588 D2AA           32005             setb    IE_EX1                                  ; Enable int1 interrupts (DShot 
                               only)
00058A 53E6EF         32006             anl     EIE1, #0EFh                             ; Disable pca interrupts
00058D                32007     pca_int_exit:
                      32008+1           Clear_COVF_Interrupt
                      32010     IF 90 == 0
                                        Clear_CCF_Interrupt
                                ENDIF
000590 D0E0           32013             pop     ACC                                             ; Restore preserved regi
                               sters
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   517

000592 D0D0           32014             pop     PSW
000594 D2AF           32015             setb    IE_EA
000596 32             32016             reti
                      32017     
                      32018     
                      32019     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      32020     ;
                      32021     ; Wait xms ~(x*4*250)  (Different entry points) 
                      32022     ;
                      32023     ; No assumptions
                      32024     ;
                      32025     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
000597                32026     wait1ms:        
000597 7901           32027             mov     Temp2, #1
000599 8014           32028             jmp     waitxms_o
                      32029     
00059B                32030     wait3ms:        
00059B 7903           32031             mov     Temp2, #3
00059D 8010           32032             jmp     waitxms_o
                      32033     
00059F                32034     wait10ms:       
00059F 790A           32035             mov     Temp2, #10
0005A1 800C           32036             jmp     waitxms_o
                      32037     
0005A3                32038     wait30ms:       
0005A3 791E           32039             mov     Temp2, #30
0005A5 8008           32040             jmp     waitxms_o
                      32041     
0005A7                32042     wait100ms:      
0005A7 7964           32043             mov     Temp2, #100
0005A9 8004           32044             jmp     waitxms_o
                      32045     
0005AB                32046     wait200ms:      
0005AB 79C8           32047             mov     Temp2, #200
0005AD 8000           32048             jmp     waitxms_o
                      32049     
0005AF                32050     waitxms_o:      ; Outer loop
0005AF 7817           32051             mov     Temp1, #23
0005B1                32052     waitxms_m:      ; Middle loop
0005B1 E4             32053             clr     A
0005B2 D5E0FD         32054             djnz    ACC, $  ; Inner loop (42.7us - 1024 cycles)
0005B5 D8FA           32055             djnz    Temp1, waitxms_m
0005B7 D9F6           32056             djnz    Temp2, waitxms_o
0005B9 22             32057             ret
                      32058     
                      32059     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      32060     ;
                      32061     ; Set pwm limit low rpm
                      32062     ;
                      32063     ; No assumptions
                      32064     ;
                      32065     ; Sets power limit for low rpms and disables demag for low rpms
                      32066     ;
                      32067     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0005BA                32068     set_pwm_limit_low_rpm:
                      32069             ; Set pwm limit
0005BA 78FF           32070             mov     Temp1, #0FFh                                    ; Default full power
0005BC 200028         32071             jb      Flags1.STARTUP_PHASE, set_pwm_limit_low_rpm_exit        ; Exit if startu
                               p phase set
                      32072     
0005BF 7900       F   32073             mov     Temp2, #Pgm_Enable_Power_Prot           ; Check if low RPM power protect
                               ion is enabled
0005C1 E7             32074             mov     A, @Temp2
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   518

0005C2 6023           32075             jz      set_pwm_limit_low_rpm_exit              ; Exit if disabled
                      32076     
0005C4 E500       F   32077             mov     A, Comm_Period4x_H
0005C6 601F           32078             jz      set_pwm_limit_low_rpm_exit              ; Avoid divide by zero
                      32079     
0005C8 74FF           32080             mov     A, #255                                         ; Divide 255 by Comm_Per
                               iod4x_H
0005CA 8500F0     F   32081             mov     B, Comm_Period4x_H
0005CD 84             32082             div     AB
0005CE 8500F0     F   32083             mov     B, Low_Rpm_Pwr_Slope                    ; Multiply by slope
0005D1 300003         32084             jnb     Flags1.INITIAL_RUN_PHASE, ($+6) ; More protection for initial run phase 
0005D4 75F005         32085             mov     B, #5
0005D7 A4             32086             mul     AB
0005D8 F8             32087             mov     Temp1, A                                                ; Set new limit 
                                                       
0005D9 C5F0           32088             xch     A, B
0005DB 6002           32089             jz      ($+4)                                           ; Limit to max
                      32090             
0005DD 78FF           32091             mov     Temp1, #0FFh                            
                      32092     
0005DF C3             32093             clr     C
0005E0 E8             32094             mov     A, Temp1                                                ; Limit to min
0005E1 9500       F   32095             subb    A, Pwm_Limit_Beg
0005E3 5002           32096             jnc     set_pwm_limit_low_rpm_exit
                      32097     
0005E5 A800       F   32098             mov     Temp1, Pwm_Limit_Beg
                      32099     
0005E7                32100     set_pwm_limit_low_rpm_exit:
0005E7 8800       F   32101             mov     Pwm_Limit_By_Rpm, Temp1                         
0005E9 22             32102             ret
                      32103             
                      32104     
                      32105     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      32106     ;
                      32107     ; Set pwm limit high rpm
                      32108     ;
                      32109     ; No assumptions
                      32110     ;
                      32111     ; Sets power limit for high rpms
                      32112     ;
                      32113     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0005EA                32114     set_pwm_limit_high_rpm:
                      32115     IF 1 == 1
0005EA C3             32116             clr     C
0005EB E500       F   32117             mov     A, Comm_Period4x_L
0005ED 94A0           32118             subb    A, #0A0h                                ; Limit Comm_Period to 160, whic
                               h is 500k erpm
0005EF E500       F   32119             mov     A, Comm_Period4x_H
0005F1 9400           32120             subb    A, #00h
                      32121     ELSE
                                        clr     C
                                        mov     A, Comm_Period4x_L
                                        subb    A, #0E4h                                ; Limit Comm_Period to 228, whic
                               h is 350k erpm
                                        mov     A, Comm_Period4x_H
                                        subb    A, #00h
                                ENDIF
0005F3 E500       F   32128             mov     A, Pwm_Limit_By_Rpm
0005F5 5003           32129             jnc     set_pwm_limit_high_rpm_inc_limit
                      32130             
0005F7 14             32131             dec     A
0005F8 0100       F   32132             ajmp    set_pwm_limit_high_rpm_store
                      32133             
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   519

0005FA                32134     set_pwm_limit_high_rpm_inc_limit:
0005FA 04             32135             inc     A
0005FB                32136     set_pwm_limit_high_rpm_store:
0005FB 6002           32137             jz      ($+4)
                      32138     
0005FD F500       F   32139             mov     Pwm_Limit_By_Rpm, A
                      32140     
0005FF 22             32141             ret
                      32142     
                      32143     
                      32144     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      32145     ;
                      32146     ; Start ADC conversion
                      32147     ;
                      32148     ; No assumptions
                      32149     ;
                      32150     ; Start conversion used for measuring power supply voltage
                      32151     ;
                      32152     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
000600                32153     start_adc_conversion:
                      32154             ; Start adc
                      32155+1           Start_Adc 
000603 22             32157             ret
                      32158     
                      32159     
                      32160     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      32161     ;
                      32162     ; Check temperature, power supply voltage and limit power
                      32163     ;
                      32164     ; No assumptions
                      32165     ;
                      32166     ; Used to limit main motor power in order to maintain the required voltage
                      32167     ;
                      32168     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
000604                32169     check_temp_voltage_and_limit_power:
000604 0500       F   32170             inc     Adc_Conversion_Cnt                      ; Increment conversion counter
000606 C3             32171             clr     C
000607 E500       F   32172             mov     A, Adc_Conversion_Cnt           ; Is conversion count equal to temp rate?
000609 9408           32173             subb    A, #8
00060B 4053           32174             jc      check_voltage_start                     ; No - check voltage
                      32175     
                      32176             ; Wait for ADC conversion to complete
00060D 30EDF4         32177             jnb     ADC0CN0_ADINT, check_temp_voltage_and_limit_power
                      32178             ; Read ADC result
                      32179+1           Read_Adc_Result
                      32182             ; Stop ADC
                      32183+1           Stop_Adc
                      32184     
000614 750000     F   32185             mov     Adc_Conversion_Cnt, #0          ; Yes - temperature check. Reset counter
000617 E9             32186             mov     A, Temp2                                        ; Move ADC MSB to Temp3
000618 FA             32187             mov     Temp3, A
000619 7900       F   32188             mov     Temp2, #Pgm_Enable_Temp_Prot    ; Is temp protection enabled?
00061B E7             32189             mov     A, @Temp2
00061C 6041           32190             jz      temp_check_exit                 ; No - branch
                      32191     
00061E EA             32192             mov     A, Temp3                                        ; Is temperature reading
                                below 256?
00061F 7006           32193             jnz     temp_average_inc_dec            ; No - proceed
                      32194     
000621 E500       F   32195             mov     A, Current_Average_Temp         ; Yes -  decrement average
000623 6018           32196             jz      temp_average_updated            ; Already zero - no change
000625 800C           32197             jmp     temp_average_dec                        ; Decrement 
                      32198     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   520

000627                32199     temp_average_inc_dec:
000627 C3             32200             clr     C
000628 E8             32201             mov     A, Temp1                                        ; Check if current tempe
                               rature is above or below average
000629 9500       F   32202             subb    A, Current_Average_Temp
00062B 600E           32203             jz      temp_average_updated_load_acc   ; Equal - no change
                      32204     
00062D E500       F   32205             mov     A, Current_Average_Temp         ; Above - increment average
00062F 5005           32206             jnc     temp_average_inc                                
                      32207     
000631 600A           32208             jz      temp_average_updated            ; Below - decrement average if average i
                               s not already zero
000633                32209     temp_average_dec:
000633 14             32210             dec     A                                               ; Decrement average
000634 8007           32211             jmp     temp_average_updated
                      32212     
000636                32213     temp_average_inc:
000636 04             32214             inc     A                                               ; Increment average
000637 60FA           32215             jz      temp_average_dec
000639 8002           32216             jmp     temp_average_updated
                      32217     
00063B                32218     temp_average_updated_load_acc:
00063B E500       F   32219             mov     A, Current_Average_Temp
00063D                32220     temp_average_updated:
00063D F500       F   32221             mov     Current_Average_Temp, A
00063F C3             32222             clr     C
000640 9500       F   32223             subb    A, Temp_Prot_Limit                      ; Is temperature below first lim
                               it?
000642 401B           32224             jc      temp_check_exit                 ; Yes - exit
                      32225     
000644 7500C0     F   32226             mov  Pwm_Limit, #192                    ; No - limit pwm
                      32227     
000647 C3             32228             clr     C
000648 9404           32229             subb    A, #(TEMP_LIMIT_STEP/2)         ; Is temperature below second limit
00064A 4013           32230             jc      temp_check_exit                 ; Yes - exit
                      32231     
00064C 750080     F   32232             mov  Pwm_Limit, #128                    ; No - limit pwm
                      32233     
00064F C3             32234             clr     C
000650 9404           32235             subb    A, #(TEMP_LIMIT_STEP/2)         ; Is temperature below third limit
000652 400B           32236             jc      temp_check_exit                 ; Yes - exit
                      32237     
000654 750040     F   32238             mov  Pwm_Limit, #64                             ; No - limit pwm
                      32239     
000657 C3             32240             clr     C
000658 9404           32241             subb    A, #(TEMP_LIMIT_STEP/2)         ; Is temperature below final limit
00065A 4003           32242             jc      temp_check_exit                 ; Yes - exit
                      32243     
00065C 750000     F   32244             mov  Pwm_Limit, #0                              ; No - limit pwm
                      32245     
00065F                32246     temp_check_exit:
00065F 22             32247             ret
                      32248     
000660                32249     check_voltage_start:
                      32250             ; Increase pwm limit
000660 E500       F   32251             mov  A, Pwm_Limit
000662 2410           32252             add     A, #16                  
000664 5002           32253             jnc     ($+4)                                   ; If not max - branch
                      32254     
000666 74FF           32255             mov     A, #255
                      32256     
000668 F500       F   32257             mov     Pwm_Limit, A                            ; Increment limit 
00066A 22             32258             ret
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   521

                      32259     
                      32260     
                      32261     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      32262     ;
                      32263     ; Set startup PWM routine
                      32264     ;
                      32265     ; Either the SETTLE_PHASE or the STEPPER_PHASE flag must be set
                      32266     ;
                      32267     ; Used for pwm control during startup
                      32268     ;
                      32269     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
00066B                32270     set_startup_pwm:        
                      32271             ; Adjust startup power
00066B 7432           32272             mov     A, #50                                          ; Set power
00066D 7900       F   32273             mov     Temp2, #Pgm_Startup_Pwr_Decoded
00066F 87F0           32274             mov     B, @Temp2
000671 A4             32275             mul     AB
000672 C5F0           32276             xch     A, B
000674 A2F7           32277             mov     C, B.7                                          ; Multiply result by 2 (
                               unity gain is 128)
000676 33             32278             rlc     A
000677 F500       F   32279             mov     Pwm_Limit_Beg, A                                ; Set initial pwm limit
000679 22             32280             ret
                      32281     
                      32282     
                      32283     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      32284     ;
                      32285     ; Initialize timing routine
                      32286     ;
                      32287     ; No assumptions
                      32288     ;
                      32289     ; Part of initialization before motor start
                      32290     ;
                      32291     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
00067A                32292     initialize_timing: 
00067A 750000     F   32293             mov     Comm_Period4x_L, #00h                           ; Set commutation period
                                registers
00067D 7500F0     F   32294             mov     Comm_Period4x_H, #0F0h
000680 22             32295             ret
                      32296     
                      32297     
                      32298     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      32299     ;
                      32300     ; Calculate next commutation timing routine
                      32301     ;
                      32302     ; No assumptions
                      32303     ;
                      32304     ; Called immediately after each commutation
                      32305     ; Also sets up timer 3 to wait advance timing
                      32306     ; Two entry points are used
                      32307     ;
                      32308     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
000681                32309     calc_next_comm_timing:          ; Entry point for run phase
                      32310             ; Read commutation time
000681 C2AF           32311             clr     IE_EA
000683 C2CA           32312             clr     TMR2CN0_TR2             ; Timer 2 disabled
000685 A8CC           32313             mov     Temp1, TMR2L            ; Load timer value
000687 A9CD           32314             mov     Temp2, TMR2H    
000689 AA00       F   32315             mov     Temp3, Timer2_X
00068B 30CF01         32316             jnb     TMR2CN0_TF2H, ($+4)     ; Check if interrupt is pending
00068E 0A             32317             inc     Temp3                   ; If it is pending, then timer has already wrapp
                               ed
00068F D2CA           32318             setb    TMR2CN0_TR2             ; Timer 2 enabled
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   522

000691 D2AF           32319             setb    IE_EA
                      32320     IF 1 == 1
000693 C3             32321             clr     C
000694 EA             32322             mov     A, Temp3
000695 13             32323             rrc     A
000696 FA             32324             mov     Temp3, A
000697 E9             32325             mov     A, Temp2
000698 13             32326             rrc     A
000699 F9             32327             mov     Temp2, A
00069A E8             32328             mov     A, Temp1
00069B 13             32329             rrc     A
00069C F8             32330             mov     Temp1, A
                      32331     ENDIF
                      32332             ; Calculate this commutation time
00069D AB00       F   32333             mov     Temp4, Prev_Comm_L
00069F AC00       F   32334             mov     Temp5, Prev_Comm_H
0006A1 8800       F   32335             mov     Prev_Comm_L, Temp1              ; Store timestamp as previous commutation
0006A3 8900       F   32336             mov     Prev_Comm_H, Temp2
0006A5 C3             32337             clr     C
0006A6 E8             32338             mov     A, Temp1
0006A7 9B             32339             subb    A, Temp4                                ; Calculate the new commutation 
                               time
0006A8 F8             32340             mov     Temp1, A
0006A9 E9             32341             mov     A, Temp2
0006AA 9C             32342             subb    A, Temp5
0006AB 20000A         32343             jb      Flags1.STARTUP_PHASE, calc_next_comm_startup
                      32344     
                      32345     IF 1 == 1
0006AE 547F           32346             anl     A, #7Fh
                      32347     ENDIF
0006B0 F9             32348             mov     Temp2, A
0006B1 300002         32349             jnb     Flags1.HIGH_RPM, ($+5)  ; Branch if high rpm
0006B4 0100       F   32350             ajmp    calc_next_comm_timing_fast
                      32351     
0006B6 0100       F   32352             ajmp    calc_next_comm_normal
                      32353     
0006B8                32354     calc_next_comm_startup:
0006B8 AD00       F   32355             mov     Temp6, Prev_Comm_X
0006BA 8A00       F   32356             mov     Prev_Comm_X, Temp3              ; Store extended timestamp as previous c
                               ommutation
0006BC F9             32357             mov     Temp2, A
0006BD EA             32358             mov     A, Temp3
0006BE 9D             32359             subb    A, Temp6                                ; Calculate the new extended com
                               mutation time
                      32360     IF 1 == 1
0006BF 547F           32361             anl     A, #7Fh
                      32362     ENDIF
0006C1 FA             32363             mov     Temp3, A
0006C2 6006           32364             jz      calc_next_comm_startup_no_X
                      32365     
0006C4 78FF           32366             mov     Temp1, #0FFh
0006C6 79FF           32367             mov     Temp2, #0FFh
0006C8 0100       F   32368             ajmp    calc_next_comm_startup_average
                      32369     
0006CA                32370     calc_next_comm_startup_no_X:
0006CA AE00       F   32371             mov     Temp7, Prev_Prev_Comm_L
0006CC AF00       F   32372             mov     Temp8, Prev_Prev_Comm_H
0006CE 8B00       F   32373             mov     Prev_Prev_Comm_L, Temp4
0006D0 8C00       F   32374             mov     Prev_Prev_Comm_H, Temp5
0006D2 A800       F   32375             mov     Temp1, Prev_Comm_L              ; Reload this commutation time  
0006D4 A900       F   32376             mov     Temp2, Prev_Comm_H
0006D6 C3             32377             clr     C
0006D7 E8             32378             mov     A, Temp1
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   523

0006D8 9E             32379             subb    A, Temp7                                ; Calculate the new commutation 
                               time based upon the two last commutations (to reduce sensitivity to offset)
0006D9 F8             32380             mov     Temp1, A
0006DA E9             32381             mov     A, Temp2
0006DB 9F             32382             subb    A, Temp8
0006DC F9             32383             mov     Temp2, A
                      32384     
0006DD                32385     calc_next_comm_startup_average:
0006DD C3             32386             clr     C
0006DE E500       F   32387             mov     A, Comm_Period4x_H              ; Average with previous and save
0006E0 13             32388             rrc     A
0006E1 FB             32389             mov     Temp4, A
0006E2 E500       F   32390             mov     A, Comm_Period4x_L
0006E4 13             32391             rrc     A
0006E5 FA             32392             mov     Temp3, A
0006E6 E8             32393             mov     A, Temp1                        
0006E7 2A             32394             add     A, Temp3
0006E8 F500       F   32395             mov     Comm_Period4x_L, A
0006EA E9             32396             mov     A, Temp2
0006EB 3B             32397             addc    A, Temp4
0006EC F500       F   32398             mov     Comm_Period4x_H, A
0006EE 5006           32399             jnc     ($+8)
                      32400     
0006F0 7500FF     F   32401             mov     Comm_Period4x_L, #0FFh
0006F3 7500FF     F   32402             mov     Comm_Period4x_H, #0FFh
                      32403     
0006F6 0100       F   32404             ajmp    calc_new_wait_times_setup
                      32405     
0006F8                32406     calc_next_comm_normal:
                      32407             ; Calculate new commutation time 
0006F8 AA00       F   32408             mov     Temp3, Comm_Period4x_L  ; Comm_Period4x(-l-h) holds the time of 4 commut
                               ations
0006FA AB00       F   32409             mov     Temp4, Comm_Period4x_H
0006FC AC00       F   32410             mov     Temp5, Comm_Period4x_L  ; Copy variables
0006FE AD00       F   32411             mov     Temp6, Comm_Period4x_H
000700 7E04           32412             mov     Temp7, #4                               ; Divide Comm_Period4x 4 times a
                               s default
000702 7F02           32413             mov     Temp8, #2                               ; Divide new commutation time 2 
                               times as default
000704 C3             32414             clr     C
000705 EB             32415             mov     A, Temp4
000706 9404           32416             subb    A, #04h
000708 400D           32417             jc      calc_next_comm_avg_period_div
                      32418     
00070A 1E             32419             dec     Temp7                           ; Reduce averaging time constant for low
                                speeds
00070B 1F             32420             dec     Temp8
                      32421     
00070C C3             32422             clr     C
00070D EB             32423             mov     A, Temp4
00070E 9408           32424             subb    A, #08h
000710 4005           32425             jc      calc_next_comm_avg_period_div
                      32426     
000712 200002         32427             jb      Flags1.INITIAL_RUN_PHASE, calc_next_comm_avg_period_div ; Do not average
                                very fast during initial run
                      32428     
000715 1E             32429             dec     Temp7                           ; Reduce averaging time constant more fo
                               r even lower speeds
000716 1F             32430             dec     Temp8
                      32431     
000717                32432     calc_next_comm_avg_period_div:
000717 C3             32433             clr     C
000718 ED             32434             mov     A, Temp6                                        
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   524

000719 13             32435             rrc     A                                       ; Divide by 2
00071A FD             32436             mov     Temp6, A        
00071B EC             32437             mov     A, Temp5                                
00071C 13             32438             rrc     A
00071D FC             32439             mov     Temp5, A
00071E DEF7           32440             djnz    Temp7, calc_next_comm_avg_period_div
                      32441     
000720 C3             32442             clr     C
000721 EA             32443             mov     A, Temp3
000722 9C             32444             subb    A, Temp5                                ; Subtract a fraction
000723 FA             32445             mov     Temp3, A
000724 EB             32446             mov     A, Temp4
000725 9D             32447             subb    A, Temp6
000726 FB             32448             mov     Temp4, A
000727 EF             32449             mov     A, Temp8                                ; Divide new time
000728 6009           32450             jz      calc_next_comm_new_period_div_done
                      32451     
00072A                32452     calc_next_comm_new_period_div:
00072A C3             32453             clr     C
00072B E9             32454             mov     A, Temp2                                        
00072C 13             32455             rrc     A                                       ; Divide by 2
00072D F9             32456             mov     Temp2, A        
00072E E8             32457             mov     A, Temp1                                
00072F 13             32458             rrc     A
000730 F8             32459             mov     Temp1, A
000731 DFF7           32460             djnz    Temp8, calc_next_comm_new_period_div
                      32461     
000733                32462     calc_next_comm_new_period_div_done:
000733 EA             32463             mov     A, Temp3
000734 28             32464             add     A, Temp1                                ; Add the divided new time
000735 FA             32465             mov     Temp3, A
000736 EB             32466             mov     A, Temp4
000737 39             32467             addc    A, Temp2
000738 FB             32468             mov     Temp4, A
000739 8A00       F   32469             mov     Comm_Period4x_L, Temp3  ; Store Comm_Period4x_X
00073B 8B00       F   32470             mov     Comm_Period4x_H, Temp4
00073D 5006           32471             jnc     calc_new_wait_times_setup; If period larger than 0xffff - go to slow case
                      32472     
00073F 7BFF           32473             mov     Temp4, #0FFh
000741 8B00       F   32474             mov     Comm_Period4x_L, Temp4  ; Set commutation period registers to very slow 
                               timing (0xffff)
000743 8B00       F   32475             mov     Comm_Period4x_H, Temp4
                      32476     
000745                32477     calc_new_wait_times_setup:      
                      32478             ; Set high rpm bit (if above 156k erpm)
000745 C3             32479             clr     C
000746 EB             32480             mov     A, Temp4
000747 9402           32481             subb    A, #2
000749 5002           32482             jnc     ($+4)
                      32483     
00074B D200       F   32484             setb    Flags1.HIGH_RPM                 ; Set high rpm bit
                      32485             
                      32486             ; Load programmed commutation timing
00074D 300004         32487             jnb     Flags1.STARTUP_PHASE, calc_new_wait_per_startup_done    ; Set dedicated 
                               timing during startup
                      32488     
000750 7F03           32489             mov     Temp8, #3
000752 0100       F   32490             ajmp    calc_new_wait_per_demag_done
                      32491     
000754                32492     calc_new_wait_per_startup_done:
000754 7800       F   32493             mov     Temp1, #Pgm_Comm_Timing ; Load timing setting
000756 E6             32494             mov     A, @Temp1                               
000757 FF             32495             mov     Temp8, A                                ; Store in Temp8
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   525

000758 C3             32496             clr     C
000759 E500       F   32497             mov     A, Demag_Detected_Metric        ; Check demag metric
00075B 9482           32498             subb    A, #130
00075D 4011           32499             jc      calc_new_wait_per_demag_done
                      32500     
00075F 0F             32501             inc     Temp8                           ; Increase timing
                      32502     
000760 C3             32503             clr     C
000761 E500       F   32504             mov     A, Demag_Detected_Metric
000763 94A0           32505             subb    A, #160
000765 4001           32506             jc      ($+3)
                      32507     
000767 0F             32508             inc     Temp8                           ; Increase timing again
                      32509     
000768 C3             32510             clr     C
000769 EF             32511             mov     A, Temp8                                ; Limit timing to max
00076A 9406           32512             subb    A, #6
00076C 4002           32513             jc      ($+4)
                      32514     
00076E 7F05           32515             mov     Temp8, #5                               ; Set timing to max
                      32516     
000770                32517     calc_new_wait_per_demag_done:
                      32518             ; Set timing reduction
000770 7E02           32519             mov     Temp7, #2
                      32520             ; Load current commutation timing
000772 E500       F   32521             mov     A, Comm_Period4x_H              ; Divide 4 times
000774 C4             32522             swap    A
000775 540F           32523             anl     A, #00Fh
000777 F9             32524             mov     Temp2, A
000778 E500       F   32525             mov     A, Comm_Period4x_H
00077A C4             32526             swap    A
00077B 54F0           32527             anl     A, #0F0h
00077D F8             32528             mov     Temp1, A
00077E E500       F   32529             mov     A, Comm_Period4x_L
000780 C4             32530             swap    A
000781 540F           32531             anl     A, #00Fh
000783 28             32532             add     A, Temp1
000784 F8             32533             mov     Temp1, A
                      32534     
000785 C3             32535             clr     C
000786 E8             32536             mov     A, Temp1
000787 9E             32537             subb    A, Temp7
000788 FA             32538             mov     Temp3, A
000789 E9             32539             mov     A, Temp2                                
00078A 9400           32540             subb    A, #0
00078C FB             32541             mov     Temp4, A
00078D 4009           32542             jc      load_min_time                   ; Check that result is still positive
                      32543     
00078F C3             32544             clr     C
000790 EA             32545             mov     A, Temp3
000791 9401           32546             subb    A, #1
000793 EB             32547             mov     A, Temp4                        
000794 9400           32548             subb    A, #0
000796 5004           32549             jnc     calc_new_wait_times_exit        ; Check that result is still above minum
                               um
                      32550     
000798                32551     load_min_time:
000798 7A01           32552             mov     Temp3, #1
00079A E4             32553             clr     A
00079B FB             32554             mov     Temp4, A 
                      32555     
00079C                32556     calc_new_wait_times_exit:       
00079C 020000     F   32557             ljmp    wait_advance_timing
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   526

                      32558     
                      32559     
                      32560     ; Fast calculation (Comm_Period4x_H less than 2)
00079F                32561     calc_next_comm_timing_fast:                     
                      32562             ; Calculate new commutation time
00079F AA00       F   32563             mov     Temp3, Comm_Period4x_L  ; Comm_Period4x(-l-h) holds the time of 4 commut
                               ations
0007A1 AB00       F   32564             mov     Temp4, Comm_Period4x_H
0007A3 EB             32565             mov     A, Temp4                                ; Divide by 2 4 times
0007A4 C4             32566             swap    A
0007A5 FE             32567             mov     Temp7, A
0007A6 EA             32568             mov     A, Temp3
0007A7 C4             32569             swap A
0007A8 540F           32570             anl     A, #0Fh
0007AA 4E             32571             orl     A, Temp7
0007AB FC             32572             mov     Temp5, A
0007AC C3             32573             clr     C
0007AD EA             32574             mov     A, Temp3                                ; Subtract a fraction
0007AE 9C             32575             subb    A, Temp5
0007AF FA             32576             mov     Temp3, A
0007B0 EB             32577             mov     A, Temp4                                
0007B1 9400           32578             subb    A, #0
0007B3 FB             32579             mov     Temp4, A
0007B4 C3             32580             clr     C
0007B5 E8             32581             mov     A, Temp1
0007B6 13             32582             rrc     A                                       ; Divide by 2 2 times
0007B7 C3             32583             clr     C
0007B8 13             32584             rrc     A
0007B9 F8             32585             mov     Temp1, A
0007BA EA             32586             mov     A, Temp3                                ; Add the divided new time
0007BB 28             32587             add     A, Temp1
0007BC FA             32588             mov     Temp3, A
0007BD EB             32589             mov     A, Temp4
0007BE 3400           32590             addc    A, #0
0007C0 FB             32591             mov     Temp4, A
0007C1 8A00       F   32592             mov     Comm_Period4x_L, Temp3  ; Store Comm_Period4x_X
0007C3 8B00       F   32593             mov     Comm_Period4x_H, Temp4
0007C5 C3             32594             clr     C
0007C6 EB             32595             mov     A, Temp4                                ; If erpm below 156k - go to nor
                               mal case
0007C7 9402           32596             subb    A, #2
0007C9 4002           32597             jc      ($+4)
                      32598     
0007CB C200       F   32599             clr     Flags1.HIGH_RPM                 ; Clear high rpm bit
                      32600     
                      32601             ; Set timing reduction
0007CD 7802           32602             mov     Temp1, #2
0007CF EB             32603             mov     A, Temp4                                ; Divide by 2 4 times
0007D0 C4             32604             swap    A
0007D1 FE             32605             mov     Temp7, A
0007D2 7B00           32606             mov     Temp4, #0
0007D4 EA             32607             mov     A, Temp3
0007D5 C4             32608             swap A
0007D6 540F           32609             anl     A, #0Fh
0007D8 4E             32610             orl     A, Temp7
0007D9 FA             32611             mov     Temp3, A
0007DA C3             32612             clr     C
0007DB EA             32613             mov     A, Temp3
0007DC 98             32614             subb    A, Temp1
0007DD FA             32615             mov     Temp3, A
0007DE 4005           32616             jc      load_min_time_fast              ; Check that result is still positive
                      32617     
0007E0 C3             32618             clr     C
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   527

0007E1 9401           32619             subb    A, #1
0007E3 5002           32620             jnc     calc_new_wait_times_fast_done   ; Check that result is still above minum
                               um
                      32621     
0007E5                32622     load_min_time_fast:
0007E5 7A01           32623             mov     Temp3, #1
                      32624     
0007E7                32625     calc_new_wait_times_fast_done:  
0007E7 7800       F   32626             mov     Temp1, #Pgm_Comm_Timing ; Load timing setting
0007E9 E6             32627             mov     A, @Temp1                               
0007EA FF             32628             mov     Temp8, A                                ; Store in Temp8
                      32629     
                      32630     
                      32631     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      32632     ;
                      32633     ; Wait advance timing routine
                      32634     ;
                      32635     ; No assumptions
                      32636     ; NOTE: Be VERY careful if using temp registers. They are passed over this routine
                      32637     ;
                      32638     ; Waits for the advance timing to elapse and sets up the next zero cross wait
                      32639     ;
                      32640     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0007EB                32641     wait_advance_timing:    
0007EB 300002         32642             jnb     Flags0.T3_PENDING, ($+5)
0007EE 0100       F   32643             ajmp    wait_advance_timing
                      32644     
                      32645             ; Setup next wait time
0007F0 850092     F   32646             mov     TMR3RLL, Wt_ZC_Tout_Start_L
0007F3 850093     F   32647             mov     TMR3RLH, Wt_ZC_Tout_Start_H
0007F6 D200       F   32648             setb    Flags0.T3_PENDING
0007F8 43E680         32649             orl     EIE1, #80h      ; Enable timer 3 interrupts
                      32650     
                      32651     
                      32652     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      32653     ;
                      32654     ; Calculate new wait times routine
                      32655     ;
                      32656     ; No assumptions
                      32657     ;
                      32658     ; Calculates new wait times
                      32659     ;
                      32660     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0007FB                32661     calc_new_wait_times:    
0007FB C3             32662             clr     C
0007FC E4             32663             clr     A
0007FD 9A             32664             subb    A, Temp3                                ; Negate
0007FE F8             32665             mov     Temp1, A        
0007FF E4             32666             clr     A
000800 9B             32667             subb    A, Temp4                                
000801 F9             32668             mov     Temp2, A        
                      32669     IF 1 == 1
000802 C3             32670             clr     C
000803 E8             32671             mov     A, Temp1                                ; Multiply by 2
000804 33             32672             rlc     A
000805 F8             32673             mov     Temp1, A
000806 E9             32674             mov     A, Temp2
000807 33             32675             rlc     A
000808 F9             32676             mov     Temp2, A
                      32677     ENDIF
000809 300003         32678             jnb     Flags1.HIGH_RPM, ($+6)  ; Branch if high rpm
00080C 020000     F   32679             ljmp    calc_new_wait_times_fast
                      32680     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   528

00080F E8             32681             mov     A, Temp1                                ; Copy values
000810 FA             32682             mov     Temp3, A
000811 E9             32683             mov     A, Temp2
000812 FB             32684             mov     Temp4, A
000813 D3             32685             setb    C                                       ; Negative numbers - set carry
000814 E9             32686             mov     A, Temp2                                
000815 13             32687             rrc     A                                       ; Divide by 2
000816 FD             32688             mov     Temp6, A
000817 E8             32689             mov     A, Temp1
000818 13             32690             rrc     A
000819 FC             32691             mov     Temp5, A
00081A 8800       F   32692             mov     Wt_Zc_Tout_Start_L, Temp1; Set 15deg time for zero cross scan timeout
00081C 8900       F   32693             mov     Wt_Zc_Tout_Start_H, Temp2
00081E C3             32694             clr     C
00081F EF             32695             mov     A, Temp8                                ; (Temp8 has Pgm_Comm_Timing)
000820 9403           32696             subb    A, #3                           ; Is timing normal?
000822 6038           32697             jz      store_times_decrease    ; Yes - branch
                      32698     
000824 EF             32699             mov     A, Temp8                                
000825 20E00C         32700             jb      ACC.0, adjust_timing_two_steps  ; If an odd number - branch
                      32701     
000828 E8             32702             mov     A, Temp1                                ; Add 7.5deg and store in Temp1/2
000829 2C             32703             add     A, Temp5
00082A F8             32704             mov     Temp1, A
00082B E9             32705             mov     A, Temp2
00082C 3D             32706             addc    A, Temp6
00082D F9             32707             mov     Temp2, A
00082E EC             32708             mov     A, Temp5                                ; Store 7.5deg in Temp3/4
00082F FA             32709             mov     Temp3, A
000830 ED             32710             mov     A, Temp6                        
000831 FB             32711             mov     Temp4, A
000832 8013           32712             jmp     store_times_up_or_down
                      32713     
000834                32714     adjust_timing_two_steps:
000834 E8             32715             mov     A, Temp1                                ; Add 15deg and store in Temp1/2
000835 28             32716             add     A, Temp1
000836 F8             32717             mov     Temp1, A
000837 E9             32718             mov     A, Temp2
000838 39             32719             addc    A, Temp2
000839 F9             32720             mov     Temp2, A
00083A C3             32721             clr     C
00083B E8             32722             mov     A, Temp1
00083C 2401           32723             add     A, #1
00083E F8             32724             mov     Temp1, A
00083F E9             32725             mov     A, Temp2
000840 3400           32726             addc    A, #0
000842 F9             32727             mov     Temp2, A
000843 7AFF           32728             mov     Temp3, #-1                              ; Store minimum time in Temp3/4
000845 7BFF           32729             mov     Temp4, #0FFh
                      32730     
000847                32731     store_times_up_or_down:
000847 C3             32732             clr     C
000848 EF             32733             mov     A, Temp8                                
000849 9403           32734             subb    A, #3                                   ; Is timing higher than normal?
00084B 400F           32735             jc      store_times_decrease            ; No - branch
                      32736     
00084D                32737     store_times_increase:
00084D 8A00       F   32738             mov     Wt_Comm_Start_L, Temp3          ; Now commutation time (~60deg) divided 
                               by 4 (~15deg nominal)
00084F 8B00       F   32739             mov     Wt_Comm_Start_H, Temp4
000851 8800       F   32740             mov     Wt_Adv_Start_L, Temp1           ; New commutation advance time (~15deg n
                               ominal)
000853 8900       F   32741             mov     Wt_Adv_Start_H, Temp2
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   529

000855 8C00       F   32742             mov     Wt_Zc_Scan_Start_L, Temp5       ; Use this value for zero cross scan del
                               ay (7.5deg)
000857 8D00       F   32743             mov     Wt_Zc_Scan_Start_H, Temp6
000859 020000     F   32744             ljmp    wait_before_zc_scan
                      32745     
00085C                32746     store_times_decrease:
00085C 8800       F   32747             mov     Wt_Comm_Start_L, Temp1          ; Now commutation time (~60deg) divided 
                               by 4 (~15deg nominal)
00085E 8900       F   32748             mov     Wt_Comm_Start_H, Temp2
000860 8A00       F   32749             mov     Wt_Adv_Start_L, Temp3           ; New commutation advance time (~15deg n
                               ominal)
000862 8B00       F   32750             mov     Wt_Adv_Start_H, Temp4
000864 8C00       F   32751             mov     Wt_Zc_Scan_Start_L, Temp5       ; Use this value for zero cross scan del
                               ay (7.5deg)
000866 8D00       F   32752             mov     Wt_Zc_Scan_Start_H, Temp6
000868 300012         32753             jnb     Flags1.STARTUP_PHASE, store_times_exit
                      32754     
00086B 7500F0     F   32755             mov     Wt_Comm_Start_L, #0F0h          ; Set very short delays for all but adva
                               nce time during startup, in order to widen zero cross capture range
00086E 7500FF     F   32756             mov     Wt_Comm_Start_H, #0FFh
000871 7500F0     F   32757             mov     Wt_Zc_Scan_Start_L, #0F0h
000874 7500FF     F   32758             mov     Wt_Zc_Scan_Start_H, #0FFh
000877 7500F0     F   32759             mov     Wt_Zc_Tout_Start_L, #0F0h
00087A 7500FF     F   32760             mov     Wt_Zc_Tout_Start_H, #0FFh
                      32761     
00087D                32762     store_times_exit:
00087D 020000     F   32763             ljmp    wait_before_zc_scan
                      32764     
                      32765     
000880                32766     calc_new_wait_times_fast:       
000880 E8             32767             mov     A, Temp1                                ; Copy values
000881 FA             32768             mov     Temp3, A
000882 D3             32769             setb    C                                       ; Negative numbers - set carry
000883 E8             32770             mov     A, Temp1                                ; Divide by 2
000884 13             32771             rrc     A
000885 FC             32772             mov     Temp5, A
000886 8800       F   32773             mov     Wt_Zc_Tout_Start_L, Temp1; Set 15deg time for zero cross scan timeout
000888 C3             32774             clr     C
000889 EF             32775             mov     A, Temp8                                ; (Temp8 has Pgm_Comm_Timing)
00088A 9403           32776             subb    A, #3                           ; Is timing normal?
00088C 6021           32777             jz      store_times_decrease_fast; Yes - branch
                      32778     
00088E EF             32779             mov     A, Temp8                                
00088F 20E007         32780             jb      ACC.0, adjust_timing_two_steps_fast     ; If an odd number - branch
                      32781     
000892 E8             32782             mov     A, Temp1                                ; Add 7.5deg and store in Temp1
000893 2C             32783             add     A, Temp5
000894 F8             32784             mov     Temp1, A
000895 EC             32785             mov     A, Temp5                                ; Store 7.5deg in Temp3
000896 FA             32786             mov     Temp3, A
000897 0100       F   32787             ajmp    store_times_up_or_down_fast
                      32788     
000899                32789     adjust_timing_two_steps_fast:
000899 E8             32790             mov     A, Temp1                                ; Add 15deg and store in Temp1
00089A 28             32791             add     A, Temp1
00089B 2401           32792             add     A, #1
00089D F8             32793             mov     Temp1, A
00089E 7AFF           32794             mov     Temp3, #-1                      ; Store minimum time in Temp3
                      32795     
0008A0                32796     store_times_up_or_down_fast:
0008A0 C3             32797             clr     C
0008A1 EF             32798             mov     A, Temp8                                
0008A2 9403           32799             subb    A, #3                           ; Is timing higher than normal?
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   530

0008A4 4009           32800             jc      store_times_decrease_fast; No - branch
                      32801     
0008A6                32802     store_times_increase_fast:
0008A6 8A00       F   32803             mov     Wt_Comm_Start_L, Temp3          ; Now commutation time (~60deg) divided 
                               by 4 (~15deg nominal)
0008A8 8800       F   32804             mov     Wt_Adv_Start_L, Temp1           ; New commutation advance time (~15deg n
                               ominal)
0008AA 8C00       F   32805             mov     Wt_Zc_Scan_Start_L, Temp5       ; Use this value for zero cross scan del
                               ay (7.5deg)
0008AC 020000     F   32806             ljmp    wait_before_zc_scan
                      32807     
0008AF                32808     store_times_decrease_fast:
0008AF 8800       F   32809             mov     Wt_Comm_Start_L, Temp1          ; Now commutation time (~60deg) divided 
                               by 4 (~15deg nominal)
0008B1 8A00       F   32810             mov     Wt_Adv_Start_L, Temp3           ; New commutation advance time (~15deg n
                               ominal)
0008B3 8C00       F   32811             mov     Wt_Zc_Scan_Start_L, Temp5       ; Use this value for zero cross scan del
                               ay (7.5deg)
                      32812     
                      32813     
                      32814     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      32815     ;
                      32816     ; Wait before zero cross scan routine
                      32817     ;
                      32818     ; No assumptions
                      32819     ;
                      32820     ; Waits for the zero cross scan wait time to elapse
                      32821     ; Also sets up timer 3 for the zero cross scan timeout time
                      32822     ;
                      32823     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0008B5                32824     wait_before_zc_scan:    
0008B5 300002         32825             jnb     Flags0.T3_PENDING, ($+5)
0008B8 0100       F   32826             ajmp    wait_before_zc_scan
                      32827     
0008BA 750002     F   32828             mov     Startup_Zc_Timeout_Cntd, #2
0008BD                32829     setup_zc_scan_timeout:
0008BD D200       F   32830             setb    Flags0.T3_PENDING
0008BF 43E680         32831             orl     EIE1, #80h                      ; Enable timer 3 interrupts
0008C2 E500       F   32832             mov     A, Flags1
0008C4 5403           32833             anl     A, #((1 SHL STARTUP_PHASE)+(1 SHL INITIAL_RUN_PHASE))
0008C6 602D           32834             jz      wait_before_zc_scan_exit                
                      32835     
0008C8 A800       F   32836             mov     Temp1, Comm_Period4x_L  ; Set long timeout when starting
0008CA A900       F   32837             mov     Temp2, Comm_Period4x_H
0008CC C3             32838             clr     C
0008CD E9             32839             mov     A, Temp2
0008CE 13             32840             rrc     A
0008CF F9             32841             mov     Temp2, A
0008D0 E8             32842             mov     A, Temp1
0008D1 13             32843             rrc     A
0008D2 F8             32844             mov     Temp1, A
                      32845     IF 1 == 0
                                        clr     C
                                        mov     A, Temp2
                                        rrc     A
                                        mov     Temp2, A
                                        mov     A, Temp1
                                        rrc     A
                                        mov     Temp1, A
                                ENDIF
0008D3 300004         32854             jnb     Flags1.STARTUP_PHASE, setup_zc_scan_timeout_startup_done
                      32855     
0008D6 E9             32856             mov     A, Temp2
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   531

0008D7 2440           32857             add     A, #40h                         ; Increase timeout somewhat to avoid fal
                               se wind up
0008D9 F9             32858             mov     Temp2, A
                      32859     
0008DA                32860     setup_zc_scan_timeout_startup_done:
0008DA C2AF           32861             clr     IE_EA
0008DC 53E67F         32862             anl     EIE1, #7Fh                      ; Disable timer 3 interrupts
0008DF 759100         32863             mov     TMR3CN0, #00h                   ; Timer 3 disabled and interrupt flag cl
                               eared
0008E2 C3             32864             clr     C
0008E3 E4             32865             clr     A
0008E4 98             32866             subb    A, Temp1                                ; Set timeout
0008E5 F594           32867             mov     TMR3L, A
0008E7 E4             32868             clr     A
0008E8 99             32869             subb    A, Temp2                
0008E9 F595           32870             mov     TMR3H, A
0008EB 759104         32871             mov     TMR3CN0, #04h                   ; Timer 3 enabled and interrupt flag cle
                               ared
0008EE D200       F   32872             setb    Flags0.T3_PENDING
0008F0 43E680         32873             orl     EIE1, #80h                      ; Enable timer 3 interrupts
0008F3 D2AF           32874             setb    IE_EA
                      32875     
0008F5                32876     wait_before_zc_scan_exit:          
0008F5 22             32877             ret
                      32878     
                      32879     
                      32880     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      32881     ;
                      32882     ; Wait for comparator to go low/high routines
                      32883     ;
                      32884     ; No assumptions
                      32885     ;
                      32886     ; Waits for the zero cross scan wait time to elapse
                      32887     ; Then scans for comparator going low/high
                      32888     ;
                      32889     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0008F6                32890     wait_for_comp_out_low:
0008F6 D200       F   32891             setb    Flags0.DEMAG_DETECTED           ; Set demag detected flag as default
0008F8 750000     F   32892             mov     Comparator_Read_Cnt, #0         ; Reset number of comparator reads
0008FB 750000     F   32893             mov     Bit_Access, #00h                        ; Desired comparator output
0008FE 300003         32894             jnb     Flags1.DIR_CHANGE_BRAKE, ($+6)
000901 750040     F   32895             mov     Bit_Access, #40h                
000904 0100       F   32896             ajmp    wait_for_comp_out_start
                      32897     
000906                32898     wait_for_comp_out_high:
000906 D200       F   32899             setb    Flags0.DEMAG_DETECTED           ; Set demag detected flag as default
000908 750000     F   32900             mov     Comparator_Read_Cnt, #0         ; Reset number of comparator reads
00090B 750040     F   32901             mov     Bit_Access, #40h                        ; Desired comparator output
00090E 300003         32902             jnb     Flags1.DIR_CHANGE_BRAKE, ($+6)
000911 750000     F   32903             mov     Bit_Access, #00h                
                      32904     
000914                32905     wait_for_comp_out_start:
                      32906             ; Set number of comparator readings
000914 7801           32907             mov     Temp1, #1                                       ; Number of OK readings 
                               required
000916 7901           32908             mov     Temp2, #1                                       ; Max number of readings
                                required
000918 200020         32909             jb      Flags1.HIGH_RPM, comp_scale_samples     ; Branch if high rpm
                      32910     
00091B E500       F   32911             mov     A, Flags1                                       ; Clear demag detected f
                               lag if start phases
00091D 5403           32912             anl     A, #((1 SHL STARTUP_PHASE)+(1 SHL INITIAL_RUN_PHASE))
00091F 6002           32913             jz      ($+4)
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   532

                      32914                     
000921 C200       F   32915             clr     Flags0.DEMAG_DETECTED
                      32916     
000923 7914           32917             mov     Temp2, #20                              ; Too low value (~<15) causes ro
                               ugh running at pwm harmonics. Too high a value (~>35) causes the RCT4215 630 to run rough on full throttle
000925 E500       F   32918             mov     A, Comm_Period4x_H                      ; Set number of readings higher 
                               for lower speeds
000927 C3             32919             clr     C
000928 13             32920             rrc     A
000929 7001           32921             jnz     ($+3)
00092B 04             32922             inc     A
00092C F8             32923             mov     Temp1, A
00092D C3             32924             clr     C                                               
00092E 9414           32925             subb    A, #20
000930 4002           32926             jc      ($+4)
                      32927     
000932 7814           32928             mov     Temp1, #20
                      32929             
000934 300004         32930             jnb     Flags1.STARTUP_PHASE, comp_scale_samples
                      32931     
000937 781B           32932             mov     Temp1, #27                              ; Set many samples during startu
                               p, approximately one pwm period
000939 791B           32933             mov     Temp2, #27
                      32934     
00093B                32935     comp_scale_samples:
                      32936     IF 1 == 1
00093B C3             32937             clr     C
00093C E8             32938             mov     A, Temp1
00093D 33             32939             rlc     A
00093E F8             32940             mov     Temp1, A
00093F C3             32941             clr     C
000940 E9             32942             mov     A, Temp2
000941 33             32943             rlc     A
000942 F9             32944             mov     Temp2, A
                      32945     ENDIF
000943                32946     comp_check_timeout:
000943 200010         32947             jb      Flags0.T3_PENDING, comp_check_timeout_not_timed_out             ; Has ze
                               ro cross scan timeout elapsed?
                      32948     
000946 E500       F   32949             mov     A, Comparator_Read_Cnt                  ; Check that comparator has been
                                read
000948 600C           32950             jz      comp_check_timeout_not_timed_out        ; If not read - branch
                      32951     
00094A 300003         32952             jnb     Flags1.STARTUP_PHASE, comp_check_timeout_timeout_extended       ; Extend
                                timeout during startup
                      32953     
00094D D50004         32954             djnz    Startup_Zc_Timeout_Cntd, comp_check_timeout_extend_timeout
                      32955     
000950                32956     comp_check_timeout_timeout_extended:
000950 D200       F   32957             setb    Flags0.COMP_TIMED_OUT
000952 0100       F   32958             ajmp    setup_comm_wait
                      32959     
000954                32960     comp_check_timeout_extend_timeout:
000954 1100       F   32961             call    setup_zc_scan_timeout
000956                32962     comp_check_timeout_not_timed_out:
000956 0500       F   32963             inc     Comparator_Read_Cnt                     ; Increment comparator read count
                      32964+1           Read_Comp_Out                                   ; Read comparator output
00095A 5440           32966             anl     A, #40h
00095C B50002         32967             cjne    A, Bit_Access, comp_read_wrong
00095F 0100       F   32968             ajmp    comp_read_ok
                      32969             
000961                32970     comp_read_wrong:
000961 300009         32971             jnb     Flags1.STARTUP_PHASE, comp_read_wrong_not_startup
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   533

                      32972     
000964 08             32973             inc     Temp1                                   ; Increment number of OK reading
                               s required
000965 C3             32974             clr     C
000966 E8             32975             mov     A, Temp1
000967 99             32976             subb    A, Temp2                                        ; If above initial requi
                               rement - do not increment further
000968 4001           32977             jc      ($+3)
00096A 18             32978             dec     Temp1
                      32979     
00096B 0100       F   32980             ajmp    comp_check_timeout                      ; Continue to look for good ones
                      32981     
00096D                32982     comp_read_wrong_not_startup:
00096D 20000A         32983             jb      Flags0.DEMAG_DETECTED, comp_read_wrong_extend_timeout
                      32984     
000970 08             32985             inc     Temp1                                   ; Increment number of OK reading
                               s required
000971 C3             32986             clr     C
000972 E8             32987             mov     A, Temp1
000973 99             32988             subb    A, Temp2                                        
000974 4002           32989             jc      ($+4)
000976 0100       F   32990             ajmp    wait_for_comp_out_start         ; If above initial requirement - go back
                                and restart
                      32991     
000978 0100       F   32992             ajmp    comp_check_timeout                      ; Otherwise - take another readi
                               ng
                      32993     
00097A                32994     comp_read_wrong_extend_timeout:
00097A C200       F   32995             clr     Flags0.DEMAG_DETECTED           ; Clear demag detected flag
00097C 53E67F         32996             anl     EIE1, #7Fh                              ; Disable timer 3 interrupts
00097F 759100         32997             mov     TMR3CN0, #00h                           ; Timer 3 disabled and interrupt
                                flag cleared
000982 300011         32998             jnb     Flags1.HIGH_RPM, comp_read_wrong_low_rpm        ; Branch if not high rpm
                      32999     
000985 759400         33000             mov     TMR3L, #00h                             ; Set timeout to ~1ms
                      33001     IF 1 == 1
000988 7595F0         33002             mov     TMR3H, #0F0h
                      33003     ELSE
                                        mov     TMR3H, #0F8h
                                ENDIF
00098B                33006     comp_read_wrong_timeout_set:
00098B 759104         33007             mov     TMR3CN0, #04h                           ; Timer 3 enabled and interrupt 
                               flag cleared
00098E D200       F   33008             setb    Flags0.T3_PENDING
000990 43E680         33009             orl     EIE1, #80h                              ; Enable timer 3 interrupts
000993 020000     F   33010             ljmp    wait_for_comp_out_start         ; If comparator output is not correct - 
                               go back and restart
                      33011     
000996                33012     comp_read_wrong_low_rpm:
000996 E500       F   33013             mov     A, Comm_Period4x_H                      ; Set timeout to ~4x comm period
                                4x value
000998 7EFF           33014             mov     Temp7, #0FFh                            ; Default to long
                      33015     IF 1 == 1
00099A C3             33016             clr     C
00099B 33             33017             rlc     A
00099C 4009           33018             jc      comp_read_wrong_load_timeout
                      33019     
                      33020     ENDIF
00099E C3             33021             clr     C
00099F 33             33022             rlc     A
0009A0 4005           33023             jc      comp_read_wrong_load_timeout
                      33024     
0009A2 C3             33025             clr     C
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   534

0009A3 33             33026             rlc     A
0009A4 4001           33027             jc      comp_read_wrong_load_timeout
                      33028     
0009A6 FE             33029             mov     Temp7, A
                      33030     
0009A7                33031     comp_read_wrong_load_timeout:
0009A7 C3             33032             clr     C
0009A8 E4             33033             clr     A
0009A9 9E             33034             subb    A, Temp7
0009AA 759400         33035             mov     TMR3L, #0
0009AD F595           33036             mov     TMR3H, A
0009AF 0100       F   33037             ajmp    comp_read_wrong_timeout_set
                      33038     
0009B1                33039     comp_read_ok:
0009B1 C3             33040             clr     C
0009B2 E500       F   33041             mov     A, Startup_Cnt                          ; Force a timeout for the first 
                               commutation
0009B4 9401           33042             subb    A, #1
0009B6 5002           33043             jnc     ($+4)
0009B8 0100       F   33044             ajmp    wait_for_comp_out_start
                      33045     
0009BA 300002         33046             jnb     Flags0.DEMAG_DETECTED, ($+5)    ; Do not accept correct comparator outpu
                               t if it is demag
0009BD 0100       F   33047             ajmp    wait_for_comp_out_start
                      33048     
0009BF D802           33049             djnz    Temp1, comp_read_ok_jmp         ; Decrement readings counter - repeat co
                               mparator reading if not zero
0009C1 0100       F   33050             ajmp    ($+4)
                      33051     
0009C3                33052     comp_read_ok_jmp:
0009C3 0100       F   33053             ajmp    comp_check_timeout
                      33054     
0009C5 C200       F   33055             clr     Flags0.COMP_TIMED_OUT
                      33056     
                      33057     
                      33058     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      33059     ;
                      33060     ; Setup commutation timing routine
                      33061     ;
                      33062     ; No assumptions
                      33063     ;
                      33064     ; Sets up and starts wait from commutation to zero cross
                      33065     ;
                      33066     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0009C7                33067     setup_comm_wait:
0009C7 C2AF           33068             clr     IE_EA
0009C9 53E67F         33069             anl     EIE1, #7Fh              ; Disable timer 3 interrupts
0009CC 759100         33070             mov     TMR3CN0, #00h           ; Timer 3 disabled and interrupt flag cleared
0009CF 850094     F   33071             mov     TMR3L, Wt_Comm_Start_L
0009D2 850095     F   33072             mov     TMR3H, Wt_Comm_Start_H
0009D5 759104         33073             mov     TMR3CN0, #04h           ; Timer 3 enabled and interrupt flag cleared
                      33074             ; Setup next wait time
0009D8 850092     F   33075             mov     TMR3RLL, Wt_Adv_Start_L
0009DB 850093     F   33076             mov     TMR3RLH, Wt_Adv_Start_H
0009DE D200       F   33077             setb    Flags0.T3_PENDING
0009E0 43E680         33078             orl     EIE1, #80h              ; Enable timer 3 interrupts
0009E3 D2AF           33079             setb    IE_EA                   ; Enable interrupts again
                      33080     
                      33081     
                      33082     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      33083     ;
                      33084     ; Evaluate comparator integrity
                      33085     ;
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   535

                      33086     ; No assumptions
                      33087     ;
                      33088     ; Checks comparator signal behaviour versus expected behaviour
                      33089     ;
                      33090     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0009E5                33091     evaluate_comparator_integrity:
0009E5 E500       F   33092             mov     A, Flags1
0009E7 5403           33093             anl     A, #((1 SHL STARTUP_PHASE)+(1 SHL INITIAL_RUN_PHASE))
0009E9 6007           33094             jz      eval_comp_check_timeout
                      33095     
0009EB 200002         33096             jb      Flags1.INITIAL_RUN_PHASE, ($+5) ; Do not increment beyond startup phase
0009EE 0500       F   33097             inc     Startup_Cnt                                     ; Increment counter
0009F0 8010           33098             jmp     eval_comp_exit
                      33099     
0009F2                33100     eval_comp_check_timeout:
0009F2 30000D         33101             jnb     Flags0.COMP_TIMED_OUT, eval_comp_exit   ; Has timeout elapsed?
0009F5 20000A         33102             jb      Flags1.DIR_CHANGE_BRAKE, eval_comp_exit ; Do not exit run mode if it is 
                               braking
0009F8 200007         33103             jb      Flags0.DEMAG_DETECTED, eval_comp_exit   ; Do not exit run mode if it is 
                               a demag situation
0009FB 1581           33104             dec     SP                                                              ; Routin
                               e exit without "ret" command
0009FD 1581           33105             dec     SP
0009FF 020000     F   33106             ljmp    run_to_wait_for_power_on_fail                   ; Yes - exit run mode
                      33107     
000A02                33108     eval_comp_exit:
000A02 22             33109             ret
                      33110     
                      33111     
                      33112     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      33113     ;
                      33114     ; Wait for commutation routine
                      33115     ;
                      33116     ; No assumptions
                      33117     ;
                      33118     ; Waits from zero cross to commutation 
                      33119     ;
                      33120     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
000A03                33121     wait_for_comm: 
                      33122             ; Update demag metric
000A03 7800           33123             mov     Temp1, #0
000A05 300002         33124             jnb     Flags0.DEMAG_DETECTED, ($+5)
                      33125     
000A08 7801           33126             mov     Temp1, #1
                      33127     
000A0A E500       F   33128             mov     A, Demag_Detected_Metric        ; Sliding average of 8, 256 when demag a
                               nd 0 when not. Limited to minimum 120
000A0C 75F007         33129             mov     B, #7
000A0F A4             33130             mul     AB                                      ; Multiply by 7
000A10 F9             33131             mov     Temp2, A
000A11 E5F0           33132             mov     A, B                                    ; Add new value for current dema
                               g status
000A13 28             33133             add     A, Temp1                                
000A14 F5F0           33134             mov     B, A
000A16 E9             33135             mov     A, Temp2
000A17 A2F0           33136             mov     C, B.0                          ; Divide by 8
000A19 13             33137             rrc     A                                       
000A1A A2F1           33138             mov     C, B.1
000A1C 13             33139             rrc     A
000A1D A2F2           33140             mov     C, B.2
000A1F 13             33141             rrc     A
000A20 F500       F   33142             mov     Demag_Detected_Metric, A
000A22 C3             33143             clr     C
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   536

000A23 9478           33144             subb    A, #120                         ; Limit to minimum 120
000A25 5003           33145             jnc     ($+5)
                      33146     
000A27 750078     F   33147             mov     Demag_Detected_Metric, #120
                      33148     
000A2A C3             33149             clr     C
000A2B E500       F   33150             mov     A, Demag_Detected_Metric        ; Check demag metric
000A2D 9500       F   33151             subb    A, Demag_Pwr_Off_Thresh
000A2F 4006           33152             jc      wait_for_comm_wait              ; Cut power if many consecutive demags. 
                               This will help retain sync during hard accelerations
                      33153     
                      33154+1           All_pwmFETs_off
                      33156+1           Set_Pwms_Off
                      33158     
000A37                33159     wait_for_comm_wait:
000A37 300002         33160             jnb Flags0.T3_PENDING, ($+5)                    
000A3A 0100       F   33161             ajmp    wait_for_comm_wait
                      33162     
                      33163             ; Setup next wait time
000A3C 850092     F   33164             mov     TMR3RLL, Wt_Zc_Scan_Start_L
000A3F 850093     F   33165             mov     TMR3RLH, Wt_Zc_Scan_Start_H
000A42 D200       F   33166             setb    Flags0.T3_PENDING
000A44 43E680         33167             orl     EIE1, #80h                      ; Enable timer 3 interrupts
000A47 22             33168             ret
                      33169     
                      33170     
                      33171     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      33172     ;
                      33173     ; Commutation routines
                      33174     ;
                      33175     ; No assumptions
                      33176     ;
                      33177     ; Performs commutation switching 
                      33178     ;
                      33179     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      33180     ; Comm phase 1 to comm phase 2
000A48                33181     comm1comm2:     
                      33182+1           Set_RPM_Out
000A48 200017         33183             jb      Flags3.PGM_DIR_REV, comm12_rev
                      33184     
000A4B C2AF           33185             clr     IE_EA                           ; Disable all interrupts
                      33186+1           BcomFET_off                             ; Turn off comfet
                      33188+1           AcomFET_on                              ; Turn on comfet
                      33191+1           Set_Pwm_C                                       ; To reapply power after a demag
                                cut
000A5B D2AF           33194             setb    IE_EA
                      33195+1           Set_Comp_Phase_B                        ; Set comparator phase
000A60 0100       F   33197             jmp     comm_exit
                      33198     
000A62                33199     comm12_rev:     
000A62 C2AF           33200             clr     IE_EA                           ; Disable all interrupts
                      33201+1           BcomFET_off                             ; Turn off comfet
                      33203+1           CcomFET_on                              ; Turn on comfet (reverse)
                      33206+1           Set_Pwm_A                                       ; To reapply power after a demag
                                cut
000A72 D2AF           33209             setb    IE_EA
                      33210+1           Set_Comp_Phase_B                        ; Set comparator phase
000A77 0100       F   33212             jmp     comm_exit
                      33213     
                      33214     
                      33215     ; Comm phase 2 to comm phase 3
000A79                33216     comm2comm3:     
                      33217+1           Clear_RPM_Out
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   537

000A79 200017         33218             jb      Flags3.PGM_DIR_REV, comm23_rev
                      33219     
000A7C C2AF           33220             clr     IE_EA                           ; Disable all interrupts
                      33221+1           CpwmFET_off                             ; Turn off pwmfet
                      33223+1           Set_Pwm_B                                       ; To reapply power after a demag
                                cut
                      33226+1           AcomFET_on
000A8C D2AF           33229             setb    IE_EA
                      33230+1           Set_Comp_Phase_C                        ; Set comparator phase
000A91 0100       F   33232             ajmp    comm_exit
                      33233     
000A93                33234     comm23_rev:
000A93 C2AF           33235             clr     IE_EA                           ; Disable all interrupts
                      33236+1           ApwmFET_off                             ; Turn off pwmfet (reverse)
                      33238+1           Set_Pwm_B                                       ; To reapply power after a demag
                                cut
                      33241+1           CcomFET_on
000AA3 D2AF           33244             setb    IE_EA
                      33245+1           Set_Comp_Phase_A                        ; Set comparator phase (reverse)
000AA8 0100       F   33247             ajmp    comm_exit
                      33248     
                      33249     
                      33250     ; Comm phase 3 to comm phase 4
000AAA                33251     comm3comm4:     
                      33252+1           Set_RPM_Out
000AAA 200017         33253             jb      Flags3.PGM_DIR_REV, comm34_rev
                      33254     
000AAD C2AF           33255             clr     IE_EA                           ; Disable all interrupts
                      33256+1           AcomFET_off                             ; Turn off comfet
                      33258+1           CcomFET_on                              ; Turn on comfet
                      33261+1           Set_Pwm_B                                       ; To reapply power after a demag
                                cut
000ABD D2AF           33264             setb    IE_EA
                      33265+1           Set_Comp_Phase_A                        ; Set comparator phase
000AC2 0100       F   33267             jmp     comm_exit
                      33268     
000AC4                33269     comm34_rev:     
000AC4 C2AF           33270             clr     IE_EA                           ; Disable all interrupts
                      33271+1           CcomFET_off                             ; Turn off comfet (reverse)
                      33273+1           AcomFET_on                              ; Turn on comfet (reverse)
                      33276+1           Set_Pwm_B                                       ; To reapply power after a demag
                                cut
000AD4 D2AF           33279             setb    IE_EA
                      33280+1           Set_Comp_Phase_C                        ; Set comparator phase (reverse)
000AD9 0100       F   33282             jmp     comm_exit
                      33283     
                      33284     
                      33285     ; Comm phase 4 to comm phase 5
000ADB                33286     comm4comm5:     
                      33287+1           Clear_RPM_Out
000ADB 200017         33288             jb      Flags3.PGM_DIR_REV, comm45_rev
                      33289     
000ADE C2AF           33290             clr     IE_EA                           ; Disable all interrupts
                      33291+1           BpwmFET_off                             ; Turn off pwmfet
                      33293+1           Set_Pwm_A                                       ; To reapply power after a demag
                                cut
                      33296+1           CcomFET_on
000AEE D2AF           33299             setb    IE_EA
                      33300+1           Set_Comp_Phase_B                        ; Set comparator phase
000AF3 8077           33302             jmp     comm_exit
                      33303     
000AF5                33304     comm45_rev:
000AF5 C2AF           33305             clr     IE_EA                           ; Disable all interrupts
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   538

                      33306+1           BpwmFET_off                             ; Turn off pwmfet
                      33308+1           Set_Pwm_C
                      33311+1           AcomFET_on                              ; To reapply power after a demag cut
000B05 D2AF           33314             setb    IE_EA
                      33315+1           Set_Comp_Phase_B                        ; Set comparator phase
000B0A 8060           33317             jmp     comm_exit
                      33318     
                      33319     
                      33320     ; Comm phase 5 to comm phase 6
000B0C                33321     comm5comm6:     
                      33322+1           Set_RPM_Out
000B0C 200017         33323             jb      Flags3.PGM_DIR_REV, comm56_rev
                      33324     
000B0F C2AF           33325             clr     IE_EA                           ; Disable all interrupts
                      33326+1           CcomFET_off                             ; Turn off comfet
                      33328+1           BcomFET_on                              ; Turn on comfet
                      33331+1           Set_Pwm_A                                       ; To reapply power after a demag
                                cut
000B1F D2AF           33334             setb    IE_EA
                      33335+1           Set_Comp_Phase_C                        ; Set comparator phase
000B24 8046           33337             jmp     comm_exit
                      33338     
000B26                33339     comm56_rev:
000B26 C2AF           33340             clr     IE_EA                           ; Disable all interrupts
                      33341+1           AcomFET_off                             ; Turn off comfet (reverse)
                      33343+1           BcomFET_on                              ; Turn on comfet
                      33346+1           Set_Pwm_C                                       ; To reapply power after a demag
                                cut
000B36 D2AF           33349             setb    IE_EA
                      33350+1           Set_Comp_Phase_A                        ; Set comparator phase (reverse)
000B3B 802F           33352             jmp     comm_exit
                      33353     
                      33354     
                      33355     ; Comm phase 6 to comm phase 1
000B3D                33356     comm6comm1:     
                      33357+1           Clear_RPM_Out
000B3D 200017         33358             jb      Flags3.PGM_DIR_REV, comm61_rev
                      33359     
000B40 C2AF           33360             clr     IE_EA                           ; Disable all interrupts
                      33361+1           ApwmFET_off                             ; Turn off pwmfet
                      33363+1           Set_Pwm_C
                      33366+1           BcomFET_on                              ; To reapply power after a demag cut
000B50 D2AF           33369             setb    IE_EA
                      33370+1           Set_Comp_Phase_A                        ; Set comparator phase
000B55 8015           33372             jmp     comm_exit
                      33373     
000B57                33374     comm61_rev:
000B57 C2AF           33375             clr     IE_EA                           ; Disable all interrupts
                      33376+1           CpwmFET_off                             ; Turn off pwmfet (reverse)
                      33378+1           Set_Pwm_A
                      33381+1           BcomFET_on                              ; To reapply power after a demag cut
000B67 D2AF           33384             setb    IE_EA
                      33385+1           Set_Comp_Phase_C                        ; Set comparator phase (reverse)
                      33387     
000B6C                33388     comm_exit:
000B6C 22             33389             ret
                      33390     
                      33391     
                      33392     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      33393     ;
                      33394     ; Beeper routines (4 different entry points) 
                      33395     ;
                      33396     ; No assumptions
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   539

                      33397     ;
                      33398     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
000B6D                33399     beep_f1:        ; Entry point 1, load beeper frequency 1 settings
000B6D 7A14           33400             mov     Temp3, #20      ; Off wait loop length
000B6F 7B32           33401             mov     Temp4, #50      ; Number of beep pulses
000B71 8012           33402             jmp     beep
                      33403     
000B73                33404     beep_f2:        ; Entry point 2, load beeper frequency 2 settings
000B73 7A10           33405             mov     Temp3, #16
000B75 7B23           33406             mov     Temp4, #35
000B77 800C           33407             jmp     beep
                      33408     
000B79                33409     beep_f3:        ; Entry point 3, load beeper frequency 3 settings
000B79 7A0D           33410             mov     Temp3, #13
000B7B 7B2D           33411             mov     Temp4, #45
000B7D 8006           33412             jmp     beep
                      33413     
000B7F                33414     beep_f4:        ; Entry point 4, load beeper frequency 4 settings
000B7F 7A0B           33415             mov     Temp3, #11
000B81 7B32           33416             mov     Temp4, #50
000B83 8000           33417             jmp     beep
                      33418     
000B85                33419     beep:   ; Beep loop start
000B85 E500       F   33420             mov     A, Beep_Strength
000B87 D5E001         33421             djnz    ACC, beep_start
000B8A 22             33422             ret
                      33423     
000B8B                33424     beep_start:
000B8B 7902           33425             mov     Temp2, #2
000B8D                33426     beep_onoff:
000B8D E4             33427             clr     A
                      33428+1           BcomFET_off             ; BcomFET off
000B91 D5E0FD         33430             djnz    ACC, $          ; Allow some time after comfet is turned off
                      33431+1           BpwmFET_on              ; BpwmFET on (in order to charge the driver of the BcomF
                               ET)
000B99 D5E0FD         33434             djnz    ACC, $          ; Let the pwmfet be turned on a while
                      33435+1           BpwmFET_off             ; BpwmFET off again
000B9F D5E0FD         33437             djnz    ACC, $          ; Allow some time after pwmfet is turned off
                      33438+1           BcomFET_on              ; BcomFET on
000BA7 D5E0FD         33441             djnz    ACC, $          ; Allow some time after comfet is turned on
                      33442             ; Turn on pwmfet
000BAA E9             33443             mov     A, Temp2
000BAB 20E005         33444             jb      ACC.0, beep_apwmfet_on
                      33445+1           ApwmFET_on              ; ApwmFET on
000BB3                33448     beep_apwmfet_on:
000BB3 30E005         33449             jnb     ACC.0, beep_cpwmfet_on
                      33450+1           CpwmFET_on              ; CpwmFET on
000BBB                33453     beep_cpwmfet_on:
000BBB E500       F   33454             mov     A, Beep_Strength
000BBD D5E0FD         33455             djnz    ACC, $          
                      33456             ; Turn off pwmfet
000BC0 E9             33457             mov     A, Temp2
000BC1 20E003         33458             jb      ACC.0, beep_apwmfet_off
                      33459+1           ApwmFET_off             ; ApwmFET off
000BC7                33461     beep_apwmfet_off:
000BC7 30E003         33462             jnb     ACC.0, beep_cpwmfet_off
                      33463+1           CpwmFET_off             ; CpwmFET off
000BCD                33465     beep_cpwmfet_off:
000BCD 7496           33466             mov     A, #150         ; 25s off
000BCF D5E0FD         33467             djnz    ACC, $          
000BD2 D9B9           33468             djnz    Temp2, beep_onoff
                      33469             ; Copy variable
000BD4 EA             33470             mov     A, Temp3
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   540

000BD5 F8             33471             mov     Temp1, A        
000BD6                33472     beep_off:               ; Fets off loop
000BD6 D5E0FD         33473             djnz    ACC, $
000BD9 D8FB           33474             djnz    Temp1,  beep_off
000BDB DBA8           33475             djnz    Temp4,  beep
                      33476+1           BcomFET_off             ; BcomFET off
000BE0 22             33478             ret
                      33479     
                      33480     
                      33481     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      33482     ;
                      33483     ; Switch power off routine
                      33484     ;
                      33485     ; No assumptions
                      33486     ;
                      33487     ; Switches all fets off 
                      33488     ;
                      33489     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
000BE1                33490     switch_power_off:
                      33491+1           All_pwmFETs_Off         ; Turn off all pwm fets
                      33493+1           All_comFETs_Off         ; Turn off all commutation fets
                      33495+1           Set_Pwms_Off
000BEA 22             33497             ret                     
                      33498     
                      33499     
                      33500     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      33501     ;
                      33502     ; Set default parameters
                      33503     ;
                      33504     ; No assumptions
                      33505     ;
                      33506     ; Sets default programming parameters
                      33507     ;
                      33508     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
000BEB                33509     set_default_parameters:
000BEB 7800       F   33510             mov     Temp1, #_Pgm_Gov_P_Gain
000BED 76FF           33511             mov     @Temp1, #0FFh   ; Governor P gain
000BEF 08             33512             inc     Temp1
000BF0 76FF           33513             mov     @Temp1, #0FFh   ; Governor I gain
000BF2 08             33514             inc     Temp1
000BF3 76FF           33515             mov     @Temp1, #0FFh   ; Governor mode
000BF5 08             33516             inc     Temp1
000BF6 76FF           33517             mov     @Temp1, #0FFh   ; Low voltage limit
000BF8 08             33518             inc     Temp1
000BF9 76FF           33519             mov     @Temp1, #0FFh   ; Multi gain
000BFB 08             33520             inc     Temp1
000BFC 76FF           33521             mov     @Temp1, #0FFh   
000BFE 08             33522             inc     Temp1
000BFF 7609           33523             mov     @Temp1, #DEFAULT_PGM_STARTUP_PWR
000C01 08             33524             inc     Temp1
000C02 76FF           33525             mov     @Temp1, #0FFh   ; Pwm freq
000C04 08             33526             inc     Temp1
000C05 7601           33527             mov     @Temp1, #DEFAULT_PGM_DIRECTION
                      33528     
000C07 7800       F   33529             mov     Temp1, #Pgm_Enable_TX_Program
000C09 7601           33530             mov     @Temp1, #DEFAULT_PGM_ENABLE_TX_PROGRAM
000C0B 08             33531             inc     Temp1
000C0C 76FF           33532             mov     @Temp1, #0FFh   ; Main rearm start
000C0E 08             33533             inc     Temp1
000C0F 76FF           33534             mov     @Temp1, #0FFh   ; Governor setup target
000C11 08             33535             inc     Temp1
000C12 76FF           33536             mov     @Temp1, #0FFh   ; Startup rpm   
000C14 08             33537             inc     Temp1
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   541

000C15 76FF           33538             mov     @Temp1, #0FFh   ; Startup accel
000C17 08             33539             inc     Temp1
000C18 76FF           33540             mov     @Temp1, #0FFh   ; Voltage comp
000C1A 08             33541             inc     Temp1
000C1B 7603           33542             mov     @Temp1, #DEFAULT_PGM_COMM_TIMING
000C1D 08             33543             inc     Temp1
000C1E 76FF           33544             mov     @Temp1, #0FFh   ; Damping force 
000C20 08             33545             inc     Temp1
000C21 76FF           33546             mov     @Temp1, #0FFh   ; Governor range
000C23 08             33547             inc     Temp1
000C24 76FF           33548             mov     @Temp1, #0FFh   ; Startup method        
000C26 08             33549             inc     Temp1
000C27 7625           33550             mov     @Temp1, #DEFAULT_PGM_MIN_THROTTLE
000C29 08             33551             inc     Temp1
000C2A 76D0           33552             mov     @Temp1, #DEFAULT_PGM_MAX_THROTTLE
000C2C 08             33553             inc     Temp1
000C2D 7628           33554             mov     @Temp1, #DEFAULT_PGM_BEEP_STRENGTH
000C2F 08             33555             inc     Temp1
000C30 7650           33556             mov     @Temp1, #DEFAULT_PGM_BEACON_STRENGTH
000C32 08             33557             inc     Temp1
000C33 7604           33558             mov     @Temp1, #DEFAULT_PGM_BEACON_DELAY
000C35 08             33559             inc     Temp1
000C36 76FF           33560             mov     @Temp1, #0FFh   ; Throttle rate 
000C38 08             33561             inc     Temp1
000C39 7602           33562             mov     @Temp1, #DEFAULT_PGM_DEMAG_COMP
000C3B 08             33563             inc     Temp1
000C3C 76FF           33564             mov     @Temp1, #0FFh   ; Bec voltage high
000C3E 08             33565             inc     Temp1
000C3F 767A           33566             mov     @Temp1, #DEFAULT_PGM_CENTER_THROTTLE
000C41 08             33567             inc     Temp1
000C42 76FF           33568             mov     @Temp1, #0FFh   
000C44 08             33569             inc     Temp1
000C45 7607           33570             mov     @Temp1, #DEFAULT_PGM_ENABLE_TEMP_PROT
000C47 08             33571             inc     Temp1
000C48 7601           33572             mov     @Temp1, #DEFAULT_PGM_ENABLE_POWER_PROT
000C4A 08             33573             inc     Temp1
000C4B 76FF           33574             mov     @Temp1, #0FFh   ; Enable pwm input
000C4D 08             33575             inc     Temp1
000C4E 76FF           33576             mov     @Temp1, #0FFh   ; Pwm dither
000C50 08             33577             inc     Temp1
000C51 7600           33578             mov     @Temp1, #DEFAULT_PGM_BRAKE_ON_STOP
000C53 08             33579             inc     Temp1
000C54 7600           33580             mov     @Temp1, #DEFAULT_PGM_LED_CONTROL
000C56 22             33581             ret
                      33582     
                      33583     
                      33584     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      33585     ;
                      33586     ; Scale throttle cal
                      33587     ;
                      33588     ; No assumptions
                      33589     ;
                      33590     ; Scales a throttle cal value
                      33591     ; Input is ACC, output is Temp2/Temp1
                      33592     ;
                      33593     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
000C57                33594     scale_throttle_cal:
000C57 FA             33595             mov     Temp3, A
000C58 75F00C         33596             mov     B, #0Ch                 ; Calculate "3%" (for going from 1000us to numer
                               ical 1024)
000C5B A4             33597             mul     AB
000C5C ABF0           33598             mov     Temp4, B
000C5E EA             33599             mov     A, Temp3
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   542

000C5F C3             33600             clr     C                               ; Shift to 9 bits
000C60 33             33601             rlc     A
000C61 F8             33602             mov     Temp1, A
000C62 7401           33603             mov     A, #1
000C64 33             33604             rlc     A
000C65 F9             33605             mov     Temp2, A
000C66 E8             33606             mov     A, Temp1                        ; Shift to 10 bits
000C67 C3             33607             clr     C
000C68 33             33608             rlc     A
000C69 F8             33609             mov     Temp1, A
000C6A E9             33610             mov     A, Temp2
000C6B 33             33611             rlc     A
000C6C F9             33612             mov     Temp2, A
000C6D E8             33613             mov     A, Temp1                        ; Add "3%"
000C6E C3             33614             clr     C
000C6F 2B             33615             add     A, Temp4
000C70 F8             33616             mov     Temp1, A
000C71 E9             33617             mov     A, Temp2
000C72 3400           33618             addc    A, #0
000C74 F9             33619             mov     Temp2, A
                      33620     IF 1 == 1
000C75 E8             33621             mov     A, Temp1                        ; Shift to 11 bits
000C76 C3             33622             clr     C
000C77 33             33623             rlc     A
000C78 F8             33624             mov     Temp1, A
000C79 E9             33625             mov     A, Temp2
000C7A 33             33626             rlc     A
000C7B F9             33627             mov     Temp2, A
                      33628     ENDIF
000C7C 22             33629     ret
                      33630     
                      33631     
                      33632     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      33633     ;
                      33634     ; Decode settings
                      33635     ;
                      33636     ; No assumptions
                      33637     ;
                      33638     ; Decodes various settings
                      33639     ;
                      33640     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
000C7D                33641     decode_settings:
                      33642             ; Load programmed direction
000C7D 7800       F   33643             mov     Temp1, #Pgm_Direction   
000C7F E6             33644             mov     A, @Temp1                               
000C80 C3             33645             clr     C
000C81 9403           33646             subb    A, #3
000C83 D200       F   33647             setb    Flags3.PGM_BIDIR
000C85 5002           33648             jnc     ($+4)
                      33649     
000C87 C200       F   33650             clr     Flags3.PGM_BIDIR
                      33651     
000C89 C200       F   33652             clr     Flags3.PGM_DIR_REV
000C8B E6             33653             mov     A, @Temp1                               
000C8C 30E102         33654             jnb     ACC.1, ($+5)
000C8F D200       F   33655             setb    Flags3.PGM_DIR_REV
000C91 A200       F   33656             mov     C, Flags3.PGM_DIR_REV
000C93 9200       F   33657             mov     Flags3.PGM_BIDIR_REV, C
                      33658             ; Decode startup power
000C95 7800       F   33659             mov     Temp1, #Pgm_Startup_Pwr         
000C97 E6             33660             mov     A, @Temp1                               
000C98 14             33661             dec     A       
000C99 900000     F   33662             mov     DPTR, #STARTUP_POWER_TABLE
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   543

000C9C 93             33663             movc A, @A+DPTR 
000C9D 7800       F   33664             mov     Temp1, #Pgm_Startup_Pwr_Decoded
000C9F F6             33665             mov     @Temp1, A       
                      33666             ; Decode low rpm power slope
000CA0 7800       F   33667             mov     Temp1, #Pgm_Startup_Pwr
000CA2 E6             33668             mov     A, @Temp1
000CA3 F500       F   33669             mov     Low_Rpm_Pwr_Slope, A
000CA5 C3             33670             clr     C
000CA6 9402           33671             subb    A, #2
000CA8 5003           33672             jnc     ($+5)
000CAA 750002     F   33673             mov     Low_Rpm_Pwr_Slope, #2
                      33674             ; Decode demag compensation
000CAD 7800       F   33675             mov     Temp1, #Pgm_Demag_Comp          
000CAF E6             33676             mov     A, @Temp1                               
000CB0 7500FF     F   33677             mov     Demag_Pwr_Off_Thresh, #255      ; Set default
                      33678     
000CB3 B40203         33679             cjne    A, #2, decode_demag_high
                      33680     
000CB6 7500A0     F   33681             mov     Demag_Pwr_Off_Thresh, #160      ; Settings for demag comp low
                      33682     
000CB9                33683     decode_demag_high:
000CB9 B40303         33684             cjne    A, #3, decode_demag_done
                      33685     
000CBC 750082     F   33686             mov     Demag_Pwr_Off_Thresh, #130      ; Settings for demag comp high
                      33687     
000CBF                33688     decode_demag_done:
                      33689             ; Decode temperature protection limit
000CBF 7800       F   33690             mov     Temp1, #Pgm_Enable_Temp_Prot
000CC1 E6             33691             mov     A, @Temp1
000CC2 F8             33692             mov     Temp1, A
000CC3 6006           33693             jz      decode_temp_done
                      33694     
000CC5 7428           33695             mov     A, #(TEMP_LIMIT-TEMP_LIMIT_STEP)
000CC7                33696     decode_temp_step:
000CC7 2409           33697             add     A, #TEMP_LIMIT_STEP
000CC9 D8FC           33698             djnz    Temp1, decode_temp_step
                      33699     
000CCB                33700     decode_temp_done:
000CCB F500       F   33701             mov     Temp_Prot_Limit, A
                      33702             ; Decode throttle cal
000CCD 7800       F   33703             mov     Temp1, #Pgm_Min_Throttle                ; Throttle cal is in 4us units
000CCF E6             33704             mov     A, @Temp1
000CD0 1100       F   33705             call    scale_throttle_cal
000CD2 8800       F   33706             mov     Min_Throttle_L, Temp1
000CD4 8900       F   33707             mov     Min_Throttle_H, Temp2
000CD6 7800       F   33708             mov     Temp1, #Pgm_Center_Throttle     ; Throttle cal is in 4us units
000CD8 E6             33709             mov     A, @Temp1
000CD9 1100       F   33710             call    scale_throttle_cal
000CDB 8800       F   33711             mov     Center_Throttle_L, Temp1
000CDD 8900       F   33712             mov     Center_Throttle_H, Temp2
000CDF 7800       F   33713             mov     Temp1, #Pgm_Max_Throttle                ; Throttle cal is in 4us units
000CE1 E6             33714             mov     A, @Temp1
000CE2 1100       F   33715             call    scale_throttle_cal
000CE4 8800       F   33716             mov     Max_Throttle_L, Temp1
000CE6 8900       F   33717             mov     Max_Throttle_H, Temp2
000CE8 1100       F   33718             call    switch_power_off
000CEA 22             33719             ret
                      33720     
                      33721     
                      33722     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      33723     ;
                      33724     ; Find throttle gains
                      33725     ;
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   544

                      33726     ; No assumptions
                      33727     ;
                      33728     ; Finds throttle gains for both directions in bidirectional mode
                      33729     ;
                      33730     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
000CEB                33731     find_throttle_gains:
                      33732             ; Check if full range is chosen
000CEB 300011         33733             jnb     Flags2.RCP_FULL_RANGE, find_throttle_gains_normal
                      33734     
000CEE 7A00           33735             mov     Temp3, #0               ; Min throttle
000CF0 7B00           33736             mov     Temp4, #0
000CF2 7CFF           33737             mov     Temp5, #255     ; Max throttle
000CF4 7D00           33738             mov     Temp6, #0
000CF6 7E00           33739             mov     Temp7, #0               ; Deadband
000CF8 1100       F   33740             call    find_throttle_gain
000CFA 8B00       F   33741             mov     Throttle_Gain_M, Temp4
000CFC 8A00       F   33742             mov     Throttle_Gain, Temp3
000CFE 22             33743             ret
                      33744     
000CFF                33745     find_throttle_gains_normal:
                      33746             ; Check if bidirectional operation
000CFF 300022         33747             jnb     Flags3.PGM_BIDIR, find_throttle_gains_bidir_done
                      33748     
000D02 7800       F   33749             mov     Temp1, #Pgm_Min_Throttle
000D04 E6             33750             mov     A, @Temp1
000D05 FA             33751             mov     Temp3, A
000D06 7B00           33752             mov     Temp4, #0
000D08 7800       F   33753             mov     Temp1, #Pgm_Center_Throttle
000D0A E6             33754             mov     A, @Temp1
000D0B FC             33755             mov     Temp5, A
000D0C 7D00           33756             mov     Temp6, #0
000D0E C3             33757             clr     C
000D0F EA             33758             mov     A, Temp3                        ; Scale gains in bidirectional
000D10 33             33759             rlc     A
000D11 FA             33760             mov     Temp3, A
000D12 EB             33761             mov     A, Temp4
000D13 33             33762             rlc     A
000D14 FB             33763             mov     Temp4, A
000D15 C3             33764             clr     C
000D16 EC             33765             mov     A, Temp5
000D17 33             33766             rlc     A
000D18 FC             33767             mov     Temp5, A
000D19 ED             33768             mov     A, Temp6
000D1A 33             33769             rlc     A
000D1B FD             33770             mov     Temp6, A
000D1C 7E0A           33771             mov     Temp7, #10              ; Compensate for deadband in bidirectional
000D1E 1100       F   33772             call    find_throttle_gain
000D20 8B00       F   33773             mov     Throttle_Gain_BD_Rev_M, Temp4
000D22 8A00       F   33774             mov     Throttle_Gain_BD_Rev, Temp3
                      33775     
000D24                33776     find_throttle_gains_bidir_done:
000D24 7800       F   33777             mov     Temp1, #Pgm_Min_Throttle
000D26 300002         33778             jnb     Flags3.PGM_BIDIR, ($+5)
                      33779     
000D29 7800       F   33780             mov     Temp1, #Pgm_Center_Throttle
                      33781     
000D2B E6             33782             mov     A, @Temp1
000D2C FA             33783             mov     Temp3, A
000D2D 7B00           33784             mov     Temp4, #0
000D2F 7800       F   33785             mov     Temp1, #Pgm_Max_Throttle
000D31 E6             33786             mov     A, @Temp1
000D32 FC             33787             mov     Temp5, A
000D33 7D00           33788             mov     Temp6, #0
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   545

000D35 7E00           33789             mov     Temp7, #0                       ; No deadband
000D37 300010         33790             jnb     Flags3.PGM_BIDIR, find_throttle_gain_fwd
                      33791     
000D3A C3             33792             clr     C
000D3B EA             33793             mov     A, Temp3                        ; Scale gains in bidirectional
000D3C 33             33794             rlc     A
000D3D FA             33795             mov     Temp3, A
000D3E EB             33796             mov     A, Temp4
000D3F 33             33797             rlc     A
000D40 FB             33798             mov     Temp4, A
000D41 C3             33799             clr     C
000D42 EC             33800             mov     A, Temp5
000D43 33             33801             rlc     A
000D44 FC             33802             mov     Temp5, A
000D45 ED             33803             mov     A, Temp6
000D46 33             33804             rlc     A
000D47 FD             33805             mov     Temp6, A
000D48 7E0A           33806             mov     Temp7, #10              ; Compensate for deadband in bidirectional
                      33807     
000D4A                33808     find_throttle_gain_fwd:
000D4A 1100       F   33809             call    find_throttle_gain
000D4C 8B00       F   33810             mov     Throttle_Gain_M, Temp4
000D4E 8A00       F   33811             mov     Throttle_Gain, Temp3
000D50 22             33812             ret
                      33813     
                      33814     
                      33815     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      33816     ;
                      33817     ; Find throttle gain
                      33818     ;
                      33819     ; The difference between max and min throttle must be more than 140us (a Pgm_xxx_Throttl
                               e difference of 35)
                      33820     ; Temp4/3 holds min throttle, Temp6/5 holds max throttle, Temp7 holds deadband, Temp4/Te
                               mp3 gives resulting gain
                      33821     ;
                      33822     ; Finds throttle gain from throttle calibration values
                      33823     ;
                      33824     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
000D51                33825     find_throttle_gain:
                      33826             ; Subtract deadband from max
000D51 C3             33827             clr     C
000D52 EC             33828             mov     A, Temp5
000D53 9E             33829             subb    A, Temp7
000D54 FC             33830             mov     Temp5, A
000D55 ED             33831             mov     A, Temp6
000D56 9400           33832             subb    A, #0
000D58 FD             33833             mov     Temp6, A
                      33834             ; Calculate difference
000D59 C3             33835             clr     C
000D5A EC             33836             mov     A, Temp5
000D5B 9A             33837             subb    A, Temp3
000D5C FC             33838             mov     Temp5, A
000D5D ED             33839             mov     A, Temp6
000D5E 9B             33840             subb    A, Temp4
000D5F FD             33841             mov     Temp6, A
                      33842             ; Check that difference is minimum 35
000D60 C3             33843             clr     C
000D61 EC             33844             mov     A, Temp5
000D62 9423           33845             subb    A, #35
000D64 ED             33846             mov     A, Temp6
000D65 9400           33847             subb    A, #0
000D67 5004           33848             jnc     ($+6)
                      33849     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   546

000D69 7C23           33850             mov     Temp5, #35
000D6B 7D00           33851             mov     Temp6, #0
                      33852     
                      33853             ; Check that difference is maximum 511
000D6D C3             33854             clr     C
000D6E EC             33855             mov     A, Temp5
000D6F 94FF           33856             subb    A, #255
000D71 ED             33857             mov     A, Temp6
000D72 9401           33858             subb    A, #1
000D74 4004           33859             jc      ($+6)
                      33860     
000D76 7CFF           33861             mov     Temp5, #255
000D78 7D01           33862             mov     Temp6, #1
                      33863     
                      33864             ; Find gain
000D7A 7BFF           33865             mov     Temp4, #0FFh
000D7C                33866     find_throttle_gain_loop:
000D7C 0B             33867             inc     Temp4
000D7D 7A00           33868             mov     Temp3, #0
000D7F                33869     test_throttle_gain:
000D7F 0A             33870             inc     Temp3
000D80 EA             33871             mov     A, Temp3
000D81 7009           33872             jnz     test_throttle_gain_mult
                      33873     
000D83 C3             33874             clr     C
000D84 EC             33875             mov     A, Temp5                        ; Set multiplier x2 and range /2
000D85 33             33876             rlc     A
000D86 FC             33877             mov     Temp5, A
000D87 ED             33878             mov     A, Temp6
000D88 33             33879             rlc     A
000D89 FD             33880             mov     Temp6, A
000D8A 0100       F   33881             ajmp    find_throttle_gain_loop
                      33882     
000D8C                33883     test_throttle_gain_mult:
000D8C EC             33884             mov     A, Temp5                        ; A has difference, B has gain
000D8D 8AF0           33885             mov     B, Temp3
000D8F A4             33886             mul     AB
000D90 AEF0           33887             mov     Temp7, B
000D92 ED             33888             mov     A, Temp6
000D93 8AF0           33889             mov     B, Temp3
000D95 A4             33890             mul     AB
000D96 2E             33891             add     A, Temp7
000D97 947C           33892             subb    A, #124
000D99 40E4           33893             jc      test_throttle_gain
                      33894     
000D9B EA             33895             mov     A, Temp3
000D9C F4             33896             cpl     A
000D9D 60DD           33897             jz      find_throttle_gain_loop
                      33898     
000D9F 22             33899             ret
                      33900     
                      33901     
                      33902     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      33903     ;
                      33904     ; Average throttle 
                      33905     ;
                      33906     ; Outputs result in Temp8
                      33907     ;
                      33908     ; Averages throttle calibration readings
                      33909     ;
                      33910     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
000DA0                33911     average_throttle:
000DA0 D200       F   33912             setb    Flags2.RCP_FULL_RANGE   ; Set range to 1000-2020us
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   547

000DA2 1100       F   33913             call    find_throttle_gains     ; Set throttle gains
000DA4 120000     F   33914             call wait30ms           
000DA7 120000     F   33915             call wait30ms
000DAA 7A00           33916             mov     Temp3, #0
000DAC 7B00           33917             mov     Temp4, #0
000DAE 7C10           33918             mov     Temp5, #16              ; Average 16 measurments
000DB0                33919     average_throttle_meas:
000DB0 120000     F   33920             call    wait3ms                 ; Wait for new RC pulse value
000DB3 E500       F   33921             mov     A, New_Rcp              ; Get new RC pulse value
000DB5 2A             33922             add     A, Temp3
000DB6 FA             33923             mov     Temp3, A
000DB7 7400           33924             mov     A, #0
000DB9 3B             33925             addc A, Temp4
000DBA FB             33926             mov     Temp4, A
000DBB DCF3           33927             djnz    Temp5, average_throttle_meas
                      33928     
000DBD 7C04           33929             mov     Temp5, #4                       ; Shift 4 times
000DBF                33930     average_throttle_div:
000DBF C3             33931             clr     C
000DC0 EB             33932             mov     A, Temp4                ; Shift right 
000DC1 13             33933             rrc     A      
000DC2 FB             33934             mov     Temp4, A   
000DC3 EA             33935             mov     A, Temp3   
000DC4 13             33936             rrc     A      
000DC5 FA             33937             mov     Temp3, A   
000DC6 DCF7           33938             djnz    Temp5, average_throttle_div
                      33939     
000DC8 FF             33940             mov     Temp8, A                ; Copy to Temp8
000DC9 EB             33941             mov     A, Temp4
000DCA 6002           33942             jz      ($+4)
                      33943     
000DCC 7FFF           33944             mov     Temp8, #0FFh
                      33945     
000DCE C200       F   33946             clr     Flags2.RCP_FULL_RANGE
000DD0 1100       F   33947             call    find_throttle_gains     ; Set throttle gains
000DD2 22             33948             ret
                      33949     
                      33950     
                      33951     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      33952     ;
                      33953     ; LED control
                      33954     ;
                      33955     ; No assumptions
                      33956     ;
                      33957     ; Controls LEDs
                      33958     ;
                      33959     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
000DD3                33960     led_control:
000DD3 7800       F   33961             mov     Temp1, #Pgm_LED_Control
000DD5 E6             33962             mov     A, @Temp1
000DD6 F9             33963             mov     Temp2, A
000DD7 5403           33964             anl     A, #03h
                      33965+1           Set_LED_0
000DD9 7000           33966             jnz     led_0_done
                      33967+1           Clear_LED_0
000DDB                33968     led_0_done:
000DDB E9             33969             mov     A, Temp2
000DDC 540C           33970             anl     A, #0Ch
                      33971+1           Set_LED_1
000DDE 7000           33972             jnz     led_1_done
                      33973+1           Clear_LED_1
000DE0                33974     led_1_done:
000DE0 E9             33975             mov     A, Temp2
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   548

000DE1 5430           33976             anl     A, #030h
                      33977+1           Set_LED_2
000DE3 7000           33978             jnz     led_2_done
                      33979+1           Clear_LED_2
000DE5                33980     led_2_done:
000DE5 E9             33981             mov     A, Temp2
000DE6 54C0           33982             anl     A, #0C0h
                      33983+1           Set_LED_3
000DE8 7000           33984             jnz     led_3_done
                      33985+1           Clear_LED_3
000DEA                33986     led_3_done:
000DEA 22             33987             ret
                      33988     
                      33989     
                      33990     
                      33991     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      33992     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      33993     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      33994     ;
                      33995     ; Main program start
                      33996     ;
                      33997     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      33998     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      33999     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      34000     
000DEB                34001     pgm_start:
                      34002             ; Initialize flash keys to invalid values
000DEB 750000     F   34003             mov     Flash_Key_1, #0
000DEE 750000     F   34004             mov     Flash_Key_2, #0
                      34005             ; Disable the WDT.
000DF1 7597DE         34006             mov     WDTCN, #0DEh            ; Disable watchdog
000DF4 7597AD         34007             mov     WDTCN, #0ADh            
                      34008             ; Initialize stack
000DF7 7581C0         34009             mov     SP, #0c0h                       ; Stack = 64 upper bytes of RAM
                      34010             ; Initialize VDD monitor
000DFA 43FF80         34011             orl     VDM0CN, #080h           ; Enable the VDD monitor
000DFD 75EF06         34012             mov     RSTSRC, #06h    ; Set missing clock and VDD monitor as a reset source if
                                not 1S capable
                      34013             ; Set clock frequency
000E00 75A900         34014             mov     CLKSEL, #00h            ; Set clock divider to 1
                      34015             ; Switch power off
000E03 1100       F   34016             call    switch_power_off
                      34017             ; Ports initialization
000E05 7580FF         34018             mov     P0, #P0_INIT
000E08 75F193         34019             mov     P0MDIN, #P0_DIGITAL
000E0B 75A400         34020             mov     P0MDOUT, #P0_PUSHPULL
000E0E 7580FF         34021             mov     P0, #P0_INIT
000E11 75D4FF         34022             mov     P0SKIP, #P0_SKIP                                
000E14 759000         34023             mov     P1, #P1_INIT
000E17 75F28F         34024             mov     P1MDIN, #P1_DIGITAL
000E1A 75A570         34025             mov     P1MDOUT, #P1_PUSHPULL
000E1D 759000         34026             mov     P1, #P1_INIT
000E20 75D5FF         34027             mov     P1SKIP, #P1_SKIP                                
000E23 75A601         34028             mov     P2MDOUT, #P2_PUSHPULL                           
                      34029             ; Initialize the XBAR and related functionality
                      34030+1           Initialize_Xbar
                      34033             ; Switch power off again, after initializing ports
000E2C 1100       F   34034             call    switch_power_off
                      34035             ; Clear RAM
000E2E E4             34036             clr     A                               ; Clear accumulator
000E2F F8             34037             mov     Temp1, A                        ; Clear Temp1
000E30                34038             clear_ram:      
000E30 F6             34039             mov     @Temp1, A                       ; Clear RAM
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   549

000E31 D8FD           34040             djnz Temp1, clear_ram   ; Is A not zero? - jump
                      34041             ; Set default programmed parameters
000E33 1100       F   34042             call    set_default_parameters
                      34043             ; Read all programmed parameters
000E35 120000     F   34044             call read_all_eeprom_parameters
                      34045             ; Set beep strength
000E38 7800       F   34046             mov     Temp1, #Pgm_Beep_Strength
000E3A 8600       F   34047             mov     Beep_Strength, @Temp1
                      34048             ; Set initial arm variable
000E3C 750001     F   34049             mov     Initial_Arm, #1
                      34050             ; Initializing beep
000E3F C2AF           34051             clr     IE_EA                   ; Disable interrupts explicitly
000E41 120000     F   34052             call wait200ms  
000E44 1100       F   34053             call beep_f1
000E46 120000     F   34054             call wait10ms  ; preston
000E49 1100       F   34055             call beep_f2
000E4B 120000     F   34056             call wait10ms   ; preston
000E4E 1100       F   34057             call beep_f3
000E50 120000     F   34058             call wait10ms  ; preston
000E53 1100       F   34059             call    led_control
                      34060     
                      34061     
                      34062     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      34063     ;
                      34064     ; No signal entry point
                      34065     ;
                      34066     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
000E55                34067     init_no_signal:
                      34068             ; Disable interrupts explicitly
000E55 C2AF           34069             clr     IE_EA
                      34070             ; Initialize flash keys to invalid values
000E57 750000     F   34071             mov     Flash_Key_1, #0
000E5A 750000     F   34072             mov     Flash_Key_2, #0
                      34073             ; Check if input signal is high for more than 15ms
000E5D 78FA           34074             mov     Temp1, #250
000E5F                34075     input_high_check_1:
000E5F 79FA           34076             mov     Temp2, #250
000E61                34077     input_high_check_2:
000E61 308707         34078             jnb     RTX_PORT.RTX_PIN, bootloader_done       ; Look for low
000E64 D9FB           34079             djnz    Temp2, input_high_check_2
000E66 D8F7           34080             djnz    Temp1, input_high_check_1
                      34081     
000E68 021C00         34082             ljmp    1C00h                   ; Jump to bootloader
                      34083     
000E6B                34084     bootloader_done:
                      34085             ; Decode settings
000E6B 1100       F   34086             call    decode_settings
                      34087             ; Find throttle gain from stored min and max settings
000E6D 1100       F   34088             call    find_throttle_gains
                      34089             ; Set beep strength
000E6F 7800       F   34090             mov     Temp1, #Pgm_Beep_Strength
000E71 8600       F   34091             mov     Beep_Strength, @Temp1
                      34092             ; Switch power off
000E73 1100       F   34093             call    switch_power_off
                      34094             ; Set clock frequency
                      34095     IF 1 == 1
                      34096+1           Set_MCU_Clk_24MHz
                      34102     ENDIF
                      34103             ; Setup timers for pwm input
000E84 75E407         34104             mov     IT01CF, #RTX_PIN        ; Route RCP input to INT0
000E87 758811         34105             mov     TCON, #11h              ; Timer 0 run and INT0 edge triggered
000E8A 758E04         34106             mov     CKCON0, #04h            ; Timer 0 clock is system clock
000E8D 758909         34107             mov     TMOD, #09h              ; Timer 0 set to 16bits and gated by INT0
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   550

000E90 75C804         34108             mov     TMR2CN0, #04h           ; Timer 2 enabled
000E93 759104         34109             mov     TMR3CN0, #04h           ; Timer 3 enabled
                      34110+1           Initialize_PCA                  ; Initialize PCA
                      34128+1           Set_Pwm_Polarity                ; Set pwm polarity
                      34134+1           Enable_Power_Pwm_Module ; Enable power pwm module
                      34140+1           Enable_Damp_Pwm_Module  ; Enable damping pwm module
                      34146             ; Enable interrupts
                      34147     IF 1 == 0
                                        mov     IE, #21h                        ; Enable timer 2 interrupts and INT0 int
                               errupts
                                ELSE
000EAB 75A823         34150             mov     IE, #23h                        ; Enable timer 0, timer 2 interrupts and
                                INT0 interrupts
                      34151     ENDIF
000EAE 75E690         34152             mov     EIE1, #90h              ; Enable timer 3 and PCA0 interrupts
000EB1 75B801         34153             mov     IP, #01h                        ; High priority to INT0 interrupts
                      34154             ; Initialize comparator
                      34155+1           Initialize_Comparator   ; Initialize comparator
                      34158             ; Initialize ADC
                      34159+1           Initialize_Adc                  ; Initialize ADC operation
000EC9 120000     F   34169             call    wait1ms
000ECC D2AF           34170             setb    IE_EA                   ; Enable all interrupts
                      34171             ; Reset stall count
000ECE 750000     F   34172             mov     Stall_Cnt, #0
                      34173             ; Initialize RC pulse
000ED1 C200       F   34174             clr     Flags2.RCP_UPDATED                      ; Clear updated flag
000ED3 120000     F   34175             call wait200ms
                      34176             ; Clear all shot flags
000ED6 C200       F   34177             clr     Flags2.RCP_ONESHOT125                   ; Clear OneShot125 flag
000ED8 C200       F   34178             clr     Flags2.RCP_ONESHOT42                    ; Clear OneShot42 flag
000EDA C200       F   34179             clr     Flags2.RCP_MULTISHOT                    ; Clear Multishot flag
000EDC C200       F   34180             clr     Flags2.RCP_DSHOT                                ; Clear DShot flag
000EDE 750000     F   34181             mov     Dshot_Cmd, #0                                   ; Clear Dshot command
000EE1 750000     F   34182             mov     Dshot_Cmd_Cnt, #0                               ; Clear Dshot command co
                               unt
                      34183             ; Test whether signal is regular pwm
000EE4 750000     F   34184             mov     Rcp_Outside_Range_Cnt, #0               ; Reset out of range counter
000EE7 120000     F   34185             call wait100ms                                          ; Wait for new RC pulse
000EEA C3             34186             clr     C
000EEB E500       F   34187             mov     A, Rcp_Outside_Range_Cnt                        ; Check how many pulses 
                               were outside normal range ("900-2235us")
000EED 940A           34188             subb    A, #10                                          
000EEF 5002           34189             jnc     ($+4)
000EF1 0100       F   34190             ajmp    validate_rcp_start
                      34191     
                      34192             ; Test whether signal is OneShot125
000EF3 D200       F   34193             setb    Flags2.RCP_ONESHOT125                   ; Set OneShot125 flag
000EF5 750000     F   34194             mov     Rcp_Outside_Range_Cnt, #0               ; Reset out of range counter
000EF8 120000     F   34195             call wait100ms                                          ; Wait for new RC pulse
000EFB C3             34196             clr     C
000EFC E500       F   34197             mov     A, Rcp_Outside_Range_Cnt                        ; Check how many pulses 
                               were outside normal range ("900-2235us")
000EFE 940A           34198             subb    A, #10
000F00 5002           34199             jnc     ($+4)
000F02 0100       F   34200             ajmp    validate_rcp_start
                      34201     
                      34202             ; Test whether signal is OneShot42
000F04 C200       F   34203             clr     Flags2.RCP_ONESHOT125
000F06 D200       F   34204             setb    Flags2.RCP_ONESHOT42                    ; Set OneShot42 flag
000F08 750000     F   34205             mov     Rcp_Outside_Range_Cnt, #0               ; Reset out of range counter
000F0B 120000     F   34206             call wait100ms                                          ; Wait for new RC pulse
000F0E C3             34207             clr     C
000F0F E500       F   34208             mov     A, Rcp_Outside_Range_Cnt                        ; Check how many pulses 
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   551

                               were outside normal range ("900-2235us")
000F11 940A           34209             subb    A, #10
000F13 5002           34210             jnc     ($+4)
000F15 0100       F   34211             ajmp    validate_rcp_start
                      34212     
                      34213             ; Setup timers for DShot
000F17 75E4F7         34214             mov     IT01CF, #(80h+(RTX_PIN SHL 4)+(RTX_PIN))        ; Route RCP input to INT
                               0/1, with INT1 inverted
000F1A 758851         34215             mov     TCON, #51h              ; Timer 0/1 run and INT0 edge triggered
000F1D 758E01         34216             mov     CKCON0, #01h            ; Timer 0/1 clock is system clock divided by 4 (
                               for DShot150)
000F20 7589AA         34217             mov     TMOD, #0AAh             ; Timer 0/1 set to 8bits auto reload and gated b
                               y INT0
000F23 758C00         34218             mov     TH0, #0                 ; Auto reload value zero
000F26 758D00         34219             mov     TH1, #0
                      34220             ; Setup interrupts for DShot
000F29 C2A9           34221             clr     IE_ET0                  ; Disable timer 0 interrupts
000F2B D2AB           34222             setb    IE_ET1                  ; Enable timer 1 interrupts
000F2D D2AA           34223             setb    IE_EX1                  ; Enable int1 interrupts
                      34224             ; Setup variables for DSshot150
                      34225     IF 1 == 1
000F2F 750080     F   34226             mov     DShot_Timer_Preset, #128                        ; Load DShot sync timer 
                               preset (for DShot150)
                      34227     ELSE
                                        mov     DShot_Timer_Preset, #192
                                ENDIF
000F32 750014     F   34230             mov     DShot_Pwm_Thr, #20                              ; Load DShot qualificati
                               on pwm threshold (for DShot150)
000F35 750050     F   34231             mov     DShot_Frame_Length_Thr, #80             ; Load DShot frame length criter
                               ia
                      34232             ; Test whether signal is DShot150
000F38 C200       F   34233             clr     Flags2.RCP_ONESHOT42
000F3A D200       F   34234             setb    Flags2.RCP_DSHOT
000F3C 75000A     F   34235             mov     Rcp_Outside_Range_Cnt, #10              ; Set out of range counter
000F3F 120000     F   34236             call wait100ms                                          ; Wait for new RC pulse
000F42 750010     F   34237             mov     DShot_Pwm_Thr, #16                              ; Load DShot regular pwm
                                threshold
000F45 C3             34238             clr     C
000F46 E500       F   34239             mov     A, Rcp_Outside_Range_Cnt                        ; Check if pulses were a
                               ccepted
000F48 940A           34240             subb    A, #10
000F4A 750000     F   34241             mov     Dshot_Cmd, #0
000F4D 750000     F   34242             mov     Dshot_Cmd_Cnt, #0
000F50 4069           34243             jc      validate_rcp_start
                      34244     
                      34245             ; Setup variables for DShot300
000F52 758E0C         34246             mov     CKCON0, #0Ch                                    ; Timer 0/1 clock is sys
                               tem clock (for DShot300)
                      34247     IF 1 == 1
000F55 750000     F   34248             mov     DShot_Timer_Preset, #0                  ; Load DShot sync timer preset (
                               for DShot300)
                      34249     ELSE
                                        mov     DShot_Timer_Preset, #128
                                ENDIF
000F58 750028     F   34252             mov     DShot_Pwm_Thr, #40                              ; Load DShot qualificati
                               on pwm threshold (for DShot300)
000F5B 750028     F   34253             mov     DShot_Frame_Length_Thr, #40             ; Load DShot frame length criter
                               ia
                      34254             ; Test whether signal is DShot300
000F5E 75000A     F   34255             mov     Rcp_Outside_Range_Cnt, #10              ; Set out of range counter
000F61 120000     F   34256             call wait100ms                                          ; Wait for new RC pulse
000F64 750020     F   34257             mov     DShot_Pwm_Thr, #32                              ; Load DShot regular pwm
                                threshold
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   552

000F67 C3             34258             clr     C
000F68 E500       F   34259             mov     A, Rcp_Outside_Range_Cnt                        ; Check if pulses were a
                               ccepted
000F6A 940A           34260             subb    A, #10
000F6C 750000     F   34261             mov     Dshot_Cmd, #0
000F6F 750000     F   34262             mov     Dshot_Cmd_Cnt, #0
000F72 4047           34263             jc      validate_rcp_start
                      34264     
                      34265             ; Setup variables for DShot600
000F74 758E0C         34266             mov     CKCON0, #0Ch                                    ; Timer 0/1 clock is sys
                               tem clock (for DShot600)
                      34267     IF 1 == 1
000F77 750080     F   34268             mov     DShot_Timer_Preset, #128                        ; Load DShot sync timer 
                               preset (for DShot600)
                      34269     ELSE
                                        mov     DShot_Timer_Preset, #192
                                ENDIF
000F7A 750014     F   34272             mov     DShot_Pwm_Thr, #20                              ; Load DShot qualificati
                               on pwm threshold (for DShot600)
000F7D 750014     F   34273             mov     DShot_Frame_Length_Thr, #20             ; Load DShot frame length criter
                               ia
                      34274             ; Test whether signal is DShot600
000F80 75000A     F   34275             mov     Rcp_Outside_Range_Cnt, #10              ; Set out of range counter
000F83 120000     F   34276             call wait100ms                                          ; Wait for new RC pulse
000F86 750010     F   34277             mov     DShot_Pwm_Thr, #16                              ; Load DShot regular pwm
                                threshold
000F89 C3             34278             clr     C
000F8A E500       F   34279             mov     A, Rcp_Outside_Range_Cnt                        ; Check if pulses were a
                               ccepted
000F8C 940A           34280             subb    A, #10
000F8E 750000     F   34281             mov     Dshot_Cmd, #0
000F91 750000     F   34282             mov     Dshot_Cmd_Cnt, #0
000F94 4025           34283             jc      validate_rcp_start
                      34284     
                      34285             ; Setup timers for Multishot
000F96 75E407         34286             mov     IT01CF, #RTX_PIN        ; Route RCP input to INT0
000F99 758811         34287             mov     TCON, #11h              ; Timer 0 run and INT0 edge triggered
000F9C 758E04         34288             mov     CKCON0, #04h            ; Timer 0 clock is system clock
000F9F 758909         34289             mov     TMOD, #09h              ; Timer 0 set to 16bits and gated by INT0
                      34290             ; Setup interrupts for Multishot
000FA2 D2A9           34291             setb    IE_ET0                  ; Enable timer 0 interrupts
000FA4 C2AB           34292             clr     IE_ET1                  ; Disable timer 1 interrupts
000FA6 C2AA           34293             clr     IE_EX1                  ; Disable int1 interrupts
                      34294             ; Test whether signal is Multishot
000FA8 C200       F   34295             clr     Flags2.RCP_DSHOT
000FAA D200       F   34296             setb    Flags2.RCP_MULTISHOT                    ; Set Multishot flag
000FAC 750000     F   34297             mov     Rcp_Outside_Range_Cnt, #0               ; Reset out of range counter
000FAF 120000     F   34298             call wait100ms                                          ; Wait for new RC pulse
000FB2 C3             34299             clr     C
000FB3 E500       F   34300             mov     A, Rcp_Outside_Range_Cnt                        ; Check how many pulses 
                               were outside normal range ("900-2235us")
000FB5 940A           34301             subb    A, #10
000FB7 4002           34302             jc      validate_rcp_start
                      34303     
000FB9 0100       F   34304             ajmp    init_no_signal
                      34305     
000FBB                34306     validate_rcp_start:
                      34307             ; Validate RC pulse
000FBB 120000     F   34308             call wait3ms                                            ; Wait for new RC pulse
000FBE 200003         34309             jb      Flags2.RCP_UPDATED, ($+6)               ; Is there an updated RC pulse a
                               vailable - proceed
000FC1 020000     F   34310             ljmp    init_no_signal                                  ; Go back to detect inpu
                               t signal
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   553

                      34311     
                      34312             ; Beep arm sequence start signal
000FC4 C2AF           34313             clr     IE_EA                                           ; Disable all interrupts
000FC6 1100       F   34314             call beep_f1                                            ; Signal that RC pulse i
                               s ready
000FC8 1100       F   34315             call beep_f1
000FCA 1100       F   34316             call beep_f1
000FCC D2AF           34317             setb    IE_EA                                           ; Enable all interrupts
000FCE 120000     F   34318             call wait200ms  
                      34319     
                      34320             ; Arming sequence start
000FD1                34321     arming_start:
000FD1 200003         34322             jb      Flags2.RCP_DSHOT, ($+6) ; Disable tx programming for DShot
000FD4 300003         34323             jnb     Flags3.PGM_BIDIR, ($+6)
                      34324     
000FD7 020000     F   34325             ljmp    program_by_tx_checked   ; Disable tx programming if bidirectional operat
                               ion
                      34326     
000FDA 120000     F   34327             call wait3ms
000FDD 7800       F   34328             mov     Temp1, #Pgm_Enable_TX_Program; Start programming mode entry if enabled
000FDF E6             34329             mov     A, @Temp1                               
000FE0 C3             34330             clr     C
000FE1 9401           34331             subb    A, #1                           ; Is TX programming enabled?
000FE3 5003           34332             jnc     arming_initial_arm_check        ; Yes - proceed
                      34333     
000FE5 020000     F   34334             jmp     program_by_tx_checked   ; No - branch
                      34335     
000FE8                34336     arming_initial_arm_check:
000FE8 E500       F   34337             mov     A, Initial_Arm                  ; Yes - check if it is initial arm seque
                               nce
000FEA C3             34338             clr     C
000FEB 9401           34339             subb    A, #1                           ; Is it the initial arm sequence?
000FED 5003           34340             jnc     arming_check                    ; Yes - proceed
                      34341     
000FEF 020000     F   34342             jmp     program_by_tx_checked   ; No - branch
                      34343     
000FF2                34344     arming_check:
                      34345             ; Initialize flash keys to valid values
000FF2 7500A5     F   34346             mov     Flash_Key_1, #0A5h
000FF5 7500F1     F   34347             mov     Flash_Key_2, #0F1h
                      34348             ; Throttle calibration and tx program entry
000FF8 7F02           34349             mov     Temp8, #2                               ; Set 1 seconds wait time
000FFA                34350     throttle_high_cal:                      
000FFA D200       F   34351             setb    Flags2.RCP_FULL_RANGE   ; Set range to 1000-2020us
000FFC 1100       F   34352             call    find_throttle_gains             ; Set throttle gains
000FFE 120000     F   34353             call wait100ms                          ; Wait for new throttle value
001001 C2AF           34354             clr     IE_EA                           ; Disable interrupts (freeze New_Rcp val
                               ue)
001003 C200       F   34355             clr     Flags2.RCP_FULL_RANGE   ; Set programmed range
001005 120000     F   34356             call    find_throttle_gains             ; Set throttle gains
001008 C3             34357             clr     C
001009 E500       F   34358             mov     A, New_Rcp                      ; Load new RC pulse value
00100B 947F           34359             subb    A, #(255/2)                     ; Is RC pulse above midstick?
00100D D2AF           34360             setb    IE_EA                           ; Enable interrupts
00100F 4070           34361             jc      program_by_tx_checked   ; No - branch
                      34362     
001011 120000     F   34363             call wait1ms            
001014 C2AF           34364             clr     IE_EA                           ; Disable all interrupts
001016 120000     F   34365             call beep_f4
001019 D2AF           34366             setb    IE_EA                           ; Enable all interrupts
00101B DFDD           34367             djnz    Temp8, throttle_high_cal        ; Continue to wait
                      34368     
00101D 120000     F   34369             call    average_throttle
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   554

001020 C3             34370             clr     C
001021 EF             34371             mov     A, Temp8
001022 7800       F   34372             mov     Temp1, #Pgm_Max_Throttle        ; Store
001024 F6             34373             mov     @Temp1, A                       
001025 120000     F   34374             call wait200ms                          
001028 1100       F   34375             call    success_beep
                      34376     
00102A                34377     throttle_low_cal_start:
00102A 7F0A           34378             mov     Temp8, #10                      ; Set 3 seconds wait time
00102C                34379     throttle_low_cal:                       
00102C D200       F   34380             setb    Flags2.RCP_FULL_RANGE   ; Set range to 1000-2020us
00102E 120000     F   34381             call    find_throttle_gains             ; Set throttle gains
001031 120000     F   34382             call wait100ms
001034 C2AF           34383             clr     IE_EA                           ; Disable interrupts (freeze New_Rcp val
                               ue)
001036 C200       F   34384             clr     Flags2.RCP_FULL_RANGE   ; Set programmed range
001038 120000     F   34385             call    find_throttle_gains             ; Set throttle gains
00103B C3             34386             clr     C
00103C E500       F   34387             mov     A, New_Rcp                      ; Load new RC pulse value
00103E 947F           34388             subb    A, #(255/2)                     ; Below midstick?
001040 D2AF           34389             setb    IE_EA                           ; Enable interrupts
001042 50E6           34390             jnc     throttle_low_cal_start  ; No - start over
                      34391     
001044 120000     F   34392             call wait1ms            
001047 C2AF           34393             clr     IE_EA                           ; Disable all interrupts
001049 120000     F   34394             call beep_f1
00104C 120000     F   34395             call wait10ms
00104F 120000     F   34396             call beep_f1
001052 D2AF           34397             setb    IE_EA                           ; Enable all interrupts
001054 DFD6           34398             djnz    Temp8, throttle_low_cal ; Continue to wait
                      34399     
001056 120000     F   34400             call    average_throttle
001059 EF             34401             mov     A, Temp8
00105A 2403           34402             add     A, #3                           ; Add about 1%
00105C 7800       F   34403             mov     Temp1, #Pgm_Min_Throttle        ; Store
00105E F6             34404             mov     @Temp1, A                       
00105F F8             34405             mov     Temp1, A                                ; Min throttle in Temp1
001060 7900       F   34406             mov     Temp2, #Pgm_Max_Throttle
001062 E7             34407             mov     A, @Temp2
001063 C3             34408             clr     C
001064 9423           34409             subb    A, #35                          ; Subtract 35 (140us) from max throttle
001066 4003           34410             jc      program_by_tx_entry_limit
001068 98             34411             subb    A, Temp1                                ; Subtract min from max
001069 5006           34412             jnc     program_by_tx_entry_store
                      34413     
00106B                34414     program_by_tx_entry_limit:
00106B E8             34415             mov     A, Temp1                                ; Load min
00106C 2423           34416             add     A, #35                          ; Make max 140us higher than min
00106E 7800       F   34417             mov     Temp1, #Pgm_Max_Throttle        ; Store new max
001070 F6             34418             mov     @Temp1, A
                      34419     
001071                34420     program_by_tx_entry_store:
001071 120000     F   34421             call wait200ms                          
001074 1100       F   34422             call erase_and_store_all_in_eeprom      
001076 1100       F   34423             call    success_beep_inverted
                      34424     
001078                34425     program_by_tx_entry_wait:
001078 120000     F   34426             call wait100ms
00107B 120000     F   34427             call    find_throttle_gains             ; Set throttle gains
00107E 020000     F   34428             ljmp    init_no_signal                  ; Go back
                      34429     
001081                34430     program_by_tx_checked:
                      34431             ; Initialize flash keys to invalid values
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   555

001081 750000     F   34432             mov     Flash_Key_1, #0
001084 750000     F   34433             mov     Flash_Key_2, #0
001087 120000     F   34434             call wait100ms                          ; Wait for new throttle value
00108A C3             34435             clr     C
00108B E500       F   34436             mov     A, New_Rcp                      ; Load new RC pulse value
00108D 9401           34437             subb    A, #1                           ; Below stop?
00108F 4003           34438             jc      arm_end_beep                    ; Yes - proceed
                      34439     
001091 020000     F   34440             jmp     arming_start                    ; No - start over
                      34441     
001094                34442     arm_end_beep:
                      34443             ; Beep arm sequence end signal
001094 C2AF           34444             clr     IE_EA                           ; Disable all interrupts
001096 120000     F   34445             call beep_f4                            ; Signal that rcpulse is ready
001099 120000     F   34446             call beep_f4
00109C 120000     F   34447             call beep_f4
00109F D2AF           34448             setb    IE_EA                           ; Enable all interrupts
0010A1 120000     F   34449             call wait200ms
                      34450     
                      34451             ; Clear initial arm variable
0010A4 750000     F   34452             mov     Initial_Arm, #0
                      34453     
                      34454             ; Armed and waiting for power on
0010A7                34455     wait_for_power_on:
0010A7 E4             34456             clr     A
0010A8 F500       F   34457             mov     Power_On_Wait_Cnt_L, A  ; Clear wait counter
0010AA F500       F   34458             mov     Power_On_Wait_Cnt_H, A  
0010AC                34459     wait_for_power_on_loop:
0010AC 0500       F   34460             inc     Power_On_Wait_Cnt_L             ; Increment low wait counter
0010AE E500       F   34461             mov     A, Power_On_Wait_Cnt_L
0010B0 F4             34462             cpl     A
0010B1 703F           34463             jnz     wait_for_power_on_no_beep; Counter wrapping (about 3 sec)
                      34464     
0010B3 0500       F   34465             inc     Power_On_Wait_Cnt_H             ; Increment high wait counter
0010B5 7800       F   34466             mov     Temp1, #Pgm_Beacon_Delay
0010B7 E6             34467             mov     A, @Temp1
0010B8 7819           34468             mov     Temp1, #25              ; Approximately 1 min
0010BA 14             34469             dec     A
0010BB 6012           34470             jz      beep_delay_set
                      34471     
0010BD 7832           34472             mov     Temp1, #50              ; Approximately 2 min
0010BF 14             34473             dec     A
0010C0 600D           34474             jz      beep_delay_set
                      34475     
0010C2 787D           34476             mov     Temp1, #125             ; Approximately 5 min
0010C4 14             34477             dec     A
0010C5 6008           34478             jz      beep_delay_set
                      34479     
0010C7 78FA           34480             mov     Temp1, #250             ; Approximately 10 min
0010C9 14             34481             dec     A
0010CA 6003           34482             jz      beep_delay_set
                      34483     
0010CC 750000     F   34484             mov     Power_On_Wait_Cnt_H, #0         ; Reset counter for infinite delay
                      34485     
0010CF                34486     beep_delay_set:
0010CF C3             34487             clr     C
0010D0 E500       F   34488             mov     A, Power_On_Wait_Cnt_H
0010D2 98             34489             subb    A, Temp1                                ; Check against chosen delay
0010D3 401D           34490             jc      wait_for_power_on_no_beep; Has delay elapsed?
                      34491     
0010D5 120000     F   34492             call    switch_power_off                ; Switch power off in case braking is set
0010D8 120000     F   34493             call    wait1ms
0010DB 1500       F   34494             dec     Power_On_Wait_Cnt_H             ; Decrement high wait counter
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   556

0010DD 750000     F   34495             mov     Power_On_Wait_Cnt_L, #0 ; Set low wait counter
0010E0 7800       F   34496             mov     Temp1, #Pgm_Beacon_Strength
0010E2 8600       F   34497             mov     Beep_Strength, @Temp1
0010E4 C2AF           34498             clr     IE_EA                           ; Disable all interrupts
0010E6 120000     F   34499             call beep_f4                            ; Signal that there is no signal
0010E9 D2AF           34500             setb    IE_EA                           ; Enable all interrupts
0010EB 7800       F   34501             mov     Temp1, #Pgm_Beep_Strength
0010ED 8600       F   34502             mov     Beep_Strength, @Temp1
0010EF 120000     F   34503             call wait100ms                          ; Wait for new RC pulse to be measured
                      34504     
0010F2                34505     wait_for_power_on_no_beep:
0010F2 120000     F   34506             call wait10ms
0010F5 E500       F   34507             mov     A, Rcp_Timeout_Cntd                     ; Load RC pulse timeout counter 
                               value
0010F7 7003           34508             jnz     wait_for_power_on_not_missing   ; If it is not zero - proceed
                      34509     
0010F9 020000     F   34510             jmp     init_no_signal                          ; If pulses missing - go back to
                                detect input signal
                      34511     
0010FC                34512     wait_for_power_on_not_missing:
0010FC C3             34513             clr     C
0010FD E500       F   34514             mov     A, New_Rcp                      ; Load new RC pulse value
0010FF 9401           34515             subb    A, #1                           ; Higher than stop
001101 500A           34516             jnc     wait_for_power_on_nonzero       ; Yes - proceed
                      34517     
001103 C3             34518             clr     C
001104 E500       F   34519             mov     A, Dshot_Cmd
001106 9401           34520             subb    A, #1                           ; 1 or higher
001108 5016           34521             jnc     check_dshot_cmd         ; Check Dshot command
                      34522     
00110A 020000     F   34523             ljmp    wait_for_power_on_loop  ; If not Dshot command - start over
                      34524     
00110D                34525     wait_for_power_on_nonzero:
00110D 120000     F   34526             lcall wait100ms                 ; Wait to see if start pulse was only a glitch
001110 E500       F   34527             mov     A, Rcp_Timeout_Cntd             ; Load RC pulse timeout counter value
001112 7003           34528             jnz     ($+5)                           ; If it is not zero - proceed
001114 020000     F   34529             ljmp    init_no_signal                  ; If it is zero (pulses missing) - go ba
                               ck to detect input signal
                      34530     
001117 750000     F   34531             mov     Dshot_Cmd, #0
00111A 750000     F   34532             mov     Dshot_Cmd_Cnt, #0
00111D 020000     F   34533             ljmp init_start
                      34534     
001120                34535     check_dshot_cmd:
001120 C3             34536             clr     C
001121 E500       F   34537             mov     A, Dshot_Cmd
001123 9401           34538             subb A, #1
001125 7017           34539             jnz     dshot_beep_2
                      34540     
001127 C2AF           34541             clr     IE_EA
001129 120000     F   34542             call    switch_power_off                ; Switch power off in case braking is set
00112C 7800       F   34543             mov     Temp1, #Pgm_Beacon_Strength
00112E 8600       F   34544             mov     Beep_Strength, @Temp1
001130 120000     F   34545             call beep_f1
001133 7800       F   34546             mov     Temp1, #Pgm_Beep_Strength
001135 8600       F   34547             mov     Beep_Strength, @Temp1
001137 D2AF           34548             setb    IE_EA   
001139 120000     F   34549             call wait100ms  
00113C 0100       F   34550             jmp     clear_dshot_cmd
                      34551     
00113E                34552     dshot_beep_2:   
00113E C3             34553             clr     C
00113F E500       F   34554             mov     A, Dshot_Cmd
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   557

001141 9402           34555             subb A, #2
001143 7017           34556             jnz     dshot_beep_3
                      34557     
001145 C2AF           34558             clr     IE_EA
001147 120000     F   34559             call    switch_power_off                ; Switch power off in case braking is set
00114A 7800       F   34560             mov     Temp1, #Pgm_Beacon_Strength
00114C 8600       F   34561             mov     Beep_Strength, @Temp1
00114E 120000     F   34562             call beep_f2
001151 7800       F   34563             mov     Temp1, #Pgm_Beep_Strength
001153 8600       F   34564             mov     Beep_Strength, @Temp1
001155 D2AF           34565             setb    IE_EA   
001157 120000     F   34566             call wait100ms  
00115A 0100       F   34567             jmp     clear_dshot_cmd
                      34568     
00115C                34569     dshot_beep_3:           
00115C C3             34570             clr     C
00115D E500       F   34571             mov     A, Dshot_Cmd
00115F 9403           34572             subb A, #3
001161 7017           34573             jnz     dshot_beep_4
                      34574     
001163 C2AF           34575             clr     IE_EA
001165 120000     F   34576             call    switch_power_off                ; Switch power off in case braking is set
001168 7800       F   34577             mov     Temp1, #Pgm_Beacon_Strength
00116A 8600       F   34578             mov     Beep_Strength, @Temp1
00116C 120000     F   34579             call beep_f3
00116F 7800       F   34580             mov     Temp1, #Pgm_Beep_Strength
001171 8600       F   34581             mov     Beep_Strength, @Temp1
001173 D2AF           34582             setb    IE_EA   
001175 120000     F   34583             call wait100ms  
001178 0100       F   34584             jmp     clear_dshot_cmd
                      34585     
00117A                34586     dshot_beep_4:
00117A C3             34587             clr     C
00117B E500       F   34588             mov     A, Dshot_Cmd
00117D 9404           34589             subb A, #4
00117F 7017           34590             jnz     dshot_beep_5
                      34591     
001181 C2AF           34592             clr     IE_EA
001183 120000     F   34593             call    switch_power_off                ; Switch power off in case braking is set
001186 7800       F   34594             mov     Temp1, #Pgm_Beacon_Strength
001188 8600       F   34595             mov     Beep_Strength, @Temp1
00118A 120000     F   34596             call beep_f4
00118D 7800       F   34597             mov     Temp1, #Pgm_Beep_Strength
00118F 8600       F   34598             mov     Beep_Strength, @Temp1
001191 D2AF           34599             setb    IE_EA   
001193 120000     F   34600             call wait100ms          
001196 0100       F   34601             jmp     clear_dshot_cmd
                      34602     
001198                34603     dshot_beep_5:
001198 C3             34604             clr     C
001199 E500       F   34605             mov     A, Dshot_Cmd
00119B 9405           34606             subb A, #5
00119D 7017           34607             jnz     dshot_direction_1
                      34608     
00119F C2AF           34609             clr     IE_EA
0011A1 120000     F   34610             call    switch_power_off                ; Switch power off in case braking is set
0011A4 7800       F   34611             mov     Temp1, #Pgm_Beacon_Strength
0011A6 8600       F   34612             mov     Beep_Strength, @Temp1
0011A8 120000     F   34613             call beep_f4
0011AB 7800       F   34614             mov     Temp1, #Pgm_Beep_Strength
0011AD 8600       F   34615             mov     Beep_Strength, @Temp1
0011AF D2AF           34616             setb    IE_EA   
0011B1 120000     F   34617             call wait100ms  
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   558

0011B4 0100       F   34618             jmp     clear_dshot_cmd
                      34619     
0011B6                34620     dshot_direction_1:
0011B6 C3             34621             clr     C
0011B7 E500       F   34622             mov     A, Dshot_Cmd
0011B9 9407           34623             subb A, #7
0011BB 7019           34624             jnz     dshot_direction_2
                      34625     
0011BD C3             34626             clr     C
0011BE E500       F   34627             mov     A, Dshot_Cmd_Cnt
0011C0 9406           34628             subb A, #6                                      ; Needs to receive it 6 times in
                                a row
0011C2 5002           34629             jnc     ($+4)                                   ; Same as "jc dont_clear_dshot_c
                               md"
0011C4 0100       F   34630             ajmp wait_for_power_on_not_missing
                      34631     
0011C6 7401           34632             mov     A, #1
0011C8 300002         34633             jnb     Flags3.PGM_BIDIR, ($+5)
0011CB 7403           34634             mov     A, #3
0011CD 7800       F   34635             mov     Temp1, #Pgm_Direction
0011CF F6             34636             mov     @Temp1, A
0011D0 C200       F   34637             clr     Flags3.PGM_DIR_REV
0011D2 C200       F   34638             clr     Flags3.PGM_BIDIR_REV
0011D4 0100       F   34639             jmp     clear_dshot_cmd
                      34640     
0011D6                34641     dshot_direction_2:
0011D6 C3             34642             clr     C
0011D7 E500       F   34643             mov     A, Dshot_Cmd
0011D9 9408           34644             subb A, #8
0011DB 7019           34645             jnz     dshot_direction_bidir_off
                      34646     
0011DD C3             34647             clr     C
0011DE E500       F   34648             mov     A, Dshot_Cmd_Cnt
0011E0 9406           34649             subb A, #6                                      ; Needs to receive it 6 times in
                                a row
0011E2 5002           34650             jnc     ($+4)                                   ; Same as "jc dont_clear_dshot_c
                               md"
0011E4 0100       F   34651             ajmp wait_for_power_on_not_missing
                      34652     
0011E6 7402           34653             mov     A, #2
0011E8 300002         34654             jnb     Flags3.PGM_BIDIR, ($+5)
0011EB 7404           34655             mov     A, #4
0011ED 7800       F   34656             mov     Temp1, #Pgm_Direction
0011EF F6             34657             mov     @Temp1, A
0011F0 D200       F   34658             setb Flags3.PGM_DIR_REV
0011F2 D200       F   34659             setb Flags3.PGM_BIDIR_REV
0011F4 0100       F   34660             jmp     clear_dshot_cmd
                      34661     
0011F6                34662     dshot_direction_bidir_off:
0011F6 C3             34663             clr     C
0011F7 E500       F   34664             mov     A, Dshot_Cmd
0011F9 9409           34665             subb A, #9
0011FB 7017           34666             jnz     dshot_direction_bidir_on
                      34667     
0011FD C3             34668             clr     C
0011FE E500       F   34669             mov     A, Dshot_Cmd_Cnt
001200 9406           34670             subb A, #6                                      ; Needs to receive it 6 times in
                                a row
001202 5002           34671             jnc     ($+4)                                   ; Same as "jc dont_clear_dshot_c
                               md"
001204 0100       F   34672             ajmp wait_for_power_on_not_missing
                      34673     
001206 30000B         34674             jnb     Flags3.PGM_BIDIR, dshot_direction_bidir_on
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   559

                      34675     
001209 C3             34676             clr     C
00120A 7800       F   34677             mov     Temp1, #Pgm_Direction
00120C E6             34678             mov     A, @Temp1
00120D 9402           34679             subb    A, #2
00120F F6             34680             mov     @Temp1, A
001210 C200       F   34681             clr     Flags3.PGM_BIDIR
001212 0100       F   34682             jmp     clear_dshot_cmd
                      34683     
001214                34684     dshot_direction_bidir_on:
001214 C3             34685             clr     C
001215 E500       F   34686             mov     A, Dshot_Cmd
001217 940A           34687             subb A, #10
001219 7016           34688             jnz     dshot_direction_normal
                      34689     
00121B C3             34690             clr     C
00121C E500       F   34691             mov     A, Dshot_Cmd_Cnt
00121E 9406           34692             subb A, #6                                      ; Needs to receive it 6 times in
                                a row
001220 5002           34693             jnc     ($+4)                                   ; Same as "jc dont_clear_dshot_c
                               md"
001222 0100       F   34694             ajmp wait_for_power_on_not_missing
                      34695     
001224 20000A         34696             jb      Flags3.PGM_BIDIR, dshot_direction_normal
                      34697     
001227 7800       F   34698             mov     Temp1, #Pgm_Direction
001229 E6             34699             mov     A, @Temp1
00122A 2402           34700             add     A, #2
00122C F6             34701             mov     @Temp1, A
00122D D200       F   34702             setb    Flags3.PGM_BIDIR
00122F 0100       F   34703             jmp     clear_dshot_cmd
                      34704     
001231                34705     dshot_direction_normal: 
001231 C3             34706             clr     C
001232 E500       F   34707             mov     A, Dshot_Cmd
001234 9414           34708             subb A, #20
001236 7025           34709             jnz     dshot_direction_reverse
                      34710     
001238 C3             34711             clr     C
001239 E500       F   34712             mov     A, Dshot_Cmd_Cnt
00123B 9406           34713             subb A, #6                                      ; Needs to receive it 6 times in
                                a row
00123D 5002           34714             jnc     ($+4)                                   ; Same as "jc dont_clear_dshot_c
                               md"
00123F 0100       F   34715             ajmp wait_for_power_on_not_missing
                      34716     
001241 C2AF           34717             clr     IE_EA                                   ; DPTR used in interrupts
001243 900000     F   34718             mov     DPTR, #Eep_Pgm_Direction                ; Read from flash
001246 7400           34719             mov     A, #0
001248 93             34720             movc    A, @A+DPTR
001249 D2AF           34721             setb    IE_EA
00124B 7800       F   34722             mov     Temp1, #Pgm_Direction
00124D F6             34723             mov     @Temp1, A
00124E 13             34724             rrc     A                                               ; Lsb to carry
00124F C200       F   34725             clr     Flags3.PGM_DIR_REV
001251 C200       F   34726             clr     Flags3.PGM_BIDIR_REV
001253 4002           34727             jc      ($+4)
001255 D200       F   34728             setb    Flags3.PGM_DIR_REV
001257 4002           34729             jc      ($+4)
001259 D200       F   34730             setb    Flags3.PGM_BIDIR_REV
00125B 8057           34731             jmp     clear_dshot_cmd
                      34732     
00125D                34733     dshot_direction_reverse:                        ; Temporary reverse
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   560

00125D C3             34734             clr     C
00125E E500       F   34735             mov     A, Dshot_Cmd
001260 9415           34736             subb A, #21
001262 7038           34737             jnz     dshot_save_settings
                      34738     
001264 C3             34739             clr     C
001265 E500       F   34740             mov     A, Dshot_Cmd_Cnt
001267 9406           34741             subb A, #6                                      ; Needs to receive it 6 times in
                                a row
001269 404F           34742             jc      dont_clear_dshot_cmd
                      34743             
00126B C2AF           34744             clr     IE_EA                                   ; DPTR used in interrupts
00126D 900000     F   34745             mov     DPTR, #Eep_Pgm_Direction                ; Read from flash
001270 7400           34746             mov     A, #0
001272 93             34747             movc    A, @A+DPTR
001273 D2AF           34748             setb    IE_EA
001275 F8             34749             mov     Temp1, A
001276 B80102         34750             cjne    Temp1, #1, ($+5)
001279 7402           34751             mov     A, #2
00127B B80202         34752             cjne    Temp1, #2, ($+5)
00127E 7401           34753             mov     A, #1
001280 B80302         34754             cjne    Temp1, #3, ($+5)
001283 7404           34755             mov     A, #4
001285 B80402         34756             cjne    Temp1, #4, ($+5)
001288 7403           34757             mov     A, #3
00128A 7800       F   34758             mov     Temp1, #Pgm_Direction
00128C F6             34759             mov     @Temp1, A
00128D 13             34760             rrc     A                                               ; Lsb to carry
00128E C200       F   34761             clr     Flags3.PGM_DIR_REV
001290 C200       F   34762             clr     Flags3.PGM_BIDIR_REV
001292 4002           34763             jc      ($+4)
001294 D200       F   34764             setb    Flags3.PGM_DIR_REV
001296 4002           34765             jc      ($+4)
001298 D200       F   34766             setb    Flags3.PGM_BIDIR_REV
00129A 8018           34767             jmp     clear_dshot_cmd
                      34768     
00129C                34769     dshot_save_settings:
00129C C3             34770             clr     C
00129D E500       F   34771             mov     A, Dshot_Cmd
00129F 940C           34772             subb A, #12
0012A1 7011           34773             jnz     clear_dshot_cmd
                      34774     
0012A3 7500A5     F   34775             mov     Flash_Key_1, #0A5h                      ; Initialize flash keys to valid
                                values
0012A6 7500F1     F   34776             mov     Flash_Key_2, #0F1h
0012A9 C3             34777             clr     C
0012AA E500       F   34778             mov     A, Dshot_Cmd_Cnt
0012AC 9406           34779             subb A, #6                                      ; Needs to receive it 6 times in
                                a row
0012AE 400A           34780             jc      dont_clear_dshot_cmd
                      34781     
0012B0 1100       F   34782             call erase_and_store_all_in_eeprom
0012B2 D2AF           34783             setb    IE_EA
                      34784             
0012B4                34785     clear_dshot_cmd:
0012B4 750000     F   34786             mov     Dshot_Cmd, #0
0012B7 750000     F   34787             mov     Dshot_Cmd_Cnt, #0
                      34788     
0012BA                34789     dont_clear_dshot_cmd:
0012BA 750000     F   34790             mov     Flash_Key_1, #0                 ; Initialize flash keys to invalid values
0012BD 750000     F   34791             mov     Flash_Key_2, #0
0012C0 0100       F   34792             jmp     wait_for_power_on_not_missing
                      34793     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   561

                      34794     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      34795     ;
                      34796     ; Start entry point
                      34797     ;
                      34798     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0012C2                34799     init_start:
0012C2 C2AF           34800             clr     IE_EA
0012C4 120000     F   34801             call switch_power_off
0012C7 E4             34802             clr     A
0012C8 D2AF           34803             setb    IE_EA
0012CA E4             34804             clr     A
0012CB F500       F   34805             mov     Adc_Conversion_Cnt, A
0012CD F500       F   34806             mov     Flags0, A                               ; Clear flags0
0012CF F500       F   34807             mov     Flags1, A                               ; Clear flags1
0012D1 F500       F   34808             mov     Demag_Detected_Metric, A        ; Clear demag metric
                      34809             ;**** **** **** **** ****
                      34810             ; Motor start beginning
                      34811             ;**** **** **** **** **** 
0012D3 750008     F   34812             mov     Adc_Conversion_Cnt, #8                          ; Make sure a temp readi
                               ng is done
0012D6 120000     F   34813             call wait1ms
0012D9 120000     F   34814             call start_adc_conversion
0012DC                34815     read_initial_temp:
0012DC 30EDFD         34816             jnb     ADC0CN0_ADINT, read_initial_temp
                      34817+1           Read_Adc_Result                                         ; Read initial temperatu
                               re
0012E3 E9             34820             mov     A, Temp2
0012E4 7001           34821             jnz     ($+3)                                                   ; Is reading bel
                               ow 256?
                      34822     
0012E6 F8             34823             mov     Temp1, A                                                        ; Yes - 
                               set average temperature value to zero
                      34824     
0012E7 8800       F   34825             mov     Current_Average_Temp, Temp1                     ; Set initial average te
                               mperature
0012E9 120000     F   34826             call check_temp_voltage_and_limit_power
0012EC 750008     F   34827             mov     Adc_Conversion_Cnt, #8                          ; Make sure a temp readi
                               ng is done next time
                      34828             ; Set up start operating conditions
0012EF C2AF           34829             clr     IE_EA                           ; Disable interrupts
0012F1 120000     F   34830             call set_startup_pwm
0012F4 850000     F   34831             mov     Pwm_Limit, Pwm_Limit_Beg
0012F7 850000     F   34832             mov     Pwm_Limit_By_Rpm, Pwm_Limit_Beg
0012FA D2AF           34833             setb    IE_EA
                      34834             ; Begin startup sequence
                      34835     IF 1 == 1
                      34836+1           Set_MCU_Clk_48MHz
                      34842     ENDIF
00130B 300007         34843             jnb     Flags3.PGM_BIDIR, init_start_bidir_done ; Check if bidirectional operati
                               on
                      34844     
00130E C200       F   34845             clr     Flags3.PGM_DIR_REV                      ; Set spinning direction. Defaul
                               t fwd
001310 300002         34846             jnb     Flags2.RCP_DIR_REV, ($+5)       ; Check force direction
001313 D200       F   34847             setb    Flags3.PGM_DIR_REV                      ; Set spinning direction
                      34848     
001315                34849     init_start_bidir_done:
001315 D200       F   34850             setb    Flags1.STARTUP_PHASE            ; Set startup phase flag
001317 750000     F   34851             mov     Startup_Cnt, #0                 ; Reset counter
00131A 120000     F   34852             call comm5comm6                         ; Initialize commutation
00131D 120000     F   34853             call comm6comm1                         
001320 120000     F   34854             call initialize_timing                  ; Initialize timing
001323 120000     F   34855             call    calc_next_comm_timing           ; Set virtual commutation point
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   562

001326 120000     F   34856             call initialize_timing                  ; Initialize timing
001329 120000     F   34857             call    calc_next_comm_timing           
00132C 120000     F   34858             call    initialize_timing                       ; Initialize timing
                      34859     
                      34860     
                      34861     
                      34862     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      34863     ;
                      34864     ; Run entry point
                      34865     ;
                      34866     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      34867     
                      34868     ; Run 1 = B(p-on) + C(n-pwm) - comparator A evaluated
                      34869     ; Out_cA changes from low to high
00132F                34870     run1:
00132F 120000     F   34871             call wait_for_comp_out_high     ; Wait for high
                      34872     ;               setup_comm_wait         ; Setup wait time from zero cross to commutation
                      34873     ;               evaluate_comparator_integrity   ; Check whether comparator reading has b
                               een normal
001332 120000     F   34874             call wait_for_comm                      ; Wait from zero cross to commutation
001335 120000     F   34875             call comm1comm2                 ; Commutate
001338 120000     F   34876             call calc_next_comm_timing      ; Calculate next timing and wait advance timing 
                               wait
                      34877     ;               wait_advance_timing             ; Wait advance timing and start zero cro
                               ss wait
                      34878     ;               calc_new_wait_times
                      34879     ;               wait_before_zc_scan             ; Wait zero cross wait and start zero cr
                               oss timeout
                      34880     
                      34881     ; Run 2 = A(p-on) + C(n-pwm) - comparator B evaluated
                      34882     ; Out_cB changes from high to low
00133B                34883     run2:
00133B 120000     F   34884             call wait_for_comp_out_low
                      34885     ;               setup_comm_wait
                      34886     ;               evaluate_comparator_integrity
00133E 200003         34887             jb      Flags1.HIGH_RPM, ($+6)  ; Skip if high rpm
001341 120000     F   34888             lcall set_pwm_limit_low_rpm
001344 300003         34889             jnb     Flags1.HIGH_RPM, ($+6)  ; Do if high rpm
001347 120000     F   34890             lcall set_pwm_limit_high_rpm
00134A 120000     F   34891             call wait_for_comm
00134D 120000     F   34892             call comm2comm3
001350 120000     F   34893             call calc_next_comm_timing
                      34894     ;               wait_advance_timing
                      34895     ;               calc_new_wait_times
                      34896     ;               wait_before_zc_scan
                      34897     
                      34898     ; Run 3 = A(p-on) + B(n-pwm) - comparator C evaluated
                      34899     ; Out_cC changes from low to high
001353                34900     run3:
001353 120000     F   34901             call wait_for_comp_out_high
                      34902     ;               setup_comm_wait
                      34903     ;               evaluate_comparator_integrity
001356 120000     F   34904             call wait_for_comm
001359 120000     F   34905             call comm3comm4
00135C 120000     F   34906             call calc_next_comm_timing
                      34907     ;               wait_advance_timing
                      34908     ;               calc_new_wait_times
                      34909     ;               wait_before_zc_scan
                      34910     
                      34911     ; Run 4 = C(p-on) + B(n-pwm) - comparator A evaluated
                      34912     ; Out_cA changes from high to low
00135F                34913     run4:
00135F 120000     F   34914             call wait_for_comp_out_low
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   563

                      34915     ;               setup_comm_wait
                      34916     ;               evaluate_comparator_integrity
001362 120000     F   34917             call wait_for_comm
001365 120000     F   34918             call comm4comm5
001368 120000     F   34919             call calc_next_comm_timing
                      34920     ;               wait_advance_timing
                      34921     ;               calc_new_wait_times
                      34922     ;               wait_before_zc_scan
                      34923     
                      34924     ; Run 5 = C(p-on) + A(n-pwm) - comparator B evaluated
                      34925     ; Out_cB changes from low to high
00136B                34926     run5:
00136B 120000     F   34927             call wait_for_comp_out_high
                      34928     ;               setup_comm_wait
                      34929     ;               evaluate_comparator_integrity
00136E 120000     F   34930             call wait_for_comm
001371 120000     F   34931             call comm5comm6
001374 120000     F   34932             call calc_next_comm_timing
                      34933     ;               wait_advance_timing
                      34934     ;               calc_new_wait_times
                      34935     ;               wait_before_zc_scan
                      34936     
                      34937     ; Run 6 = B(p-on) + A(n-pwm) - comparator C evaluated
                      34938     ; Out_cC changes from high to low
001377                34939     run6:
001377 120000     F   34940             call start_adc_conversion
00137A 120000     F   34941             call wait_for_comp_out_low
                      34942     ;               setup_comm_wait
                      34943     ;               evaluate_comparator_integrity
00137D 120000     F   34944             call wait_for_comm
001380 120000     F   34945             call comm6comm1
001383 120000     F   34946             call check_temp_voltage_and_limit_power
001386 120000     F   34947             call calc_next_comm_timing
                      34948     ;               wait_advance_timing
                      34949     ;               calc_new_wait_times
                      34950     ;               wait_before_zc_scan
                      34951     
                      34952             ; Check if it is direct startup
001389 300027         34953             jnb     Flags1.STARTUP_PHASE, normal_run_checks
                      34954     
                      34955             ; Set spoolup power variables
00138C 850000     F   34956             mov     Pwm_Limit, Pwm_Limit_Beg                ; Set initial max power
                      34957             ; Check startup counter
00138F 7918           34958             mov     Temp2, #24                              ; Set nominal startup parameters
001391 7A0C           34959             mov     Temp3, #12
001393 C3             34960             clr     C
001394 E500       F   34961             mov     A, Startup_Cnt                          ; Load counter
001396 99             34962             subb    A, Temp2                                        ; Is counter above requi
                               rement?
001397 400E           34963             jc      direct_start_check_rcp          ; No - proceed
                      34964     
001399 C200       F   34965             clr     Flags1.STARTUP_PHASE            ; Clear startup phase flag
00139B D200       F   34966             setb    Flags1.INITIAL_RUN_PHASE                ; Set initial run phase flag
00139D 8A00       F   34967             mov     Initial_Run_Rot_Cntd, Temp3     ; Set initial run rotation count
00139F 850000     F   34968             mov     Pwm_Limit, Pwm_Limit_Beg
0013A2 850000     F   34969             mov     Pwm_Limit_By_Rpm, Pwm_Limit_Beg
0013A5 800C           34970             jmp     normal_run_checks
                      34971     
0013A7                34972     direct_start_check_rcp:
0013A7 C3             34973             clr     C
0013A8 E500       F   34974             mov     A, New_Rcp                              ; Load new pulse value
0013AA 9401           34975             subb    A, #1                                   ; Check if pulse is below stop v
                               alue
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   564

0013AC 4003           34976             jc      ($+5)
                      34977     
0013AE 020000     F   34978             ljmp    run1                                            ; Continue to run 
                      34979     
0013B1 0100       F   34980             jmp     run_to_wait_for_power_on
                      34981     
                      34982     
0013B3                34983     normal_run_checks:
                      34984             ; Check if it is initial run phase
0013B3 30001F         34985             jnb     Flags1.INITIAL_RUN_PHASE, initial_run_phase_done        ; If not initial
                                run phase - branch
0013B6 20001C         34986             jb      Flags1.DIR_CHANGE_BRAKE, initial_run_phase_done ; If a direction change 
                               - branch
                      34987     
                      34988             ; Decrement startup rotaton count
0013B9 E500       F   34989             mov     A, Initial_Run_Rot_Cntd
0013BB 14             34990             dec     A
                      34991             ; Check number of initial rotations
0013BC 7006           34992             jnz     initial_run_check_startup_rot   ; Branch if counter is not zero
                      34993     
0013BE C200       F   34994             clr     Flags1.INITIAL_RUN_PHASE                ; Clear initial run phase flag
0013C0 D200       F   34995             setb    Flags1.MOTOR_STARTED            ; Set motor started
0013C2 0100       F   34996             jmp run1                                                ; Continue with normal r
                               un
                      34997     
0013C4                34998     initial_run_check_startup_rot:
0013C4 F500       F   34999             mov     Initial_Run_Rot_Cntd, A         ; Not zero - store counter
                      35000     
0013C6 200007         35001             jb      Flags3.PGM_BIDIR, initial_run_continue_run      ; Check if bidirectional
                                operation
                      35002     
0013C9 C3             35003             clr     C
0013CA E500       F   35004             mov     A, New_Rcp                              ; Load new pulse value
0013CC 9401           35005             subb    A, #1                                   ; Check if pulse is below stop v
                               alue
0013CE 4003           35006             jc      ($+5)
                      35007     
0013D0                35008     initial_run_continue_run:
0013D0 020000     F   35009             ljmp    run1                                            ; Continue to run 
                      35010     
0013D3 8064           35011             jmp     run_to_wait_for_power_on
                      35012     
0013D5                35013     initial_run_phase_done:
                      35014             ; Reset stall count
0013D5 750000     F   35015             mov     Stall_Cnt, #0
                      35016             ; Exit run loop after a given time
0013D8 20000F         35017             jb      Flags3.PGM_BIDIR, run6_check_timeout    ; Check if bidirectional operati
                               on
                      35018     
0013DB 78FA           35019             mov     Temp1, #250
0013DD 7900       F   35020             mov     Temp2, #Pgm_Brake_On_Stop
0013DF E7             35021             mov     A, @Temp2
0013E0 6002           35022             jz      ($+4)
                      35023     
0013E2 7803           35024             mov     Temp1, #3                                       ; About 100ms before sto
                               pping when brake is set
                      35025     
0013E4 C3             35026             clr     C
0013E5 E500       F   35027             mov     A, Rcp_Stop_Cnt                 ; Load stop RC pulse counter low byte va
                               lue
0013E7 98             35028             subb    A, Temp1                                        ; Is number of stop RC p
                               ulses above limit?
0013E8 504F           35029             jnc     run_to_wait_for_power_on                ; Yes, go back to wait for power
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   565

                               on
                      35030     
0013EA                35031     run6_check_timeout:
0013EA E500       F   35032             mov     A, Rcp_Timeout_Cntd                     ; Load RC pulse timeout counter 
                               value
0013EC 604B           35033             jz      run_to_wait_for_power_on                ; If it is zero - go back to wai
                               t for poweron
                      35034     
0013EE                35035     run6_check_dir:
0013EE 300017         35036             jnb     Flags3.PGM_BIDIR, run6_check_speed              ; Check if bidirectional
                                operation
                      35037     
0013F1 200005         35038             jb      Flags3.PGM_DIR_REV, run6_check_dir_rev          ; Check if actual rotati
                               on direction
0013F4 200007         35039             jb      Flags2.RCP_DIR_REV, run6_check_dir_change       ; Matches force direction
0013F7 800F           35040             jmp     run6_check_speed
                      35041     
0013F9                35042     run6_check_dir_rev:
0013F9 300002         35043             jnb     Flags2.RCP_DIR_REV, run6_check_dir_change
0013FC 800A           35044             jmp     run6_check_speed
                      35045     
0013FE                35046     run6_check_dir_change:
0013FE 200007         35047             jb      Flags1.DIR_CHANGE_BRAKE, run6_check_speed
                      35048     
001401 D200       F   35049             setb    Flags1.DIR_CHANGE_BRAKE         ; Set brake flag
001403 850000     F   35050             mov     Pwm_Limit, Pwm_Limit_Beg                ; Set max power while braking
001406 0100       F   35051             jmp     run4                                            ; Go back to run 4, ther
                               eby changing force direction
                      35052     
001408                35053     run6_check_speed:
001408 78F0           35054             mov     Temp1, #0F0h                            ; Default minimum speed
00140A 300005         35055             jnb     Flags1.DIR_CHANGE_BRAKE, run6_brake_done; Is it a direction change?
                      35056     
00140D 850000     F   35057             mov     Pwm_Limit, Pwm_Limit_Beg        ; Set max power while braking
001410 7820           35058             mov     Temp1, #20h                             ; Bidirectional braking terminat
                               ion speed
                      35059     
001412                35060     run6_brake_done:
001412 C3             35061             clr     C
001413 E500       F   35062             mov     A, Comm_Period4x_H                      ; Is Comm_Period4x more than 32m
                               s (~1220 eRPM)?
001415 98             35063             subb    A, Temp1
001416 5003           35064             jnc     ($+5)                                   ; Yes - stop or turn direction 
001418 020000     F   35065             ljmp    run1                                            ; No - go back to run 1
                      35066     
00141B 30001B         35067             jnb     Flags1.DIR_CHANGE_BRAKE, run_to_wait_for_power_on       ; If it is not a
                                direction change - stop
                      35068     
00141E C200       F   35069             clr     Flags1.DIR_CHANGE_BRAKE         ; Clear brake flag
001420 C200       F   35070             clr     Flags3.PGM_DIR_REV                      ; Set spinning direction. Defaul
                               t fwd
001422 300002         35071             jnb     Flags2.RCP_DIR_REV, ($+5)       ; Check force direction
001425 D200       F   35072             setb    Flags3.PGM_DIR_REV                      ; Set spinning direction
001427 D200       F   35073             setb    Flags1.INITIAL_RUN_PHASE
001429 750012     F   35074             mov     Initial_Run_Rot_Cntd, #18
00142C 850000     F   35075             mov     Pwm_Limit, Pwm_Limit_Beg                ; Set initial max power
00142F 0100       F   35076             jmp     run1                                            ; Go back to run 1 
                      35077     
001431                35078     run_to_wait_for_power_on_fail:  
001431 0500       F   35079             inc     Stall_Cnt                                       ; Increment stall count
001433 E500       F   35080             mov     A, New_Rcp                              ; Check if RCP is zero, then it 
                               is a normal stop                        
001435 6002           35081             jz      run_to_wait_for_power_on
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   566

001437 0100       F   35082             ajmp    run_to_wait_for_power_on_stall_done
                      35083     
001439                35084     run_to_wait_for_power_on:       
001439 750000     F   35085             mov     Stall_Cnt, #0
                      35086     
00143C                35087     run_to_wait_for_power_on_stall_done:
00143C C2AF           35088             clr     IE_EA
00143E 120000     F   35089             call switch_power_off
001441 750000     F   35090             mov     Flags0, #0                              ; Clear flags0
001444 750000     F   35091             mov     Flags1, #0                              ; Clear flags1
                      35092     IF 1 == 1
                      35093+1           Set_MCU_Clk_24MHz
                      35099     ENDIF
001456 D2AF           35100             setb    IE_EA
001458 120000     F   35101             call    wait100ms                                       ; Wait for pwm to be sto
                               pped
00145B 120000     F   35102             call switch_power_off
00145E 7800       F   35103             mov     Temp1, #Pgm_Brake_On_Stop
001460 E6             35104             mov     A, @Temp1
001461 600F           35105             jz      run_to_wait_for_power_on_brake_done
                      35106     
                      35107+1           AcomFET_on
                      35110+1           BcomFET_on
                      35113+1           CcomFET_on
                      35116     
001472                35117     run_to_wait_for_power_on_brake_done:
001472 C3             35118             clr     C
001473 E500       F   35119             mov     A, Stall_Cnt
001475 9404           35120             subb    A, #4
001477 4003           35121             jc      jmp_wait_for_power_on
001479 020000     F   35122             jmp     init_no_signal
                      35123     
00147C                35124     jmp_wait_for_power_on:
00147C 0100       F   35125             jmp     wait_for_power_on                       ; Go back to wait for power on
                      35126     
                      35127     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      35128     
                      35129     ;$include (BLHeliPgm.inc) ; Include source code for programming the ESC
                    +135130     ;**** **** **** **** ****
                    +135131     ;
                    +135132     ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +135133     ;
                    +135134     ; Copyright 2011, 2012 Steffen Skaug
                    +135135     ; This program is distributed under the terms of the GNU General Public License
                    +135136     ;
                    +135137     ; This file is part of BLHeli.
                    +135138     ;
                    +135139     ; BLHeli is free software: you can redistribute it and/or modify
                    +135140     ; it under the terms of the GNU General Public License as published by
                    +135141     ; the Free Software Foundation, either version 3 of the License, or
                    +135142     ; (at your option) any later version.
                    +135143     ;
                    +135144     ; BLHeli is distributed in the hope that it will be useful,
                    +135145     ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +135146     ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +135147     ; GNU General Public License for more details.
                    +135148     ;
                    +135149     ; You should have received a copy of the GNU General Public License
                    +135150     ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +135151     ;
                    +135152     ;**** **** **** **** ****
                    +135153     ;
                    +135154     ; BLHeliTxPgm SiLabs                                      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   567

                    +135155     ;                                                         
                    +135156     ; EEPROM is not available in SiLabs MCUs                  
                    +135157     ; Therefore a segment of the flash is used as "EEPROM"    
                    +135158     ;                                                         
                    +135159     ;**** **** **** **** ****
                    +135160     
                    +135161     
                    +135162     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                    +135163     ;
                    +135164     ; Read all eeprom parameters routine
                    +135165     ;
                    +135166     ; No assumptions
                    +135167     ;
                    +135168     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
00147E              +135169     read_all_eeprom_parameters:     
                    +135170             ; Check initialized signature
00147E 900000     F +135171             mov     DPTR, #Eep_Initialized_L
001481 7800       F +135172             mov     Temp1, #Bit_Access
001483 1100       F +135173             call read_eeprom_byte
001485 E500       F +135174             mov     A, Bit_Access
001487 B4550A       +135175             cjne    A, #055h, read_eeprom_store_defaults
00148A A3           +135176             inc     DPTR                            ; Now Eep_Initialized_H
00148B 1100       F +135177             call read_eeprom_byte
00148D E500       F +135178             mov     A, Bit_Access
00148F B4AA02       +135179             cjne    A, #0AAh, read_eeprom_store_defaults
001492 8013         +135180             jmp     read_eeprom_read
                    +135181     
                    +135182     
001494              +135183     read_eeprom_store_defaults:
001494 7500A5     F +135184             mov     Flash_Key_1, #0A5h
001497 7500F1     F +135185             mov     Flash_Key_2, #0F1h
00149A 120000     F +135186             call set_default_parameters     
00149D 1100       F +135187             call erase_and_store_all_in_eeprom      
00149F 750000     F +135188             mov     Flash_Key_1, #0
0014A2 750000     F +135189             mov     Flash_Key_2, #0
0014A5 801D         +135190             jmp     read_eeprom_exit
                    +135191     
0014A7              +135192     read_eeprom_read:
                    +135193             ; Read eeprom
0014A7 900000     F +135194             mov     DPTR, #_Eep_Pgm_Gov_P_Gain
0014AA 7800       F +135195             mov     Temp1, #_Pgm_Gov_P_Gain 
0014AC 7B0A         +135196             mov     Temp4, #10
0014AE              +135197     read_eeprom_block1:
0014AE 1100       F +135198             call read_eeprom_byte
0014B0 A3           +135199             inc     DPTR                            
0014B1 08           +135200             inc     Temp1                   
0014B2 DBFA         +135201             djnz    Temp4, read_eeprom_block1
                    +135202     
0014B4 900000     F +135203             mov     DPTR, #Eep_Enable_TX_Program
0014B7 7800       F +135204             mov     Temp1, #Pgm_Enable_TX_Program   
0014B9 7B1A         +135205             mov     Temp4, #26      ; 26 parameters
0014BB              +135206     read_eeprom_block2:
0014BB 1100       F +135207             call read_eeprom_byte
0014BD A3           +135208             inc     DPTR                            
0014BE 08           +135209             inc     Temp1           
0014BF DBFA         +135210             djnz    Temp4, read_eeprom_block2
                    +135211     
0014C1 900000     F +135212             mov     DPTR, #Eep_Dummy                        ; Set pointer to uncritical area
                    +135213     
0014C4              +135214     read_eeprom_exit:
0014C4 22           +135215             ret
                    +135216     
                    +135217     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   568

                    +135218     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                    +135219     ;
                    +135220     ; Erase flash and store all parameter value in EEPROM routine
                    +135221     ;
                    +135222     ; No assumptions
                    +135223     ;
                    +135224     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0014C5              +135225     erase_and_store_all_in_eeprom:
0014C5 C2AF         +135226             clr     IE_EA                                   ; Disable interrupts
0014C7 1100       F +135227             call    read_tags
0014C9 1100       F +135228             call    erase_flash                             ; Erase flash
                    +135229     
0014CB 900000     F +135230             mov     DPTR, #Eep_FW_Main_Revision     ; Store firmware main revision
0014CE 7410         +135231             mov     A, #EEPROM_FW_MAIN_REVISION
0014D0 1100       F +135232             call write_eeprom_byte_from_acc
                    +135233     
0014D2 A3           +135234             inc     DPTR                                            ; Now firmware sub revis
                               ion
0014D3 744D         +135235             mov     A, #EEPROM_FW_SUB_REVISION
0014D5 1100       F +135236             call write_eeprom_byte_from_acc
                    +135237     
0014D7 A3           +135238             inc     DPTR                                            ; Now layout revision
0014D8 7421         +135239             mov     A, #EEPROM_LAYOUT_REVISION
0014DA 1100       F +135240             call write_eeprom_byte_from_acc
                    +135241     
                    +135242             ; Write eeprom
0014DC 900000     F +135243             mov     DPTR, #_Eep_Pgm_Gov_P_Gain
0014DF 7800       F +135244             mov     Temp1, #_Pgm_Gov_P_Gain
0014E1 7B0A         +135245             mov     Temp4, #10
0014E3              +135246     write_eeprom_block1:
0014E3 1100       F +135247             call write_eeprom_byte
0014E5 A3           +135248             inc     DPTR                                            
0014E6 08           +135249             inc     Temp1                                   
0014E7 DBFA         +135250             djnz    Temp4, write_eeprom_block1
                    +135251     
0014E9 900000     F +135252             mov     DPTR, #Eep_Enable_TX_Program
0014EC 7800       F +135253             mov     Temp1, #Pgm_Enable_TX_Program   
0014EE 7B1A         +135254             mov     Temp4, #26      ; 26 parameters
0014F0              +135255     write_eeprom_block2:
0014F0 1100       F +135256             call write_eeprom_byte
0014F2 A3           +135257             inc     DPTR                                            
0014F3 08           +135258             inc     Temp1                                   
0014F4 DBFA         +135259             djnz    Temp4, write_eeprom_block2
                    +135260     
0014F6 1100       F +135261             call    write_tags
0014F8 1100       F +135262             call write_eeprom_signature
0014FA 900000     F +135263             mov     DPTR, #Eep_Dummy                        ; Set pointer to uncritical area
0014FD 22           +135264             ret     
                    +135265     
                    +135266     
                    +135267     
                    +135268     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                    +135269     ;
                    +135270     ; Read eeprom byte routine
                    +135271     ;
                    +135272     ; Gives data in A and in address given by Temp1. Assumes address in DPTR 
                    +135273     ; Also assumes address high byte to be zero
                    +135274     ;
                    +135275     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0014FE              +135276     read_eeprom_byte:
0014FE E4           +135277             clr     A
0014FF 93           +135278             movc    A, @A+DPTR                      ; Read from flash
001500 F6           +135279             mov     @Temp1, A
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   569

001501 22           +135280             ret
                    +135281     
                    +135282     
                    +135283     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                    +135284     ;
                    +135285     ; Write eeprom byte routine
                    +135286     ;
                    +135287     ; Assumes data in address given by Temp1, or in accumulator. Assumes address in DPTR 
                    +135288     ; Also assumes address high byte to be zero
                    +135289     ;
                    +135290     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
001502              +135291     write_eeprom_byte:
001502 E6           +135292             mov     A, @Temp1
001503              +135293     write_eeprom_byte_from_acc:
001503 438F01       +135294             orl     PSCTL, #01h                     ; Set the PSWE bit
001506 538FFD       +135295             anl     PSCTL, #0FDh                    ; Clear the PSEE bit
001509 FF           +135296             mov     Temp8, A
00150A C3           +135297             clr     C
00150B E583         +135298             mov     A, DPH                          ; Check that address is not in bootloade
                               r area
00150D 941C         +135299             subb    A, #1Ch
00150F 4001         +135300             jc      ($+3)
                    +135301     
001511 22           +135302             ret
                    +135303     
001512 EF           +135304             mov     A, Temp8
001513 8500B7     F +135305             mov     FLKEY, Flash_Key_1              ; First key code
001516 8500B7     F +135306             mov     FLKEY, Flash_Key_2              ; Second key code
001519 F0           +135307             movx    @DPTR, A                                ; Write to flash
00151A 538FFE       +135308             anl     PSCTL, #0FEh                    ; Clear the PSWE bit
00151D 22           +135309             ret
                    +135310     
                    +135311     
                    +135312     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                    +135313     ;
                    +135314     ; Erase flash routine (erases the flash segment used for "eeprom" variables)
                    +135315     ;
                    +135316     ; No assumptions
                    +135317     ;
                    +135318     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
00151E              +135319     erase_flash:    
00151E 438F02       +135320             orl     PSCTL, #02h                     ; Set the PSEE bit
001521 438F01       +135321             orl     PSCTL, #01h                     ; Set the PSWE bit
001524 8500B7     F +135322             mov     FLKEY, Flash_Key_1              ; First key code
001527 8500B7     F +135323             mov     FLKEY, Flash_Key_2              ; Second key code
00152A 900000     F +135324             mov     DPTR, #Eep_Initialized_L        
00152D F0           +135325             movx    @DPTR, A
00152E 538FFC       +135326             anl     PSCTL, #0FCh                    ; Clear the PSEE and PSWE bits
001531 22           +135327             ret
                    +135328     
                    +135329     
                    +135330     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                    +135331     ;
                    +135332     ; Write eeprom signature routine
                    +135333     ;
                    +135334     ; No assumptions
                    +135335     ;
                    +135336     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
001532              +135337     write_eeprom_signature: 
001532 900000     F +135338             mov     DPTR, #Eep_Initialized_L
001535 7455         +135339             mov     A, #055h
001537 1100       F +135340             call write_eeprom_byte_from_acc
                    +135341     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   570

001539 900000     F +135342             mov     DPTR, #Eep_Initialized_H
00153C 74AA         +135343             mov     A, #0AAh
00153E 1100       F +135344             call write_eeprom_byte_from_acc
001540 22           +135345             ret
                    +135346     
                    +135347     
                    +135348     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                    +135349     ;
                    +135350     ; Read all tags from flash and store in temporary storage
                    +135351     ;
                    +135352     ; No assumptions
                    +135353     ;
                    +135354     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
001541              +135355     read_tags:
001541 7A30         +135356             mov     Temp3, #48                              ; Number of tags
001543 7900       F +135357             mov     Temp2, #Temp_Storage            ; Set RAM address
001545 7800       F +135358             mov     Temp1, #Bit_Access
001547 900000     F +135359             mov     DPTR, #Eep_ESC_Layout           ; Set flash address
00154A              +135360     read_tag:       
00154A 1100       F +135361             call read_eeprom_byte
00154C E500       F +135362             mov     A, Bit_Access
00154E F7           +135363             mov     @Temp2, A                       ; Write to RAM
00154F 09           +135364             inc     Temp2
001550 A3           +135365             inc     DPTR
001551 DAF7         +135366             djnz Temp3, read_tag    
001553 22           +135367             ret
                    +135368     
                    +135369     
                    +135370     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                    +135371     ;
                    +135372     ; Write all tags from temporary storage and store in flash
                    +135373     ;
                    +135374     ; No assumptions
                    +135375     ;
                    +135376     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
001554              +135377     write_tags:
001554 7A30         +135378             mov     Temp3, #48                              ; Number of tags
001556 7900       F +135379             mov     Temp2, #Temp_Storage            ; Set RAM address
001558 900000     F +135380             mov     DPTR, #Eep_ESC_Layout           ; Set flash address
00155B              +135381     write_tag:      
00155B E7           +135382             mov     A, @Temp2                       ; Read from RAM
00155C 1100       F +135383             call write_eeprom_byte_from_acc
00155E 09           +135384             inc     Temp2
00155F A3           +135385             inc     DPTR
001560 DAF9         +135386             djnz Temp3, write_tag   
001562 22           +135387             ret
                    +135388     
                    +135389     
                    +135390     ;**;**** **** **** **** **** **** **** **** **** **** **** **** ****
                    +135391     ;
                    +135392     ; Wait 1 second routine
                    +135393     ;
                    +135394     ; No assumptions
                    +135395     ;
                    +135396     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
001563              +135397     wait1s:
001563 7C05         +135398             mov     Temp5, #5
001565              +135399     wait1s_loop:
001565 120000     F +135400             call wait200ms
001568 DCFB         +135401             djnz    Temp5, wait1s_loop
00156A 22           +135402             ret
                    +135403     
                    +135404     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   571

                    +135405     ;**;**** **** **** **** **** **** **** **** **** **** **** **** ****
                    +135406     ;
                    +135407     ; Success beep routine
                    +135408     ;
                    +135409     ; No assumptions
                    +135410     ;
                    +135411     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
00156B              +135412     success_beep:
00156B C2AF         +135413             clr     IE_EA                           ; Disable all interrupts
00156D 120000     F +135414             call beep_f1
001570 120000     F +135415             call beep_f2
001573 120000     F +135416             call beep_f3
001576 120000     F +135417             call beep_f4
001579 120000     F +135418             call wait10ms
00157C 120000     F +135419             call beep_f1
00157F 120000     F +135420             call beep_f2
001582 120000     F +135421             call beep_f3
001585 120000     F +135422             call beep_f4
001588 120000     F +135423             call wait10ms
00158B 120000     F +135424             call beep_f1
00158E 120000     F +135425             call beep_f2
001591 120000     F +135426             call beep_f3
001594 120000     F +135427             call beep_f4
001597 D2AF         +135428             setb    IE_EA                           ; Enable all interrupts
001599 22           +135429             ret
                    +135430     
                    +135431     
                    +135432     ;**;**** **** **** **** **** **** **** **** **** **** **** **** ****
                    +135433     ;
                    +135434     ; Success beep inverted routine
                    +135435     ;
                    +135436     ; No assumptions
                    +135437     ;
                    +135438     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
00159A              +135439     success_beep_inverted:
00159A C2AF         +135440             clr     IE_EA                           ; Disable all interrupts
00159C 120000     F +135441             call beep_f4
00159F 120000     F +135442             call beep_f3
0015A2 120000     F +135443             call beep_f2
0015A5 120000     F +135444             call beep_f1
0015A8 120000     F +135445             call wait10ms
0015AB 120000     F +135446             call beep_f4
0015AE 120000     F +135447             call beep_f3
0015B1 120000     F +135448             call beep_f2
0015B4 120000     F +135449             call beep_f1
0015B7 120000     F +135450             call wait10ms
0015BA 120000     F +135451             call beep_f4
0015BD 120000     F +135452             call beep_f3
0015C0 120000     F +135453             call beep_f2
0015C3 120000     F +135454             call beep_f1
0015C6 D2AF         +135455             setb    IE_EA                           ; Enable all interrupts
0015C8 22           +135456             ret
                    +135457     
                    +135458     
                      35459     ;$include (BLHeliBootLoad.inc) ; Include source code for bootloader
                    +135460     ; BLHeli bootloader for SiLabs MCUs. Based upon AVRootloader (copyright HR)
                    +135461     
 017D7840           +135462     XTAL                                    EQU     25000000        
                    +135463     
 1C00               +135464     BOOT_START                      EQU     1C00h   ; Bootloader segment address
 005F5E10           +135465     BOOT_DELAY                      EQU     XTAL/4  ; About 250ms (don't set to fast to avoi
                               d connection problems)
 4B00               +135466     BOOT_BAUDRATE                   EQU     19200   ; Only used if no baudrate detection act
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   572

                               ivated, XTAL is than important
 0006               +135467     BOOT_VERSION                    EQU     6               ; Version 6 (must be not changed)
 0001               +135468     BOOT_PAGES                      EQU     1               ; Number of flash segments for b
                               ootloader
                    +135469     
 001A               +135470     UART_LOOP                               EQU     26              ; Depends upon timing of
                                putc, getc 
 0198               +135471     BAUDTIME                                EQU     ((XTAL/BOOT_BAUDRATE)/3)-UART_LOOP
                    +135472     
 0030               +135473     SUCCESS                         EQU     030h
 00C0               +135474     ERRORVERIFY                     EQU     0C0h
 00C1               +135475     ERRORCOMMAND                    EQU     0C1h
 00C2               +135476     ERRORCRC                                EQU     0C2h
 00C5               +135477     ERRORPROG                               EQU     0C5h
                    +135478     
 A001               +135479     POLYNOM                         EQU     0A001h          ; CRC Polynom
                    +135480     
  REG               +135481     Xl                                      EQU     R0                      ; Temporary X
  REG               +135482     Xh                                      EQU     R1
  REG               +135483     Paral                           EQU     R2                      ; Params for UART
  REG               +135484     Parah                           EQU     R3      
  REG               +135485     Cmdl                                    EQU     R4                      ; Commands
  REG               +135486     Cmdh                                    EQU     R5      
  REG               +135487     Cntl                                    EQU     R6                      ; Baudtime
  REG               +135488     Cnth                                    EQU     R7
                    +135489     
000020              +135490     DSEG AT 20h                                     
000020              +135491     Bit_Reg:                                DS      1                       ; Bit storage re
                               gister
000021              +135492     Byte_Reg:                               DS      1                       ; Byte storage r
                               egister
000022              +135493     Crcl:                           DS      1                       ; CRC 16Bit
000023              +135494     Crch:                           DS      1
000024              +135495     Baudl:                          DS      1                       ; Baudtime
000025              +135496     Baudh:                          DS      1
000026              +135497     Bit_Cnt:                                DS      1                       ; Counter in UAR
                               T loops
000027              +135498     Byte_Cntl:                      DS      1                       ; Generic counter
000028              +135499     Byte_Cnth:                      DS      1                       
000029              +135500     BL_Flash_Key_1:         DS      1                       ; Flash keys
00002A              +135501     BL_Flash_Key_2:         DS      1
                    +135502     
001C00              +135503     CSEG AT BOOT_START              ; Bootloader start
001C00 C2AF         +135504     init:clr        IE_EA
                    +135505             ; Select register bank 0 for main program routines
001C02 C2D3         +135506             clr     PSW.3                           ; Select register bank 0 for main progra
                               m routines      
                    +135507             ; Disable the WDT.
001C04 7597DE       +135508             mov     WDTCN, #0DEh                    ; Disable watchdog
001C07 7597AD       +135509             mov     WDTCN, #0ADh            
                    +135510             ; Initialize stack
001C0A 7581C0       +135511             mov     SP, #0c0h                               ; Stack = 64 upper bytes of RAM
                    +135512             ; Initialize clock
001C0D 75A900       +135513             mov     CLKSEL, #00h                    ; Set clock divider to 1
                    +135514             ; Initialize VDD monitor
001C10 43FF80       +135515             orl     VDM0CN, #080h                   ; Enable the VDD monitor
001C13 750038     F +135516             mov     Baudl, #38h                     ; Wait 100us
001C16 750003     F +135517             mov     Baudh, #03h
001C19 1100       F +135518             acall waitf
                    +135519             ; Initialize flash keys
001C1B 7500A5     F +135520             mov     BL_Flash_Key_1, #0A5h   ; First key code
001C1E 7500F1     F +135521             mov     BL_Flash_Key_2, #0F1h   ; Second key code
                    +135522             ; Initialize ports
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   573

001C21 43F180       +135523             orl     RTX_MDIN, #(1 SHL RTX_PIN)              ; Set digital
001C24 53A47F       +135524             anl     RTX_MDOUT, #NOT(1 SHL RTX_PIN)  ; Disable pushpull
001C27 D287         +135525             setb    RTX_PORT.RTX_PIN                                ; Set data high
001C29 75D4FF       +135526             mov     RTX_SKIP, #0FFh
001C2C 75E340       +135527             mov     XBR2, #40h;                                     ; Enable crossbar
                    +135528             ; Set number of connect attempts before exiting bootloader
001C2F 7DFA         +135529             mov     Cmdh, #250
                    +135530     
                    +135531             ; Identifier scanning
001C31 7803         +135532     abd:    mov     Xl, #(low(BOOT_DELAY / 6)+1)
001C33 79E6         +135533             mov     Xh, #(high(BOOT_DELAY / 6)+1)
001C35 7C10         +135534             mov     Cmdl, #(high((BOOT_DELAY / 6) SHR 8)+1)
001C37 750000     F +135535             mov     Crcl, #0
001C3A 750000     F +135536             mov     Crch, #0
001C3D 900000     F +135537             mov     DPTR, #BOOT_SIGN
001C40 7B06         +135538             mov     Parah, #(BOOT_MSG - BOOT_SIGN)
001C42 750098     F +135539             mov     Baudl, #low(BAUDTIME)
001C45 750001     F +135540             mov     Baudh, #high(BAUDTIME)
                    +135541     
001C48              +135542     wait_for_low:
001C48 308702       +135543             jnb     RTX_PORT.RTX_PIN, ($+5)
001C4B 0100       F +135544             ajmp wait_for_low
                    +135545     
                    +135546             ; Identifier (BOOT_SIGN) scanning with timeout and checksum
001C4D 208708       +135547     id1:    jb      RTX_PORT.RTX_PIN, id3   ; Look for high
001C50 D8FB         +135548             djnz    Xl, id1                         ; Subtract 1 from X (BOOT_DELAY)
001C52 D9F9         +135549             djnz    Xh, id1
001C54 DCF7         +135550             djnz    Cmdl, id1 
                    +135551     
001C56 0100       F +135552             ajmp    exit
                    +135553     
001C58 308708       +135554     id3:    jnb     RTX_PORT.RTX_PIN, id4   ; Look for low
001C5B D8FB         +135555             djnz    Xl, id3                         ; Subtract 1 from X (BOOT_DELAY)
001C5D D9F9         +135556             djnz    Xh, id3
001C5F DCF7         +135557             djnz    Cmdl, id3
                    +135558     
001C61 0100       F +135559             ajmp    exit
                    +135560     
001C63 1100       F +135561     id4:    acall getx                              ; Read character
001C65 E4           +135562             clr     A                       
001C66 93           +135563             movc A, @A+DPTR                 ; Load BOOT_SIGN character
001C67 A3           +135564             inc     DPTR
001C68 C3           +135565             clr     C
001C69 9A           +135566             subb    A, Paral                                ; Compare with read character
001C6A 6004         +135567             jz      id5
001C6C DDC3         +135568             djnz    Cmdh, abd                               ; Retry if not last connect atte
                               mpt
001C6E 0100       F +135569             ajmp    exit
                    +135570     
001C70              +135571     id5:
001C70 DBDB         +135572             djnz    Parah, id1
                    +135573     
001C72 1100       F +135574             acall getw                              ; Read CRC
001C74 6002         +135575             jz      ($+4)                           ; Check CRC
001C76 0100       F +135576             ajmp    abd
                    +135577             
                    +135578             ; Send info about chip/bootloader (BOOT_MSG + BOOT_INFO)
001C78 7B08         +135579             mov     Parah, #((BOOT_INFO - BOOT_MSG) + 4)
001C7A E4           +135580     in1:    clr     A                       
001C7B 93           +135581             movc A, @A+DPTR                 ; Load character
001C7C FA           +135582             mov     Paral, A
001C7D A3           +135583             inc     DPTR
001C7E 1100       F +135584             acall putc
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   574

001C80 DBF8         +135585             djnz    Parah, in1
                    +135586     
                    +135587     
                    +135588             ; Main commandloop
                    +135589             ; 0=Run/restart 
                    +135590             ; 1=Program flash, 2=Erase flash, 3=Read flash
                    +135591             ; 0xFF=Set address, 0xFE=Set buffer, 0xFD=Keep alive 
001C82 7A30         +135592     main:mov        Paral, #SUCCESS
001C84 1100       F +135593     mai1:acall putc
001C86 750000     F +135594             mov     Crcl, #0                                ; Reset CRC
001C89 750000     F +135595             mov     Crch, #0
001C8C 1100       F +135596             acall getw                              ; Get command
001C8E EA           +135597             mov     A, Paral
001C8F FC           +135598             mov     Cmdl, A
001C90 EB           +135599             mov     A, Parah
001C91 FD           +135600             mov     Cmdh, A
001C92 C3           +135601             clr     C
001C93 ED           +135602             mov     A, Cmdh
001C94 94FE         +135603             subb    A, #0FEh
001C96 400E         +135604             jc      mai2                                    ; Jump if not set address or set
                                buffer 
                    +135605     
001C98 1100       F +135606             acall getw                              ; Address or number of bytes
001C9A 8A00       F +135607             mov     Byte_Cntl, Paral                ; Store number of bytes for set buffer
001C9C 8B00       F +135608             mov     Byte_Cnth, Parah        
001C9E ED           +135609             mov     A, Cmdh
001C9F 30E004       +135610             jnb     ACC.0, mai2                     ; Jump if set buffer
                    +135611     
001CA2 8A82         +135612             mov     DPL, Paral                      ; Store flash address (for set address)
001CA4 8B83         +135613             mov     DPH, Parah
                    +135614     
001CA6 1100       F +135615     mai2:acall getw                         ; Get CRC
001CA8 7AC2         +135616             mov     Paral, #ERRORCRC
001CAA 70D8         +135617             jnz     mai1
001CAC C3           +135618             clr     C
001CAD ED           +135619             mov     A, Cmdh
001CAE 94FE         +135620             subb    A, #0FEh
001CB0 6019         +135621             jz      setbuf                          ; If command is set buffer, receive data
001CB2 50CE         +135622             jnc     main
                    +135623     
001CB4 BD0029       +135624             cjne    Cmdh, #0, mai4                  ; Jump if command != 0 (and not set buff
                               er)
                    +135625     
                    +135626             ; Run application/restart bootloader
001CB7 EC           +135627             mov     A, Cmdl
001CB8 600F         +135628             jz      rst
001CBA 750000     F +135629     exit:mov        Bit_Access, #0                  ; Clear variable used by flash lock dete
                               ct
001CBD 7500FF     F +135630             mov     Bit_Access_Int, #0FFh   ; Set variable to indicate that program executio
                               n came from bootloader
001CC0 750000     F +135631             mov     BL_Flash_Key_1, #0              ; Set flash keys to invalid values
001CC3 750000     F +135632             mov     BL_Flash_Key_2, #0
001CC6 020000       +135633             ljmp    0000h
001CC9 0100       F +135634     rst:    ajmp    init
                    +135635     
                    +135636             ; Set buffer
001CCB A800       F +135637     setbuf:mov Xl, Byte_Cntl                        ; Set number of bytes 
001CCD A900       F +135638             mov     Xh, Byte_Cnth
001CCF 08           +135639             inc     Xl      
001CD0 09           +135640             inc     Xh      
001CD1 D804         +135641     set4:djnz       Xl, set5
001CD3 D902         +135642             djnz    Xh, set5
001CD5 0100       F +135643             ajmp    set6
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   575

                    +135644     
001CD7 1100       F +135645     set5:acall getc                         ; Receive data
001CD9 EA           +135646             mov     A, Paral
001CDA F2           +135647             movx    @Xl, A                          ; Store data in XRAM
001CDB 0100       F +135648             ajmp    set4
                    +135649     
001CDD 0D           +135650     set6:inc        Cmdh    
001CDE 0100       F +135651             ajmp    mai2
                    +135652     
001CE0 C3           +135653     mai4:clr        C
001CE1 ED           +135654             mov     A, Cmdh
001CE2 9403         +135655             subb    A, #3
001CE4 5051         +135656             jnc     mai5                                    ; Jump if command >= 3
                    +135657     
                    +135658             ; Program/erase
001CE6 ED           +135659             mov     A, Cmdh
001CE7 A2E0         +135660             mov     C, ACC.0
001CE9 9200       F +135661             mov     Bit_Reg.0, C    
001CEB 7AC5         +135662             mov     Paral, #ERRORPROG
001CED C3           +135663             clr     C
001CEE E582         +135664             mov     A, DPL
001CF0 9400         +135665             subb    A, #low(BOOT_START)
001CF2 E583         +135666             mov     A, DPH
001CF4 941C         +135667             subb    A, #high(BOOT_START)
001CF6 508C         +135668             jnc     mai1                                    ; Jump if in bootloader segment
001CF8 200010       +135669             jb      Bit_Reg.0, pro3         ; Jump if program command
                    +135670     
                    +135671             ; Erase flash
001CFB 438F02       +135672             orl     PSCTL, #02h                     ; Set the PSEE bit
001CFE 438F01       +135673             orl     PSCTL, #01h                     ; Set the PSWE bit
001D01 8500B7     F +135674             mov     FLKEY, BL_Flash_Key_1   ; First key code
001D04 8500B7     F +135675             mov     FLKEY, BL_Flash_Key_2   ; Second key code
001D07 F0           +135676             movx    @DPTR, A
001D08 300027       +135677             jnb     Bit_Reg.0, pro6         ; Jump if erase command
                    +135678     
                    +135679             ; Program flash
001D0B A800       F +135680     pro3:mov        Xl, Byte_Cntl                   ; Set number of bytes 
001D0D A900       F +135681             mov     Xh, Byte_Cnth
001D0F 08           +135682             inc     Xl      
001D10 09           +135683             inc     Xh      
001D11 438F01       +135684             orl     PSCTL, #01h                     ; Set the PSWE bit
001D14 538FFD       +135685             anl     PSCTL, #0FDh                    ; Clear the PSEE bit
001D17 D804         +135686     pro4:djnz       Xl, pro5
001D19 D902         +135687             djnz    Xh, pro5
001D1B 0100       F +135688             ajmp    pro6
                    +135689     
001D1D              +135690     pro5:
001D1D C3           +135691             clr     C
001D1E E583         +135692             mov     A, DPH                          ; Check that address is not in bootloade
                               r area
001D20 941C         +135693             subb    A, #1Ch
001D22 4003         +135694             jc      ($+5)
                    +135695     
001D24 A3           +135696             inc     DPTR                                    ; Increment flash address
001D25 0100       F +135697             ajmp    pro4
                    +135698     
001D27 E2           +135699             movx    A, @Xl                          ; Read from XRAM                
001D28 8500B7     F +135700             mov     FLKEY, BL_Flash_Key_1   ; First key code
001D2B 8500B7     F +135701             mov     FLKEY, BL_Flash_Key_2   ; Second key code
001D2E F0           +135702             movx    @DPTR, A                                ; Write to flash
001D2F A3           +135703             inc     DPTR                                    ; Increment flash address
001D30 0100       F +135704             ajmp    pro4
                    +135705     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   576

001D32 538FFC       +135706     pro6:anl        PSCTL, #0FCh                    ; Clear the PSEE and PSWE bits
001D35 0100       F +135707             ajmp    main                                    ; Successfully done erase or pro
                               gram
                    +135708     
                    +135709             ; Read flash
001D37 7AC1         +135710     mai5:mov        Paral, #ERRORCOMMAND    ; Illegal command
001D39 BD030C       +135711             cjne    Cmdh, #3, mai6                  ; Jump if not read flash command
                    +135712     
001D3C E4           +135713     rd1:    clr     A
001D3D 93           +135714             movc    A, @A+DPTR                      ; Read from flash
001D3E A3           +135715             inc     DPTR                                    ; Increment flash address
001D3F FA           +135716             mov     Paral, A
001D40 1100       F +135717             acall putp
001D42 DCF8         +135718             djnz    Cmdl, rd1                       ; Decrement bytes to read       
                    +135719     
001D44 1100       F +135720             acall putw                              ; CRC
001D46 0100       F +135721             ajmp    main
                    +135722     
001D48 0100       F +135723     mai6:ajmp       mai1
                    +135724     
                    +135725     
                    +135726     
                    +135727     
                    +135728             ; Send char with crc
001D4A AA00       F +135729     putw:mov        Paral, Crcl
001D4C AB00       F +135730             mov     Parah, Crch
001D4E 1100       F +135731             acall putc
001D50 EB           +135732             mov     A, Parah
001D51 FA           +135733             mov     Paral, A
001D52 EA           +135734     putp:mov        A, Paral
001D53 6200       F +135735             xrl     Crcl, A
001D55 750008     F +135736             mov     Bit_Cnt, #8
001D58 C3           +135737     put1:clr        C
001D59 E500       F +135738             mov     A, Crch
001D5B 13           +135739             rrc     A
001D5C F500       F +135740             mov     Crch, A
001D5E E500       F +135741             mov     A, Crcl
001D60 13           +135742             rrc     A
001D61 F500       F +135743             mov     Crcl, A
001D63 5006         +135744             jnc     put2
                    +135745     
001D65 6300A0     F +135746             xrl     Crch, #high(POLYNOM)
001D68 630001     F +135747             xrl     Crcl, #low(POLYNOM)
                    +135748     
001D6B D500EA       +135749     put2:djnz       Bit_Cnt, put1
                    +135750     
                    +135751     
                    +135752             ; Send char
001D6E 1100       F +135753     putc:acall waitf
001D70 1100       F +135754             acall waitf
001D72 75000A     F +135755             mov     Bit_Cnt, #10
001D75 EA           +135756             mov     A, Paral
001D76 F4           +135757             cpl     A
001D77 200002       +135758     put3:jb Bit_Reg.1, ($+5)
001D7A D287         +135759             setb    RTX_PORT.RTX_PIN                ; Set pin high
001D7C 300002       +135760             jnb     Bit_Reg.1, ($+5)
001D7F C287         +135761             clr     RTX_PORT.RTX_PIN                ; Set pin low
001D81 1100       F +135762             acall waitf                                                     
001D83 C3           +135763             clr     C
001D84 13           +135764             rrc     A
001D85 4002         +135765             jc      put4            
                    +135766                                                     
001D87 C200       F +135767             clr     Bit_Reg.1
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   577

                    +135768     
001D89 D500EB       +135769     put4:djnz       Bit_Cnt, put3
                    +135770     
001D8C 22           +135771             ret
                    +135772     
                    +135773     
                    +135774             ; Receive char/word
001D8D 1100       F +135775     getw:acall getc
001D8F EA           +135776             mov     A, Paral
001D90 FB           +135777             mov     Parah, A
001D91 208702       +135778     getc:jb RTX_PORT.RTX_PIN, ($+5) ; Wait for high
001D94 0100       F +135779             ajmp    getc
                    +135780     
001D96 308702       +135781     get1:jnb        RTX_PORT.RTX_PIN, ($+5) ; Wait for low
001D99 0100       F +135782             ajmp    get1
                    +135783     
001D9B 750008     F +135784     getx:mov        Bit_Cnt, #8
001D9E AE00       F +135785             mov     Cntl, Baudl
001DA0 AF00       F +135786             mov     Cnth, Baudh
001DA2 C3           +135787             clr     C
001DA3 EF           +135788             mov     A, Cnth                         ; Wait half a baud
001DA4 13           +135789             rrc     A
001DA5 FF           +135790             mov     Cnth, A
001DA6 EE           +135791             mov     A, Cntl
001DA7 13           +135792             rrc     A
001DA8 FE           +135793             mov     Cntl, A
001DA9 1100       F +135794             acall waith
001DAB 1100       F +135795     get2:acall waitf                                ; Wait one baud                         
                                                       
001DAD C3           +135796             clr     C
001DAE EA           +135797             mov     A, Paral
001DAF 13           +135798             rrc     A
001DB0 308702       +135799             jnb     RTX_PORT.RTX_PIN, ($+5)                 
001DB3 4480         +135800             orl     A, #080h
                    +135801     
001DB5 FA           +135802             mov     Paral, A
001DB6 30E703       +135803             jnb     ACC.7, ($+6) 
001DB9 630001     F +135804             xrl     Crcl, #low(POLYNOM)
                    +135805     
001DBC C3           +135806             clr     C
001DBD E500       F +135807             mov     A, Crch
001DBF 13           +135808             rrc     A
001DC0 F500       F +135809             mov     Crch, A
001DC2 E500       F +135810             mov     A, Crcl
001DC4 13           +135811             rrc     A
001DC5 F500       F +135812             mov     Crcl, A
001DC7 5006         +135813             jnc     get3                            
                    +135814     
001DC9 6300A0     F +135815             xrl     Crch, #high(POLYNOM)
001DCC 630001     F +135816             xrl     Crcl, #low(POLYNOM)
                    +135817     
001DCF D500D9       +135818     get3:djnz       Bit_Cnt, get2
                    +135819     
001DD2 E500       F +135820             mov     A, Crcl 
001DD4 6500       F +135821             xrl     A, Crch 
001DD6 6500       F +135822             xrl     A, Crch 
001DD8 F500       F +135823             mov     Crcl, A
001DDA 22           +135824             ret
                    +135825     
                    +135826     
                    +135827             ; UART delays                                                                   
                                       
001DDB AE00       F +135828     waitf:mov       Cntl, Baudl     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   578

001DDD AF00       F +135829             mov     Cnth, Baudh
001DDF 0E           +135830     waith:inc Cntl
001DE0 0F           +135831             inc     Cnth
001DE1 DEFE         +135832     wait1:djnz Cntl, wait1
001DE3 DFFC         +135833             djnz Cnth, wait1
                    +135834     
001DE5 D200       F +135835             setb    Bit_Reg.1
001DE7 22           +135836             ret                                                                     
                    +135837     
                    +135838     
001DE8 424C4865     +135839     BOOT_SIGN:      DB      "BLHeli"        
001DEC 6C69                     
                    +135840     
001DEE 34373164     +135841     BOOT_MSG:               DB      "471d"          ; Interface-MCU_BootlaoderRevision
                    +135842     
001DF2 E8B20601     +135843     BOOT_INFO:      DB      SIGNATURE_001, SIGNATURE_002, BOOT_VERSION, BOOT_PAGES
                    +135844     
                      35845     
                      35846     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      35847     
                      35848     
                      35849     
0019FD                35850     CSEG AT 19FDh
0019FD                35851     reset:
0019FD 020000     F   35852     ljmp    pgm_start
                      35853     
                      35854     
                      35855     
                      35856     END
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   579

SYMBOL TABLE LISTING
------ ----- -------


N A M E                              T Y P E  V A L U E     ATTRIBUTES

_EEP_MAIN_REARM_START . . . . . . .  C  ADDR  1A10H     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_BEC_VOLTAGE_HIGH . . . . .  C  ADDR  1A20H     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_DAMPING_FORCE. . . . . . .  C  ADDR  1A16H     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_ENABLE_PWM_INPUT . . . . .  C  ADDR  1A25H     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_GOV_I_GAIN . . . . . . . .  C  ADDR  1A04H     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_GOV_MODE . . . . . . . . .  C  ADDR  1A05H     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_GOV_P_GAIN . . . . . . . .  C  ADDR  1A03H     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_GOV_RANGE. . . . . . . . .  C  ADDR  1A17H     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_GOV_SETUP_TARGET . . . . .  C  ADDR  1A11H     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_INPUT_POL. . . . . . . . .  C  ADDR  1A0CH     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_LOW_VOLTAGE_LIM. . . . . .  C  ADDR  1A06H     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_MAIN_SPOOLUP_TIME. . . . .  C  ADDR  1A22H     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_MOTOR_GAIN . . . . . . . .  C  ADDR  1A07H     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_MOTOR_IDLE . . . . . . . .  C  ADDR  1A08H     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_PWM_DITHER . . . . . . . .  C  ADDR  1A26H     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_PWM_FREQ . . . . . . . . .  C  ADDR  1A0AH     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_STARTUP_ACCEL. . . . . . .  C  ADDR  1A13H     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_STARTUP_METHOD . . . . . .  C  ADDR  1A18H     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_STARTUP_RPM. . . . . . . .  C  ADDR  1A12H     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_THROTTLE_RATE. . . . . . .  C  ADDR  1A1EH     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_VOLT_COMP. . . . . . . . .  C  ADDR  1A14H     R   SEG=?CO?BLHELI_S?7
_PGM_BEC_VOLTAGE_HIGH . . . . . . .  I  ADDR  009DH     R   SEG=?ID?BLHELI_S?5
_PGM_DAMPING_FORCE. . . . . . . . .  I  ADDR  0093H     R   SEG=?ID?BLHELI_S?5
_PGM_ENABLE_PWM_INPUT . . . . . . .  I  ADDR  00A2H     R   SEG=?ID?BLHELI_S?5
_PGM_GOV_I_GAIN . . . . . . . . . .  I  ADDR  0081H     R   SEG=?ID?BLHELI_S?5
_PGM_GOV_MODE . . . . . . . . . . .  I  ADDR  0082H     R   SEG=?ID?BLHELI_S?5
_PGM_GOV_P_GAIN . . . . . . . . . .  I  ADDR  0080H     R   SEG=?ID?BLHELI_S?5
_PGM_GOV_RANGE. . . . . . . . . . .  I  ADDR  0094H     R   SEG=?ID?BLHELI_S?5
_PGM_GOV_SETUP_TARGET . . . . . . .  I  ADDR  008EH     R   SEG=?ID?BLHELI_S?5
_PGM_LOW_VOLTAGE_LIM. . . . . . . .  I  ADDR  0083H     R   SEG=?ID?BLHELI_S?5
_PGM_MAIN_REARM_START . . . . . . .  I  ADDR  008DH     R   SEG=?ID?BLHELI_S?5
_PGM_MAIN_SPOOLUP_TIME. . . . . . .  I  ADDR  009FH     R   SEG=?ID?BLHELI_S?5
_PGM_MOTOR_GAIN . . . . . . . . . .  I  ADDR  0084H     R   SEG=?ID?BLHELI_S?5
_PGM_MOTOR_IDLE . . . . . . . . . .  I  ADDR  0085H     R   SEG=?ID?BLHELI_S?5
_PGM_PWM_DITHER . . . . . . . . . .  I  ADDR  00A3H     R   SEG=?ID?BLHELI_S?5
_PGM_PWM_FREQ . . . . . . . . . . .  I  ADDR  0087H     R   SEG=?ID?BLHELI_S?5
_PGM_STARTUP_ACCEL. . . . . . . . .  I  ADDR  0090H     R   SEG=?ID?BLHELI_S?5
_PGM_STARTUP_METHOD . . . . . . . .  I  ADDR  0095H     R   SEG=?ID?BLHELI_S?5
_PGM_STARTUP_RPM. . . . . . . . . .  I  ADDR  008FH     R   SEG=?ID?BLHELI_S?5
_PGM_THROTTLE_RATE. . . . . . . . .  I  ADDR  009BH     R   SEG=?ID?BLHELI_S?5
_PGM_VOLT_COMP. . . . . . . . . . .  I  ADDR  0091H     R   SEG=?ID?BLHELI_S?5
A_. . . . . . . . . . . . . . . . .  N  NUMB  0001H     A   
ABD . . . . . . . . . . . . . . . .  C  ADDR  1C31H     R   SEG=?CO?BLHELI_S?19
ACC . . . . . . . . . . . . . . . .  D  ADDR  00E0H     A   
ACC_ACC0. . . . . . . . . . . . . .  B  ADDR  00E0H.0   A   
ACC_ACC1. . . . . . . . . . . . . .  B  ADDR  00E0H.1   A   
ACC_ACC2. . . . . . . . . . . . . .  B  ADDR  00E0H.2   A   
ACC_ACC3. . . . . . . . . . . . . .  B  ADDR  00E0H.3   A   
ACC_ACC4. . . . . . . . . . . . . .  B  ADDR  00E0H.4   A   
ACC_ACC5. . . . . . . . . . . . . .  B  ADDR  00E0H.5   A   
ACC_ACC6. . . . . . . . . . . . . .  B  ADDR  00E0H.6   A   
ACC_ACC7. . . . . . . . . . . . . .  B  ADDR  00E0H.7   A   
ADC0. . . . . . . . . . . . . . . .  D  ADDR  00BDH     A   
ADC0AC. . . . . . . . . . . . . . .  D  ADDR  00B3H     A   
ADC0CF. . . . . . . . . . . . . . .  D  ADDR  00BCH     A   
ADC0CN0 . . . . . . . . . . . . . .  D  ADDR  00E8H     A   
ADC0CN0_ADBMEN. . . . . . . . . . .  B  ADDR  00E8H.6   A   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   580

ADC0CN0_ADBUSY. . . . . . . . . . .  B  ADDR  00E8H.4   A   
ADC0CN0_ADCM0 . . . . . . . . . . .  B  ADDR  00E8H.0   A   
ADC0CN0_ADCM1 . . . . . . . . . . .  B  ADDR  00E8H.1   A   
ADC0CN0_ADCM2 . . . . . . . . . . .  B  ADDR  00E8H.2   A   
ADC0CN0_ADEN. . . . . . . . . . . .  B  ADDR  00E8H.7   A   
ADC0CN0_ADINT . . . . . . . . . . .  B  ADDR  00E8H.5   A   
ADC0CN0_ADWINT. . . . . . . . . . .  B  ADDR  00E8H.3   A   
ADC0CN1 . . . . . . . . . . . . . .  D  ADDR  00B2H     A   
ADC0EOC_IRQN. . . . . . . . . . . .  N  NUMB  000AH     A   
ADC0GT. . . . . . . . . . . . . . .  D  ADDR  00C3H     A   
ADC0GTH . . . . . . . . . . . . . .  D  ADDR  00C4H     A   
ADC0GTL . . . . . . . . . . . . . .  D  ADDR  00C3H     A   
ADC0H . . . . . . . . . . . . . . .  D  ADDR  00BEH     A   
ADC0L . . . . . . . . . . . . . . .  D  ADDR  00BDH     A   
ADC0LT. . . . . . . . . . . . . . .  D  ADDR  00C5H     A   
ADC0LTH . . . . . . . . . . . . . .  D  ADDR  00C6H     A   
ADC0LTL . . . . . . . . . . . . . .  D  ADDR  00C5H     A   
ADC0MX. . . . . . . . . . . . . . .  D  ADDR  00BBH     A   
ADC0PWR . . . . . . . . . . . . . .  D  ADDR  00DFH     A   
ADC0TK. . . . . . . . . . . . . . .  D  ADDR  00B9H     A   
ADC0WC_IRQN . . . . . . . . . . . .  N  NUMB  0009H     A   
ADC_CONVERSION_CNT. . . . . . . . .  D  ADDR  005EH     R   SEG=?DT?BLHELI_S?4
ADJUST_TIMING_TWO_STEPS . . . . . .  C  ADDR  0834H     R   SEG=?CO?BLHELI_S?17
ADJUST_TIMING_TWO_STEPS_FAST. . . .  C  ADDR  0899H     R   SEG=?CO?BLHELI_S?17
APWMFET . . . . . . . . . . . . . .  N  NUMB  0006H     A   
ARM_END_BEEP. . . . . . . . . . . .  C  ADDR  1094H     R   SEG=?CO?BLHELI_S?17
ARMING_CHECK. . . . . . . . . . . .  C  ADDR  0FF2H     R   SEG=?CO?BLHELI_S?17
ARMING_INITIAL_ARM_CHECK. . . . . .  C  ADDR  0FE8H     R   SEG=?CO?BLHELI_S?17
ARMING_START. . . . . . . . . . . .  C  ADDR  0FD1H     R   SEG=?CO?BLHELI_S?17
AVERAGE_THROTTLE. . . . . . . . . .  C  ADDR  0DA0H     R   SEG=?CO?BLHELI_S?17
AVERAGE_THROTTLE_DIV. . . . . . . .  C  ADDR  0DBFH     R   SEG=?CO?BLHELI_S?17
AVERAGE_THROTTLE_MEAS . . . . . . .  C  ADDR  0DB0H     R   SEG=?CO?BLHELI_S?17
B . . . . . . . . . . . . . . . . .  D  ADDR  00F0H     A   
B_. . . . . . . . . . . . . . . . .  N  NUMB  0002H     A   
B_B0. . . . . . . . . . . . . . . .  B  ADDR  00F0H.0   A   
B_B1. . . . . . . . . . . . . . . .  B  ADDR  00F0H.1   A   
B_B2. . . . . . . . . . . . . . . .  B  ADDR  00F0H.2   A   
B_B3. . . . . . . . . . . . . . . .  B  ADDR  00F0H.3   A   
B_B4. . . . . . . . . . . . . . . .  B  ADDR  00F0H.4   A   
B_B5. . . . . . . . . . . . . . . .  B  ADDR  00F0H.5   A   
B_B6. . . . . . . . . . . . . . . .  B  ADDR  00F0H.6   A   
B_B7. . . . . . . . . . . . . . . .  B  ADDR  00F0H.7   A   
BAUDH . . . . . . . . . . . . . . .  D  ADDR  0025H     R   SEG=?DT?BLHELI_S?18
BAUDL . . . . . . . . . . . . . . .  D  ADDR  0024H     R   SEG=?DT?BLHELI_S?18
BAUDTIME. . . . . . . . . . . . . .  N  NUMB  0198H     A   
BEEP. . . . . . . . . . . . . . . .  C  ADDR  0B85H     R   SEG=?CO?BLHELI_S?17
BEEP_APWMFET_OFF. . . . . . . . . .  C  ADDR  0BC7H     R   SEG=?CO?BLHELI_S?17
BEEP_APWMFET_ON . . . . . . . . . .  C  ADDR  0BB3H     R   SEG=?CO?BLHELI_S?17
BEEP_CPWMFET_OFF. . . . . . . . . .  C  ADDR  0BCDH     R   SEG=?CO?BLHELI_S?17
BEEP_CPWMFET_ON . . . . . . . . . .  C  ADDR  0BBBH     R   SEG=?CO?BLHELI_S?17
BEEP_DELAY_SET. . . . . . . . . . .  C  ADDR  10CFH     R   SEG=?CO?BLHELI_S?17
BEEP_F1 . . . . . . . . . . . . . .  C  ADDR  0B6DH     R   SEG=?CO?BLHELI_S?17
BEEP_F2 . . . . . . . . . . . . . .  C  ADDR  0B73H     R   SEG=?CO?BLHELI_S?17
BEEP_F3 . . . . . . . . . . . . . .  C  ADDR  0B79H     R   SEG=?CO?BLHELI_S?17
BEEP_F4 . . . . . . . . . . . . . .  C  ADDR  0B7FH     R   SEG=?CO?BLHELI_S?17
BEEP_OFF. . . . . . . . . . . . . .  C  ADDR  0BD6H     R   SEG=?CO?BLHELI_S?17
BEEP_ONOFF. . . . . . . . . . . . .  C  ADDR  0B8DH     R   SEG=?CO?BLHELI_S?17
BEEP_START. . . . . . . . . . . . .  C  ADDR  0B8BH     R   SEG=?CO?BLHELI_S?17
BEEP_STRENGTH . . . . . . . . . . .  D  ADDR  0064H     R   SEG=?DT?BLHELI_S?4
BIT_ACCESS. . . . . . . . . . . . .  D  ADDR  0020H     R   SEG=?DT?BLHELI_S?3
BIT_ACCESS_INT. . . . . . . . . . .  D  ADDR  0021H     R   SEG=?DT?BLHELI_S?3
BIT_CNT . . . . . . . . . . . . . .  D  ADDR  0026H     R   SEG=?DT?BLHELI_S?18
BIT_REG . . . . . . . . . . . . . .  D  ADDR  0020H     R   SEG=?DT?BLHELI_S?18
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   581

BL_FLASH_KEY_1. . . . . . . . . . .  D  ADDR  0029H     R   SEG=?DT?BLHELI_S?18
BL_FLASH_KEY_2. . . . . . . . . . .  D  ADDR  002AH     R   SEG=?DT?BLHELI_S?18
BOOT_BAUDRATE . . . . . . . . . . .  N  NUMB  4B00H     A   
BOOT_DELAY. . . . . . . . . . . . .  N  NUMB  005F5E10H A   
BOOT_INFO . . . . . . . . . . . . .  C  ADDR  1DF2H     R   SEG=?CO?BLHELI_S?19
BOOT_MSG. . . . . . . . . . . . . .  C  ADDR  1DEEH     R   SEG=?CO?BLHELI_S?19
BOOT_PAGES. . . . . . . . . . . . .  N  NUMB  0001H     A   
BOOT_SIGN . . . . . . . . . . . . .  C  ADDR  1DE8H     R   SEG=?CO?BLHELI_S?19
BOOT_START. . . . . . . . . . . . .  N  NUMB  1C00H     A   
BOOT_VERSION. . . . . . . . . . . .  N  NUMB  0006H     A   
BOOTLOADER_DONE . . . . . . . . . .  C  ADDR  0E6BH     R   SEG=?CO?BLHELI_S?17
BPWMFET . . . . . . . . . . . . . .  N  NUMB  0005H     A   
BYTE_CNTH . . . . . . . . . . . . .  D  ADDR  0028H     R   SEG=?DT?BLHELI_S?18
BYTE_CNTL . . . . . . . . . . . . .  D  ADDR  0027H     R   SEG=?DT?BLHELI_S?18
BYTE_REG. . . . . . . . . . . . . .  D  ADDR  0021H     R   SEG=?DT?BLHELI_S?18
C_. . . . . . . . . . . . . . . . .  N  NUMB  0003H     A   
CALC_NEW_WAIT_PER_DEMAG_DONE. . . .  C  ADDR  0770H     R   SEG=?CO?BLHELI_S?17
CALC_NEW_WAIT_PER_STARTUP_DONE. . .  C  ADDR  0754H     R   SEG=?CO?BLHELI_S?17
CALC_NEW_WAIT_TIMES . . . . . . . .  C  ADDR  07FBH     R   SEG=?CO?BLHELI_S?17
CALC_NEW_WAIT_TIMES_EXIT. . . . . .  C  ADDR  079CH     R   SEG=?CO?BLHELI_S?17
CALC_NEW_WAIT_TIMES_FAST. . . . . .  C  ADDR  0880H     R   SEG=?CO?BLHELI_S?17
CALC_NEW_WAIT_TIMES_FAST_DONE . . .  C  ADDR  07E7H     R   SEG=?CO?BLHELI_S?17
CALC_NEW_WAIT_TIMES_SETUP . . . . .  C  ADDR  0745H     R   SEG=?CO?BLHELI_S?17
CALC_NEXT_COMM_AVG_PERIOD_DIV . . .  C  ADDR  0717H     R   SEG=?CO?BLHELI_S?17
CALC_NEXT_COMM_NEW_PERIOD_DIV . . .  C  ADDR  072AH     R   SEG=?CO?BLHELI_S?17
CALC_NEXT_COMM_NEW_PERIOD_DIV_DONE.  C  ADDR  0733H     R   SEG=?CO?BLHELI_S?17
CALC_NEXT_COMM_NORMAL . . . . . . .  C  ADDR  06F8H     R   SEG=?CO?BLHELI_S?17
CALC_NEXT_COMM_STARTUP. . . . . . .  C  ADDR  06B8H     R   SEG=?CO?BLHELI_S?17
CALC_NEXT_COMM_STARTUP_AVERAGE. . .  C  ADDR  06DDH     R   SEG=?CO?BLHELI_S?17
CALC_NEXT_COMM_STARTUP_NO_X . . . .  C  ADDR  06CAH     R   SEG=?CO?BLHELI_S?17
CALC_NEXT_COMM_TIMING . . . . . . .  C  ADDR  0681H     R   SEG=?CO?BLHELI_S?17
CALC_NEXT_COMM_TIMING_FAST. . . . .  C  ADDR  079FH     R   SEG=?CO?BLHELI_S?17
CENTER_THROTTLE_H . . . . . . . . .  D  ADDR  0034H     R   SEG=?DT?BLHELI_S?4
CENTER_THROTTLE_L . . . . . . . . .  D  ADDR  0033H     R   SEG=?DT?BLHELI_S?4
CHECK_DSHOT_CMD . . . . . . . . . .  C  ADDR  1120H     R   SEG=?CO?BLHELI_S?17
CHECK_TEMP_VOLTAGE_AND_LIMIT_POWER.  C  ADDR  0604H     R   SEG=?CO?BLHELI_S?17
CHECK_VOLTAGE_START . . . . . . . .  C  ADDR  0660H     R   SEG=?CO?BLHELI_S?17
CKCON0. . . . . . . . . . . . . . .  D  ADDR  008EH     A   
CKCON1. . . . . . . . . . . . . . .  D  ADDR  00A6H     A   
CLEAR_DSHOT_CMD . . . . . . . . . .  C  ADDR  12B4H     R   SEG=?CO?BLHELI_S?17
CLEAR_RAM . . . . . . . . . . . . .  C  ADDR  0E30H     R   SEG=?CO?BLHELI_S?17
CLKSEL. . . . . . . . . . . . . . .  D  ADDR  00A9H     A   
CLOCK_SET_AT_48MHZ. . . . . . . . .  D  ADDR  0066H     R   SEG=?DT?BLHELI_S?4
CMDH. . . . . . . . . . . . . . . .     REG   R            
CMDL. . . . . . . . . . . . . . . .     REG   R            
CMP0_IRQN . . . . . . . . . . . . .  N  NUMB  000CH     A   
CMP0CN0 . . . . . . . . . . . . . .  D  ADDR  009BH     A   
CMP0CN1 . . . . . . . . . . . . . .  D  ADDR  0099H     A   
CMP0MD. . . . . . . . . . . . . . .  D  ADDR  009DH     A   
CMP0MX. . . . . . . . . . . . . . .  D  ADDR  009FH     A   
CMP1_IRQN . . . . . . . . . . . . .  N  NUMB  000DH     A   
CMP1CN0 . . . . . . . . . . . . . .  D  ADDR  00BFH     A   
CMP1CN1 . . . . . . . . . . . . . .  D  ADDR  00ACH     A   
CMP1MD. . . . . . . . . . . . . . .  D  ADDR  00ABH     A   
CMP1MX. . . . . . . . . . . . . . .  D  ADDR  00AAH     A   
CNTH. . . . . . . . . . . . . . . .     REG   R            
CNTL. . . . . . . . . . . . . . . .     REG   R            
COMM12_REV. . . . . . . . . . . . .  C  ADDR  0A62H     R   SEG=?CO?BLHELI_S?17
COMM1COMM2. . . . . . . . . . . . .  C  ADDR  0A48H     R   SEG=?CO?BLHELI_S?17
COMM23_REV. . . . . . . . . . . . .  C  ADDR  0A93H     R   SEG=?CO?BLHELI_S?17
COMM2COMM3. . . . . . . . . . . . .  C  ADDR  0A79H     R   SEG=?CO?BLHELI_S?17
COMM34_REV. . . . . . . . . . . . .  C  ADDR  0AC4H     R   SEG=?CO?BLHELI_S?17
COMM3COMM4. . . . . . . . . . . . .  C  ADDR  0AAAH     R   SEG=?CO?BLHELI_S?17
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   582

COMM45_REV. . . . . . . . . . . . .  C  ADDR  0AF5H     R   SEG=?CO?BLHELI_S?17
COMM4COMM5. . . . . . . . . . . . .  C  ADDR  0ADBH     R   SEG=?CO?BLHELI_S?17
COMM56_REV. . . . . . . . . . . . .  C  ADDR  0B26H     R   SEG=?CO?BLHELI_S?17
COMM5COMM6. . . . . . . . . . . . .  C  ADDR  0B0CH     R   SEG=?CO?BLHELI_S?17
COMM61_REV. . . . . . . . . . . . .  C  ADDR  0B57H     R   SEG=?CO?BLHELI_S?17
COMM6COMM1. . . . . . . . . . . . .  C  ADDR  0B3DH     R   SEG=?CO?BLHELI_S?17
COMM_EXIT . . . . . . . . . . . . .  C  ADDR  0B6CH     R   SEG=?CO?BLHELI_S?17
COMM_PERIOD4X_H . . . . . . . . . .  D  ADDR  0048H     R   SEG=?DT?BLHELI_S?4
COMM_PERIOD4X_L . . . . . . . . . .  D  ADDR  0047H     R   SEG=?DT?BLHELI_S?4
COMP_CHECK_TIMEOUT. . . . . . . . .  C  ADDR  0943H     R   SEG=?CO?BLHELI_S?17
COMP_CHECK_TIMEOUT_EXTEND_TIMEOUT .  C  ADDR  0954H     R   SEG=?CO?BLHELI_S?17
COMP_CHECK_TIMEOUT_NOT_TIMED_OUT. .  C  ADDR  0956H     R   SEG=?CO?BLHELI_S?17
COMP_CHECK_TIMEOUT_TIMEOUT_EXTENDED  C  ADDR  0950H     R   SEG=?CO?BLHELI_S?17
COMP_COM. . . . . . . . . . . . . .  N  NUMB  0003H     A   
COMP_READ_OK. . . . . . . . . . . .  C  ADDR  09B1H     R   SEG=?CO?BLHELI_S?17
COMP_READ_OK_JMP. . . . . . . . . .  C  ADDR  09C3H     R   SEG=?CO?BLHELI_S?17
COMP_READ_WRONG . . . . . . . . . .  C  ADDR  0961H     R   SEG=?CO?BLHELI_S?17
COMP_READ_WRONG_EXTEND_TIMEOUT. . .  C  ADDR  097AH     R   SEG=?CO?BLHELI_S?17
COMP_READ_WRONG_LOAD_TIMEOUT. . . .  C  ADDR  09A7H     R   SEG=?CO?BLHELI_S?17
COMP_READ_WRONG_LOW_RPM . . . . . .  C  ADDR  0996H     R   SEG=?CO?BLHELI_S?17
COMP_READ_WRONG_NOT_STARTUP . . . .  C  ADDR  096DH     R   SEG=?CO?BLHELI_S?17
COMP_READ_WRONG_TIMEOUT_SET . . . .  C  ADDR  098BH     R   SEG=?CO?BLHELI_S?17
COMP_SCALE_SAMPLES. . . . . . . . .  C  ADDR  093BH     R   SEG=?CO?BLHELI_S?17
COMP_TIMED_OUT. . . . . . . . . . .  N  NUMB  0002H     A   
COMPARATOR_READ_CNT . . . . . . . .  D  ADDR  0049H     R   SEG=?DT?BLHELI_S?4
CPWMFET . . . . . . . . . . . . . .  N  NUMB  0004H     A   
CRC0_PAGE . . . . . . . . . . . . .  N  NUMB  0000H     A   
CRC0CN0 . . . . . . . . . . . . . .  D  ADDR  00CEH     A   
CRC0CN1 . . . . . . . . . . . . . .  D  ADDR  0086H     A   
CRC0CNT . . . . . . . . . . . . . .  D  ADDR  00D3H     A   
CRC0DAT . . . . . . . . . . . . . .  D  ADDR  00DEH     A   
CRC0FLIP. . . . . . . . . . . . . .  D  ADDR  00CFH     A   
CRC0IN. . . . . . . . . . . . . . .  D  ADDR  00DDH     A   
CRC0ST. . . . . . . . . . . . . . .  D  ADDR  00D2H     A   
CRCH. . . . . . . . . . . . . . . .  D  ADDR  0023H     R   SEG=?DT?BLHELI_S?18
CRCL. . . . . . . . . . . . . . . .  D  ADDR  0022H     R   SEG=?DT?BLHELI_S?18
CURRENT_AVERAGE_TEMP. . . . . . . .  D  ADDR  005FH     R   SEG=?DT?BLHELI_S?4
CURRENT_POWER_PWM_REG_H . . . . . .  D  ADDR  005AH     R   SEG=?DT?BLHELI_S?4
D_. . . . . . . . . . . . . . . . .  N  NUMB  0004H     A   
DAMP_PWM_REG_H. . . . . . . . . . .  D  ADDR  0059H     R   SEG=?DT?BLHELI_S?4
DAMP_PWM_REG_L. . . . . . . . . . .  D  ADDR  0058H     R   SEG=?DT?BLHELI_S?4
DEBUGPIN. . . . . . . . . . . . . .  N  NUMB  0000H     A   
DECODE_DEMAG_DONE . . . . . . . . .  C  ADDR  0CBFH     R   SEG=?CO?BLHELI_S?17
DECODE_DEMAG_HIGH . . . . . . . . .  C  ADDR  0CB9H     R   SEG=?CO?BLHELI_S?17
DECODE_SETTINGS . . . . . . . . . .  C  ADDR  0C7DH     R   SEG=?CO?BLHELI_S?17
DECODE_TEMP_DONE. . . . . . . . . .  C  ADDR  0CCBH     R   SEG=?CO?BLHELI_S?17
DECODE_TEMP_STEP. . . . . . . . . .  C  ADDR  0CC7H     R   SEG=?CO?BLHELI_S?17
DEFAULT_PGM_BEACON_DELAY. . . . . .  N  NUMB  0004H     A   
DEFAULT_PGM_BEACON_STRENGTH . . . .  N  NUMB  0050H     A   
DEFAULT_PGM_BEEP_STRENGTH . . . . .  N  NUMB  0028H     A   
DEFAULT_PGM_BRAKE_ON_STOP . . . . .  N  NUMB  0000H     A   
DEFAULT_PGM_CENTER_THROTTLE . . . .  N  NUMB  007AH     A   
DEFAULT_PGM_COMM_TIMING . . . . . .  N  NUMB  0003H     A   
DEFAULT_PGM_DEMAG_COMP. . . . . . .  N  NUMB  0002H     A   
DEFAULT_PGM_DIRECTION . . . . . . .  N  NUMB  0001H     A   
DEFAULT_PGM_ENABLE_POWER_PROT . . .  N  NUMB  0001H     A   
DEFAULT_PGM_ENABLE_TEMP_PROT. . . .  N  NUMB  0007H     A   
DEFAULT_PGM_ENABLE_TX_PROGRAM . . .  N  NUMB  0001H     A   
DEFAULT_PGM_LED_CONTROL . . . . . .  N  NUMB  0000H     A   
DEFAULT_PGM_MAX_THROTTLE. . . . . .  N  NUMB  00D0H     A   
DEFAULT_PGM_MIN_THROTTLE. . . . . .  N  NUMB  0025H     A   
DEFAULT_PGM_STARTUP_PWR . . . . . .  N  NUMB  0009H     A   
DEMAG_DETECTED. . . . . . . . . . .  N  NUMB  0001H     A   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   583

DEMAG_DETECTED_METRIC . . . . . . .  D  ADDR  003DH     R   SEG=?DT?BLHELI_S?4
DEMAG_PWR_OFF_THRESH. . . . . . . .  D  ADDR  003EH     R   SEG=?DT?BLHELI_S?4
DERIVID . . . . . . . . . . . . . .  D  ADDR  00ADH     A   
DEVICEID. . . . . . . . . . . . . .  D  ADDR  00B5H     A   
DIR_CHANGE_BRAKE. . . . . . . . . .  N  NUMB  0003H     A   
DIRECT_START_CHECK_RCP. . . . . . .  C  ADDR  13A7H     R   SEG=?CO?BLHELI_S?17
DONT_CLEAR_DSHOT_CMD. . . . . . . .  C  ADDR  12BAH     R   SEG=?CO?BLHELI_S?17
DP. . . . . . . . . . . . . . . . .  D  ADDR  0082H     A   
DPH . . . . . . . . . . . . . . . .  D  ADDR  0083H     A   
DPL . . . . . . . . . . . . . . . .  D  ADDR  0082H     A   
DSHOT_BEEP_2. . . . . . . . . . . .  C  ADDR  113EH     R   SEG=?CO?BLHELI_S?17
DSHOT_BEEP_3. . . . . . . . . . . .  C  ADDR  115CH     R   SEG=?CO?BLHELI_S?17
DSHOT_BEEP_4. . . . . . . . . . . .  C  ADDR  117AH     R   SEG=?CO?BLHELI_S?17
DSHOT_BEEP_5. . . . . . . . . . . .  C  ADDR  1198H     R   SEG=?CO?BLHELI_S?17
DSHOT_CMD . . . . . . . . . . . . .  D  ADDR  0052H     R   SEG=?DT?BLHELI_S?4
DSHOT_CMD_CNT . . . . . . . . . . .  D  ADDR  0053H     R   SEG=?DT?BLHELI_S?4
DSHOT_DIRECTION_1 . . . . . . . . .  C  ADDR  11B6H     R   SEG=?CO?BLHELI_S?17
DSHOT_DIRECTION_2 . . . . . . . . .  C  ADDR  11D6H     R   SEG=?CO?BLHELI_S?17
DSHOT_DIRECTION_BIDIR_OFF . . . . .  C  ADDR  11F6H     R   SEG=?CO?BLHELI_S?17
DSHOT_DIRECTION_BIDIR_ON. . . . . .  C  ADDR  1214H     R   SEG=?CO?BLHELI_S?17
DSHOT_DIRECTION_NORMAL. . . . . . .  C  ADDR  1231H     R   SEG=?CO?BLHELI_S?17
DSHOT_DIRECTION_REVERSE . . . . . .  C  ADDR  125DH     R   SEG=?CO?BLHELI_S?17
DSHOT_FRAME_LENGTH_THR. . . . . . .  D  ADDR  006EH     R   SEG=?DT?BLHELI_S?4
DSHOT_FRAME_START_H . . . . . . . .  D  ADDR  006DH     R   SEG=?DT?BLHELI_S?4
DSHOT_FRAME_START_L . . . . . . . .  D  ADDR  006CH     R   SEG=?DT?BLHELI_S?4
DSHOT_PWM_THR . . . . . . . . . . .  D  ADDR  006AH     R   SEG=?DT?BLHELI_S?4
DSHOT_SAVE_SETTINGS . . . . . . . .  C  ADDR  129CH     R   SEG=?CO?BLHELI_S?17
DSHOT_TIMER_PRESET. . . . . . . . .  D  ADDR  006BH     R   SEG=?DT?BLHELI_S?4
E_. . . . . . . . . . . . . . . . .  N  NUMB  0005H     A   
EEP_DUMMY . . . . . . . . . . . . .  C  ADDR  1A29H     R   SEG=?CO?BLHELI_S?7
EEP_ENABLE_TX_PROGRAM . . . . . . .  C  ADDR  1A0FH     R   SEG=?CO?BLHELI_S?7
EEP_ESC_LAYOUT. . . . . . . . . . .  C  ADDR  1A40H     R   SEG=?CO?BLHELI_S?1
EEP_ESC_MCU . . . . . . . . . . . .  C  ADDR  1A50H     R   SEG=?CO?BLHELI_S?2
EEP_FW_MAIN_REVISION. . . . . . . .  C  ADDR  1A00H     R   SEG=?CO?BLHELI_S?7
EEP_FW_SUB_REVISION . . . . . . . .  C  ADDR  1A01H     R   SEG=?CO?BLHELI_S?7
EEP_INITIALIZED_H . . . . . . . . .  C  ADDR  1A0EH     R   SEG=?CO?BLHELI_S?7
EEP_INITIALIZED_L . . . . . . . . .  C  ADDR  1A0DH     R   SEG=?CO?BLHELI_S?7
EEP_LAYOUT_REVISION . . . . . . . .  C  ADDR  1A02H     R   SEG=?CO?BLHELI_S?7
EEP_NAME. . . . . . . . . . . . . .  C  ADDR  1A60H     R   SEG=?CO?BLHELI_S?8
EEP_PGM_BEACON_DELAY. . . . . . . .  C  ADDR  1A1DH     R   SEG=?CO?BLHELI_S?7
EEP_PGM_BEACON_STRENGTH . . . . . .  C  ADDR  1A1CH     R   SEG=?CO?BLHELI_S?7
EEP_PGM_BEEP_STRENGTH . . . . . . .  C  ADDR  1A1BH     R   SEG=?CO?BLHELI_S?7
EEP_PGM_BRAKE_ON_STOP . . . . . . .  C  ADDR  1A27H     R   SEG=?CO?BLHELI_S?7
EEP_PGM_CENTER_THROTTLE . . . . . .  C  ADDR  1A21H     R   SEG=?CO?BLHELI_S?7
EEP_PGM_COMM_TIMING . . . . . . . .  C  ADDR  1A15H     R   SEG=?CO?BLHELI_S?7
EEP_PGM_DEMAG_COMP. . . . . . . . .  C  ADDR  1A1FH     R   SEG=?CO?BLHELI_S?7
EEP_PGM_DIRECTION . . . . . . . . .  C  ADDR  1A0BH     R   SEG=?CO?BLHELI_S?7
EEP_PGM_ENABLE_POWER_PROT . . . . .  C  ADDR  1A24H     R   SEG=?CO?BLHELI_S?7
EEP_PGM_LED_CONTROL . . . . . . . .  C  ADDR  1A28H     R   SEG=?CO?BLHELI_S?7
EEP_PGM_MAX_THROTTLE. . . . . . . .  C  ADDR  1A1AH     R   SEG=?CO?BLHELI_S?7
EEP_PGM_MIN_THROTTLE. . . . . . . .  C  ADDR  1A19H     R   SEG=?CO?BLHELI_S?7
EEP_PGM_STARTUP_PWR . . . . . . . .  C  ADDR  1A09H     R   SEG=?CO?BLHELI_S?7
EEP_PGM_TEMP_PROT_ENABLE. . . . . .  C  ADDR  1A23H     R   SEG=?CO?BLHELI_S?7
EEPROM_FW_MAIN_REVISION . . . . . .  N  NUMB  0010H     A   
EEPROM_FW_SUB_REVISION. . . . . . .  N  NUMB  004DH     A   
EEPROM_LAYOUT_REVISION. . . . . . .  N  NUMB  0021H     A   
EIE1. . . . . . . . . . . . . . . .  D  ADDR  00E6H     A   
EIE2. . . . . . . . . . . . . . . .  D  ADDR  00CEH     A   
EIP1. . . . . . . . . . . . . . . .  D  ADDR  00F3H     A   
EIP1H . . . . . . . . . . . . . . .  D  ADDR  00F5H     A   
EIP2. . . . . . . . . . . . . . . .  D  ADDR  00F4H     A   
EIP2H . . . . . . . . . . . . . . .  D  ADDR  00F6H     A   
EMI0CN. . . . . . . . . . . . . . .  D  ADDR  00E7H     A   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   584

ERASE_AND_STORE_ALL_IN_EEPROM . . .  C  ADDR  14C5H     R   SEG=?CO?BLHELI_S?17
ERASE_FLASH . . . . . . . . . . . .  C  ADDR  151EH     R   SEG=?CO?BLHELI_S?17
ERRORCOMMAND. . . . . . . . . . . .  N  NUMB  00C1H     A   
ERRORCRC. . . . . . . . . . . . . .  N  NUMB  00C2H     A   
ERRORPROG . . . . . . . . . . . . .  N  NUMB  00C5H     A   
ERRORVERIFY . . . . . . . . . . . .  N  NUMB  00C0H     A   
EVAL_COMP_CHECK_TIMEOUT . . . . . .  C  ADDR  09F2H     R   SEG=?CO?BLHELI_S?17
EVAL_COMP_EXIT. . . . . . . . . . .  C  ADDR  0A02H     R   SEG=?CO?BLHELI_S?17
EVALUATE_COMPARATOR_INTEGRITY . . .  C  ADDR  09E5H     R   SEG=?CO?BLHELI_S?17
EXIT. . . . . . . . . . . . . . . .  C  ADDR  1CBAH     R   SEG=?CO?BLHELI_S?19
F_. . . . . . . . . . . . . . . . .  N  NUMB  0006H     A   
FIND_THROTTLE_GAIN. . . . . . . . .  C  ADDR  0D51H     R   SEG=?CO?BLHELI_S?17
FIND_THROTTLE_GAIN_FWD. . . . . . .  C  ADDR  0D4AH     R   SEG=?CO?BLHELI_S?17
FIND_THROTTLE_GAIN_LOOP . . . . . .  C  ADDR  0D7CH     R   SEG=?CO?BLHELI_S?17
FIND_THROTTLE_GAINS . . . . . . . .  C  ADDR  0CEBH     R   SEG=?CO?BLHELI_S?17
FIND_THROTTLE_GAINS_BIDIR_DONE. . .  C  ADDR  0D24H     R   SEG=?CO?BLHELI_S?17
FIND_THROTTLE_GAINS_NORMAL. . . . .  C  ADDR  0CFFH     R   SEG=?CO?BLHELI_S?17
FLAGS0. . . . . . . . . . . . . . .  D  ADDR  0024H     R   SEG=?DT?BLHELI_S?3
FLAGS1. . . . . . . . . . . . . . .  D  ADDR  0025H     R   SEG=?DT?BLHELI_S?3
FLAGS2. . . . . . . . . . . . . . .  D  ADDR  0026H     R   SEG=?DT?BLHELI_S?3
FLAGS3. . . . . . . . . . . . . . .  D  ADDR  0027H     R   SEG=?DT?BLHELI_S?3
FLASH_KEY_1 . . . . . . . . . . . .  D  ADDR  0067H     R   SEG=?DT?BLHELI_S?4
FLASH_KEY_2 . . . . . . . . . . . .  D  ADDR  0068H     R   SEG=?DT?BLHELI_S?4
FLKEY . . . . . . . . . . . . . . .  D  ADDR  00B7H     A   
G_. . . . . . . . . . . . . . . . .  N  NUMB  0007H     A   
GET1. . . . . . . . . . . . . . . .  C  ADDR  1D96H     R   SEG=?CO?BLHELI_S?19
GET2. . . . . . . . . . . . . . . .  C  ADDR  1DABH     R   SEG=?CO?BLHELI_S?19
GET3. . . . . . . . . . . . . . . .  C  ADDR  1DCFH     R   SEG=?CO?BLHELI_S?19
GET_RCP_END . . . . . . . . . . . .  C  ADDR  0363H     R   SEG=?CO?BLHELI_S?17
GETC. . . . . . . . . . . . . . . .  C  ADDR  1D91H     R   SEG=?CO?BLHELI_S?19
GETW. . . . . . . . . . . . . . . .  C  ADDR  1D8DH     R   SEG=?CO?BLHELI_S?19
GETX. . . . . . . . . . . . . . . .  C  ADDR  1D9BH     R   SEG=?CO?BLHELI_S?19
H_. . . . . . . . . . . . . . . . .  N  NUMB  0008H     A   
HFO0CAL . . . . . . . . . . . . . .  D  ADDR  00C7H     A   
HFO1CAL . . . . . . . . . . . . . .  D  ADDR  00D6H     A   
HFOCN . . . . . . . . . . . . . . .  D  ADDR  00EFH     A   
HIGH_RPM. . . . . . . . . . . . . .  N  NUMB  0004H     A   
I2C0_IRQN . . . . . . . . . . . . .  N  NUMB  0012H     A   
I2C0CN0 . . . . . . . . . . . . . .  D  ADDR  00BAH     A   
I2C0DIN . . . . . . . . . . . . . .  D  ADDR  00BCH     A   
I2C0DOUT. . . . . . . . . . . . . .  D  ADDR  00BBH     A   
I2C0FCN0. . . . . . . . . . . . . .  D  ADDR  00ADH     A   
I2C0FCN1. . . . . . . . . . . . . .  D  ADDR  00ABH     A   
I2C0FCT . . . . . . . . . . . . . .  D  ADDR  00F5H     A   
I2C0SLAD. . . . . . . . . . . . . .  D  ADDR  00BDH     A   
I2C0STAT. . . . . . . . . . . . . .  D  ADDR  00B9H     A   
I2CSLAVE0_PAGE. . . . . . . . . . .  N  NUMB  0020H     A   
I_. . . . . . . . . . . . . . . . .  N  NUMB  0009H     A   
ID1 . . . . . . . . . . . . . . . .  C  ADDR  1C4DH     R   SEG=?CO?BLHELI_S?19
ID3 . . . . . . . . . . . . . . . .  C  ADDR  1C58H     R   SEG=?CO?BLHELI_S?19
ID4 . . . . . . . . . . . . . . . .  C  ADDR  1C63H     R   SEG=?CO?BLHELI_S?19
ID5 . . . . . . . . . . . . . . . .  C  ADDR  1C70H     R   SEG=?CO?BLHELI_S?19
IE. . . . . . . . . . . . . . . . .  D  ADDR  00A8H     A   
IE_EA . . . . . . . . . . . . . . .  B  ADDR  00A8H.7   A   
IE_ES0. . . . . . . . . . . . . . .  B  ADDR  00A8H.4   A   
IE_ESPI0. . . . . . . . . . . . . .  B  ADDR  00A8H.6   A   
IE_ET0. . . . . . . . . . . . . . .  B  ADDR  00A8H.1   A   
IE_ET1. . . . . . . . . . . . . . .  B  ADDR  00A8H.3   A   
IE_ET2. . . . . . . . . . . . . . .  B  ADDR  00A8H.5   A   
IE_EX0. . . . . . . . . . . . . . .  B  ADDR  00A8H.0   A   
IE_EX1. . . . . . . . . . . . . . .  B  ADDR  00A8H.2   A   
IN1 . . . . . . . . . . . . . . . .  C  ADDR  1C7AH     R   SEG=?CO?BLHELI_S?19
INIT. . . . . . . . . . . . . . . .  C  ADDR  1C00H     R   SEG=?CO?BLHELI_S?19
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   585

INIT_NO_SIGNAL. . . . . . . . . . .  C  ADDR  0E55H     R   SEG=?CO?BLHELI_S?17
INIT_START. . . . . . . . . . . . .  C  ADDR  12C2H     R   SEG=?CO?BLHELI_S?17
INIT_START_BIDIR_DONE . . . . . . .  C  ADDR  1315H     R   SEG=?CO?BLHELI_S?17
INITIAL_ARM . . . . . . . . . . . .  D  ADDR  0030H     R   SEG=?DT?BLHELI_S?4
INITIAL_RUN_CHECK_STARTUP_ROT . . .  C  ADDR  13C4H     R   SEG=?CO?BLHELI_S?17
INITIAL_RUN_CONTINUE_RUN. . . . . .  C  ADDR  13D0H     R   SEG=?CO?BLHELI_S?17
INITIAL_RUN_PHASE . . . . . . . . .  N  NUMB  0001H     A   
INITIAL_RUN_PHASE_DONE. . . . . . .  C  ADDR  13D5H     R   SEG=?CO?BLHELI_S?17
INITIAL_RUN_ROT_CNTD. . . . . . . .  D  ADDR  003BH     R   SEG=?DT?BLHELI_S?4
INITIALIZE_TIMING . . . . . . . . .  C  ADDR  067AH     R   SEG=?CO?BLHELI_S?17
INITIALIZED_H_DUMMY . . . . . . . .  I  ADDR  008BH     R   SEG=?ID?BLHELI_S?5
INITIALIZED_L_DUMMY . . . . . . . .  I  ADDR  008AH     R   SEG=?ID?BLHELI_S?5
INPUT_HIGH_CHECK_1. . . . . . . . .  C  ADDR  0E5FH     R   SEG=?CO?BLHELI_S?17
INPUT_HIGH_CHECK_2. . . . . . . . .  C  ADDR  0E61H     R   SEG=?CO?BLHELI_S?17
INT0_INT. . . . . . . . . . . . . .  C  ADDR  031CH     R   SEG=?CO?BLHELI_S?17
INT0_INT_BIDIR_DO_DEADBAND. . . . .  C  ADDR  0456H     R   SEG=?CO?BLHELI_S?17
INT0_INT_BIDIR_FWD. . . . . . . . .  C  ADDR  0430H     R   SEG=?CO?BLHELI_S?17
INT0_INT_BIDIR_REV_CHK. . . . . . .  C  ADDR  0435H     R   SEG=?CO?BLHELI_S?17
INT0_INT_CALCULATE. . . . . . . . .  C  ADDR  0417H     R   SEG=?CO?BLHELI_S?17
INT0_INT_CHECK_FULL_RANGE . . . . .  C  ADDR  03FDH     R   SEG=?CO?BLHELI_S?17
INT0_INT_DO_THROTTLE_GAIN . . . . .  C  ADDR  0475H     R   SEG=?CO?BLHELI_S?17
INT0_INT_EXIT . . . . . . . . . . .  C  ADDR  052BH     R   SEG=?CO?BLHELI_S?17
INT0_INT_FALL_GAIN_DONE . . . . . .  C  ADDR  03D8H     R   SEG=?CO?BLHELI_S?17
INT0_INT_FALL_NOT_MULTISHOT . . . .  C  ADDR  0385H     R   SEG=?CO?BLHELI_S?17
INT0_INT_FALL_NOT_ONESHOT_125 . . .  C  ADDR  03AFH     R   SEG=?CO?BLHELI_S?17
INT0_INT_FALL_NOT_ONESHOT_42. . . .  C  ADDR  0397H     R   SEG=?CO?BLHELI_S?17
INT0_INT_GAIN_LOOP. . . . . . . . .  C  ADDR  04B7H     R   SEG=?CO?BLHELI_S?17
INT0_INT_GAIN_RCP_DONE. . . . . . .  C  ADDR  04BFH     R   SEG=?CO?BLHELI_S?17
INT0_INT_NOT_BIDIR. . . . . . . . .  C  ADDR  0469H     R   SEG=?CO?BLHELI_S?17
INT0_INT_NOT_DSHOT. . . . . . . . .  C  ADDR  032BH     R   SEG=?CO?BLHELI_S?17
INT0_INT_OUTSIDE_RANGE. . . . . . .  C  ADDR  03E7H     R   SEG=?CO?BLHELI_S?17
INT0_INT_PULSE_READY. . . . . . . .  C  ADDR  04D4H     R   SEG=?CO?BLHELI_S?17
INT0_INT_SET_MIN. . . . . . . . . .  C  ADDR  040CH     R   SEG=?CO?BLHELI_S?17
INT0_INT_SET_PWM_DAMP_SET . . . . .  C  ADDR  050DH     R   SEG=?CO?BLHELI_S?17
INT0_INT_SET_PWM_REGISTERS. . . . .  C  ADDR  04F6H     R   SEG=?CO?BLHELI_S?17
INT0_INT_SET_TIMEOUT. . . . . . . .  C  ADDR  0528H     R   SEG=?CO?BLHELI_S?17
INT0_INT_STARTUP_BOOST_STALL. . . .  C  ADDR  048CH     R   SEG=?CO?BLHELI_S?17
INT0_INT_STARTUP_BOOSTED. . . . . .  C  ADDR  0496H     R   SEG=?CO?BLHELI_S?17
INT0_INT_UNIDIR_NEG . . . . . . . .  C  ADDR  046DH     R   SEG=?CO?BLHELI_S?17
INT0_IRQN . . . . . . . . . . . . .  N  NUMB  0000H     A   
INT1_INT. . . . . . . . . . . . . .  C  ADDR  0535H     R   SEG=?CO?BLHELI_S?17
INT1_IRQN . . . . . . . . . . . . .  N  NUMB  0002H     A   
IP. . . . . . . . . . . . . . . . .  D  ADDR  00B8H     A   
IP_PS0. . . . . . . . . . . . . . .  B  ADDR  00B8H.4   A   
IP_PSPI0. . . . . . . . . . . . . .  B  ADDR  00B8H.6   A   
IP_PT0. . . . . . . . . . . . . . .  B  ADDR  00B8H.1   A   
IP_PT1. . . . . . . . . . . . . . .  B  ADDR  00B8H.3   A   
IP_PT2. . . . . . . . . . . . . . .  B  ADDR  00B8H.5   A   
IP_PX0. . . . . . . . . . . . . . .  B  ADDR  00B8H.0   A   
IP_PX1. . . . . . . . . . . . . . .  B  ADDR  00B8H.2   A   
IPH . . . . . . . . . . . . . . . .  D  ADDR  00F2H     A   
IT01CF. . . . . . . . . . . . . . .  D  ADDR  00E4H     A   
J_. . . . . . . . . . . . . . . . .  N  NUMB  000AH     A   
JMP_WAIT_FOR_POWER_ON . . . . . . .  C  ADDR  147CH     R   SEG=?CO?BLHELI_S?17
K_. . . . . . . . . . . . . . . . .  N  NUMB  000BH     A   
L_. . . . . . . . . . . . . . . . .  N  NUMB  000CH     A   
LED_0_DONE. . . . . . . . . . . . .  C  ADDR  0DDBH     R   SEG=?CO?BLHELI_S?17
LED_1_DONE. . . . . . . . . . . . .  C  ADDR  0DE0H     R   SEG=?CO?BLHELI_S?17
LED_2_DONE. . . . . . . . . . . . .  C  ADDR  0DE5H     R   SEG=?CO?BLHELI_S?17
LED_3_DONE. . . . . . . . . . . . .  C  ADDR  0DEAH     R   SEG=?CO?BLHELI_S?17
LED_CONTROL . . . . . . . . . . . .  C  ADDR  0DD3H     R   SEG=?CO?BLHELI_S?17
LEGACY_PAGE . . . . . . . . . . . .  N  NUMB  0000H     A   
LFO0CN. . . . . . . . . . . . . . .  D  ADDR  00B1H     A   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   586

LOAD_MIN_TIME . . . . . . . . . . .  C  ADDR  0798H     R   SEG=?CO?BLHELI_S?17
LOAD_MIN_TIME_FAST. . . . . . . . .  C  ADDR  07E5H     R   SEG=?CO?BLHELI_S?17
LOW_RPM_PWR_SLOPE . . . . . . . . .  D  ADDR  003FH     R   SEG=?DT?BLHELI_S?4
M_. . . . . . . . . . . . . . . . .  N  NUMB  000DH     A   
MAI1. . . . . . . . . . . . . . . .  C  ADDR  1C84H     R   SEG=?CO?BLHELI_S?19
MAI2. . . . . . . . . . . . . . . .  C  ADDR  1CA6H     R   SEG=?CO?BLHELI_S?19
MAI4. . . . . . . . . . . . . . . .  C  ADDR  1CE0H     R   SEG=?CO?BLHELI_S?19
MAI5. . . . . . . . . . . . . . . .  C  ADDR  1D37H     R   SEG=?CO?BLHELI_S?19
MAI6. . . . . . . . . . . . . . . .  C  ADDR  1D48H     R   SEG=?CO?BLHELI_S?19
MAIN. . . . . . . . . . . . . . . .  C  ADDR  1C82H     R   SEG=?CO?BLHELI_S?19
MAX_THROTTLE_H. . . . . . . . . . .  D  ADDR  0036H     R   SEG=?DT?BLHELI_S?4
MAX_THROTTLE_L. . . . . . . . . . .  D  ADDR  0035H     R   SEG=?DT?BLHELI_S?4
MIN_THROTTLE_H. . . . . . . . . . .  D  ADDR  0032H     R   SEG=?DT?BLHELI_S?4
MIN_THROTTLE_L. . . . . . . . . . .  D  ADDR  0031H     R   SEG=?DT?BLHELI_S?4
MOTOR_STARTED . . . . . . . . . . .  N  NUMB  0002H     A   
MUX_A . . . . . . . . . . . . . . .  N  NUMB  0002H     A   
MUX_B . . . . . . . . . . . . . . .  N  NUMB  0005H     A   
MUX_C . . . . . . . . . . . . . . .  N  NUMB  0006H     A   
N_. . . . . . . . . . . . . . . . .  N  NUMB  000EH     A   
NEW_RCP . . . . . . . . . . . . . .  D  ADDR  0054H     R   SEG=?DT?BLHELI_S?4
NORMAL_RUN_CHECKS . . . . . . . . .  C  ADDR  13B3H     R   SEG=?CO?BLHELI_S?17
O_. . . . . . . . . . . . . . . . .  N  NUMB  000FH     A   
P0. . . . . . . . . . . . . . . . .  D  ADDR  0080H     A   
P0_B0 . . . . . . . . . . . . . . .  B  ADDR  0080H.0   A   
P0_B1 . . . . . . . . . . . . . . .  B  ADDR  0080H.1   A   
P0_B2 . . . . . . . . . . . . . . .  B  ADDR  0080H.2   A   
P0_B3 . . . . . . . . . . . . . . .  B  ADDR  0080H.3   A   
P0_B4 . . . . . . . . . . . . . . .  B  ADDR  0080H.4   A   
P0_B5 . . . . . . . . . . . . . . .  B  ADDR  0080H.5   A   
P0_B6 . . . . . . . . . . . . . . .  B  ADDR  0080H.6   A   
P0_B7 . . . . . . . . . . . . . . .  B  ADDR  0080H.7   A   
P0_DIGITAL. . . . . . . . . . . . .  N  NUMB  FF93H     A   
P0_INIT . . . . . . . . . . . . . .  N  NUMB  00FFH     A   
P0_PUSHPULL . . . . . . . . . . . .  N  NUMB  0000H     A   
P0_SKIP . . . . . . . . . . . . . .  N  NUMB  00FFH     A   
P0MASK. . . . . . . . . . . . . . .  D  ADDR  00FEH     A   
P0MAT . . . . . . . . . . . . . . .  D  ADDR  00FDH     A   
P0MDIN. . . . . . . . . . . . . . .  D  ADDR  00F1H     A   
P0MDOUT . . . . . . . . . . . . . .  D  ADDR  00A4H     A   
P0SKIP. . . . . . . . . . . . . . .  D  ADDR  00D4H     A   
P1. . . . . . . . . . . . . . . . .  D  ADDR  0090H     A   
P1_B0 . . . . . . . . . . . . . . .  B  ADDR  0090H.0   A   
P1_B1 . . . . . . . . . . . . . . .  B  ADDR  0090H.1   A   
P1_B2 . . . . . . . . . . . . . . .  B  ADDR  0090H.2   A   
P1_B3 . . . . . . . . . . . . . . .  B  ADDR  0090H.3   A   
P1_B4 . . . . . . . . . . . . . . .  B  ADDR  0090H.4   A   
P1_B5 . . . . . . . . . . . . . . .  B  ADDR  0090H.5   A   
P1_B6 . . . . . . . . . . . . . . .  B  ADDR  0090H.6   A   
P1_B7 . . . . . . . . . . . . . . .  B  ADDR  0090H.7   A   
P1_DIGITAL. . . . . . . . . . . . .  N  NUMB  FF8FH     A   
P1_INIT . . . . . . . . . . . . . .  N  NUMB  0000H     A   
P1_PUSHPULL . . . . . . . . . . . .  N  NUMB  0070H     A   
P1_SKIP . . . . . . . . . . . . . .  N  NUMB  00FFH     A   
P1MASK. . . . . . . . . . . . . . .  D  ADDR  00EEH     A   
P1MAT . . . . . . . . . . . . . . .  D  ADDR  00EDH     A   
P1MDIN. . . . . . . . . . . . . . .  D  ADDR  00F2H     A   
P1MDOUT . . . . . . . . . . . . . .  D  ADDR  00A5H     A   
P1SKIP. . . . . . . . . . . . . . .  D  ADDR  00D5H     A   
P2. . . . . . . . . . . . . . . . .  D  ADDR  00A0H     A   
P2_B0 . . . . . . . . . . . . . . .  B  ADDR  00A0H.0   A   
P2_B1 . . . . . . . . . . . . . . .  B  ADDR  00A0H.1   A   
P2_B2 . . . . . . . . . . . . . . .  B  ADDR  00A0H.2   A   
P2_B3 . . . . . . . . . . . . . . .  B  ADDR  00A0H.3   A   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   587

P2_PUSHPULL . . . . . . . . . . . .  N  NUMB  0001H     A   
P2MASK. . . . . . . . . . . . . . .  D  ADDR  00FCH     A   
P2MAT . . . . . . . . . . . . . . .  D  ADDR  00FBH     A   
P2MDIN. . . . . . . . . . . . . . .  D  ADDR  00F3H     A   
P2MDOUT . . . . . . . . . . . . . .  D  ADDR  00A6H     A   
P2SKIP. . . . . . . . . . . . . . .  D  ADDR  00CCH     A   
P3. . . . . . . . . . . . . . . . .  D  ADDR  00B0H     A   
P3_B0 . . . . . . . . . . . . . . .  B  ADDR  00B0H.0   A   
P3_B1 . . . . . . . . . . . . . . .  B  ADDR  00B0H.1   A   
P3MDIN. . . . . . . . . . . . . . .  D  ADDR  00F4H     A   
P3MDOUT . . . . . . . . . . . . . .  D  ADDR  009CH     A   
P_. . . . . . . . . . . . . . . . .  N  NUMB  0010H     A   
PARAH . . . . . . . . . . . . . . .     REG   R            
PARAL . . . . . . . . . . . . . . .     REG   R            
PCA0. . . . . . . . . . . . . . . .  D  ADDR  00F9H     A   
PCA0_IRQN . . . . . . . . . . . . .  N  NUMB  000BH     A   
PCA0_PAGE . . . . . . . . . . . . .  N  NUMB  0000H     A   
PCA0CENT. . . . . . . . . . . . . .  D  ADDR  009EH     A   
PCA0CLR . . . . . . . . . . . . . .  D  ADDR  009CH     A   
PCA0CN0 . . . . . . . . . . . . . .  D  ADDR  00D8H     A   
PCA0CN0_CCF0. . . . . . . . . . . .  B  ADDR  00D8H.0   A   
PCA0CN0_CCF1. . . . . . . . . . . .  B  ADDR  00D8H.1   A   
PCA0CN0_CCF2. . . . . . . . . . . .  B  ADDR  00D8H.2   A   
PCA0CN0_CF. . . . . . . . . . . . .  B  ADDR  00D8H.7   A   
PCA0CN0_CR. . . . . . . . . . . . .  B  ADDR  00D8H.6   A   
PCA0CP0 . . . . . . . . . . . . . .  D  ADDR  00FBH     A   
PCA0CP1 . . . . . . . . . . . . . .  D  ADDR  00E9H     A   
PCA0CP2 . . . . . . . . . . . . . .  D  ADDR  00EBH     A   
PCA0CPH0. . . . . . . . . . . . . .  D  ADDR  00FCH     A   
PCA0CPH1. . . . . . . . . . . . . .  D  ADDR  00EAH     A   
PCA0CPH2. . . . . . . . . . . . . .  D  ADDR  00ECH     A   
PCA0CPL0. . . . . . . . . . . . . .  D  ADDR  00FBH     A   
PCA0CPL1. . . . . . . . . . . . . .  D  ADDR  00E9H     A   
PCA0CPL2. . . . . . . . . . . . . .  D  ADDR  00EBH     A   
PCA0CPM0. . . . . . . . . . . . . .  D  ADDR  00DAH     A   
PCA0CPM1. . . . . . . . . . . . . .  D  ADDR  00DBH     A   
PCA0CPM2. . . . . . . . . . . . . .  D  ADDR  00DCH     A   
PCA0H . . . . . . . . . . . . . . .  D  ADDR  00FAH     A   
PCA0L . . . . . . . . . . . . . . .  D  ADDR  00F9H     A   
PCA0MD. . . . . . . . . . . . . . .  D  ADDR  00D9H     A   
PCA0POL . . . . . . . . . . . . . .  D  ADDR  0096H     A   
PCA0PWM . . . . . . . . . . . . . .  D  ADDR  00F7H     A   
PCA_INT . . . . . . . . . . . . . .  C  ADDR  0544H     R   SEG=?CO?BLHELI_S?17
PCA_INT_EXIT. . . . . . . . . . . .  C  ADDR  058DH     R   SEG=?CO?BLHELI_S?17
PCA_INT_HI_PWM. . . . . . . . . . .  C  ADDR  055DH     R   SEG=?CO?BLHELI_S?17
PCA_INT_SET_PWM . . . . . . . . . .  C  ADDR  0565H     R   SEG=?CO?BLHELI_S?17
PCON0 . . . . . . . . . . . . . . .  D  ADDR  0087H     A   
PCON1 . . . . . . . . . . . . . . .  D  ADDR  009AH     A   
PFE0CN. . . . . . . . . . . . . . .  D  ADDR  00C1H     A   
PG2_PAGE. . . . . . . . . . . . . .  N  NUMB  0010H     A   
PG3_PAGE. . . . . . . . . . . . . .  N  NUMB  0020H     A   
PGM_BEACON_DELAY. . . . . . . . . .  I  ADDR  009AH     R   SEG=?ID?BLHELI_S?5
PGM_BEACON_STRENGTH . . . . . . . .  I  ADDR  0099H     R   SEG=?ID?BLHELI_S?5
PGM_BEEP_STRENGTH . . . . . . . . .  I  ADDR  0098H     R   SEG=?ID?BLHELI_S?5
PGM_BIDIR . . . . . . . . . . . . .  N  NUMB  0002H     A   
PGM_BIDIR_REV . . . . . . . . . . .  N  NUMB  0001H     A   
PGM_BRAKE_ON_STOP . . . . . . . . .  I  ADDR  00A4H     R   SEG=?ID?BLHELI_S?5
PGM_CENTER_THROTTLE . . . . . . . .  I  ADDR  009EH     R   SEG=?ID?BLHELI_S?5
PGM_COMM_TIMING . . . . . . . . . .  I  ADDR  0092H     R   SEG=?ID?BLHELI_S?5
PGM_DEMAG_COMP. . . . . . . . . . .  I  ADDR  009CH     R   SEG=?ID?BLHELI_S?5
PGM_DIR_REV . . . . . . . . . . . .  N  NUMB  0000H     A   
PGM_DIRECTION . . . . . . . . . . .  I  ADDR  0088H     R   SEG=?ID?BLHELI_S?5
PGM_ENABLE_POWER_PROT . . . . . . .  I  ADDR  00A1H     R   SEG=?ID?BLHELI_S?5
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   588

PGM_ENABLE_TEMP_PROT. . . . . . . .  I  ADDR  00A0H     R   SEG=?ID?BLHELI_S?5
PGM_ENABLE_TX_PROGRAM . . . . . . .  I  ADDR  008CH     R   SEG=?ID?BLHELI_S?5
PGM_INPUT_POL . . . . . . . . . . .  I  ADDR  0089H     R   SEG=?ID?BLHELI_S?5
PGM_LED_CONTROL . . . . . . . . . .  I  ADDR  00A5H     R   SEG=?ID?BLHELI_S?5
PGM_MAX_THROTTLE. . . . . . . . . .  I  ADDR  0097H     R   SEG=?ID?BLHELI_S?5
PGM_MIN_THROTTLE. . . . . . . . . .  I  ADDR  0096H     R   SEG=?ID?BLHELI_S?5
PGM_START . . . . . . . . . . . . .  C  ADDR  0DEBH     R   SEG=?CO?BLHELI_S?17
PGM_STARTUP_PWR . . . . . . . . . .  I  ADDR  0086H     R   SEG=?ID?BLHELI_S?5
PGM_STARTUP_PWR_DECODED . . . . . .  I  ADDR  00A6H     R   SEG=?ID?BLHELI_S?5
PMATCH_IRQN . . . . . . . . . . . .  N  NUMB  0008H     A   
POLYNOM . . . . . . . . . . . . . .  N  NUMB  A001H     A   
POWER_ON_WAIT_CNT_H . . . . . . . .  D  ADDR  0038H     R   SEG=?DT?BLHELI_S?4
POWER_ON_WAIT_CNT_L . . . . . . . .  D  ADDR  0037H     R   SEG=?DT?BLHELI_S?4
POWER_PWM_REG_H . . . . . . . . . .  D  ADDR  0057H     R   SEG=?DT?BLHELI_S?4
POWER_PWM_REG_L . . . . . . . . . .  D  ADDR  0056H     R   SEG=?DT?BLHELI_S?4
PREV_COMM_H . . . . . . . . . . . .  D  ADDR  0043H     R   SEG=?DT?BLHELI_S?4
PREV_COMM_L . . . . . . . . . . . .  D  ADDR  0042H     R   SEG=?DT?BLHELI_S?4
PREV_COMM_X . . . . . . . . . . . .  D  ADDR  0044H     R   SEG=?DT?BLHELI_S?4
PREV_PREV_COMM_H. . . . . . . . . .  D  ADDR  0046H     R   SEG=?DT?BLHELI_S?4
PREV_PREV_COMM_L. . . . . . . . . .  D  ADDR  0045H     R   SEG=?DT?BLHELI_S?4
PRO3. . . . . . . . . . . . . . . .  C  ADDR  1D0BH     R   SEG=?CO?BLHELI_S?19
PRO4. . . . . . . . . . . . . . . .  C  ADDR  1D17H     R   SEG=?CO?BLHELI_S?19
PRO5. . . . . . . . . . . . . . . .  C  ADDR  1D1DH     R   SEG=?CO?BLHELI_S?19
PRO6. . . . . . . . . . . . . . . .  C  ADDR  1D32H     R   SEG=?CO?BLHELI_S?19
PROGRAM_BY_TX_CHECKED . . . . . . .  C  ADDR  1081H     R   SEG=?CO?BLHELI_S?17
PROGRAM_BY_TX_ENTRY_LIMIT . . . . .  C  ADDR  106BH     R   SEG=?CO?BLHELI_S?17
PROGRAM_BY_TX_ENTRY_STORE . . . . .  C  ADDR  1071H     R   SEG=?CO?BLHELI_S?17
PROGRAM_BY_TX_ENTRY_WAIT. . . . . .  C  ADDR  1078H     R   SEG=?CO?BLHELI_S?17
PRTDRV. . . . . . . . . . . . . . .  D  ADDR  00F6H     A   
PSCTL . . . . . . . . . . . . . . .  D  ADDR  008FH     A   
PSW . . . . . . . . . . . . . . . .  D  ADDR  00D0H     A   
PSW_AC. . . . . . . . . . . . . . .  B  ADDR  00D0H.6   A   
PSW_CY. . . . . . . . . . . . . . .  B  ADDR  00D0H.7   A   
PSW_F0. . . . . . . . . . . . . . .  B  ADDR  00D0H.5   A   
PSW_F1. . . . . . . . . . . . . . .  B  ADDR  00D0H.1   A   
PSW_OV. . . . . . . . . . . . . . .  B  ADDR  00D0H.2   A   
PSW_PARITY. . . . . . . . . . . . .  B  ADDR  00D0H.0   A   
PSW_RS0 . . . . . . . . . . . . . .  B  ADDR  00D0H.3   A   
PSW_RS1 . . . . . . . . . . . . . .  B  ADDR  00D0H.4   A   
PUT1. . . . . . . . . . . . . . . .  C  ADDR  1D58H     R   SEG=?CO?BLHELI_S?19
PUT2. . . . . . . . . . . . . . . .  C  ADDR  1D6BH     R   SEG=?CO?BLHELI_S?19
PUT3. . . . . . . . . . . . . . . .  C  ADDR  1D77H     R   SEG=?CO?BLHELI_S?19
PUT4. . . . . . . . . . . . . . . .  C  ADDR  1D89H     R   SEG=?CO?BLHELI_S?19
PUTC. . . . . . . . . . . . . . . .  C  ADDR  1D6EH     R   SEG=?CO?BLHELI_S?19
PUTP. . . . . . . . . . . . . . . .  C  ADDR  1D52H     R   SEG=?CO?BLHELI_S?19
PUTW. . . . . . . . . . . . . . . .  C  ADDR  1D4AH     R   SEG=?CO?BLHELI_S?19
PWM_LIMIT . . . . . . . . . . . . .  D  ADDR  005BH     R   SEG=?DT?BLHELI_S?4
PWM_LIMIT_BEG . . . . . . . . . . .  D  ADDR  005DH     R   SEG=?DT?BLHELI_S?4
PWM_LIMIT_BY_RPM. . . . . . . . . .  D  ADDR  005CH     R   SEG=?DT?BLHELI_S?4
Q_. . . . . . . . . . . . . . . . .  N  NUMB  0011H     A   
R_. . . . . . . . . . . . . . . . .  N  NUMB  0012H     A   
RCP_DIR_REV . . . . . . . . . . . .  N  NUMB  0005H     A   
RCP_DSHOT . . . . . . . . . . . . .  N  NUMB  0004H     A   
RCP_FULL_RANGE. . . . . . . . . . .  N  NUMB  0006H     A   
RCP_IN. . . . . . . . . . . . . . .  N  NUMB  0007H     A   
RCP_MULTISHOT . . . . . . . . . . .  N  NUMB  0003H     A   
RCP_ONESHOT125. . . . . . . . . . .  N  NUMB  0001H     A   
RCP_ONESHOT42 . . . . . . . . . . .  N  NUMB  0002H     A   
RCP_OUTSIDE_RANGE_CNT . . . . . . .  D  ADDR  0022H     R   SEG=?DT?BLHELI_S?3
RCP_STOP_CNT. . . . . . . . . . . .  D  ADDR  0055H     R   SEG=?DT?BLHELI_S?4
RCP_TIMEOUT_CNTD. . . . . . . . . .  D  ADDR  0023H     R   SEG=?DT?BLHELI_S?3
RCP_UPDATED . . . . . . . . . . . .  N  NUMB  0000H     A   
RD1 . . . . . . . . . . . . . . . .  C  ADDR  1D3CH     R   SEG=?CO?BLHELI_S?19
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   589

READ_ALL_EEPROM_PARAMETERS. . . . .  C  ADDR  147EH     R   SEG=?CO?BLHELI_S?17
READ_EEPROM_BLOCK1. . . . . . . . .  C  ADDR  14AEH     R   SEG=?CO?BLHELI_S?17
READ_EEPROM_BLOCK2. . . . . . . . .  C  ADDR  14BBH     R   SEG=?CO?BLHELI_S?17
READ_EEPROM_BYTE. . . . . . . . . .  C  ADDR  14FEH     R   SEG=?CO?BLHELI_S?17
READ_EEPROM_EXIT. . . . . . . . . .  C  ADDR  14C4H     R   SEG=?CO?BLHELI_S?17
READ_EEPROM_READ. . . . . . . . . .  C  ADDR  14A7H     R   SEG=?CO?BLHELI_S?17
READ_EEPROM_STORE_DEFAULTS. . . . .  C  ADDR  1494H     R   SEG=?CO?BLHELI_S?17
READ_INITIAL_TEMP . . . . . . . . .  C  ADDR  12DCH     R   SEG=?CO?BLHELI_S?17
READ_TAG. . . . . . . . . . . . . .  C  ADDR  154AH     R   SEG=?CO?BLHELI_S?17
READ_TAGS . . . . . . . . . . . . .  C  ADDR  1541H     R   SEG=?CO?BLHELI_S?17
REF0CN. . . . . . . . . . . . . . .  D  ADDR  00D1H     A   
REG0CN. . . . . . . . . . . . . . .  D  ADDR  00C9H     A   
REG1CN. . . . . . . . . . . . . . .  D  ADDR  00C6H     A   
RESET . . . . . . . . . . . . . . .  C  ADDR  19FDH     R   SEG=?CO?BLHELI_S?20
REVID . . . . . . . . . . . . . . .  D  ADDR  00B6H     A   
RST . . . . . . . . . . . . . . . .  C  ADDR  1CC9H     R   SEG=?CO?BLHELI_S?19
RSTSRC. . . . . . . . . . . . . . .  D  ADDR  00EFH     A   
RTX_MDIN. . . . . . . . . . . . . .  D  ADDR  00F1H     A   
RTX_MDOUT . . . . . . . . . . . . .  D  ADDR  00A4H     A   
RTX_PIN . . . . . . . . . . . . . .  N  NUMB  0007H     A   
RTX_PORT. . . . . . . . . . . . . .  D  ADDR  0080H     A   
RTX_SKIP. . . . . . . . . . . . . .  D  ADDR  00D4H     A   
RUN1. . . . . . . . . . . . . . . .  C  ADDR  132FH     R   SEG=?CO?BLHELI_S?17
RUN2. . . . . . . . . . . . . . . .  C  ADDR  133BH     R   SEG=?CO?BLHELI_S?17
RUN3. . . . . . . . . . . . . . . .  C  ADDR  1353H     R   SEG=?CO?BLHELI_S?17
RUN4. . . . . . . . . . . . . . . .  C  ADDR  135FH     R   SEG=?CO?BLHELI_S?17
RUN5. . . . . . . . . . . . . . . .  C  ADDR  136BH     R   SEG=?CO?BLHELI_S?17
RUN6. . . . . . . . . . . . . . . .  C  ADDR  1377H     R   SEG=?CO?BLHELI_S?17
RUN6_BRAKE_DONE . . . . . . . . . .  C  ADDR  1412H     R   SEG=?CO?BLHELI_S?17
RUN6_CHECK_DIR. . . . . . . . . . .  C  ADDR  13EEH     R   SEG=?CO?BLHELI_S?17
RUN6_CHECK_DIR_CHANGE . . . . . . .  C  ADDR  13FEH     R   SEG=?CO?BLHELI_S?17
RUN6_CHECK_DIR_REV. . . . . . . . .  C  ADDR  13F9H     R   SEG=?CO?BLHELI_S?17
RUN6_CHECK_SPEED. . . . . . . . . .  C  ADDR  1408H     R   SEG=?CO?BLHELI_S?17
RUN6_CHECK_TIMEOUT. . . . . . . . .  C  ADDR  13EAH     R   SEG=?CO?BLHELI_S?17
RUN_TO_WAIT_FOR_POWER_ON. . . . . .  C  ADDR  1439H     R   SEG=?CO?BLHELI_S?17
RUN_TO_WAIT_FOR_POWER_ON_BRAKE_DONE  C  ADDR  1472H     R   SEG=?CO?BLHELI_S?17
RUN_TO_WAIT_FOR_POWER_ON_FAIL . . .  C  ADDR  1431H     R   SEG=?CO?BLHELI_S?17
RUN_TO_WAIT_FOR_POWER_ON_STALL_DONE  C  ADDR  143CH     R   SEG=?CO?BLHELI_S?17
S_. . . . . . . . . . . . . . . . .  N  NUMB  0013H     A   
SBCON1. . . . . . . . . . . . . . .  D  ADDR  0094H     A   
SBRL1 . . . . . . . . . . . . . . .  D  ADDR  0095H     A   
SBRLH1. . . . . . . . . . . . . . .  D  ADDR  0096H     A   
SBRLL1. . . . . . . . . . . . . . .  D  ADDR  0095H     A   
SBUF0 . . . . . . . . . . . . . . .  D  ADDR  0099H     A   
SBUF1 . . . . . . . . . . . . . . .  D  ADDR  0092H     A   
SCALE_THROTTLE_CAL. . . . . . . . .  C  ADDR  0C57H     R   SEG=?CO?BLHELI_S?17
SCON0 . . . . . . . . . . . . . . .  D  ADDR  0098H     A   
SCON0_MCE . . . . . . . . . . . . .  B  ADDR  0098H.5   A   
SCON0_RB8 . . . . . . . . . . . . .  B  ADDR  0098H.2   A   
SCON0_REN . . . . . . . . . . . . .  B  ADDR  0098H.4   A   
SCON0_RI. . . . . . . . . . . . . .  B  ADDR  0098H.0   A   
SCON0_SMODE . . . . . . . . . . . .  B  ADDR  0098H.7   A   
SCON0_TB8 . . . . . . . . . . . . .  B  ADDR  0098H.3   A   
SCON0_TI. . . . . . . . . . . . . .  B  ADDR  0098H.1   A   
SCON1 . . . . . . . . . . . . . . .  D  ADDR  00C8H     A   
SCON1_OVR . . . . . . . . . . . . .  B  ADDR  00C8H.7   A   
SCON1_PERR. . . . . . . . . . . . .  B  ADDR  00C8H.6   A   
SCON1_RBX . . . . . . . . . . . . .  B  ADDR  00C8H.2   A   
SCON1_REN . . . . . . . . . . . . .  B  ADDR  00C8H.4   A   
SCON1_RI. . . . . . . . . . . . . .  B  ADDR  00C8H.0   A   
SCON1_TBX . . . . . . . . . . . . .  B  ADDR  00C8H.3   A   
SCON1_TI. . . . . . . . . . . . . .  B  ADDR  00C8H.1   A   
SET4. . . . . . . . . . . . . . . .  C  ADDR  1CD1H     R   SEG=?CO?BLHELI_S?19
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   590

SET5. . . . . . . . . . . . . . . .  C  ADDR  1CD7H     R   SEG=?CO?BLHELI_S?19
SET6. . . . . . . . . . . . . . . .  C  ADDR  1CDDH     R   SEG=?CO?BLHELI_S?19
SET_DEFAULT_PARAMETERS. . . . . . .  C  ADDR  0BEBH     R   SEG=?CO?BLHELI_S?17
SET_PWM_LIMIT_HIGH_RPM. . . . . . .  C  ADDR  05EAH     R   SEG=?CO?BLHELI_S?17
SET_PWM_LIMIT_HIGH_RPM_INC_LIMIT. .  C  ADDR  05FAH     R   SEG=?CO?BLHELI_S?17
SET_PWM_LIMIT_HIGH_RPM_STORE. . . .  C  ADDR  05FBH     R   SEG=?CO?BLHELI_S?17
SET_PWM_LIMIT_LOW_RPM . . . . . . .  C  ADDR  05BAH     R   SEG=?CO?BLHELI_S?17
SET_PWM_LIMIT_LOW_RPM_EXIT. . . . .  C  ADDR  05E7H     R   SEG=?CO?BLHELI_S?17
SET_STARTUP_PWM . . . . . . . . . .  C  ADDR  066BH     R   SEG=?CO?BLHELI_S?17
SETBUF. . . . . . . . . . . . . . .  C  ADDR  1CCBH     R   SEG=?CO?BLHELI_S?19
SETUP_COMM_WAIT . . . . . . . . . .  C  ADDR  09C7H     R   SEG=?CO?BLHELI_S?17
SETUP_ZC_SCAN_TIMEOUT . . . . . . .  C  ADDR  08BDH     R   SEG=?CO?BLHELI_S?17
SETUP_ZC_SCAN_TIMEOUT_STARTUP_DONE.  C  ADDR  08DAH     R   SEG=?CO?BLHELI_S?17
SFRPAGE . . . . . . . . . . . . . .  D  ADDR  00A7H     A   
SFRPGCN . . . . . . . . . . . . . .  D  ADDR  00CFH     A   
SFRSTACK. . . . . . . . . . . . . .  D  ADDR  00D7H     A   
SIGNATURE_001 . . . . . . . . . . .  N  NUMB  00E8H     A   
SIGNATURE_002 . . . . . . . . . . .  N  NUMB  00B2H     A   
SKIP_T2_INT . . . . . . . . . . . .  D  ADDR  0065H     R   SEG=?DT?BLHELI_S?4
SMB0_PAGE . . . . . . . . . . . . .  N  NUMB  0020H     A   
SMB0ADM . . . . . . . . . . . . . .  D  ADDR  00D6H     A   
SMB0ADR . . . . . . . . . . . . . .  D  ADDR  00D7H     A   
SMB0CF. . . . . . . . . . . . . . .  D  ADDR  00C1H     A   
SMB0CN0 . . . . . . . . . . . . . .  D  ADDR  00C0H     A   
SMB0CN0_ACK . . . . . . . . . . . .  B  ADDR  00C0H.1   A   
SMB0CN0_ACKRQ . . . . . . . . . . .  B  ADDR  00C0H.3   A   
SMB0CN0_ARBLOST . . . . . . . . . .  B  ADDR  00C0H.2   A   
SMB0CN0_MASTER. . . . . . . . . . .  B  ADDR  00C0H.7   A   
SMB0CN0_SI. . . . . . . . . . . . .  B  ADDR  00C0H.0   A   
SMB0CN0_STA . . . . . . . . . . . .  B  ADDR  00C0H.5   A   
SMB0CN0_STO . . . . . . . . . . . .  B  ADDR  00C0H.4   A   
SMB0CN0_TXMODE. . . . . . . . . . .  B  ADDR  00C0H.6   A   
SMB0DAT . . . . . . . . . . . . . .  D  ADDR  00C2H     A   
SMB0FCN0. . . . . . . . . . . . . .  D  ADDR  00C3H     A   
SMB0FCN1. . . . . . . . . . . . . .  D  ADDR  00C4H     A   
SMB0FCT . . . . . . . . . . . . . .  D  ADDR  00EFH     A   
SMB0RXLN. . . . . . . . . . . . . .  D  ADDR  00C5H     A   
SMB0TC. . . . . . . . . . . . . . .  D  ADDR  00ACH     A   
SMBUS0_IRQN . . . . . . . . . . . .  N  NUMB  0007H     A   
SMOD1 . . . . . . . . . . . . . . .  D  ADDR  0093H     A   
SP. . . . . . . . . . . . . . . . .  D  ADDR  0081H     A   
SPI0_IRQN . . . . . . . . . . . . .  N  NUMB  0006H     A   
SPI0_PAGE . . . . . . . . . . . . .  N  NUMB  0020H     A   
SPI0CFG . . . . . . . . . . . . . .  D  ADDR  00A1H     A   
SPI0CKR . . . . . . . . . . . . . .  D  ADDR  00A2H     A   
SPI0CN0 . . . . . . . . . . . . . .  D  ADDR  00F8H     A   
SPI0CN0_MODF. . . . . . . . . . . .  B  ADDR  00F8H.5   A   
SPI0CN0_NSSMD0. . . . . . . . . . .  B  ADDR  00F8H.2   A   
SPI0CN0_NSSMD1. . . . . . . . . . .  B  ADDR  00F8H.3   A   
SPI0CN0_RXOVRN. . . . . . . . . . .  B  ADDR  00F8H.4   A   
SPI0CN0_SPIEN . . . . . . . . . . .  B  ADDR  00F8H.0   A   
SPI0CN0_SPIF. . . . . . . . . . . .  B  ADDR  00F8H.7   A   
SPI0CN0_TXNF. . . . . . . . . . . .  B  ADDR  00F8H.1   A   
SPI0CN0_WCOL. . . . . . . . . . . .  B  ADDR  00F8H.6   A   
SPI0DAT . . . . . . . . . . . . . .  D  ADDR  00A3H     A   
SPI0FCN0. . . . . . . . . . . . . .  D  ADDR  009AH     A   
SPI0FCN1. . . . . . . . . . . . . .  D  ADDR  009BH     A   
SPI0FCT . . . . . . . . . . . . . .  D  ADDR  00F7H     A   
STALL_CNT . . . . . . . . . . . . .  D  ADDR  003CH     R   SEG=?DT?BLHELI_S?4
START_ADC_CONVERSION. . . . . . . .  C  ADDR  0600H     R   SEG=?CO?BLHELI_S?17
STARTUP_CNT . . . . . . . . . . . .  D  ADDR  0039H     R   SEG=?DT?BLHELI_S?4
STARTUP_PHASE . . . . . . . . . . .  N  NUMB  0000H     A   
STARTUP_POWER_TABLE . . . . . . . .  C  ADDR  0080H     R   SEG=?CO?BLHELI_S?17
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   591

STARTUP_ZC_TIMEOUT_CNTD . . . . . .  D  ADDR  003AH     R   SEG=?DT?BLHELI_S?4
STORE_TIMES_DECREASE. . . . . . . .  C  ADDR  085CH     R   SEG=?CO?BLHELI_S?17
STORE_TIMES_DECREASE_FAST . . . . .  C  ADDR  08AFH     R   SEG=?CO?BLHELI_S?17
STORE_TIMES_EXIT. . . . . . . . . .  C  ADDR  087DH     R   SEG=?CO?BLHELI_S?17
STORE_TIMES_INCREASE. . . . . . . .  C  ADDR  084DH     R   SEG=?CO?BLHELI_S?17
STORE_TIMES_INCREASE_FAST . . . . .  C  ADDR  08A6H     R   SEG=?CO?BLHELI_S?17
STORE_TIMES_UP_OR_DOWN. . . . . . .  C  ADDR  0847H     R   SEG=?CO?BLHELI_S?17
STORE_TIMES_UP_OR_DOWN_FAST . . . .  C  ADDR  08A0H     R   SEG=?CO?BLHELI_S?17
SUCCESS . . . . . . . . . . . . . .  N  NUMB  0030H     A   
SUCCESS_BEEP. . . . . . . . . . . .  C  ADDR  156BH     R   SEG=?CO?BLHELI_S?17
SUCCESS_BEEP_INVERTED . . . . . . .  C  ADDR  159AH     R   SEG=?CO?BLHELI_S?17
SWITCH_POWER_OFF. . . . . . . . . .  C  ADDR  0BE1H     R   SEG=?CO?BLHELI_S?17
T0_INT. . . . . . . . . . . . . . .  C  ADDR  008DH     R   SEG=?CO?BLHELI_S?17
T1_DSHOT_INC_CMD_CNT. . . . . . . .  C  ADDR  023DH     R   SEG=?CO?BLHELI_S?17
T1_DSHOT_SET_CMD. . . . . . . . . .  C  ADDR  0233H     R   SEG=?CO?BLHELI_S?17
T1_INT. . . . . . . . . . . . . . .  C  ADDR  0090H     R   SEG=?CO?BLHELI_S?17
T1_INT_BIDIR_FWD. . . . . . . . . .  C  ADDR  0258H     R   SEG=?CO?BLHELI_S?17
T1_INT_BIDIR_REV_CHK. . . . . . . .  C  ADDR  025DH     R   SEG=?CO?BLHELI_S?17
T1_INT_DECODE . . . . . . . . . . .  C  ADDR  00F2H     R   SEG=?CO?BLHELI_S?17
T1_INT_DECODE_LSB . . . . . . . . .  C  ADDR  0178H     R   SEG=?CO?BLHELI_S?17
T1_INT_DECODE_MSB . . . . . . . . .  C  ADDR  00FDH     R   SEG=?CO?BLHELI_S?17
T1_INT_FRAME_FAIL . . . . . . . . .  C  ADDR  02C8H     R   SEG=?CO?BLHELI_S?17
T1_INT_FRAME_TIME_SCALED. . . . . .  C  ADDR  00CCH     R   SEG=?CO?BLHELI_S?17
T1_INT_LSB_FAIL . . . . . . . . . .  C  ADDR  016FH     R   SEG=?CO?BLHELI_S?17
T1_INT_MSB_FAIL . . . . . . . . . .  C  ADDR  00F4H     R   SEG=?CO?BLHELI_S?17
T1_INT_NOT_BIDIR. . . . . . . . . .  C  ADDR  0269H     R   SEG=?CO?BLHELI_S?17
T1_INT_STARTUP_BOOST_STALL. . . . .  C  ADDR  029AH     R   SEG=?CO?BLHELI_S?17
T1_INT_STARTUP_BOOSTED. . . . . . .  C  ADDR  02A4H     R   SEG=?CO?BLHELI_S?17
T1_INT_XOR_OK . . . . . . . . . . .  C  ADDR  0200H     R   SEG=?CO?BLHELI_S?17
T1_INT_ZERO_RCP_CHECKED . . . . . .  C  ADDR  02B9H     R   SEG=?CO?BLHELI_S?17
T1_NORMAL_RANGE . . . . . . . . . .  C  ADDR  023FH     R   SEG=?CO?BLHELI_S?17
T2_INT. . . . . . . . . . . . . . .  C  ADDR  02D1H     R   SEG=?CO?BLHELI_S?17
T2_INT_EXIT . . . . . . . . . . . .  C  ADDR  0304H     R   SEG=?CO?BLHELI_S?17
T2_INT_RCP_STOP . . . . . . . . . .  C  ADDR  02F9H     R   SEG=?CO?BLHELI_S?17
T2_INT_START. . . . . . . . . . . .  C  ADDR  02E6H     R   SEG=?CO?BLHELI_S?17
T3_INT. . . . . . . . . . . . . . .  C  ADDR  0309H     R   SEG=?CO?BLHELI_S?17
T3_PENDING. . . . . . . . . . . . .  N  NUMB  0000H     A   
T_. . . . . . . . . . . . . . . . .  N  NUMB  0014H     A   
TCON. . . . . . . . . . . . . . . .  D  ADDR  0088H     A   
TCON_IE0. . . . . . . . . . . . . .  B  ADDR  0088H.1   A   
TCON_IE1. . . . . . . . . . . . . .  B  ADDR  0088H.3   A   
TCON_IT0. . . . . . . . . . . . . .  B  ADDR  0088H.0   A   
TCON_IT1. . . . . . . . . . . . . .  B  ADDR  0088H.2   A   
TCON_TF0. . . . . . . . . . . . . .  B  ADDR  0088H.5   A   
TCON_TF1. . . . . . . . . . . . . .  B  ADDR  0088H.7   A   
TCON_TR0. . . . . . . . . . . . . .  B  ADDR  0088H.4   A   
TCON_TR1. . . . . . . . . . . . . .  B  ADDR  0088H.6   A   
TEMP1 . . . . . . . . . . . . . . .     REG   R            
TEMP2 . . . . . . . . . . . . . . .     REG   R            
TEMP3 . . . . . . . . . . . . . . .     REG   R            
TEMP4 . . . . . . . . . . . . . . .     REG   R            
TEMP5 . . . . . . . . . . . . . . .     REG   R            
TEMP6 . . . . . . . . . . . . . . .     REG   R            
TEMP7 . . . . . . . . . . . . . . .     REG   R            
TEMP8 . . . . . . . . . . . . . . .     REG   R            
TEMP_AVERAGE_DEC. . . . . . . . . .  C  ADDR  0633H     R   SEG=?CO?BLHELI_S?17
TEMP_AVERAGE_INC. . . . . . . . . .  C  ADDR  0636H     R   SEG=?CO?BLHELI_S?17
TEMP_AVERAGE_INC_DEC. . . . . . . .  C  ADDR  0627H     R   SEG=?CO?BLHELI_S?17
TEMP_AVERAGE_UPDATED. . . . . . . .  C  ADDR  063DH     R   SEG=?CO?BLHELI_S?17
TEMP_AVERAGE_UPDATED_LOAD_ACC . . .  C  ADDR  063BH     R   SEG=?CO?BLHELI_S?17
TEMP_CHECK_EXIT . . . . . . . . . .  C  ADDR  065FH     R   SEG=?CO?BLHELI_S?17
TEMP_LIMIT. . . . . . . . . . . . .  N  NUMB  0031H     A   
TEMP_LIMIT_STEP . . . . . . . . . .  N  NUMB  0009H     A   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   592

TEMP_PROT_LIMIT . . . . . . . . . .  D  ADDR  0069H     R   SEG=?DT?BLHELI_S?4
TEMP_STORAGE. . . . . . . . . . . .  I  ADDR  00D0H     R   SEG=?ID?BLHELI_S?6
TEST_THROTTLE_GAIN. . . . . . . . .  C  ADDR  0D7FH     R   SEG=?CO?BLHELI_S?17
TEST_THROTTLE_GAIN_MULT . . . . . .  C  ADDR  0D8CH     R   SEG=?CO?BLHELI_S?17
TH0 . . . . . . . . . . . . . . . .  D  ADDR  008CH     A   
TH1 . . . . . . . . . . . . . . . .  D  ADDR  008DH     A   
THROTTLE_GAIN . . . . . . . . . . .  D  ADDR  0060H     R   SEG=?DT?BLHELI_S?4
THROTTLE_GAIN_BD_REV. . . . . . . .  D  ADDR  0062H     R   SEG=?DT?BLHELI_S?4
THROTTLE_GAIN_BD_REV_M. . . . . . .  D  ADDR  0063H     R   SEG=?DT?BLHELI_S?4
THROTTLE_GAIN_M . . . . . . . . . .  D  ADDR  0061H     R   SEG=?DT?BLHELI_S?4
THROTTLE_HIGH_CAL . . . . . . . . .  C  ADDR  0FFAH     R   SEG=?CO?BLHELI_S?17
THROTTLE_LOW_CAL. . . . . . . . . .  C  ADDR  102CH     R   SEG=?CO?BLHELI_S?17
THROTTLE_LOW_CAL_START. . . . . . .  C  ADDR  102AH     R   SEG=?CO?BLHELI_S?17
TIMER0_IRQN . . . . . . . . . . . .  N  NUMB  0001H     A   
TIMER0_X. . . . . . . . . . . . . .  D  ADDR  0040H     R   SEG=?DT?BLHELI_S?4
TIMER1_IRQN . . . . . . . . . . . .  N  NUMB  0003H     A   
TIMER2_IRQN . . . . . . . . . . . .  N  NUMB  0005H     A   
TIMER2_PAGE . . . . . . . . . . . .  N  NUMB  0010H     A   
TIMER2_X. . . . . . . . . . . . . .  D  ADDR  0041H     R   SEG=?DT?BLHELI_S?4
TIMER3_IRQN . . . . . . . . . . . .  N  NUMB  000EH     A   
TIMER3_PAGE . . . . . . . . . . . .  N  NUMB  0010H     A   
TIMER4_IRQN . . . . . . . . . . . .  N  NUMB  0013H     A   
TIMER4_PAGE . . . . . . . . . . . .  N  NUMB  0010H     A   
TL0 . . . . . . . . . . . . . . . .  D  ADDR  008AH     A   
TL1 . . . . . . . . . . . . . . . .  D  ADDR  008BH     A   
TMOD. . . . . . . . . . . . . . . .  D  ADDR  0089H     A   
TMR2. . . . . . . . . . . . . . . .  D  ADDR  00CCH     A   
TMR2CN0 . . . . . . . . . . . . . .  D  ADDR  00C8H     A   
TMR2CN0_T2SPLIT . . . . . . . . . .  B  ADDR  00C8H.3   A   
TMR2CN0_T2XCLK0 . . . . . . . . . .  B  ADDR  00C8H.0   A   
TMR2CN0_T2XCLK1 . . . . . . . . . .  B  ADDR  00C8H.1   A   
TMR2CN0_TF2CEN. . . . . . . . . . .  B  ADDR  00C8H.4   A   
TMR2CN0_TF2H. . . . . . . . . . . .  B  ADDR  00C8H.7   A   
TMR2CN0_TF2L. . . . . . . . . . . .  B  ADDR  00C8H.6   A   
TMR2CN0_TF2LEN. . . . . . . . . . .  B  ADDR  00C8H.5   A   
TMR2CN0_TR2 . . . . . . . . . . . .  B  ADDR  00C8H.2   A   
TMR2CN1 . . . . . . . . . . . . . .  D  ADDR  00FDH     A   
TMR2H . . . . . . . . . . . . . . .  D  ADDR  00CDH     A   
TMR2L . . . . . . . . . . . . . . .  D  ADDR  00CCH     A   
TMR2RL. . . . . . . . . . . . . . .  D  ADDR  00CAH     A   
TMR2RLH . . . . . . . . . . . . . .  D  ADDR  00CBH     A   
TMR2RLL . . . . . . . . . . . . . .  D  ADDR  00CAH     A   
TMR3. . . . . . . . . . . . . . . .  D  ADDR  0094H     A   
TMR3CN0 . . . . . . . . . . . . . .  D  ADDR  0091H     A   
TMR3CN1 . . . . . . . . . . . . . .  D  ADDR  00FEH     A   
TMR3H . . . . . . . . . . . . . . .  D  ADDR  0095H     A   
TMR3L . . . . . . . . . . . . . . .  D  ADDR  0094H     A   
TMR3RL. . . . . . . . . . . . . . .  D  ADDR  0092H     A   
TMR3RLH . . . . . . . . . . . . . .  D  ADDR  0093H     A   
TMR3RLL . . . . . . . . . . . . . .  D  ADDR  0092H     A   
TMR4. . . . . . . . . . . . . . . .  D  ADDR  00A4H     A   
TMR4CN0 . . . . . . . . . . . . . .  D  ADDR  0098H     A   
TMR4CN0_T4SPLIT . . . . . . . . . .  B  ADDR  0098H.3   A   
TMR4CN0_T4XCLK0 . . . . . . . . . .  B  ADDR  0098H.0   A   
TMR4CN0_T4XCLK1 . . . . . . . . . .  B  ADDR  0098H.1   A   
TMR4CN0_TF4CEN. . . . . . . . . . .  B  ADDR  0098H.4   A   
TMR4CN0_TF4H. . . . . . . . . . . .  B  ADDR  0098H.7   A   
TMR4CN0_TF4L. . . . . . . . . . . .  B  ADDR  0098H.6   A   
TMR4CN0_TF4LEN. . . . . . . . . . .  B  ADDR  0098H.5   A   
TMR4CN0_TR4 . . . . . . . . . . . .  B  ADDR  0098H.2   A   
TMR4CN1 . . . . . . . . . . . . . .  D  ADDR  00FFH     A   
TMR4H . . . . . . . . . . . . . . .  D  ADDR  00A5H     A   
TMR4L . . . . . . . . . . . . . . .  D  ADDR  00A4H     A   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   593

TMR4RL. . . . . . . . . . . . . . .  D  ADDR  00A2H     A   
TMR4RLH . . . . . . . . . . . . . .  D  ADDR  00A3H     A   
TMR4RLL . . . . . . . . . . . . . .  D  ADDR  00A2H     A   
U_. . . . . . . . . . . . . . . . .  N  NUMB  0015H     A   
UART0_IRQN. . . . . . . . . . . . .  N  NUMB  0004H     A   
UART0_PAGE. . . . . . . . . . . . .  N  NUMB  0020H     A   
UART1_IRQN. . . . . . . . . . . . .  N  NUMB  0011H     A   
UART1_PAGE. . . . . . . . . . . . .  N  NUMB  0020H     A   
UART1FCN0 . . . . . . . . . . . . .  D  ADDR  009DH     A   
UART1FCN1 . . . . . . . . . . . . .  D  ADDR  00D8H     A   
UART1FCN1_RFRQ. . . . . . . . . . .  B  ADDR  00D8H.3   A   
UART1FCN1_RIE . . . . . . . . . . .  B  ADDR  00D8H.0   A   
UART1FCN1_RXTO0 . . . . . . . . . .  B  ADDR  00D8H.1   A   
UART1FCN1_RXTO1 . . . . . . . . . .  B  ADDR  00D8H.2   A   
UART1FCN1_TFRQ. . . . . . . . . . .  B  ADDR  00D8H.7   A   
UART1FCN1_TIE . . . . . . . . . . .  B  ADDR  00D8H.4   A   
UART1FCN1_TXHOLD. . . . . . . . . .  B  ADDR  00D8H.5   A   
UART1FCN1_TXNF. . . . . . . . . . .  B  ADDR  00D8H.6   A   
UART1FCT. . . . . . . . . . . . . .  D  ADDR  00FAH     A   
UART1LIN. . . . . . . . . . . . . .  D  ADDR  009EH     A   
UART_LOOP . . . . . . . . . . . . .  N  NUMB  001AH     A   
V_. . . . . . . . . . . . . . . . .  N  NUMB  0016H     A   
VALIDATE_RCP_START. . . . . . . . .  C  ADDR  0FBBH     R   SEG=?CO?BLHELI_S?17
VDM0CN. . . . . . . . . . . . . . .  D  ADDR  00FFH     A   
W_. . . . . . . . . . . . . . . . .  N  NUMB  0017H     A   
WAIT1 . . . . . . . . . . . . . . .  C  ADDR  1DE1H     R   SEG=?CO?BLHELI_S?19
WAIT100MS . . . . . . . . . . . . .  C  ADDR  05A7H     R   SEG=?CO?BLHELI_S?17
WAIT10MS. . . . . . . . . . . . . .  C  ADDR  059FH     R   SEG=?CO?BLHELI_S?17
WAIT1MS . . . . . . . . . . . . . .  C  ADDR  0597H     R   SEG=?CO?BLHELI_S?17
WAIT1S. . . . . . . . . . . . . . .  C  ADDR  1563H     R   SEG=?CO?BLHELI_S?17
WAIT1S_LOOP . . . . . . . . . . . .  C  ADDR  1565H     R   SEG=?CO?BLHELI_S?17
WAIT200MS . . . . . . . . . . . . .  C  ADDR  05ABH     R   SEG=?CO?BLHELI_S?17
WAIT30MS. . . . . . . . . . . . . .  C  ADDR  05A3H     R   SEG=?CO?BLHELI_S?17
WAIT3MS . . . . . . . . . . . . . .  C  ADDR  059BH     R   SEG=?CO?BLHELI_S?17
WAIT_ADVANCE_TIMING . . . . . . . .  C  ADDR  07EBH     R   SEG=?CO?BLHELI_S?17
WAIT_BEFORE_ZC_SCAN . . . . . . . .  C  ADDR  08B5H     R   SEG=?CO?BLHELI_S?17
WAIT_BEFORE_ZC_SCAN_EXIT. . . . . .  C  ADDR  08F5H     R   SEG=?CO?BLHELI_S?17
WAIT_FOR_COMM . . . . . . . . . . .  C  ADDR  0A03H     R   SEG=?CO?BLHELI_S?17
WAIT_FOR_COMM_WAIT. . . . . . . . .  C  ADDR  0A37H     R   SEG=?CO?BLHELI_S?17
WAIT_FOR_COMP_OUT_HIGH. . . . . . .  C  ADDR  0906H     R   SEG=?CO?BLHELI_S?17
WAIT_FOR_COMP_OUT_LOW . . . . . . .  C  ADDR  08F6H     R   SEG=?CO?BLHELI_S?17
WAIT_FOR_COMP_OUT_START . . . . . .  C  ADDR  0914H     R   SEG=?CO?BLHELI_S?17
WAIT_FOR_LOW. . . . . . . . . . . .  C  ADDR  1C48H     R   SEG=?CO?BLHELI_S?19
WAIT_FOR_POWER_ON . . . . . . . . .  C  ADDR  10A7H     R   SEG=?CO?BLHELI_S?17
WAIT_FOR_POWER_ON_LOOP. . . . . . .  C  ADDR  10ACH     R   SEG=?CO?BLHELI_S?17
WAIT_FOR_POWER_ON_NO_BEEP . . . . .  C  ADDR  10F2H     R   SEG=?CO?BLHELI_S?17
WAIT_FOR_POWER_ON_NONZERO . . . . .  C  ADDR  110DH     R   SEG=?CO?BLHELI_S?17
WAIT_FOR_POWER_ON_NOT_MISSING . . .  C  ADDR  10FCH     R   SEG=?CO?BLHELI_S?17
WAITF . . . . . . . . . . . . . . .  C  ADDR  1DDBH     R   SEG=?CO?BLHELI_S?19
WAITH . . . . . . . . . . . . . . .  C  ADDR  1DDFH     R   SEG=?CO?BLHELI_S?19
WAITXMS_M . . . . . . . . . . . . .  C  ADDR  05B1H     R   SEG=?CO?BLHELI_S?17
WAITXMS_O . . . . . . . . . . . . .  C  ADDR  05AFH     R   SEG=?CO?BLHELI_S?17
WDTCN . . . . . . . . . . . . . . .  D  ADDR  0097H     A   
WRITE_EEPROM_BLOCK1 . . . . . . . .  C  ADDR  14E3H     R   SEG=?CO?BLHELI_S?17
WRITE_EEPROM_BLOCK2 . . . . . . . .  C  ADDR  14F0H     R   SEG=?CO?BLHELI_S?17
WRITE_EEPROM_BYTE . . . . . . . . .  C  ADDR  1502H     R   SEG=?CO?BLHELI_S?17
WRITE_EEPROM_BYTE_FROM_ACC. . . . .  C  ADDR  1503H     R   SEG=?CO?BLHELI_S?17
WRITE_EEPROM_SIGNATURE. . . . . . .  C  ADDR  1532H     R   SEG=?CO?BLHELI_S?17
WRITE_TAG . . . . . . . . . . . . .  C  ADDR  155BH     R   SEG=?CO?BLHELI_S?17
WRITE_TAGS. . . . . . . . . . . . .  C  ADDR  1554H     R   SEG=?CO?BLHELI_S?17
WT_ADV_START_H. . . . . . . . . . .  D  ADDR  004BH     R   SEG=?DT?BLHELI_S?4
WT_ADV_START_L. . . . . . . . . . .  D  ADDR  004AH     R   SEG=?DT?BLHELI_S?4
WT_COMM_START_H . . . . . . . . . .  D  ADDR  0051H     R   SEG=?DT?BLHELI_S?4
AX51 MACRO ASSEMBLER  BLHELI_S                                                              01/09/18 16:53:17 PAGE   594

WT_COMM_START_L . . . . . . . . . .  D  ADDR  0050H     R   SEG=?DT?BLHELI_S?4
WT_ZC_SCAN_START_H. . . . . . . . .  D  ADDR  004DH     R   SEG=?DT?BLHELI_S?4
WT_ZC_SCAN_START_L. . . . . . . . .  D  ADDR  004CH     R   SEG=?DT?BLHELI_S?4
WT_ZC_TOUT_START_H. . . . . . . . .  D  ADDR  004FH     R   SEG=?DT?BLHELI_S?4
WT_ZC_TOUT_START_L. . . . . . . . .  D  ADDR  004EH     R   SEG=?DT?BLHELI_S?4
XBR0. . . . . . . . . . . . . . . .  D  ADDR  00E1H     A   
XBR1. . . . . . . . . . . . . . . .  D  ADDR  00E2H     A   
XBR2. . . . . . . . . . . . . . . .  D  ADDR  00E3H     A   
XH. . . . . . . . . . . . . . . . .     REG   R            
XL. . . . . . . . . . . . . . . . .     REG   R            
XTAL. . . . . . . . . . . . . . . .  N  NUMB  017D7840H A   


REGISTER BANK(S) USED: 0 


ASSEMBLY COMPLETE.  0 WARNING(S), 0 ERROR(S).
